import{j as e,K as M,af as V,A as Te,aF as q,aG as X,au as Q,H as U,av as E,ah as W,aD as Y,d as Z,B as ee,ag as ae,a4 as se}from"./ui-vendor-e65TVV2G.js";import{d as Ae,r as i,c as _e}from"./react-vendor-C8WR5ETM.js";import{C as Fe,a as Be,b as Me,c as Ue}from"./card-Cn5ZAoHG.js";import{u as Ee,a as te,B as h,I as Ie,b as S,p as le,q as ne,r as re,s as x,m as Le}from"./index-DMfYXVru.js";import{S as ie,a as ce,b as de,c as oe,d as u}from"./select-UbAo2Q7y.js";import{T as me,a as he,b as P,c as d,d as xe,e as o}from"./table-Dy0pubuB.js";import{A as Oe,a as $e,b as He,c as ze}from"./accordion-DSbyNMjs.js";import{A as Re,a as Ge,b as Ke,c as Je,d as Ve,e as qe,g as Xe,f as Qe}from"./alert-dialog-91NyJGuj.js";import"./data-vendor-DtxkLsA5.js";const ra=()=>{const m=Ae(),{user:l,token:T,isAuthenticated:y}=Ee(),[g,je]=i.useState([]),[ue,I]=i.useState(!0),[L,k]=i.useState(null),[f,ge]=i.useState(""),[p,pe]=i.useState("all"),[w,be]=i.useState("all"),[r,j]=i.useState(1),[b,fe]=i.useState(1),[D,Ne]=i.useState(0),[ve,C]=i.useState(!1),[O,A]=i.useState(null),[_,$]=i.useState(!1),[F,ye]=i.useState({users:[]}),[B,H]=i.useState({}),N=10,c=(l==null?void 0:l.role)==="admin",z=_e.useMemo(()=>c?Object.keys(B).length>0?B:!g||g.length===0?{}:g.reduce((a,t)=>{var n;const s=t.office&&(t.office.kabkota||t.office.name)||t.pegawai&&t.pegawai.induk_unit||((n=t.pegawai)==null?void 0:n.unit_kerja)||"Lainnya";return a[s]||(a[s]=[]),a[s].push(t),a},{}):{},[c,B,g]);i.useEffect(()=>{if(!y){m("/");return}R()},[y,m,r,p,w]),i.useEffect(()=>{y&&c&&ke()},[y,c]);const R=async()=>{var a,t;try{I(!0);const s=new URLSearchParams({page:r.toString(),limit:N.toString(),...p!=="all"&&{status:p},...f&&{search:f},...c&&w!=="all"&&{created_by:w}}),n=await te(`/api/pengajuan?${s}`,T);if(n.success){if(je(n.data.data||n.data),c){const v=n.data&&n.data.grouped_by_kabkota||n.grouped_by_kabkota;H(v||{})}fe(((a=n.data.pagination)==null?void 0:a.totalPages)||1),Ne(((t=n.data.pagination)==null?void 0:t.total)||0)}else k(n.message||"Gagal mengambil data pengajuan")}catch(s){console.error("Error fetching pengajuan data:",s),k("Terjadi kesalahan saat mengambil data pengajuan")}finally{I(!1)}},ke=async()=>{try{const a=await te("/api/pengajuan/filter-options",T);a.success&&(console.log("🔍 Debug fetchFilterOptions - Response:",a.data),ye(a.data))}catch(a){console.error("Error fetching filter options:",a)}},we=a=>{ge(a),j(1)},De=a=>{pe(a),j(1)},Ce=a=>{be(a),j(1)},Se=async()=>{if(O)try{$(!0);const a=await Le(`/api/pengajuan/${O}`,T);a.success?(R(),C(!1),A(null)):k(a.message||"Gagal menghapus pengajuan")}catch(a){console.error("Error deleting pengajuan:",a),k("Terjadi kesalahan saat menghapus pengajuan")}finally{$(!1)}},G=a=>{const t={draft:{label:"Draft",className:"bg-gray-100 text-gray-800 hover:bg-gray-200",icon:se},submitted:{label:"Diajukan",className:"bg-blue-100 text-blue-800 hover:bg-blue-200",icon:M},approved:{label:"Disetujui",className:"bg-green-100 text-green-800 hover:bg-green-200",icon:U},rejected:{label:"Ditolak",className:"bg-red-100 text-red-800 hover:bg-red-200",icon:E},resubmitted:{label:"Diajukan Ulang",className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-200",icon:se}},s=t[a]||t.draft,n=s.icon;return e.jsxs(S,{className:s.className,children:[e.jsx(n,{className:"h-3 w-3 mr-1"}),s.label]})},K=a=>({guru:"Guru",eselon_iv:"Eselon IV",fungsional:"Fungsional",pelaksana:"Pelaksana"})[a]||a,J=a=>new Date(a).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"});return console.log("🔍 Debug PengajuanIndex:",{userRole:l==null?void 0:l.role,isAdmin:c,userEmail:l==null?void 0:l.email}),e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs(Fe,{children:[e.jsx(Be,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Me,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),"Daftar Pengajuan Mutasi PNS"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:c?"Semua pengajuan mutasi PNS":"Pengajuan mutasi PNS Anda"})]}),(l==null?void 0:l.role)!=="user"&&e.jsxs(h,{onClick:()=>m("/pengajuan/select"),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Tambah Pengajuan"]})]})}),e.jsxs(Ue,{children:[L&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600",children:L})}),e.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Ie,{placeholder:"Cari berdasarkan nama pegawai, jabatan, atau jenis jabatan...",value:f,onChange:a=>we(a.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-gray-400"}),e.jsxs(ie,{value:p,onValueChange:De,children:[e.jsx(ce,{className:"w-48",children:e.jsx(de,{placeholder:"Filter Status"})}),e.jsxs(oe,{children:[e.jsx(u,{value:"all",children:"Semua Status"}),e.jsx(u,{value:"draft",children:"Draft"}),e.jsx(u,{value:"submitted",children:"Diajukan"}),e.jsx(u,{value:"approved",children:"Disetujui"}),e.jsx(u,{value:"rejected",children:"Ditolak"}),e.jsx(u,{value:"resubmitted",children:"Diajukan Ulang"})]})]})]}),c&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-gray-400"}),e.jsxs(ie,{value:w,onValueChange:Ce,children:[e.jsx(ce,{className:"w-48",children:e.jsx(de,{placeholder:"Filter Pembuat"})}),e.jsxs(oe,{children:[e.jsx(u,{value:"all",children:"Semua Pembuat"}),F.users.map(a=>e.jsx(u,{value:a.id,children:a.full_name||a.email||"Unknown User"},a.id))]})]})]})]})]}),c&&Object.keys(z).length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Tergabung berdasarkan kabupaten/kota"}),e.jsx(Oe,{type:"multiple",className:"w-full",children:Object.entries(z).map(([a,t])=>e.jsxs($e,{value:a,className:"border rounded-lg",children:[e.jsx(He,{className:"px-4 py-3 hover:no-underline",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"font-medium",children:a}),e.jsx(S,{variant:"secondary",className:"ml-2",children:t.length})]})}),e.jsx(ze,{className:"px-0",children:e.jsx("div",{className:"border-t",children:e.jsxs(me,{children:[e.jsx(he,{children:e.jsxs(P,{children:[e.jsx(d,{children:"Pegawai"}),e.jsx(d,{children:"Jenis Jabatan"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Dokumen"}),e.jsx(d,{children:"Pembuat"}),e.jsx(d,{children:"Tanggal Dibuat"}),e.jsx(d,{className:"text-right",children:"Aksi"})]})}),e.jsx(xe,{children:t.map(s=>e.jsxs(P,{className:"hover:bg-gray-50",children:[e.jsx(o,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.pegawai.nama}),e.jsx("div",{className:"text-sm text-gray-500",children:s.pegawai.jabatan})]})}),e.jsx(o,{children:e.jsx(S,{variant:"outline",children:K(s.jenis_jabatan)})}),e.jsx(o,{children:G(s.status)}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:s.files.length}),e.jsx("span",{className:"text-gray-500",children:"/"}),e.jsx("span",{className:"text-sm",children:s.total_dokumen})]})}),e.jsx(o,{children:e.jsx("div",{className:"text-sm text-gray-600",children:(()=>{var v;const n=F.users.find(Pe=>Pe.id===s.created_by);return n?n.full_name||n.email||"Unknown User":(v=s.created_by)!=null&&v.includes("@")?s.created_by:"Unknown User"})()})}),e.jsx(o,{children:e.jsx("div",{className:"text-sm text-gray-600",children:J(s.created_at)})}),e.jsx(o,{className:"text-right",children:e.jsxs(le,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"sm",children:e.jsx(X,{className:"h-4 w-4"})})}),e.jsxs(re,{align:"end",children:[e.jsxs(x,{onClick:()=>m(`/pengajuan/${s.id}`),children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Lihat Detail"]}),s.status==="submitted"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{onClick:()=>m(`/pengajuan/${s.id}`),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Setujui"]}),e.jsxs(x,{onClick:()=>m(`/pengajuan/${s.id}`),children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Tolak"]})]}),e.jsxs(x,{onClick:()=>{A(s.id),C(!0)},className:"text-red-600",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Hapus"]})]})]})})]},s.id))})]})})})]},a))}),b>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Menampilkan ",(r-1)*N+1," sampai ",Math.min(r*N,D)," dari ",D," pengajuan"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>j(r-1),disabled:r===1,children:[e.jsx(Y,{className:"h-4 w-4"}),"Sebelumnya"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:b},(a,t)=>t+1).map(a=>e.jsx(h,{variant:r===a?"default":"outline",size:"sm",onClick:()=>j(a),className:"w-8 h-8 p-0",children:a},a))}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>j(r+1),disabled:r===b,children:["Selanjutnya",e.jsx(Z,{className:"h-4 w-4"})]})]})]})]}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:ue?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(ee,{className:"h-8 w-8 animate-spin mr-2"}),e.jsx("span",{children:"Memuat data pengajuan..."})]}):g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(M,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-2",children:f||p!=="all"?"Tidak ada pengajuan yang sesuai dengan filter":"Belum ada pengajuan"}),!f&&p==="all"&&(l==null?void 0:l.role)!=="user"&&e.jsxs(h,{onClick:()=>m("/pengajuan/select"),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Buat Pengajuan Pertama"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(me,{children:[e.jsx(he,{children:e.jsxs(P,{children:[e.jsx(d,{children:"Pegawai"}),e.jsx(d,{children:"Jenis Jabatan"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Dokumen"}),c&&e.jsx(d,{children:"Pembuat"}),e.jsx(d,{children:"Tanggal Dibuat"}),e.jsx(d,{className:"text-right",children:"Aksi"})]})}),e.jsx(xe,{children:g.map(a=>e.jsxs(P,{className:"hover:bg-gray-50",children:[e.jsx(o,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.pegawai.nama}),e.jsx("div",{className:"text-sm text-gray-500",children:a.pegawai.jabatan})]})}),e.jsx(o,{children:e.jsx(S,{variant:"outline",children:K(a.jenis_jabatan)})}),e.jsx(o,{children:G(a.status)}),e.jsx(o,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:a.files.length}),e.jsx("span",{className:"text-gray-500",children:"/"}),e.jsx("span",{className:"text-sm",children:a.total_dokumen})]})}),c&&e.jsx(o,{children:e.jsx("div",{className:"text-sm text-gray-600",children:(()=>{var s;const t=F.users.find(n=>n.id===a.created_by);return t?t.full_name||t.email||"Unknown User":(s=a.created_by)!=null&&s.includes("@")?a.created_by:"Unknown User"})()})}),e.jsx(o,{children:e.jsx("div",{className:"text-sm text-gray-600",children:J(a.created_at)})}),e.jsx(o,{className:"text-right",children:e.jsxs(le,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"sm",children:e.jsx(X,{className:"h-4 w-4"})})}),e.jsxs(re,{align:"end",children:[e.jsxs(x,{onClick:()=>m(`/pengajuan/${a.id}`),children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Lihat Detail"]}),(l==null?void 0:l.role)!=="user"&&e.jsxs(e.Fragment,{children:[a.status==="draft"&&e.jsxs(x,{onClick:()=>m(`/pengajuan/${a.id}/upload`),children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Upload Dokumen"]}),a.status==="rejected"&&e.jsxs(x,{onClick:()=>m(`/pengajuan/${a.id}/edit`),children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Perbaiki Dokumen"]})]}),c&&a.status==="submitted"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{onClick:()=>m(`/pengajuan/${a.id}`),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Setujui"]}),e.jsxs(x,{onClick:()=>m(`/pengajuan/${a.id}`),children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Tolak"]})]}),(c||a.status==="draft"&&(l==null?void 0:l.role)!=="user")&&e.jsxs(x,{onClick:()=>{console.log("🔍 Debug: Klik hapus untuk pengajuan:",{id:a.id,status:a.status,isAdmin:c,userRole:l==null?void 0:l.role}),A(a.id),C(!0)},className:"text-red-600",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Hapus"]})]})]})})]},a.id))})]}),b>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Menampilkan ",(r-1)*N+1," sampai ",Math.min(r*N,D)," dari ",D," pengajuan"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>j(r-1),disabled:r===1,children:[e.jsx(Y,{className:"h-4 w-4"}),"Sebelumnya"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:b},(a,t)=>t+1).map(a=>e.jsx(h,{variant:r===a?"default":"outline",size:"sm",onClick:()=>j(a),className:"w-8 h-8 p-0",children:a},a))}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>j(r+1),disabled:r===b,children:["Selanjutnya",e.jsx(Z,{className:"h-4 w-4"})]})]})]})]})})]})]}),e.jsx(Re,{open:ve,onOpenChange:C,children:e.jsxs(Ge,{children:[e.jsxs(Ke,{children:[e.jsx(Je,{children:"Hapus Pengajuan"}),e.jsx(Ve,{children:"Apakah Anda yakin ingin menghapus pengajuan ini? Tindakan ini tidak dapat dibatalkan."})]}),e.jsxs(qe,{children:[e.jsx(Xe,{disabled:_,children:"Batal"}),e.jsx(Qe,{onClick:Se,disabled:_,className:"bg-red-600 hover:bg-red-700",children:_?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"h-4 w-4 mr-2 animate-spin"}),"Menghapus..."]}):"Hapus"})]})]})})]})};export{ra as default};
//# sourceMappingURL=PengajuanIndex-C5ROoqfk.js.map
