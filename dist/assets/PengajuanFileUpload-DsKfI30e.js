import{j as a,B as J,al as ha,K as O,H as D,au as ka,ai as ja,ag as ba,N as xa,X as H,aE as fa}from"./ui-vendor-e65TVV2G.js";import{g as Na,d as wa,u as Pa,r}from"./react-vendor-C8WR5ETM.js";import{C as v,c as F,a as Sa,b as ya}from"./card-ozF6mIds.js";import{u as Da,a as Y,b as va,B as m,D as V,e as X,f as Q,g as W,j as Fa}from"./index-CAAH4E-w.js";import{P as Aa}from"./progress-CpwL3BRY.js";import{A as Ca,a as Ka,b as Ba,c as Ua,d as Ma,e as za,g as Ea,f as Ra}from"./alert-dialog-D-kdNcbF.js";import"./data-vendor-DtxkLsA5.js";const $a=i=>({surat_pengantar:"Surat Pengantar",surat_permohonan_dari_yang_bersangkutan:"Surat Permohonan Dari Yang Bersangkutan",surat_keputusan_cpns:"Surat Keputusan CPNS",surat_keputusan_pns:"Surat Keputusan PNS",surat_keputusan_kenaikan_pangkat_terakhir:"Surat Keputusan Kenaikan Pangkat Terakhir",surat_keputusan_jabatan_terakhir:"Surat Keputusan Jabatan Terakhir",skp_2_tahun_terakhir:"SKP 2 Tahun Terakhir",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan Yang Diterbitkan Inspektorat Jenderal Kementerian Agama",surat_keterangan_anjab_abk_instansi_asal:"Surat Keterangan Anjab dan ABK terhadap jabatan PNS dari instansi asal",surat_keterangan_anjab_abk_instansi_penerima:"Surat Keterangan Anjab dan ABK terhadap jabatan PNS dari instansi penerima",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan Tidak Pernah Dijatuhi Hukuman Disiplin Tingkat Sedang atau Berat Dalam 1 (satu) Tahun Terakhir Dari PPK",surat_persetujuan_mutasi_asal:"Surat Persetujuan Mutasi dari ASAL dengan menyebutkan jabatan yang akan diduduki",surat_lolos_butuh_ppk:"Surat Lolos Butuh dari Pejabat Pembina Kepegawaian instansi yang dituju",peta_jabatan:"Peta Jabatan",hasil_assessment:"Hasil Assessment",anjab_abk_instansi_asal:"Anjab/Abk Instansi Asal",anjab_abk_instansi_penerima:"Anjab/Abk Instansi Penerima",surat_keterangan_tidak_tugas_belajar:"Surat Keterangan Tidak Sedang Tugas Belajar",sptjm_pimpinan_satker_asal:"SPTJM Pimpinan Satker dari Asal",sptjm_pimpinan_satker_penerima:"SPTJM Pimpinan Satker dari Penerima",surat_rekomendasi_instansi_pembina:"Surat Rekomendasi Instansi Pembina"})[i]||i.replace(/_/g," ").toUpperCase(),qa=i=>({surat_pengantar:"Dokumen Pengantar",surat_permohonan_dari_yang_bersangkutan:"Dokumen Pengantar",surat_keputusan_cpns:"Dokumen Kepegawaian",surat_keputusan_pns:"Dokumen Kepegawaian",surat_keputusan_kenaikan_pangkat_terakhir:"Dokumen Kepegawaian",surat_keputusan_jabatan_terakhir:"Dokumen Kepegawaian",skp_2_tahun_terakhir:"Dokumen Kepegawaian",surat_keterangan_bebas_temuan_inspektorat:"Dokumen Keterangan",surat_keterangan_anjab_abk_instansi_asal:"Dokumen Keterangan",surat_keterangan_anjab_abk_instansi_penerima:"Dokumen Keterangan",surat_pernyataan_tidak_hukuman_disiplin:"Dokumen Pernyataan",surat_persetujuan_mutasi_asal:"Dokumen Persetujuan",surat_lolos_butuh_ppk:"Dokumen Persetujuan",peta_jabatan:"Dokumen Pendukung",hasil_assessment:"Dokumen Pendukung",anjab_abk_instansi_asal:"Dokumen Pendukung",anjab_abk_instansi_penerima:"Dokumen Pendukung",surat_keterangan_tidak_tugas_belajar:"Dokumen Keterangan",sptjm_pimpinan_satker_asal:"Dokumen Pernyataan",sptjm_pimpinan_satker_penerima:"Dokumen Pernyataan",surat_rekomendasi_instansi_pembina:"Dokumen Rekomendasi"})[i]||"Dokumen Lainnya",Ta=i=>({guru:"Guru",eselon_iv:"Eselon IV",fungsional:"Fungsional",pelaksana:"Pelaksana"})[i]||i,Va=()=>{var T,G;const{pengajuanId:i}=Na(),g=wa(),A=Pa(),{token:_}=Da(),[o,Z]=r.useState(null),[h,p]=r.useState([]),[aa,C]=r.useState({}),[ea,b]=r.useState({}),[sa,K]=r.useState(!1),[na,x]=r.useState(!1),[ta,B]=r.useState(!0),[U,c]=r.useState(null),[j,M]=r.useState(!1),[d,ra]=r.useState(null),[ia,f]=r.useState(!1),[la,N]=r.useState(null),z=(T=A.state)==null?void 0:T.jabatan,w=(G=A.state)==null?void 0:G.requiredFiles,[E,R]=r.useState(null);r.useEffect(()=>{i&&$()},[i]);const $=async()=>{try{B(!0);const e=await Y(`/api/pengajuan/${i}`,_);if(e.success)if(Z(e.data.pengajuan),w&&w.length>0)p(w),z&&R(z);else if(e.data.requiredFiles&&e.data.requiredFiles.length>0)p(e.data.requiredFiles);else if(e.data.pengajuan.jabatan_id)try{const s=await Y(`/api/job-type-configurations/${e.data.pengajuan.jabatan_id}`,_);s.success&&s.data.required_files?(p(s.data.required_files),R(s.data)):p(P(e.data.pengajuan.jenis_jabatan))}catch(s){console.error("Error fetching job type configuration:",s),p(P(e.data.pengajuan.jenis_jabatan))}else p(P(e.data.pengajuan.jenis_jabatan));else c(e.message||"Gagal mengambil data pengajuan")}catch(e){console.error("Error fetching pengajuan data:",e),c("Terjadi kesalahan saat mengambil data pengajuan")}finally{B(!1)}},P=e=>{const s=["surat_pengantar","surat_permohonan_dari_yang_bersangkutan","surat_keputusan_cpns","surat_keputusan_pns","surat_keputusan_kenaikan_pangkat_terakhir","surat_keputusan_jabatan_terakhir","skp_2_tahun_terakhir","surat_keterangan_bebas_temuan_inspektorat"];return{guru:["surat_pengantar","surat_permohonan_dari_yang_bersangkutan","surat_keputusan_cpns","surat_keputusan_pns","surat_keputusan_kenaikan_pangkat_terakhir","surat_keputusan_jabatan_terakhir","skp_2_tahun_terakhir","surat_keterangan_bebas_temuan_inspektorat"],eselon_iv:["surat_pengantar","surat_permohonan_dari_yang_bersangkutan","surat_keputusan_cpns","surat_keputusan_pns","surat_keputusan_kenaikan_pangkat_terakhir","surat_keputusan_jabatan_terakhir","skp_2_tahun_terakhir","surat_keterangan_bebas_temuan_inspektorat","surat_keterangan_anjab_abk_instansi_asal","surat_keterangan_anjab_abk_instansi_penerima"],fungsional:s,pelaksana:["surat_pengantar","surat_permohonan_dari_yang_bersangkutan","surat_keputusan_cpns","surat_keputusan_pns","surat_keputusan_kenaikan_pangkat_terakhir","surat_keputusan_jabatan_terakhir","skp_2_tahun_terakhir"]}[e]||s},ua=async(e,s)=>{if(s.size>512e3){c(`File terlalu besar. Maksimal 500KB. Ukuran file: ${(s.size/1024).toFixed(1)}KB`);return}C(l=>({...l,[e]:!0})),b(l=>({...l,[e]:0}));const t=new FormData;t.append("file",s),t.append("file_type",e);try{const l=setInterval(()=>{b(u=>({...u,[e]:Math.min(u[e]+10,90)}))},200),k=await fetch(`/api/pengajuan/${i}/upload`,{method:"POST",headers:{Authorization:`Bearer ${_}`},body:t});if(clearInterval(l),b(u=>({...u,[e]:100})),k.ok){const u=await k.json();u.success?(await $(),c(null)):c(u.message||"Gagal upload file")}else c("Gagal upload file")}catch(l){console.error("Error uploading file:",l),c("Terjadi kesalahan saat upload file")}finally{C(l=>({...l,[e]:!1})),N(null)}},oa=async()=>{try{M(!0);const e=await Fa(`/api/pengajuan/${i}/submit`,{catatan:""},_);e.success?K(!0):c(e.message||"Gagal submit pengajuan")}catch(e){console.error("Error submitting pengajuan:",e),c("Terjadi kesalahan saat submit pengajuan")}finally{M(!1),x(!1)}},da=async e=>{try{const s=await fetch(`/api/pengajuan/files/${e.id}`,{headers:{Authorization:`Bearer ${_}`}});if(!s.ok)throw new Error("Gagal mengambil file");const n=await s.blob(),t=URL.createObjectURL(n);ra({...e,blobUrl:t}),f(!0)}catch(s){console.error("Error previewing file:",s),c("Gagal preview file. Silakan coba lagi.")}},ca=e=>{window.open(`/api/pengajuan/files/${e.id}`,"_blank")},ma=e=>{N(e)},q=()=>h.every(e=>o==null?void 0:o.files.some(s=>s.file_type===e)),pa=e=>o!=null&&o.files.some(s=>s.file_type===e)?"uploaded":"pending",ga=e=>{const n=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+n[t]},_a=h.reduce((e,s)=>{const n=qa(s);return e[n]||(e[n]=[]),e[n].push(s),e},{});return ta?a.jsx("div",{className:"container mx-auto p-6",children:a.jsx(v,{children:a.jsxs(F,{className:"flex items-center justify-center py-12",children:[a.jsx(J,{className:"h-8 w-8 animate-spin"}),a.jsx("span",{className:"ml-2",children:"Memuat data pengajuan..."})]})})}):o?a.jsxs("div",{className:"container mx-auto p-6",children:[a.jsxs(v,{children:[a.jsxs(Sa,{children:[a.jsx(ya,{children:"Upload Berkas Pengajuan Mutasi PNS"}),a.jsxs("div",{className:"text-sm text-gray-600",children:[o.pegawai.nama," - ",o.pegawai.jabatan]}),a.jsxs("div",{className:"text-sm text-gray-500",children:["Jenis Jabatan: ",Ta(o.jenis_jabatan)]}),a.jsxs("div",{className:"text-sm text-gray-500",children:["Total Dokumen: ",E?E.max_dokumen:h.length," surat"]})]}),a.jsxs(F,{children:[U&&a.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:a.jsx("p",{className:"text-red-600",children:U})}),h.length===0?a.jsxs("div",{className:"text-center py-12",children:[a.jsx(O,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-500 mb-2",children:"Tidak ada dokumen yang diperlukan"}),a.jsx("p",{className:"text-sm text-gray-400",children:"Silakan hubungi admin untuk mengkonfigurasi dokumen yang diperlukan"})]}):Object.entries(_a).map(([e,s])=>a.jsxs("div",{className:"mb-8",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800 border-b pb-2",children:e}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:s.map(n=>{const t=pa(n),l=aa[n],k=ea[n],u=o.files.find(y=>y.file_type===n),S=la===n;return a.jsxs("div",{className:"border rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-medium text-sm leading-tight",children:$a(n)}),a.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Upload file PDF (maks. 500KB)"})]}),a.jsxs(va,{variant:"secondary",className:t==="uploaded"?"bg-green-600 text-white hover:bg-green-700":"",children:[t==="uploaded"?a.jsx(D,{className:"h-3 w-3 mr-1"}):a.jsx(O,{className:"h-3 w-3 mr-1"}),t==="uploaded"?"Uploaded":"Pending"]})]}),t==="uploaded"&&u&&!S?a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"text-sm text-green-600",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(D,{className:"h-4 w-4"}),a.jsx("span",{className:"truncate",children:u.file_name}),a.jsxs("span",{className:"text-gray-500 text-xs",children:["(",ga(u.file_size),")"]})]})}),a.jsxs("div",{className:"flex gap-2 flex-wrap",children:[a.jsxs(m,{size:"sm",variant:"outline",onClick:()=>da(u),className:"flex items-center gap-1",children:[a.jsx(ka,{className:"h-3 w-3"}),"Preview"]}),a.jsxs(m,{size:"sm",variant:"outline",onClick:()=>ca(u),className:"flex items-center gap-1",children:[a.jsx(ja,{className:"h-3 w-3"}),"Download"]}),a.jsxs(m,{size:"sm",variant:"outline",onClick:()=>ma(n),className:"flex items-center gap-1",children:[a.jsx(ba,{className:"h-3 w-3"}),"Ganti File"]})]})]}):a.jsxs("div",{children:[a.jsx("input",{type:"file",accept:".pdf",onChange:y=>{var I;const L=(I=y.target.files)==null?void 0:I[0];L&&ua(n,L)},disabled:l,className:"hidden",id:`file-${n}`}),a.jsxs("label",{htmlFor:`file-${n}`,className:"cursor-pointer inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:[a.jsx(xa,{className:"h-4 w-4 mr-2"}),l?"Uploading...":S?"Pilih File Baru":"Pilih File"]}),S&&a.jsxs(m,{size:"sm",variant:"ghost",onClick:()=>N(null),className:"ml-2 text-gray-500",children:[a.jsx(H,{className:"h-3 w-3 mr-1"}),"Batal"]})]}),l&&a.jsxs("div",{className:"mt-2",children:[a.jsx(Aa,{value:k,className:"h-2"}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[k,"% uploaded"]})]})]},n)})})]},e)),h.length>0&&a.jsxs("div",{className:"mt-8 pt-6 border-t",children:[a.jsxs(m,{onClick:()=>x(!0),disabled:!q()||j,className:"w-full bg-green-600 hover:bg-green-700 text-white",size:"lg",children:[a.jsx(fa,{className:"h-4 w-4 mr-2"}),"Submit Pengajuan"]}),!q()&&a.jsx("p",{className:"text-sm text-gray-500 mt-2 text-center",children:"Semua berkas harus diupload sebelum dapat submit"})]})]})]}),a.jsx(Ca,{open:na,onOpenChange:x,children:a.jsxs(Ka,{children:[a.jsxs(Ba,{children:[a.jsx(Ua,{children:"Submit Pengajuan"}),a.jsx(Ma,{children:"Apakah Anda yakin ingin submit pengajuan ini? Setelah disubmit, pengajuan tidak dapat diedit lagi dan akan diproses oleh admin."})]}),a.jsxs(za,{children:[a.jsx(Ea,{disabled:j,children:"Batal"}),a.jsx(Ra,{onClick:oa,disabled:j,className:"bg-green-600 hover:bg-green-700 text-white",children:j?a.jsxs(a.Fragment,{children:[a.jsx(J,{className:"h-4 w-4 mr-2 animate-spin"}),"Submitting..."]}):"Submit Pengajuan"})]})]})}),a.jsx(V,{open:sa,onOpenChange:K,children:a.jsxs(X,{children:[a.jsx(Q,{children:a.jsx(W,{children:"Pengajuan Berhasil!"})}),a.jsxs("div",{className:"text-center py-6",children:[a.jsx(D,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),a.jsxs("p",{className:"text-lg font-medium mb-2",children:["Pengajuan untuk ",o.pegawai.nama," berhasil disubmit"]}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Pengajuan akan diproses oleh admin. Anda akan mendapat notifikasi ketika status berubah."}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx(m,{onClick:()=>g("/dashboard"),className:"flex-1 bg-green-600 hover:bg-green-700 text-white",children:"Kembali ke Dashboard"}),a.jsx(m,{onClick:()=>g("/pengajuan/select"),variant:"outline",className:"flex-1",children:"Buat Pengajuan Baru"})]})]})]})}),a.jsx(V,{open:ia,onOpenChange:e=>{f(e),!e&&(d!=null&&d.blobUrl)&&URL.revokeObjectURL(d.blobUrl)},children:a.jsxs(X,{className:"max-w-4xl",children:[a.jsx(Q,{children:a.jsx(W,{className:"flex items-center justify-between",children:a.jsxs("span",{children:["Preview File: ",d==null?void 0:d.file_name]})})}),a.jsx("div",{className:"mt-4",children:d&&a.jsxs("div",{className:"border rounded-lg overflow-hidden bg-white",children:[a.jsxs("div",{className:"bg-green-600 text-white px-4 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"font-medium",children:d.file_name}),a.jsx(m,{variant:"ghost",size:"sm",onClick:()=>f(!1),className:"text-white hover:bg-green-700",children:a.jsx(H,{className:"h-4 w-4"})})]}),a.jsx("iframe",{src:d.blobUrl||`/api/pengajuan/files/${d.id}`,className:"w-full h-96 border-0",title:"File Preview"})]})})]})})]}):a.jsx("div",{className:"container mx-auto p-6",children:a.jsx(v,{children:a.jsxs(F,{className:"flex items-center justify-center py-12",children:[a.jsx(ha,{className:"h-8 w-8 text-red-500"}),a.jsx("span",{className:"ml-2 text-red-600",children:"Pengajuan tidak ditemukan"})]})})})};export{Va as default};
//# sourceMappingURL=PengajuanFileUpload-DsKfI30e.js.map
