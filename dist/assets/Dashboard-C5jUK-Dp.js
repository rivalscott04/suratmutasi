import{j as e,a0 as d,ac as K,K as R,ad as O,ae as z,af as Q,ag as V}from"./ui-vendor-BCnv6AUJ.js";import{d as W,r as l,L as E}from"./react-vendor-C8WR5ETM.js";import{u as X,a as _,S as j,B as Z,b as f}from"./index-JbRs92HN.js";import{C as p,a as b,b as N,c as w}from"./card-Cs6QZd4w.js";import{T as ee,a as te,b as S,c as h,d as ae,e as i}from"./table-CH8ZCvzV.js";const oe=()=>{const{user:r,token:x,loading:v}=X(),C=W(),[n,$]=l.useState([]),[g,L]=l.useState([]),[D,I]=l.useState(null),[Y,M]=l.useState(!1),[se,T]=l.useState(!1),[m,G]=l.useState(""),A=n.filter(t=>{var a,s,c;return((a=t.letter_number)==null?void 0:a.toLowerCase().includes(m.toLowerCase()))||((s=t.subject)==null?void 0:s.toLowerCase().includes(m.toLowerCase()))||((c=t.template_name)==null?void 0:c.toLowerCase().includes(m.toLowerCase()))});if(l.useEffect(()=>{!v&&!r&&C("/")},[r,v,C]),l.useEffect(()=>{r&&x&&(M(!0),_("/api/letters",x).then(t=>$(t.letters||[])).catch(t=>I(t.message||"Gagal fetch surat")).finally(()=>M(!1)),T(!0),_("/api/pengajuan",x).then(t=>L(t.pengajuan||[])).catch(()=>L([])).finally(()=>T(!1)))},[r,x]),v)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen",children:[e.jsx(j,{className:"h-8 w-1/2 mb-4"}),e.jsx(j,{className:"h-10 w-1/3 mb-2"}),e.jsx(j,{className:"h-10 w-1/3 mb-2"}),e.jsx(j,{className:"h-10 w-1/3 mb-2"})]});const u=(t,a)=>{if(a===0)return t>0?"+100%":"0%";const s=(t-a)/a*100;return`${s>=0?"+":""}${Math.round(s)}%`},B=(t,a)=>{const s=new Date;return s.setMonth(s.getMonth()-1),t.filter(c=>{const o=new Date(c[a]);return o.getMonth()===s.getMonth()&&o.getFullYear()===s.getFullYear()})},k=(t,a)=>{const s=new Date;return t.filter(c=>{const o=new Date(c[a]);return o.getMonth()===s.getMonth()&&o.getFullYear()===s.getFullYear()})},F=k(n,"createdAt"),y=B(n,"createdAt");k(g,"createdAt");const H=B(g,"createdAt"),U=[{title:"Total Surat",value:n.length,change:u(n.length,y.length),icon:d,color:"text-blue-600"},{title:"Surat Bulan Ini",value:F.length,change:u(F.length,y.length),icon:K,color:"text-green-600"},{title:"Pengajuan Aktif",value:g.filter(t=>t.status==="active"||t.status==="pending").length,change:u(g.filter(t=>t.status==="active"||t.status==="pending").length,H.filter(t=>t.status==="active"||t.status==="pending").length),icon:R,color:"text-purple-600"},{title:"Surat Pending",value:n.filter(t=>t.status==="draft").length,change:u(n.filter(t=>t.status==="draft").length,y.filter(t=>t.status==="draft").length),icon:O,color:"text-orange-600"}],P=Array.from(new Set(n.map(t=>t.template_name))).filter(Boolean),q=[{title:"Buat Surat Baru",description:"Mulai membuat surat dengan template yang tersedia",icon:d,href:"/generator",color:"bg-blue-500",showForRoles:["admin","operator"]},{title:"Pengajuan",description:"Buat pengajuan jabatan untuk pegawai",icon:R,href:"/pengajuan/select",color:"bg-green-500",showForRoles:["admin","operator"]},{title:"Lihat Laporan",description:"Analisis penggunaan surat",icon:V,href:"/reports",color:"bg-purple-500",showForRoles:["admin","operator","user"]}],J=t=>t==="generated"?e.jsx(f,{className:"bg-green-100 text-green-700 border-green-200",children:"Generated"}):t==="draft"?e.jsx(f,{className:"bg-orange-100 text-orange-700 border-orange-200",children:"Draft"}):t==="signed"?e.jsx(f,{className:"bg-blue-100 text-blue-700 border-blue-200",children:"Signed"}):e.jsx(f,{className:"bg-gray-100 text-gray-700 border-gray-200",children:t});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),e.jsxs("p",{className:"text-gray-600",children:["Selamat datang, ",(r==null?void 0:r.full_name)||(r==null?void 0:r.email)||"User"," - ",(r==null?void 0:r.role)||"Operator"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx("span",{children:new Date().toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:U.map((t,a)=>{const s=t.icon;return e.jsxs(p,{children:[e.jsxs(b,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(N,{className:"text-sm font-medium text-gray-600",children:t.title}),e.jsx(s,{className:`h-4 w-4 ${t.color}`})]}),e.jsxs(w,{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:t.value}),e.jsxs("p",{className:"text-xs text-gray-500",children:[e.jsx("span",{className:"text-green-600",children:t.change})," dari bulan lalu"]})]})]},a)})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:q.filter(t=>t.showForRoles.includes((r==null?void 0:r.role)||"")).map((t,a)=>{const s=t.icon;return e.jsxs(p,{className:"hover:shadow-md transition-shadow cursor-pointer",children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${t.color}`,children:e.jsx(s,{className:"h-5 w-5 text-white"})}),e.jsx("div",{children:e.jsx(N,{className:"text-lg",children:t.title})})]})}),e.jsxs(w,{children:[e.jsx("p",{className:"text-gray-600 mb-4",children:t.description}),e.jsx(Z,{asChild:!0,variant:"outline",className:"w-full",children:e.jsxs(E,{to:t.href,children:["Akses ",e.jsx(Q,{className:"ml-2 h-4 w-4"})]})})]})]},a)})}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:e.jsxs(p,{children:[e.jsx(b,{children:e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(d,{className:"w-5 h-5 text-green-700"})," Jenis Template"]})}),e.jsx(w,{children:e.jsx("div",{className:"space-y-3",children:P.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"Belum ada template surat"}):P.map((t,a)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[e.jsx(d,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"font-medium text-gray-900",children:t})]},a))})})]})}),e.jsxs(p,{className:"mb-4",children:[e.jsx(b,{children:e.jsx(N,{className:"text-xl font-semibold",children:"Daftar Surat"})}),e.jsxs(w,{children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-2",children:e.jsx("input",{type:"text",className:"input input-bordered w-full md:w-64",placeholder:"Cari nomor, perihal, atau template...",value:m,onChange:t=>G(t.target.value)})}),Y?e.jsx("div",{children:"Loading surat..."}):D?e.jsx("div",{className:"text-error",children:D}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ee,{children:[e.jsx(te,{children:e.jsxs(S,{children:[e.jsx(h,{children:"No."}),e.jsx(h,{children:"Nomor Surat"}),e.jsx(h,{children:"Perihal"}),e.jsx(h,{children:"Status"}),e.jsx(h,{children:"Aksi"})]})}),e.jsx(ae,{children:A.length===0?e.jsx(S,{children:e.jsx(i,{colSpan:5,className:"text-center",children:"Tidak ada surat"})}):A.slice(0,5).map((t,a)=>e.jsxs(S,{children:[e.jsx(i,{children:a+1}),e.jsx(i,{children:t.letter_number}),e.jsx(i,{children:t.subject}),e.jsx(i,{children:J(t.status)}),e.jsx(i,{children:e.jsxs(E,{to:`/letters/${t.id}`,className:"btn btn-xs btn-outline flex items-center gap-1",children:[e.jsx(d,{className:"w-4 h-4"})," Detail"]})})]},t.id))})]})})]})]})]})};export{oe as default};
//# sourceMappingURL=Dashboard-C5jUK-Dp.js.map
