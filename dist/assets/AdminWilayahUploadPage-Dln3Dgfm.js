import{j as e,au as Q,aF as J,_ as P,aD as I,ar as q,ap as L,a0 as U,a1 as O,aN as X,Z as H,Y as ee,aZ as ae,ae as se,aE as te}from"./ui-vendor-DiY4nm-6.js";import{r as c,g as ie,d as le}from"./react-vendor-C8WR5ETM.js";import{C as G,c as K,a as V,b as Z}from"./card-Cu65o8DU.js";import{u as Y,d as re,B as n,b as x,a as M,k as $}from"./index-9P-lsB0e.js";import{S as ne,a as ce,b as de,c as me,d as oe}from"./select-DvMzFKrW.js";import{A as xe,a as he,b as pe,c as ue,d as je,e as ge,g as fe,f as ye}from"./alert-dialog-eX3gEOOO.js";const Ne=({pengajuanId:m,jenisJabatanId:j,onFilesUploaded:o})=>{const{token:l,user:f}=Y(),{toast:y}=re(),[S,k]=c.useState([]),[h,E]=c.useState([]);c.useState([]),c.useState("");const[v,N]=c.useState({}),[z,u]=c.useState(!1),[F,T]=c.useState(!1),[R,W]=c.useState(!0),[B,g]=c.useState(null),w=async()=>{try{W(!0),g(null);let a;if(isNaN(Number(j)))try{const s=await M("/api/job-type-configurations",l);if(s!=null&&s.success&&Array.isArray(s.data)){const r=s.data.find(p=>p.jenis_jabatan===j);if(r)a=r.id;else{g("Jenis jabatan tidak ditemukan");return}}else{g("Gagal mengambil data jenis jabatan");return}}catch{g("Gagal mencari jenis jabatan");return}else a=parseInt(String(j));const t=await M(`/api/admin-wilayah-file-config/job-type/${a}`,l);t.success?k(t.data):g("Failed to fetch file configurations")}catch(a){console.error("Error fetching file configs:",a),g("Error connecting to server")}finally{W(!1)}},D=async()=>{try{E([])}catch(a){console.error("Error fetching uploaded files:",a)}};c.useEffect(()=>{j&&(w(),D())},[j,l]);const A=async(a,t)=>{N(s=>({...s,[a]:!0}));try{const s=new FormData;s.append("file",t),s.append("pengajuan_id",m),s.append("file_type",a),s.append("file_category","admin_wilayah"),s.append("uploaded_by_role","admin_wilayah"),s.append("uploaded_by_name",(f==null?void 0:f.full_name)||"Admin Wilayah"),s.append("uploaded_by_office","Kanwil Provinsi");const r=await $(`/api/admin-wilayah/pengajuan/${m}/upload`,s,l);if(r.success){const p={id:r.data.id,pengajuan_id:m,file_type:a,file_name:t.name,file_path:r.data.file_path,file_size:t.size,verification_status:"pending",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};E(b=>[...b,p]),o([...h,p]),y({title:"Success",description:"File berhasil diupload",variant:"default"})}else y({title:"Error",description:r.message||"Gagal upload file",variant:"destructive"})}catch(s){console.error("Error uploading file:",s),y({title:"Error",description:"Gagal upload file",variant:"destructive"})}finally{N(s=>({...s,[a]:!1}))}},C=async()=>{T(!0);try{y({title:"Success",description:"Files submitted for review",variant:"default"}),u(!1)}catch{y({title:"Error",description:"Failed to submit files",variant:"destructive"})}finally{T(!1)}},i=a=>{if(a===0)return"0 Bytes";const t=1024,s=["Bytes","KB","MB","GB"],r=Math.floor(Math.log(a)/Math.log(t));return parseFloat((a/Math.pow(t,r)).toFixed(2))+" "+s[r]},d=a=>h.find(s=>s.file_type===a)?"uploaded":"pending",_=a=>h.find(t=>t.file_type===a);return R?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"space-y-3",children:[...Array(5)].map((a,t)=>e.jsx("div",{className:"h-20 bg-gray-200 rounded"},t))})]})}):B?e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Q,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Files"}),e.jsx("p",{className:"text-gray-600 mb-4",children:B}),e.jsxs(n,{onClick:w,className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4"}),"Retry"]})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Upload File Admin Wilayah"}),e.jsxs(n,{onClick:()=>{w(),D()},variant:"outline",size:"sm",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Dokumen Rekomendasi"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:S.filter(a=>a.file_type.includes("rekomendasi")||a.file_type.includes("persetujuan")).map(a=>{const t=d(a.file_type),s=_(a.file_type);return e.jsx(G,{className:"border border-gray-200",children:e.jsx(K,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:a.display_name}),a.is_required&&e.jsx(x,{variant:"destructive",className:"text-xs",children:"Wajib"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Upload file PDF (maks. 500KB)"}),t==="uploaded"&&s&&e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:s.file_name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",i(s.file_size),")"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:t==="uploaded"?e.jsxs(e.Fragment,{children:[e.jsxs(x,{className:"bg-green-600 text-white flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),"Uploaded"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(n,{size:"sm",variant:"outline",className:"h-8 px-2",children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),"Preview"]}),e.jsxs(n,{size:"sm",variant:"outline",className:"h-8 px-2",children:[e.jsx(q,{className:"h-3 w-3 mr-1"}),"Download"]}),e.jsxs(n,{size:"sm",variant:"outline",className:"h-8 px-2",children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),"Ganti File"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(x,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(U,{className:"h-3 w-3"}),"Pending"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{type:"file",accept:".pdf,.doc,.docx",onChange:r=>{var b;const p=(b=r.target.files)==null?void 0:b[0];p&&A(a.file_type,p)},className:"hidden",id:`file-${a.file_type}`}),e.jsx("label",{htmlFor:`file-${a.file_type}`,children:e.jsxs(n,{disabled:v[a.file_type],size:"sm",className:"h-8 px-3 cursor-pointer bg-green-600 hover:bg-green-700 text-white",children:[v[a.file_type]?e.jsx("div",{className:"animate-spin h-3 w-3 border-2 border-white border-t-transparent rounded-full"}):e.jsx(O,{className:"h-3 w-3 mr-1"}),"Pilih File"]})})]})]})})]})})},a.id)})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Dokumen Pengantar"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:S.filter(a=>a.file_type.includes("pengantar")||a.file_type.includes("permohonan")||a.file_type.includes("keterangan")).map(a=>{const t=d(a.file_type),s=_(a.file_type);return e.jsx(G,{className:"border border-gray-200",children:e.jsx(K,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:a.display_name}),a.is_required&&e.jsx(x,{variant:"destructive",className:"text-xs",children:"Wajib"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Upload file PDF (maks. 500KB)"}),t==="uploaded"&&s&&e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(P,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:s.file_name}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",i(s.file_size),")"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:t==="uploaded"?e.jsxs(e.Fragment,{children:[e.jsxs(x,{className:"bg-green-600 text-white flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),"Uploaded"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(n,{size:"sm",variant:"outline",className:"h-8 px-2",children:[e.jsx(I,{className:"h-3 w-3 mr-1"}),"Preview"]}),e.jsxs(n,{size:"sm",variant:"outline",className:"h-8 px-2",children:[e.jsx(q,{className:"h-3 w-3 mr-1"}),"Download"]}),e.jsxs(n,{size:"sm",variant:"outline",className:"h-8 px-2",children:[e.jsx(L,{className:"h-3 w-3 mr-1"}),"Ganti File"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(x,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(U,{className:"h-3 w-3"}),"Pending"]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("input",{type:"file",accept:".pdf,.doc,.docx",onChange:r=>{var b;const p=(b=r.target.files)==null?void 0:b[0];p&&A(a.file_type,p)},className:"hidden",id:`file-${a.file_type}`}),e.jsx("label",{htmlFor:`file-${a.file_type}`,children:e.jsxs(n,{disabled:v[a.file_type],size:"sm",className:"h-8 px-3 cursor-pointer bg-green-600 hover:bg-green-700 text-white",children:[v[a.file_type]?e.jsx("div",{className:"animate-spin h-3 w-3 border-2 border-white border-t-transparent rounded-full"}):e.jsx(O,{className:"h-3 w-3 mr-1"}),"Pilih File"]})})]})]})})]})})},a.id)})})]}),h.length>0&&e.jsx("div",{className:"flex justify-end",children:e.jsxs(n,{onClick:()=>u(!0),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Submit for Review"]})}),e.jsx(xe,{open:z,onOpenChange:u,children:e.jsxs(he,{children:[e.jsxs(pe,{children:[e.jsx(ue,{children:"Submit Files for Review"}),e.jsx(je,{children:"Are you sure you want to submit all uploaded files for review? This action cannot be undone."})]}),e.jsxs(ge,{children:[e.jsx(fe,{disabled:F,children:"Cancel"}),e.jsx(ye,{onClick:C,disabled:F,className:"bg-green-600 hover:bg-green-700",children:F?"Submitting...":"Submit"})]})]})})]})},Fe=()=>{var w,D,A,C;const{pengajuanId:m}=ie(),j=le(),{token:o}=Y(),[l,f]=c.useState(null),[y,S]=c.useState(!0),[k,h]=c.useState(!1),[E,v]=c.useState([]),[N,z]=c.useState(""),u=async()=>{var i;if(!(!o||!m)){S(!0);try{const d=await M(`/api/admin-wilayah/pengajuan/${m}`,o);d&&d.success!==!1?f(d.pengajuan||((i=d.data)==null?void 0:i.pengajuan)||d):f(null)}catch(d){console.error("Failed to fetch pengajuan detail",d),f(null)}finally{S(!1)}}},F=async()=>{try{const i=await M("/api/admin-wilayah-file-config",o);if(i!=null&&i.success&&Array.isArray(i.data)){const d=new Map;i.data.forEach(a=>{var r;const t=a.jenis_jabatan_id,s=((r=a.jenis_jabatan)==null?void 0:r.jenis_jabatan)||`Jabatan ${t}`;t&&!d.has(t)&&d.set(t,s)});const _=Array.from(d.values());v(_),_.length>0&&!N&&z(_[0])}}catch(i){console.error("Failed to fetch job types:",i)}};c.useEffect(()=>{u(),F()},[m,o]);const T=i=>new Date(i).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),R=i=>{switch(i){case"approved":return e.jsx(x,{className:"bg-green-600 text-white",children:"Disetujui Kab/Kota"});case"admin_wilayah_approved":return e.jsx(x,{className:"bg-green-700 text-white",children:"Disetujui Admin Wilayah"});case"admin_wilayah_rejected":return e.jsx(x,{className:"bg-red-600 text-white",children:"Ditolak Admin Wilayah"});case"submitted":return e.jsx(x,{className:"bg-blue-600 text-white",children:"Dikirim ke Superadmin"});default:return e.jsx(x,{className:"bg-gray-600 text-white",children:i})}},W=async()=>{if(!(!o||!m)){h(!0);try{await $(`/api/admin-wilayah/pengajuan/${m}/approve`,{},o),await u()}finally{h(!1)}}},B=async()=>{if(!(!o||!m)){h(!0);try{await $(`/api/admin-wilayah/pengajuan/${m}/reject`,{rejection_reason:"Ditolak oleh Admin Wilayah"},o),await u()}finally{h(!1)}}},g=async()=>{if(!(!o||!m)){h(!0);try{await $(`/api/admin-wilayah/pengajuan/${m}/submit-to-superadmin`,{},o),await u()}finally{h(!1)}}};return y?e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})})}):l?e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(n,{variant:"outline",onClick:()=>j("/admin-wilayah/dashboard"),className:"border-green-200 text-green-700 hover:bg-green-50",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Kembali"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Upload File Admin Wilayah"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Upload file tambahan untuk pengajuan mutasi pegawai"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"bg-green-100 text-green-800",children:"Admin Wilayah"}),R(l.status)]})]}),e.jsxs(G,{className:"border-green-200 bg-green-50",children:[e.jsx(V,{children:e.jsxs(Z,{className:"text-green-800 flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"Informasi Pengajuan"]})}),e.jsx(K,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ee,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:((w=l.pegawai)==null?void 0:w.nama)||"-"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["NIP: ",((D=l.pegawai)==null?void 0:D.nip)||"-"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ae,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:((A=l.office)==null?void 0:A.kabkota)||"-"}),e.jsx("p",{className:"text-sm text-gray-600",children:((C=l.office)==null?void 0:C.name)||"-"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(U,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Jenis Jabatan"}),e.jsx("p",{className:"text-sm text-gray-600",children:l.jenis_jabatan})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(se,{className:"h-5 w-5 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:"Tanggal Pengajuan"}),e.jsx("p",{className:"text-sm text-gray-600",children:T(l.created_at)})]})]})]})]})})]}),e.jsxs(G,{children:[e.jsx(V,{children:e.jsx(Z,{className:"text-green-800",children:"Upload File Admin Wilayah"})}),e.jsxs(K,{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Jenis Berkas Admin Wilayah"}),e.jsxs(ne,{value:N,onValueChange:z,children:[e.jsx(ce,{className:"w-full max-w-md",children:e.jsx(de,{placeholder:"Pilih jenis berkas..."})}),e.jsx(me,{children:E.map(i=>e.jsx(oe,{value:i,children:i},i))})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Pilih jenis berkas yang sudah dikonfigurasi oleh superadmin"})]}),N&&e.jsx(Ne,{pengajuanId:l.id,jenisJabatanId:N,onFilesUploaded:()=>u()})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[(l.status==="approved"||l.status==="submitted")&&e.jsxs(e.Fragment,{children:[e.jsxs(n,{onClick:B,disabled:k,className:"bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Tolak"]}),e.jsxs(n,{onClick:W,disabled:k,className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Setujui"]})]}),(l.status==="admin_wilayah_approved"||l.status==="admin_wilayah_rejected")&&e.jsxs(n,{onClick:g,disabled:k,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Submit ke Superadmin"]})]})]})}):e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(U,{className:"h-16 w-16 mx-auto text-gray-300 mb-4"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Pengajuan Tidak Ditemukan"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Pengajuan yang Anda cari tidak ditemukan atau tidak memiliki akses."}),e.jsxs(n,{onClick:()=>j("/admin-wilayah/dashboard"),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Kembali ke Dashboard"]})]})})})};export{Fe as default};
//# sourceMappingURL=AdminWilayahUploadPage-Dln3Dgfm.js.map
