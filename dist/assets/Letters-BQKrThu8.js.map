{"version":3,"file":"Letters-BQKrThu8.js","sources":["../../src/pages/Letters.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { apiGet, apiDelete, apiPut } from '@/lib/api';\r\nimport { generateUrl } from '@/lib/utils';\r\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { FileText, Printer, ExternalLink, Eye, ChevronRight, Building2, Inbox, Search, Filter, Lock, Trash2, RefreshCw, Users, ClipboardList, Info, Edit3, X } from 'lucide-react';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Table, TableHeader, TableBody, TableRow, TableHead, TableCell } from '@/components/ui/table';\r\nimport { Dialog, DialogContent, DialogTitle } from '@/components/ui/dialog';\r\nimport { Template1 } from '@/components/templates/Template1';\r\nimport { Template2 } from '@/components/templates/Template2';\r\nimport { Template3 } from '@/components/templates/Template3';\r\nimport { Template4 } from '@/components/templates/Template4';\r\nimport { Template5 } from '@/components/templates/Template5';\r\nimport { Template6 } from '@/components/templates/Template6';\r\nimport { Template7 } from '@/components/templates/Template7';\r\nimport { Template8 } from '@/components/templates/Template8';\r\nimport { Template9 } from '@/components/templates/Template9';\r\nimport { apiPost } from '@/lib/api';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport SuratPreviewContainer from '@/components/SuratPreviewContainer';\r\nimport { Skeleton } from '@/components/ui/skeleton';\r\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from '@/components/ui/accordion';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { PegawaiSearchInput } from '@/components/PegawaiSearchInput';\r\n\r\nconst Letters: React.FC = () => {\r\n  const { token, user } = useAuth();\r\n  const [letters, setLetters] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [search, setSearch] = useState('');\r\n  const [sortBy, setSortBy] = useState<'letter_number'|'template_name'|'tanggal'|'status'>('letter_number');\r\n  const [sortDir, setSortDir] = useState<'asc'|'desc'>('asc');\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [pageSize, setPageSize] = useState(10);\r\n  const [activeTab, setActiveTab] = useState<'all'|'with-employee'|'without-employee'>('all');\r\n  \r\n  const { toast } = useToast();\r\n  const [selectedPegawaiNip, setSelectedPegawaiNip] = useState<string | null>(null);\r\n  const [selectedLetterId, setSelectedLetterId] = useState<string | null>(null);\r\n  const [pegawaiLetters, setPegawaiLetters] = useState<any[]>([]);\r\n  const [modalOpen, setModalOpen] = useState(false);\r\n  const [selectedLetterForPreview, setSelectedLetterForPreview] = useState<any>(null);\r\n  const [pdfLoading, setPdfLoading] = useState(false);\r\n  const [pdfUrl, setPdfUrl] = useState<string | null>(null);\r\n  const [expandedPegawai, setExpandedPegawai] = useState<string | null>(null);\r\n  const [expandedSurat, setExpandedSurat] = useState<string | null>(null);\r\n\r\n  // State untuk pagination per kantor\r\n  const [officePaging, setOfficePaging] = useState<Record<string, { currentPage: number; pageSize: number }>>({});\r\n  // State untuk mapping officeId -> nama kantor/kabkota\r\n  const [officeMap, setOfficeMap] = useState<Record<string, { namakantor?: string; kabkota?: string }>>({});\r\n\r\n  // Tambahkan state untuk modal edit pejabat & pegawai\r\n  const [editLetter, setEditLetter] = useState<any>(null);\r\n  const [editPejabat, setEditPejabat] = useState<any>(null);\r\n  const [editPegawai, setEditPegawai] = useState<any>(null);\r\n  const [editSaving, setEditSaving] = useState(false);\r\n\r\n  const navigate = useNavigate();\r\n  const [showSessionExpiredModal, setShowSessionExpiredModal] = useState(false);\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n  const [letterToDelete, setLetterToDelete] = useState<any>(null);\r\n  const [deleting, setDeleting] = useState(false);\r\n  \r\n  // Bulk selection state\r\n  const [selectedLetters, setSelectedLetters] = useState<string[]>([]);\r\n  const [selectAll, setSelectAll] = useState(false);\r\n  const [showBulkDeleteModal, setShowBulkDeleteModal] = useState(false);\r\n  const [bulkDeleting, setBulkDeleting] = useState(false);\r\n\r\n  // Filter letters berdasarkan search\r\n  const filteredLetters = letters.filter(l =>\r\n    l.letter_number?.toLowerCase().includes(search.toLowerCase()) ||\r\n    l.template_name?.toLowerCase().includes(search.toLowerCase()) ||\r\n    l.office?.namakantor?.toLowerCase().includes(search.toLowerCase()) ||\r\n    l.office?.kabkota?.toLowerCase().includes(search.toLowerCase())\r\n  );\r\n\r\n  // Filter letters berdasarkan tab\r\n  const getFilteredLettersByTab = () => {\r\n    switch (activeTab) {\r\n      case 'with-employee':\r\n        return filteredLetters.filter(l => ![2, 9].includes(l.template_id));\r\n      case 'without-employee':\r\n        return filteredLetters.filter(l => [2, 9].includes(l.template_id));\r\n      default:\r\n        return filteredLetters;\r\n    }\r\n  };\r\n\r\n  const tabFilteredLetters = getFilteredLettersByTab();\r\n\r\n  // Sort letters\r\n  const sortedLetters = [...tabFilteredLetters].sort((a, b) => {\r\n    let aVal = a[sortBy] || '';\r\n    let bVal = b[sortBy] || '';\r\n    if (sortBy === 'tanggal') {\r\n      aVal = a.form_data?.tanggal || '';\r\n      bVal = b.form_data?.tanggal || '';\r\n    }\r\n    if (sortDir === 'asc') return String(aVal).localeCompare(String(bVal));\r\n    return String(bVal).localeCompare(String(aVal));\r\n  });\r\n\r\n  // Group surat by office (dengan fallback mapping office_id)\r\n  const groupedByOffice: Record<string, any[]> = sortedLetters.reduce((acc, surat) => {\r\n    let officeName = surat.office?.namakantor || surat.office?.kabkota;\r\n    if (!officeName && surat.office_id && officeMap[surat.office_id]) {\r\n      officeName = officeMap[surat.office_id].namakantor || officeMap[surat.office_id].kabkota;\r\n    }\r\n    if (!officeName) officeName = 'Kantor Tidak Diketahui';\r\n    if (!acc[officeName]) acc[officeName] = [];\r\n    acc[officeName].push(surat);\r\n    return acc;\r\n  }, {});\r\n \r\n  // Filter grouped by search\r\n  const filteredGrouped: [string, any[]][] = Object.entries(groupedByOffice).filter(([officeName, suratList]) => {\r\n    if (!search) return true;\r\n    return officeName.toLowerCase().includes(search.toLowerCase()) ||\r\n      suratList.some(surat => surat.letter_number.toLowerCase().includes(search.toLowerCase()));\r\n  });\r\n  \r\n  useEffect(() => {\r\n    if (!token) return;\r\n    setLoading(true);\r\n    apiGet('/api/letters', token)\r\n      .then(res => setLetters(res.letters || []))\r\n      .catch((err) => {\r\n        if (err.message && (err.message.includes('Invalid or expired token') || err.message.includes('401'))) {\r\n          setShowSessionExpiredModal(true);\r\n        } else {\r\n          setError('Gagal mengambil data surat');\r\n        }\r\n      })\r\n      .finally(() => setLoading(false));\r\n  }, [token]);\r\n\r\n  // Fetch offices saat mount\r\n  useEffect(() => {\r\n    if (!token) return;\r\n    apiGet('/api/offices', token)\r\n      .then(res => {\r\n        const map: Record<string, { namakantor?: string; kabkota?: string }> = {};\r\n        (res.offices || []).forEach((office: any) => {\r\n          map[office.id] = { namakantor: office.namakantor, kabkota: office.kabkota };\r\n        });\r\n        setOfficeMap(map);\r\n      })\r\n      .catch(() => {});\r\n  }, [token]);\r\n\r\n  // Ringkasan\r\n  const byStatus = (status: string) => letters.filter(l => l.status === status).length;\r\n  const total = letters.length;\r\n  const mostTemplate = letters.length > 0 ? \r\n    letters.reduce((acc, l) => {\r\n      acc[l.template_name] = (acc[l.template_name] || 0) + 1;\r\n      return acc;\r\n    }, {} as Record<string, number>) : {};\r\n  const mostTemplateName = Object.keys(mostTemplate).length > 0 ? \r\n    Object.entries(mostTemplate).sort(([,a], [,b]) => (b as number) - (a as number))[0][0] : 'Tidak ada data';\r\n  \r\n  // Find most recent letter\r\n  const getMostRecentLetter = () => {\r\n    if (letters.length === 0) return null;\r\n    return letters.reduce((latest, current) => {\r\n      const latestDate = new Date(latest.created_at || 0);\r\n      const currentDate = new Date(current.created_at || 0);\r\n      return currentDate > latestDate ? current : latest;\r\n    });\r\n  };\r\n  \r\n  const mostRecentLetter = getMostRecentLetter();\r\n  const getMostRecentOffice = () => {\r\n    if (!mostRecentLetter) return 'Tidak ada data';\r\n    \r\n    // Get office name from kode_kabko\r\n    const getOfficeNameFromKode = (kode: string) => {\r\n      const officeMap: Record<string, string> = {\r\n        '01': 'KOTA MATARAM',\r\n        '02': 'KABUPATEN LOMBOK BARAT',\r\n        '03': 'KABUPATEN LOMBOK TENGAH',\r\n        '04': 'KABUPATEN LOMBOK TIMUR',\r\n        '05': 'KABUPATEN SUMBAWA',\r\n        '06': 'KABUPATEN DOMPU',\r\n        '07': 'KOTA MATARAM',\r\n        '08': 'KABUPATEN BIMA',\r\n        '09': 'KOTA BIMA',\r\n        '10': 'KABUPATEN SUMBAWA BARAT',\r\n        '11': 'KABUPATEN LOMBOK UTARA',\r\n        '12': 'KABUPATEN LOMBOK TENGAH',\r\n        '13': 'KABUPATEN LOMBOK TIMUR',\r\n        '14': 'KABUPATEN SUMBAWA',\r\n        '15': 'KABUPATEN DOMPU',\r\n        '16': 'KABUPATEN BIMA',\r\n        '17': 'KOTA BIMA',\r\n        '18': 'KABUPATEN SUMBAWA BARAT',\r\n        '19': 'KABUPATEN LOMBOK UTARA',\r\n        '20': 'KABUPATEN LOMBOK TENGAH'\r\n      };\r\n      return officeMap[kode] || 'Kantor Tidak Diketahui';\r\n    };\r\n    \r\n    const officeName = mostRecentLetter.office?.namakantor || \r\n                      mostRecentLetter.office?.kabkota || \r\n                      getOfficeNameFromKode(mostRecentLetter.form_data?.kode_kabko || mostRecentLetter.office?.kode_kabko || '') ||\r\n                      'Kantor Tidak Diketahui';\r\n    \r\n    const timeAgo = mostRecentLetter.created_at ? \r\n      new Date(mostRecentLetter.created_at).toLocaleDateString('id-ID', { \r\n        day: 'numeric', \r\n        month: 'short', \r\n        hour: '2-digit', \r\n        minute: '2-digit' \r\n      }) : 'Tidak diketahui';\r\n    return `${officeName} (${timeAgo})`;\r\n  };\r\n\r\n  // Helper badge status\r\n  const getStatusBadge = (status: string) => {\r\n    if (status === 'generated') return <Badge className=\"bg-green-100 text-green-700 border-green-200\">Generated</Badge>;\r\n    if (status === 'signed') return <Badge className=\"bg-blue-100 text-blue-700 border-blue-200\">Signed</Badge>;\r\n    return null; // Hilangkan badge Draft\r\n  };\r\n\r\n  const handleShowPegawaiLetters = async (nip: string, letterId: string) => {\r\n    if (selectedPegawaiNip === nip && selectedLetterId === letterId) {\r\n      setSelectedPegawaiNip(null);\r\n      setSelectedLetterId(null);\r\n      setPegawaiLetters([]);\r\n      return;\r\n    }\r\n    setSelectedPegawaiNip(nip);\r\n    setSelectedLetterId(letterId);\r\n    try {\r\n      const res = await apiGet(`/api/letters?recipient_employee_nip=${nip}`, token);\r\n      setPegawaiLetters(res.letters || []);\r\n    } catch (err) {\r\n      toast({ title: 'Gagal mengambil data surat pegawai', description: 'Terjadi kesalahan saat mengambil data', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  // Render preview surat sesuai template\r\n  const renderPreviewByTemplate = (letter: any) => {\r\n    let data = letter.form_data;\r\n    if (typeof data === 'string') {\r\n      try { data = JSON.parse(data); } catch { data = {}; }\r\n    }\r\n    if (!data) return <div className=\"text-error\">Data surat tidak ditemukan</div>;\r\n    \r\n\r\n    \r\n    const id = String(letter.template_id);\r\n    // Fallback nomor surat universal (pakai regex agar tidak kosong setelah B-)\r\n    const nomorParts = (letter.letter_number || '').split('/');\r\n    const matchNoSurat = letter.letter_number?.match(/^B-([^/]+)/);\r\n    const fallback = {\r\n      nosrt: data.nosrt || (matchNoSurat ? matchNoSurat[1] : ''),\r\n      nosurat: data.nosurat || (matchNoSurat ? matchNoSurat[1] : ''),\r\n      blnno: data.blnno || nomorParts[5] || '',\r\n      blnnomor: data.blnnomor || nomorParts[5] || '',\r\n      thnno: data.thnno || nomorParts[6] || '',\r\n      tahunskrg: data.tahunskrg || nomorParts[6] || '',\r\n    };\r\n    const mergedData = { ...data, ...fallback };\r\n    \r\n    // Ensure unitkerja is preserved for Template 2\r\n    if (letter.template_id === 2 && data.unitkerja) {\r\n      mergedData.unitkerja = data.unitkerja;\r\n    }\r\n    \r\n    if (id === '1') return <Template1 data={mergedData} />;\r\n    if (id === '2') return <Template2 data={mergedData} />;\r\n    if (id === '3') return <Template3 data={mergedData} />;\r\n    if (id === '4') return <Template4 data={mergedData} />;\r\n    if (id === '5') return <Template5 data={mergedData} />;\r\n    if (id === '6') return <Template6 data={mergedData} />;\r\n    if (id === '7') return <Template7 data={mergedData} />;\r\n    if (id === '8') return <Template8 data={mergedData} />;\r\n    if (id === '9') return <Template9 data={mergedData} />;\r\n    return <div className=\"text-error\">Template tidak dikenali</div>;\r\n  };\r\n\r\n  const handleGeneratePdf = async (letterId: string) => {\r\n    setPdfLoading(true);\r\n    try {\r\n      const res = await apiPost(`/api/letters/${letterId}/generate-pdf`, {}, token);\r\n      setPdfUrl(res.file?.file_path || res.file_path);\r\n      toast({ title: 'PDF berhasil digenerate', description: 'Klik link untuk mengunduh.' });\r\n    } catch (err: any) {\r\n      toast({ title: 'Gagal generate PDF', description: err.message || 'Terjadi kesalahan', variant: 'destructive' });\r\n    } finally {\r\n      setPdfLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteLetter = async (letter: any) => {\r\n    // Check if user can delete this letter\r\n    const canDelete = user?.role === 'admin' || letter.created_by === user?.id;\r\n    \r\n    if (!canDelete) {\r\n      toast({ \r\n        title: 'Tidak dapat menghapus surat', \r\n        description: 'Anda hanya dapat menghapus surat yang Anda buat sendiri.',\r\n        variant: 'destructive'\r\n      });\r\n      return;\r\n    }\r\n    \r\n    setLetterToDelete(letter);\r\n    setShowDeleteModal(true);\r\n  };\r\n\r\n  // Fungsi untuk handle edit\r\n  const handleEditPejabatPegawai = (letter: any) => {\r\n    setEditLetter(letter);\r\n    setEditPejabat(null);\r\n    setEditPegawai(null);\r\n  };\r\n\r\n  // Fungsi untuk simpan perubahan\r\n  const handleSaveEditPejabatPegawai = async () => {\r\n    if (!editLetter || !editPejabat) return;\r\n    // Untuk template 2 dan 9, tidak perlu pegawai\r\n    if (editLetter.template_id !== 2 && editLetter.template_id !== 9 && !editPegawai) return;\r\n    setEditSaving(true);\r\n    try {\r\n      // Ambil data surat yang ada\r\n      const currentFormData = editLetter.form_data;\r\n      const templateId = editLetter.template_id;\r\n      \r\n      // Update data sesuai kebutuhan template\r\n      const updatedFormData = {\r\n        ...currentFormData,\r\n        // Update data pejabat (selalu ada untuk semua template)\r\n        namapejabat: editPejabat.nama || '',\r\n        nippejabat: editPejabat.nip || '',\r\n        pangkatgolpejabat: editPejabat.pangkat_gol || '',\r\n        jabatanpejabat: editPejabat.jabatan || '',\r\n      };\r\n\r\n      // Update data pegawai sesuai template (kecuali template 2 & 9)\r\n      if (templateId !== 2 && templateId !== 9 && editPegawai) {\r\n        updatedFormData.namapegawai = editPegawai.nama || '';\r\n        updatedFormData.nippegawai = editPegawai.nip || '';\r\n        updatedFormData.pangkatgolpegawai = editPegawai.pangkat_gol || '';\r\n        updatedFormData.jabatanpegawai = editPegawai.jabatan || '';\r\n      }\r\n      \r\n      // Untuk template 2 dan 9, hapus field pegawai jika ada\r\n      if (templateId === 2 || templateId === 9) {\r\n        delete updatedFormData.namapegawai;\r\n        delete updatedFormData.nippegawai;\r\n        delete updatedFormData.pangkatgolpegawai;\r\n        delete updatedFormData.jabatanpegawai;\r\n        delete updatedFormData.ukerpegawai;\r\n      }\r\n\r\n             // Update field spesifik sesuai template\r\n       switch (templateId) {\r\n         case 1: // Template 1: Surat Pernyataan Tidak Sedang Menjalani Tugas Belajar\r\n           updatedFormData.ukerpejabat = editPejabat.unit_kerja || '';\r\n           if (editPegawai) updatedFormData.ukerpegawai = editPegawai.unit_kerja || '';\r\n           break;\r\n         \r\n         case 2: // Template 2: Surat Keterangan Analisis Jabatan (tanpa pegawai)\r\n           // Template 2 tidak memerlukan update field pegawai\r\n           break;\r\n         \r\n         case 3: // Template 3: Surat Keterangan Pengalaman Mengajar\r\n           if (editPegawai) updatedFormData.tempattugas = editPegawai.tempat_tugas || '';\r\n           break;\r\n         \r\n         case 4: // Template 4: Surat Permohonan SKBT\r\n           if (editPegawai) updatedFormData.unitkerja = editPegawai.unit_kerja || '';\r\n           break;\r\n         \r\n         case 5: // Template 5: Surat Pernyataan Tidak Sedang Dalam Proses Hukuman Disiplin\r\n           updatedFormData.ukerpejabat = editPejabat.unit_kerja || '';\r\n           if (editPegawai) updatedFormData.tempattugas = editPegawai.tempat_tugas || '';\r\n           break;\r\n         \r\n         case 6: // Template 6: Surat Pernyataan Tidak Sedang Menjalani Proses Pidana\r\n           updatedFormData.ukerpejabat = editPejabat.unit_kerja || '';\r\n           if (editPegawai) updatedFormData.ukerpegawai = editPegawai.unit_kerja || '';\r\n           break;\r\n         \r\n         case 7: // Template 7: Surat Persetujuan Pelepasan\r\n           if (editPegawai) updatedFormData.tempattugas = editPegawai.tempat_tugas || '';\r\n           break;\r\n         \r\n         case 8: // Template 8: Surat Keterangan Jabatan Baru\r\n           if (editPegawai) updatedFormData.tempattugas = editPegawai.tempat_tugas || '';\r\n           break;\r\n         \r\n         case 9: // Template 9: Surat Pernyataan (tanpa pegawai)\r\n           updatedFormData.ukerpejabat = editPejabat.unit_kerja || '';\r\n           break;\r\n       }\r\n\r\n      // Kirim update ke backend\r\n      await apiPut(`/api/letters/${editLetter.id}`, {\r\n        form_data: updatedFormData\r\n      }, token);\r\n\r\n      // Refresh data\r\n      await refreshData();\r\n      \r\n      // Reset state\r\n      setEditLetter(null);\r\n      setEditPejabat(null);\r\n      setEditPegawai(null);\r\n      \r\n      // Show success message\r\n      toast({\r\n        title: \"Berhasil\",\r\n        description: \"Data pejabat dan pegawai berhasil diperbarui\",\r\n      });\r\n    } catch (error) {\r\n      console.error('Error updating letter:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Gagal memperbarui data surat\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setEditSaving(false);\r\n    }\r\n  };\r\n\r\n  // Bulk selection functions\r\n  const handleSelectLetter = (letterId: string, checked: boolean) => {\r\n    if (checked) {\r\n      setSelectedLetters(prev => [...prev, letterId]);\r\n    } else {\r\n      setSelectedLetters(prev => prev.filter(id => id !== letterId));\r\n    }\r\n  };\r\n\r\n  const handleSelectAll = (checked: boolean) => {\r\n    setSelectAll(checked);\r\n    if (checked) {\r\n      // Get all letters from all visible offices that user can delete\r\n      const allVisibleLetters = filteredGrouped.flatMap(([officeName, officeLetters]) => officeLetters);\r\n      const deletableLetters = allVisibleLetters.filter(letter => \r\n        user?.role === 'admin' || letter.created_by === user?.id\r\n      );\r\n      setSelectedLetters(deletableLetters.map(letter => letter.id));\r\n    } else {\r\n      setSelectedLetters([]);\r\n    }\r\n  };\r\n\r\n  const handleBulkDelete = () => {\r\n    if (selectedLetters.length === 0) {\r\n      toast({ \r\n        title: 'Tidak ada surat dipilih', \r\n        description: 'Pilih surat yang akan dihapus terlebih dahulu.',\r\n        variant: 'destructive'\r\n      });\r\n      return;\r\n    }\r\n    setShowBulkDeleteModal(true);\r\n  };\r\n\r\n  const confirmBulkDelete = async () => {\r\n    setBulkDeleting(true);\r\n    try {\r\n      // Delete letters one by one\r\n      for (const letterId of selectedLetters) {\r\n        await apiDelete(`/api/letters/${letterId}`, token);\r\n      }\r\n      \r\n      toast({ \r\n        title: 'Surat berhasil dihapus', \r\n        description: `${selectedLetters.length} surat telah dihapus dari sistem.`,\r\n        duration: 3000\r\n      });\r\n      \r\n      // Reset selection\r\n      setSelectedLetters([]);\r\n      setSelectAll(false);\r\n      setShowBulkDeleteModal(false);\r\n      \r\n      // Refresh data\r\n      await refreshData();\r\n      \r\n      // Reset pagination state\r\n      setOfficePaging({});\r\n      \r\n      // Reset search jika ada\r\n      if (search) {\r\n        setSearch('');\r\n      }\r\n    } catch (err: any) {\r\n      toast({ \r\n        title: 'Gagal menghapus surat', \r\n        description: err.message || 'Terjadi kesalahan', \r\n        variant: 'destructive',\r\n        duration: 5000\r\n      });\r\n    } finally {\r\n      setBulkDeleting(false);\r\n    }\r\n  };\r\n\r\n  const refreshData = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const res = await apiGet('/api/letters', token);\r\n      setLetters(res.letters || []);\r\n    } catch (err: any) {\r\n      setError('Gagal mengambil data surat');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const confirmDelete = async () => {\r\n    if (!letterToDelete) return;\r\n    \r\n    setDeleting(true);\r\n    try {\r\n      await apiDelete(`/api/letters/${letterToDelete.id}`, token);\r\n      \r\n      toast({ \r\n        title: 'Surat berhasil dihapus', \r\n        description: 'Surat telah dihapus dari sistem.',\r\n        duration: 3000\r\n      });\r\n      \r\n      // Refresh data\r\n      await refreshData();\r\n      \r\n      // Reset pagination state\r\n      setOfficePaging({});\r\n      \r\n      // Reset search jika ada\r\n      if (search) {\r\n        setSearch('');\r\n      }\r\n      \r\n      setShowDeleteModal(false);\r\n      setLetterToDelete(null);\r\n    } catch (err: any) {\r\n      toast({ \r\n        title: 'Gagal menghapus surat', \r\n        description: err.message || 'Terjadi kesalahan', \r\n        variant: 'destructive',\r\n        duration: 5000\r\n      });\r\n    } finally {\r\n      setDeleting(false);\r\n    }\r\n  };\r\n\r\n  // Helper untuk update paging per kantor\r\n  const setOfficePage = (officeName: string, page: number) => {\r\n    setOfficePaging(prev => ({\r\n      ...prev,\r\n      [officeName]: {\r\n        ...(prev[officeName] || { currentPage: 1, pageSize: 10 }),\r\n        currentPage: page,\r\n      },\r\n    }));\r\n  };\r\n  const setOfficePageSize = (officeName: string, size: number) => {\r\n    setOfficePaging(prev => ({\r\n      ...prev,\r\n      [officeName]: {\r\n        ...(prev[officeName] || { currentPage: 1, pageSize: 10 }),\r\n        pageSize: size,\r\n        currentPage: 1,\r\n      },\r\n    }));\r\n  };\r\n\r\n  // Empty state component\r\n  const EmptyState = () => (\r\n    <div className=\"flex flex-col items-center justify-center py-16 px-4\">\r\n      <div className=\"relative mb-6\">\r\n        <div className=\"w-24 h-24 bg-gradient-to-br from-green-100 to-blue-100 rounded-full flex items-center justify-center\">\r\n          <Inbox className=\"w-12 h-12 text-green-600\" />\r\n        </div>\r\n        <div className=\"absolute -top-2 -right-2 w-8 h-8 bg-red-100 rounded-full flex items-center justify-center\">\r\n          <span className=\"text-xs font-bold text-red-600\">0</span>\r\n        </div>\r\n      </div>\r\n      <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">Belum Ada Surat</h3>\r\n      <p className=\"text-gray-600 text-center max-w-md mb-6\">\r\n        Riwayat surat masih kosong. Mulai buat surat pertama Anda untuk melihat data di sini.\r\n      </p>\r\n      <div className=\"flex gap-3\">\r\n        <Button asChild className=\"bg-green-600 hover:bg-green-700\">\r\n          <Link to=\"/generator\">\r\n            <FileText className=\"w-4 h-4 mr-2\" />\r\n            Buat Surat Baru\r\n          </Link>\r\n        </Button>\r\n        <Button variant=\"outline\" onClick={refreshData} disabled={loading}>\r\n          <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\r\n          {loading ? 'Loading...' : 'Refresh Data'}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  // Loading state\r\n  if (loading) {\r\n    return (\r\n      <div className=\"max-w-7xl mx-auto p-6\">\r\n        <div className=\"mb-8\">\r\n          <Skeleton className=\"h-8 w-1/3 mb-4\" />\r\n          <Skeleton className=\"h-6 w-1/2\" />\r\n        </div>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\r\n          <Skeleton className=\"h-32\" />\r\n          <Skeleton className=\"h-32\" />\r\n          <Skeleton className=\"h-32\" />\r\n        </div>\r\n        <div className=\"space-y-4\">\r\n          <Skeleton className=\"h-16\" />\r\n          <Skeleton className=\"h-16\" />\r\n          <Skeleton className=\"h-16\" />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Error state\r\n  if (error) {\r\n    return (\r\n      <div className=\"max-w-7xl mx-auto p-6\">\r\n        <div className=\"flex flex-col items-center justify-center py-16\">\r\n          <div className=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4\">\r\n            <FileText className=\"w-8 h-8 text-red-600\" />\r\n          </div>\r\n          <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">Gagal Memuat Data</h3>\r\n          <p className=\"text-gray-600 mb-6\">{error}</p>\r\n          <Button onClick={refreshData} disabled={loading}>\r\n            <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\r\n            {loading ? 'Loading...' : 'Coba Lagi'}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto p-6\">\r\n      {/* Header */}\r\n      <div className=\"mb-8\">\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold text-gray-900\">Riwayat Surat</h1>\r\n            <p className=\"text-gray-600 mt-1\">Kelola dan pantau semua surat yang telah dibuat</p>\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <Button \r\n              variant=\"outline\" \r\n              onClick={refreshData}\r\n              disabled={loading}\r\n            >\r\n              <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\r\n              {loading ? 'Loading...' : 'Refresh'}\r\n            </Button>\r\n            {tabFilteredLetters.length > 0 && (() => {\r\n              const deletableLettersCount = tabFilteredLetters.filter(letter => \r\n                user?.role === 'admin' || letter.created_by === user?.id\r\n              ).length;\r\n              return deletableLettersCount > 0 ? (\r\n                <Button\r\n                  variant={selectAll ? \"destructive\" : \"outline\"}\r\n                  onClick={() => handleSelectAll(!selectAll)}\r\n                  className={selectAll ? \"bg-red-600 hover:bg-red-700\" : \"border-green-200 text-green-700 hover:bg-green-50\"}\r\n                >\r\n                  {selectAll ? (\r\n                    <>\r\n                      <Trash2 className=\"w-4 h-4 mr-2\" />\r\n                      Batal Pilih Semua\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <FileText className=\"w-4 h-4 mr-2\" />\r\n                      Pilih Semua ({deletableLettersCount})\r\n                    </>\r\n                  )}\r\n                </Button>\r\n              ) : null;\r\n            })()}\r\n            {/* Only show \"Buat Surat Baru\" button for admin and operator, not for user role */}\r\n            {user?.role !== 'user' && (\r\n              <Button asChild className=\"bg-green-600 hover:bg-green-700\">\r\n                <Link to=\"/generator\">\r\n                  <FileText className=\"w-4 h-4 mr-2\" />\r\n                  Buat Surat Baru\r\n                </Link>\r\n              </Button>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Search and Filter */}\r\n        <div className=\"flex flex-col sm:flex-row gap-4 mb-6\">\r\n          <div className=\"relative flex-1\">\r\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\r\n            <Input\r\n              placeholder=\"Cari surat, nomor surat, atau kantor...\"\r\n              value={search}\r\n              onChange={(e) => setSearch(e.target.value)}\r\n              className=\"pl-10\"\r\n            />\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <Select value={sortBy} onValueChange={(value: any) => setSortBy(value)}>\r\n              <SelectTrigger className=\"w-40\">\r\n                <SelectValue placeholder=\"Urutkan\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"letter_number\">Nomor Surat</SelectItem>\r\n                <SelectItem value=\"template_name\">Template</SelectItem>\r\n                <SelectItem value=\"tanggal\">Tanggal</SelectItem>\r\n                <SelectItem value=\"status\">Status</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => setSortDir(sortDir === 'asc' ? 'desc' : 'asc')}\r\n            >\r\n              {sortDir === 'asc' ? '↑' : '↓'}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Bulk Selection UI */}\r\n      {selectedLetters.length > 0 && (\r\n        <div className=\"mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg shadow-sm\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center\">\r\n                  <span className=\"text-sm font-bold text-blue-600\">{selectedLetters.length}</span>\r\n                </div>\r\n                <div>\r\n                  <h3 className=\"font-semibold text-blue-900\">\r\n                    {selectedLetters.length} surat dipilih\r\n                  </h3>\r\n                  <p className=\"text-sm text-blue-700\">\r\n                    Siap untuk dihapus\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex gap-3\">\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={() => {\r\n                  setSelectedLetters([]);\r\n                  setSelectAll(false);\r\n                }}\r\n                className=\"border-green-300 text-green-700 hover:bg-green-50\"\r\n              >\r\n                Batal Pilih\r\n              </Button>\r\n              <Button\r\n                variant=\"destructive\"\r\n                size=\"sm\"\r\n                onClick={handleBulkDelete}\r\n                className=\"bg-red-600 hover:bg-red-700 shadow-sm\"\r\n              >\r\n                <Trash2 className=\"w-4 h-4 mr-2\" />\r\n                Hapus {selectedLetters.length} Surat\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Floating Action Button for Bulk Delete */}\r\n      {selectedLetters.length > 0 && (\r\n        <div className=\"fixed bottom-6 right-6 z-50\">\r\n          <div className=\"flex flex-col gap-2\">\r\n            <Button\r\n              size=\"lg\"\r\n              onClick={handleBulkDelete}\r\n              className=\"bg-red-600 hover:bg-red-700 shadow-lg rounded-full w-16 h-16\"\r\n            >\r\n              <Trash2 className=\"w-6 h-6\" />\r\n            </Button>\r\n            <div className=\"bg-white rounded-full px-3 py-1 shadow-lg text-sm font-medium text-gray-700\">\r\n              {selectedLetters.length} surat\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Tab Navigation */}\r\n      <div className=\"mb-8\">\r\n        <div className=\"bg-white rounded-lg border border-gray-200 p-1\">\r\n          <nav className=\"flex space-x-1\">\r\n            <button\r\n              onClick={() => setActiveTab('all')}\r\n              className={`flex-1 flex items-center justify-center py-3 px-4 rounded-md font-medium text-sm transition-all duration-200 ${\r\n                activeTab === 'all'\r\n                  ? 'bg-green-50 text-green-700 border border-green-200 shadow-sm'\r\n                  : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'\r\n              }`}\r\n            >\r\n              <FileText className=\"w-4 h-4 mr-2\" />\r\n              Semua Surat\r\n              <span className=\"ml-2 bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs\">\r\n                {filteredLetters.length}\r\n              </span>\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveTab('with-employee')}\r\n              className={`flex-1 flex items-center justify-center py-3 px-4 rounded-md font-medium text-sm transition-all duration-200 ${\r\n                activeTab === 'with-employee'\r\n                  ? 'bg-green-50 text-green-700 border border-green-200 shadow-sm'\r\n                  : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'\r\n              }`}\r\n            >\r\n              <Users className=\"w-4 h-4 mr-2\" />\r\n              Surat dengan Pegawai\r\n              <span className=\"ml-2 bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs\">\r\n                {filteredLetters.filter(l => ![2, 9].includes(l.template_id)).length}\r\n              </span>\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveTab('without-employee')}\r\n              className={`flex-1 flex items-center justify-center py-3 px-4 rounded-md font-medium text-sm transition-all duration-200 ${\r\n                activeTab === 'without-employee'\r\n                  ? 'bg-orange-50 text-orange-700 border border-orange-200 shadow-sm'\r\n                  : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'\r\n              }`}\r\n            >\r\n              <ClipboardList className=\"w-4 h-4 mr-2\" />\r\n              Analisis & Pernyataan\r\n              <span className=\"ml-2 bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs\">\r\n                {filteredLetters.filter(l => [2, 9].includes(l.template_id)).length}\r\n              </span>\r\n            </button>\r\n          </nav>\r\n        </div>\r\n        \r\n        {/* Tab Description */}\r\n        <div className=\"mt-3 text-sm text-gray-600\">\r\n          {activeTab === 'all' && (\r\n            <div className=\"flex items-center\">\r\n              <Info className=\"w-4 h-4 mr-2 text-green-500\" />\r\n              Menampilkan semua surat yang telah dibuat dalam sistem\r\n            </div>\r\n          )}\r\n          {activeTab === 'with-employee' && (\r\n            <div className=\"flex items-center\">\r\n              <Info className=\"w-4 h-4 mr-2 text-green-500\" />\r\n              Surat yang memerlukan data pegawai tertentu (Template 1, 3-8)\r\n            </div>\r\n          )}\r\n          {activeTab === 'without-employee' && (\r\n            <div className=\"flex items-center\">\r\n              <Info className=\"w-4 h-4 mr-2 text-orange-500\" />\r\n              Surat analisis jabatan dan pernyataan (Template 2 & 9)\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Summary Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\r\n        <Card>\r\n          <CardContent className=\"p-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">Total Surat</p>\r\n                <p className=\"text-2xl font-bold text-gray-900\">{total}</p>\r\n              </div>\r\n              <div className=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center\">\r\n                <FileText className=\"w-6 h-6 text-blue-600\" />\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        <Card>\r\n          <CardContent className=\"p-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">Generated</p>\r\n                <p className=\"text-2xl font-bold text-green-600\">{byStatus('generated')}</p>\r\n              </div>\r\n              <div className=\"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center\">\r\n                <Printer className=\"w-6 h-6 text-green-600\" />\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        <Card>\r\n          <CardContent className=\"p-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">Surat Terbaru</p>\r\n                <p className=\"text-lg font-bold text-gray-900\">{mostRecentLetter ? `${mostRecentLetter.letter_number} - ${getMostRecentOffice()}` : 'Tidak ada data'}</p>\r\n              </div>\r\n              <div className=\"w-12 h-12 bg-teal-100 rounded-lg flex items-center justify-center\">\r\n                <Eye className=\"w-6 h-6 text-teal-600\" />\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Main Content */}\r\n      {letters.length === 0 ? (\r\n        <Card>\r\n          <CardContent className=\"p-0\">\r\n            <EmptyState />\r\n          </CardContent>\r\n        </Card>\r\n      ) : (\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Building2 className=\"w-5 h-5\" />\r\n              {activeTab === 'all' && `Surat Berdasarkan Kantor (${Object.keys(groupedByOffice).length} Kantor)`}\r\n              {activeTab === 'with-employee' && `Surat dengan Pegawai (${Object.keys(groupedByOffice).length} Kantor)`}\r\n              {activeTab === 'without-employee' && `Surat Analisis & Pernyataan (${Object.keys(groupedByOffice).length} Kantor)`}\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {filteredGrouped.length === 0 ? (\r\n              <div className=\"text-center py-8\">\r\n                <Search className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\r\n                <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Tidak Ada Hasil</h3>\r\n                <p className=\"text-gray-600\">Coba ubah kata kunci pencarian Anda</p>\r\n              </div>\r\n            ) : (\r\n              <Accordion type=\"multiple\" className=\"space-y-2\">\r\n                {filteredGrouped.map(([officeName, officeLetters], officeIndex) => {\r\n                  // Paging state per kantor\r\n                  const paging = officePaging[officeName] || { currentPage: 1, pageSize: 10 };\r\n                  const totalPages = Math.ceil(officeLetters.length / paging.pageSize);\r\n                  const pagedLetters = officeLetters.slice((paging.currentPage - 1) * paging.pageSize, paging.currentPage * paging.pageSize);\r\n                  return (\r\n                    <AccordionItem key={officeIndex} value={`office-${officeIndex}`} className=\"border rounded-lg\">\r\n                      <AccordionTrigger className=\"px-6 py-4 hover:bg-gray-50 rounded-lg\">\r\n                        <div className=\"flex items-center justify-between w-full\">\r\n                          <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center\">\r\n                              <Building2 className=\"w-4 h-4 text-green-600\" />\r\n                            </div>\r\n                            <div className=\"text-left\">\r\n                              <h3 className=\"font-semibold text-gray-900\">{officeName}</h3>\r\n                              <p className=\"text-sm text-gray-600\">{officeLetters.length} surat</p>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Badge variant=\"secondary\">{officeLetters.length}</Badge>\r\n                          </div>\r\n                        </div>\r\n                      </AccordionTrigger>\r\n                      <AccordionContent className=\"px-6 pb-4\">\r\n                        <div className=\"flex flex-col md:flex-row md:items-center md:justify-between mb-2 gap-2\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <label htmlFor={`pageSize-${officeIndex}`} className=\"text-sm\">Tampilkan</label>\r\n                            <select\r\n                              id={`pageSize-${officeIndex}`}\r\n                              value={paging.pageSize}\r\n                              onChange={e => setOfficePageSize(officeName, Number(e.target.value))}\r\n                              className=\"border rounded px-2 py-1 text-sm\"\r\n                            >\r\n                              {[10, 20, 50, 100].map(size => (\r\n                                <option key={size} value={size}>{size}</option>\r\n                              ))}\r\n                            </select>\r\n                            <span className=\"text-sm\">data per halaman</span>\r\n                          </div>\r\n                          <div className=\"text-sm text-muted-foreground\">\r\n                            Menampilkan {officeLetters.length === 0 ? 0 : ((paging.currentPage - 1) * paging.pageSize + 1)}–{Math.min(paging.currentPage * paging.pageSize, officeLetters.length)} dari {officeLetters.length} surat\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"overflow-x-auto\">\r\n                          <Table>\r\n                            <TableHeader className=\"bg-gray-50\">\r\n                              <TableRow>\r\n                                <TableHead className=\"w-12\">\r\n                                  <div className=\"flex items-center gap-2\">\r\n                                    {(() => {\r\n                                      const allVisibleLetters = filteredGrouped.flatMap(([officeName, officeLetters]) => officeLetters);\r\n                                      const deletableLettersCount = allVisibleLetters.filter(letter => \r\n                                        user?.role === 'admin' || letter.created_by === user?.id\r\n                                      ).length;\r\n                                      return (\r\n                                        <>\r\n                                          <input\r\n                                            type=\"checkbox\"\r\n                                            checked={selectAll}\r\n                                            onChange={(e) => handleSelectAll(e.target.checked)}\r\n                                            disabled={deletableLettersCount === 0}\r\n                                            className=\"w-4 h-4 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50\"\r\n                                          />\r\n                                          {selectedLetters.length > 0 && (\r\n                                            <span className=\"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full\">\r\n                                              {selectedLetters.length}\r\n                                            </span>\r\n                                          )}\r\n                                        </>\r\n                                      );\r\n                                    })()}\r\n                                  </div>\r\n                                </TableHead>\r\n                                <TableHead>No.</TableHead>\r\n                                <TableHead>Nomor Surat</TableHead>\r\n                                <TableHead>Template</TableHead>\r\n                                <TableHead>Pegawai</TableHead>\r\n                                <TableHead>Tanggal</TableHead>\r\n                                <TableHead>Status</TableHead>\r\n                                <TableHead>Aksi</TableHead>\r\n                              </TableRow>\r\n                            </TableHeader>\r\n                            <TableBody>\r\n                              {pagedLetters.map((letter, idx) => {\r\n                                let parsedFormData = letter.form_data;\r\n                                if (typeof parsedFormData === 'string') {\r\n                                  try {\r\n                                    parsedFormData = JSON.parse(parsedFormData);\r\n                                  } catch {\r\n                                    parsedFormData = {};\r\n                                  }\r\n                                }\r\n                                \r\n                                // Check if user can delete this letter\r\n                                const canDelete = user?.role === 'admin' || letter.created_by === user?.id;\r\n                                const isSelected = selectedLetters.includes(letter.id);\r\n                                \r\n                                return (\r\n                                  <TableRow \r\n                                    key={letter.id}\r\n                                    className={isSelected ? 'bg-blue-50 border-blue-200' : ''}\r\n                                  >\r\n                                    <TableCell>\r\n                                      <input\r\n                                        type=\"checkbox\"\r\n                                        checked={isSelected}\r\n                                        onChange={(e) => handleSelectLetter(letter.id, e.target.checked)}\r\n                                        disabled={!canDelete}\r\n                                        className=\"w-4 h-4 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50\"\r\n                                      />\r\n                                    </TableCell>\r\n                                    <TableCell>{(paging.currentPage - 1) * paging.pageSize + idx + 1}</TableCell>\r\n                                    <TableCell className=\"font-mono text-sm\">{letter.letter_number}</TableCell>\r\n                                    <TableCell>{letter.template_name}</TableCell>\r\n                                    <TableCell>\r\n                                      {letter.template_id === 9 ? (\r\n                                        <span className=\"text-gray-500\">Tanpa Pegawai</span>\r\n                                      ) : (\r\n                                        <div>\r\n                                          <div className=\"font-medium\">{parsedFormData.namapegawai}</div>\r\n                                          <div className=\"text-sm text-gray-500\">{letter.recipient_employee_nip}</div>\r\n                                        </div>\r\n                                      )}\r\n                                    </TableCell>\r\n                                    <TableCell>{parsedFormData.tanggal || '-'}</TableCell>\r\n                                    <TableCell>{getStatusBadge(letter.status)}</TableCell>\r\n                                    <TableCell>\r\n                                      <div className=\"flex gap-2\">\r\n                                        <Button\r\n                                          variant=\"outline\"\r\n                                          size=\"sm\"\r\n                                          onClick={() => {\r\n                                            setSelectedLetterForPreview(letter);\r\n                                            setModalOpen(true);\r\n                                          }}\r\n                                        >\r\n                                          <Eye className=\"w-4 h-4\" />\r\n                                        </Button>\r\n                                        {/* Only show edit buttons for admin/operator */}\r\n                                        {user?.role !== 'user' && (user?.role === 'admin' || letter.created_by === user?.id) && letter.template_id !== 2 && letter.template_id !== 9 && (\r\n                                          <Button\r\n                                            variant=\"outline\"\r\n                                            size=\"sm\"\r\n                                            onClick={() => handleEditPejabatPegawai(letter)}\r\n                                            className=\"text-blue-600 hover:text-blue-700 hover:bg-blue-50\"\r\n                                          >\r\n                                            <Edit3 className=\"w-4 h-4 mr-2\" />\r\n                                            Edit Pejabat & Pegawai\r\n                                          </Button>\r\n                                        )}\r\n                                        {user?.role !== 'user' && (user?.role === 'admin' || letter.created_by === user?.id) && (letter.template_id === 2 || letter.template_id === 9) && (\r\n                                          <Button\r\n                                            variant=\"outline\"\r\n                                            size=\"sm\"\r\n                                            onClick={() => handleEditPejabatPegawai(letter)}\r\n                                            className=\"text-blue-600 hover:text-blue-700 hover:bg-blue-50\"\r\n                                          >\r\n                                            <Edit3 className=\"w-4 h-4 mr-2\" />\r\n                                            Edit Pejabat\r\n                                          </Button>\r\n                                        )}\r\n                                        {/* Only show delete button for admin */}\r\n                                        {user?.role === 'admin' && (user?.role === 'admin' || letter.created_by === user?.id) && (\r\n                                          <Button\r\n                                            variant=\"outline\"\r\n                                            size=\"sm\"\r\n                                            onClick={() => handleDeleteLetter(letter)}\r\n                                            className=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\r\n                                          >\r\n                                            <Trash2 className=\"w-4 h-4\" />\r\n                                          </Button>\r\n                                        )}\r\n                                      </div>\r\n                                    </TableCell>\r\n                                  </TableRow>\r\n                                );\r\n                              })}\r\n                            </TableBody>\r\n                          </Table>\r\n                        </div>\r\n                        {/* Pagination per kantor */}\r\n                        {totalPages > 1 && (\r\n                          <div className=\"flex justify-center items-center gap-2 mt-4\">\r\n                            <Button size=\"sm\" variant=\"outline\" onClick={() => setOfficePage(officeName, Math.max(1, paging.currentPage - 1))} disabled={paging.currentPage === 1}>Prev</Button>\r\n                            {Array.from({ length: totalPages }, (_, i) => i + 1).map(page => (\r\n                              <Button\r\n                                key={page}\r\n                                size=\"sm\"\r\n                                variant={page === paging.currentPage ? 'default' : 'outline'}\r\n                                onClick={() => setOfficePage(officeName, page)}\r\n                              >\r\n                                {page}\r\n                              </Button>\r\n                            ))}\r\n                            <Button size=\"sm\" variant=\"outline\" onClick={() => setOfficePage(officeName, Math.min(totalPages, paging.currentPage + 1))} disabled={paging.currentPage === totalPages}>Next</Button>\r\n                          </div>\r\n                        )}\r\n                      </AccordionContent>\r\n                    </AccordionItem>\r\n                  );\r\n                })}\r\n              </Accordion>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Preview Modal */}\r\n      <Dialog open={modalOpen} onOpenChange={setModalOpen}>\r\n        <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\r\n          <div className=\"flex justify-between items-center mb-2\">\r\n            <DialogTitle>Preview Surat</DialogTitle>\r\n            {selectedLetterForPreview && (\r\n              <Button\r\n                size=\"sm\"\r\n                className=\"bg-green-600 hover:bg-green-700 text-white\"\r\n                onClick={() => window.open(generateUrl(`/letters/${selectedLetterForPreview.id}/preview`), '_blank')}\r\n              >\r\n                Open in New Tab\r\n              </Button>\r\n            )}\r\n          </div>\r\n          {selectedLetterForPreview && (\r\n            <div className=\"mt-4\">\r\n              {renderPreviewByTemplate(selectedLetterForPreview)}\r\n            </div>\r\n          )}\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Session Expired Modal */}\r\n      {showSessionExpiredModal && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm\">\r\n          <div className=\"bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full flex flex-col items-center animate-fade-in\">\r\n            <Lock className=\"w-16 h-16 text-yellow-500 mb-4\" />\r\n            <h2 className=\"text-2xl font-bold mb-2 text-gray-900\">Sesi Berakhir</h2>\r\n            <p className=\"text-gray-600 mb-6 text-center\">Sesi Anda telah habis. Silakan login kembali untuk melanjutkan.</p>\r\n            <button\r\n              className=\"w-full py-3 rounded-lg bg-green-600 hover:bg-green-700 text-white text-lg font-semibold shadow transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-400\"\r\n              onClick={() => {\r\n                localStorage.removeItem('token');\r\n                setShowSessionExpiredModal(false);\r\n                navigate('/login', { replace: true });\r\n              }}\r\n            >\r\n              Login Ulang\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      {showDeleteModal && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm\">\r\n          <div className=\"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full flex flex-col items-center animate-fade-in\">\r\n            <div className=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4\">\r\n              <Trash2 className=\"w-8 h-8 text-red-600\" />\r\n            </div>\r\n            <h2 className=\"text-2xl font-bold mb-2 text-gray-900\">Hapus Surat</h2>\r\n            <p className=\"text-gray-600 mb-6 text-center\">\r\n              Apakah Anda yakin ingin menghapus surat <strong>{letterToDelete?.letter_number}</strong>? \r\n              Tindakan ini tidak dapat dibatalkan.\r\n            </p>\r\n            <div className=\"flex gap-3 w-full\">\r\n              <Button\r\n                variant=\"outline\"\r\n                onClick={() => {\r\n                  setShowDeleteModal(false);\r\n                  setLetterToDelete(null);\r\n                }}\r\n                disabled={deleting}\r\n                className=\"flex-1\"\r\n              >\r\n                Batal\r\n              </Button>\r\n              <Button\r\n                onClick={confirmDelete}\r\n                disabled={deleting}\r\n                className=\"flex-1 bg-red-600 hover:bg-red-700\"\r\n              >\r\n                {deleting ? 'Menghapus...' : 'Hapus'}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Bulk Delete Confirmation Modal */}\r\n      {showBulkDeleteModal && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm\">\r\n          <div className=\"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full flex flex-col items-center animate-fade-in\">\r\n            <div className=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4\">\r\n              <Trash2 className=\"w-8 h-8 text-red-600\" />\r\n            </div>\r\n            <h2 className=\"text-2xl font-bold mb-2 text-gray-900\">Hapus Surat</h2>\r\n            <p className=\"text-gray-600 mb-6 text-center\">\r\n              Apakah Anda yakin ingin menghapus {selectedLetters.length} surat yang dipilih? \r\n              Tindakan ini tidak dapat dibatalkan.\r\n            </p>\r\n            <div className=\"flex gap-3 w-full\">\r\n              <Button\r\n                variant=\"outline\"\r\n                onClick={() => {\r\n                  setShowBulkDeleteModal(false);\r\n                  setSelectedLetters([]);\r\n                  setSelectAll(false);\r\n                }}\r\n                disabled={bulkDeleting}\r\n                className=\"flex-1\"\r\n              >\r\n                Batal\r\n              </Button>\r\n              <Button\r\n                onClick={confirmBulkDelete}\r\n                disabled={bulkDeleting}\r\n                className=\"flex-1 bg-red-600 hover:bg-red-700\"\r\n              >\r\n                {bulkDeleting ? 'Menghapus...' : 'Hapus'}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n             {/* Edit Pejabat & Pegawai Modal */}\r\n       {editLetter && (\r\n         <Dialog open={!!editLetter} onOpenChange={v => { if (!v) setEditLetter(null); }}>\r\n           <DialogContent className=\"max-w-2xl\">\r\n             <DialogTitle>\r\n               {editLetter.template_id === 2 || editLetter.template_id === 9 \r\n                 ? 'Edit Pejabat' \r\n                 : 'Edit Pejabat & Pegawai'\r\n               }\r\n             </DialogTitle>\r\n             \r\n             <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n               {/* Search Section */}\r\n               <div className=\"space-y-4\">\r\n                 <div>\r\n                   <PegawaiSearchInput\r\n                     label=\"Cari Pejabat\"\r\n                     placeholder=\"Masukkan nama atau NIP pejabat...\"\r\n                     onSelect={setEditPejabat}\r\n                     selectedPegawai={editPejabat}\r\n                   />\r\n                 </div>\r\n                 \r\n                 {(editLetter.template_id !== 2 && editLetter.template_id !== 9) && (\r\n                   <div>\r\n                     <PegawaiSearchInput\r\n                       label=\"Cari Pegawai\"\r\n                       placeholder=\"Masukkan nama atau NIP pegawai...\"\r\n                       onSelect={setEditPegawai}\r\n                       selectedPegawai={editPegawai}\r\n                     />\r\n                   </div>\r\n                 )}\r\n               </div>\r\n               \r\n               {/* Preview Section */}\r\n               <div className=\"space-y-4\">\r\n                 {/* Preview Pejabat */}\r\n                 {editPejabat && (\r\n                   <div className=\"border rounded-lg p-4 bg-blue-50\">\r\n                     <div className=\"flex justify-between items-start mb-2\">\r\n                       <h4 className=\"font-semibold text-blue-900 flex items-center\">\r\n                         <Users className=\"w-4 h-4 mr-2\" />\r\n                         Preview Pejabat\r\n                       </h4>\r\n                       <Button\r\n                         variant=\"ghost\"\r\n                         size=\"sm\"\r\n                         onClick={() => setEditPejabat(null)}\r\n                         className=\"text-blue-600 hover:text-blue-700 hover:bg-blue-100\"\r\n                       >\r\n                         <X className=\"w-3 h-3\" />\r\n                       </Button>\r\n                     </div>\r\n                     <div className=\"space-y-1 text-sm\">\r\n                       <div><span className=\"font-medium\">Nama:</span> {editPejabat.nama}</div>\r\n                       <div><span className=\"font-medium\">NIP:</span> {editPejabat.nip}</div>\r\n                       <div><span className=\"font-medium\">Pangkat/Gol:</span> {editPejabat.pangkat_gol}</div>\r\n                       <div><span className=\"font-medium\">Jabatan:</span> {editPejabat.jabatan}</div>\r\n                       <div><span className=\"font-medium\">Unit Kerja:</span> {editPejabat.unit_kerja}</div>\r\n                     </div>\r\n                   </div>\r\n                 )}\r\n                 \r\n                 {/* Preview Pegawai */}\r\n                 {editPegawai && (editLetter.template_id !== 2 && editLetter.template_id !== 9) && (\r\n                   <div className=\"border rounded-lg p-4 bg-green-50\">\r\n                     <div className=\"flex justify-between items-start mb-2\">\r\n                       <h4 className=\"font-semibold text-green-900 flex items-center\">\r\n                         <Users className=\"w-4 h-4 mr-2\" />\r\n                         Preview Pegawai\r\n                       </h4>\r\n                       <Button\r\n                         variant=\"ghost\"\r\n                         size=\"sm\"\r\n                         onClick={() => setEditPegawai(null)}\r\n                         className=\"text-green-600 hover:text-green-700 hover:bg-green-100\"\r\n                       >\r\n                         <X className=\"w-3 h-3\" />\r\n                       </Button>\r\n                     </div>\r\n                     <div className=\"space-y-1 text-sm\">\r\n                       <div><span className=\"font-medium\">Nama:</span> {editPegawai.nama}</div>\r\n                       <div><span className=\"font-medium\">NIP:</span> {editPegawai.nip}</div>\r\n                       <div><span className=\"font-medium\">Pangkat/Gol:</span> {editPegawai.pangkat_gol}</div>\r\n                       <div><span className=\"font-medium\">Jabatan:</span> {editPegawai.jabatan}</div>\r\n                       <div><span className=\"font-medium\">Unit Kerja:</span> {editPegawai.unit_kerja}</div>\r\n                       {editPegawai.tempat_tugas && (\r\n                         <div><span className=\"font-medium\">Tempat Tugas:</span> {editPegawai.tempat_tugas}</div>\r\n                       )}\r\n                     </div>\r\n                   </div>\r\n                 )}\r\n                 \r\n                 {/* Empty State */}\r\n                 {!editPejabat && (editLetter.template_id === 2 || editLetter.template_id === 9) && (\r\n                   <div className=\"border rounded-lg p-4 bg-gray-50 text-center text-gray-500\">\r\n                     <Users className=\"w-8 h-8 mx-auto mb-2 text-gray-400\" />\r\n                     <p>Pilih pejabat untuk melihat preview</p>\r\n                   </div>\r\n                 )}\r\n                 \r\n                 {!editPejabat && !editPegawai && (editLetter.template_id !== 2 && editLetter.template_id !== 9) && (\r\n                   <div className=\"border rounded-lg p-4 bg-gray-50 text-center text-gray-500\">\r\n                     <Users className=\"w-8 h-8 mx-auto mb-2 text-gray-400\" />\r\n                     <p>Pilih pejabat dan pegawai untuk melihat preview</p>\r\n                   </div>\r\n                 )}\r\n               </div>\r\n             </div>\r\n             \r\n             <div className=\"flex gap-2 justify-end mt-4\">\r\n               <Button variant=\"outline\" onClick={() => setEditLetter(null)} disabled={editSaving}>\r\n                 Batal\r\n               </Button>\r\n               <Button \r\n                 onClick={handleSaveEditPejabatPegawai} \r\n                 disabled={editSaving || !editPejabat || ((editLetter.template_id !== 2 && editLetter.template_id !== 9) && !editPegawai)} \r\n                 className=\"bg-green-600 hover:bg-green-700 text-white\"\r\n               >\r\n                 {editSaving ? 'Menyimpan...' : 'Simpan'}\r\n               </Button>\r\n             </div>\r\n           </DialogContent>\r\n         </Dialog>\r\n       )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Letters; "],"names":["Letters","token","user","useAuth","letters","setLetters","useState","loading","setLoading","error","setError","search","setSearch","sortBy","setSortBy","sortDir","setSortDir","activeTab","setActiveTab","toast","useToast","modalOpen","setModalOpen","selectedLetterForPreview","setSelectedLetterForPreview","officePaging","setOfficePaging","officeMap","setOfficeMap","editLetter","setEditLetter","editPejabat","setEditPejabat","editPegawai","setEditPegawai","editSaving","setEditSaving","navigate","useNavigate","showSessionExpiredModal","setShowSessionExpiredModal","showDeleteModal","setShowDeleteModal","letterToDelete","setLetterToDelete","deleting","setDeleting","selectedLetters","setSelectedLetters","selectAll","setSelectAll","showBulkDeleteModal","setShowBulkDeleteModal","bulkDeleting","setBulkDeleting","filteredLetters","_a","l","_b","_d","_c","_f","_e","tabFilteredLetters","groupedByOffice","b","aVal","bVal","acc","surat","officeName","filteredGrouped","suratList","useEffect","apiGet","res","err","map","office","byStatus","status","total","mostTemplate","mostRecentLetter","latest","current","latestDate","getMostRecentOffice","getOfficeNameFromKode","kode","timeAgo","getStatusBadge","Badge","renderPreviewByTemplate","letter","data","id","nomorParts","matchNoSurat","fallback","mergedData","jsx","Template1","Template2","Template3","Template4","Template5","Template6","Template7","Template8","Template9","handleDeleteLetter","handleEditPejabatPegawai","handleSaveEditPejabatPegawai","currentFormData","templateId","updatedFormData","apiPut","refreshData","handleSelectLetter","letterId","checked","prev","handleSelectAll","deletableLetters","officeLetters","handleBulkDelete","confirmBulkDelete","apiDelete","confirmDelete","setOfficePage","page","setOfficePageSize","size","EmptyState","jsxs","Inbox","Button","Link","FileText","RefreshCw","Skeleton","deletableLettersCount","Fragment","Trash2","Search","Input","e","Select","value","SelectTrigger","SelectValue","SelectContent","SelectItem","Users","ClipboardList","Info","Card","CardContent","Printer","Eye","CardHeader","CardTitle","Building2","Accordion","officeIndex","paging","totalPages","pagedLetters","AccordionItem","AccordionTrigger","AccordionContent","Table","TableHeader","TableRow","TableHead","TableBody","idx","parsedFormData","canDelete","isSelected","TableCell","Edit3","_","i","Dialog","DialogContent","DialogTitle","generateUrl","Lock","v","PegawaiSearchInput","X"],"mappings":"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"}