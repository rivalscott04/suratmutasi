import{j as a,ax as Ba,a3 as ka,a4 as G,aE as ta,F as I,E as Ra,ao as Ea,at as Ma,U as ya,al as Fa,ac as ba,ab as Ua,b2 as Ja,am as Ca,aM as $a}from"./ui-vendor-C6CR1JGj.js";import{r as d,d as Wa,e as Ia}from"./react-vendor-B0B9C2fS.js";import{C as oa,c as ca,a as fa,b as Pa}from"./card-DJBMZjiH.js";import{u as wa,d as La,B as U,b as j,a as q,c as Na,y as Ha,z as za,P as Oa}from"./index-Bl8eCSPV.js";import{S as qa,a as Ga,b as Va,c as Xa,d as Qa}from"./select-D2jGjlNg.js";import{u as va,S as Ya}from"./protected-button-BI08V9uu.js";import{P as Za}from"./PageHeader-B89tI5Hu.js";import{A as ma,a as ga,b as pa,c as ha,d as _a,e as xa,f as ja}from"./alert-dialog-DkoobKvJ.js";const Sa=({progress:c,isUploading:o,className:k=""})=>{const h=Math.min(Math.max(c,0),100),n=Math.round(h*10)/10,y=()=>o?n===0||n<20?"Preparing upload...":n<90?"Uploading file...":n<100?"Processing...":"Complete!":"",b=()=>n<20?"text-blue-600":n<90?"text-green-600":n<100?"text-yellow-600":"text-green-600",D=()=>n<20?"bg-blue-600":n<90?"bg-green-600":n<100?"bg-yellow-600":"bg-green-600";return o?a.jsxs("div",{className:`space-y-2 ${k}`,children:[a.jsxs("div",{className:"flex items-center justify-between text-xs",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"animate-spin h-3 w-3 border border-green-600 border-t-transparent rounded-full"}),a.jsx("span",{className:`font-medium ${b()}`,children:y()})]}),a.jsxs("span",{className:`font-semibold ${b()}`,children:[n,"%"]})]}),a.jsx("div",{className:"w-full",children:a.jsx("div",{className:"relative h-1.5 w-full overflow-hidden rounded-full bg-gray-200",children:a.jsx("div",{className:`h-full transition-all duration-300 ${D()}`,style:{width:`${n}%`}})})})]}):null},sa=c=>String(c).toLowerCase().replace(/[^a-z0-9_-]+/gi,"_").replace(/^_+|_+$/g,""),ae=({pengajuanId:c,jenisJabatanId:o,onFilesUploaded:k,onProgressChange:h,pengajuanStatus:n,pengajuanData:y})=>{const{token:b,user:D}=wa(),{toast:na}=La();va();const[P,ra]=d.useState([]),[f,J]=d.useState([]);d.useState([]),d.useState("");const[v,C]=d.useState({}),[L,B]=d.useState({}),[ia,K]=d.useState(!0),[H,p]=d.useState(null),[R,S]=d.useState(null),[V,A]=d.useState(!1),[X,z]=d.useState(!1),[la,da]=d.useState(""),[Q,ua]=d.useState("Error");d.useState(!1);const $=async()=>{try{K(!0),p(null);let e;if(isNaN(Number(o)))try{const t=await q("/api/job-type-configurations",b);if(t!=null&&t.success&&Array.isArray(t.data)){const i=t.data.find(l=>l.jenis_jabatan===o);if(i)e=i.id;else{p("Jenis jabatan tidak ditemukan");return}}else{p("Gagal mengambil data jenis jabatan");return}}catch{p("Gagal mencari jenis jabatan");return}else e=parseInt(String(o));const s=await q(`/api/admin-wilayah-file-config/job-type/${e}`,b);if(s.success){if(ra(s.data),h){const t=f.filter(i=>s.data.some(l=>l.file_type===i.file_type)).length;h(t,s.data.length||0)}}else p("Failed to fetch file configurations")}catch{p("Error connecting to server")}finally{K(!1)}},Y=async()=>{var e;try{const s=await q(`/api/admin-wilayah/pengajuan/${c}`,b);if(s!=null&&s.success){const i=(s.uploadedAdminWilayahFiles||((e=s.data)==null?void 0:e.uploadedAdminWilayahFiles)||[]).map(l=>({id:l.id,pengajuan_id:c,file_type:l.file_type,file_name:l.file_name,file_path:l.file_path,file_size:l.file_size,verification_status:l.verification_status||"pending",created_at:l.created_at,updated_at:l.updated_at}));J(i)}else J([])}catch{J([])}};d.useEffect(()=>{o&&($(),Y())},[o,b]),d.useEffect(()=>{if(h){const e=P.length,s=f.filter(t=>P.some(i=>i.file_type===t.file_type)).length;h(s,e)}},[P,f]);const W=async(e,s)=>{C(t=>({...t,[e]:!0})),B(t=>({...t,[e]:0}));try{if(!E()){C(u=>({...u,[e]:!1})),B(u=>({...u,[e]:0}));return}const t=new FormData;t.append("file",s),t.append("pengajuan_id",c),t.append("file_type",e),t.append("file_category","admin_wilayah"),t.append("uploaded_by_role","admin_wilayah"),t.append("uploaded_by_name",(D==null?void 0:D.full_name)||"Admin Wilayah"),t.append("uploaded_by_office","Kanwil Provinsi");for(let[u,x]of t.entries());const i=setInterval(()=>{B(u=>{const x=u[e]||0;return x<90?{...u,[e]:x+Math.random()*20}:u})},200),l=await Na(`/api/admin-wilayah/pengajuan/${c}/upload`,t,b);if(clearInterval(i),B(u=>({...u,[e]:100})),l.success){const u={id:l.data.id,pengajuan_id:c,file_type:e,file_name:s.name,file_path:l.data.file_path,file_size:s.size,verification_status:"pending",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},x=[...f,u];if(J(x),k(x),h){const O=P.length,g=x.filter(M=>P.some(F=>F.file_type===M.file_type)).length;h(g,O)}na({title:"Success",description:`Upload berhasil: ${s.name}`,variant:"default",duration:3e3})}else{const u=l.message||"Terjadi kesalahan saat mengupload file. Silakan coba lagi.";N("Upload Gagal",u)}}catch{N("Upload Gagal","Terjadi kesalahan saat mengupload file. Periksa koneksi internet Anda dan coba lagi.")}finally{C(t=>({...t,[e]:!1})),B(t=>({...t,[e]:0}))}},Z=e=>{if(e===0)return"0 Bytes";const s=1024,t=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,i)).toFixed(2))+" "+t[i]},aa=e=>f.find(t=>t.file_type===e)?"uploaded":"pending",ea=e=>f.find(s=>s.file_type===e),r=(e,s)=>{var i;return((i={Guru:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Madrasah":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Wakil Kepala Madrasah":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala TU":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Seksi":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Sub Bagian":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Urusan":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},Staff:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},Pelaksana:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"}}[e])==null?void 0:i[s])||null},m=e=>{const{file_type:s,display_name:t}=e;if(s==="surat_rekomendasi_kanwil")return r(o,s)||"Surat Rekomendasi dari Instansi Pembina - Varian 6.1-6.9";const i=r(o,s);return i||t},_=async e=>{try{const s=await fetch(`/api/pengajuan/files/${e.id}`,{headers:{Authorization:`Bearer ${b}`}});if(!s.ok)throw new Error("Gagal mengambil file");const t=await s.blob(),i=URL.createObjectURL(t);window.open(i,"_blank"),setTimeout(()=>URL.revokeObjectURL(i),5e3)}catch{Ha("OPERATION_FAILED","Gagal membuka preview file")}},w=async e=>{try{const s=await fetch(`/api/pengajuan/files/${e.id}`,{headers:{Authorization:`Bearer ${b}`}});if(!s.ok)throw new Error("Gagal mengambil file");const t=await s.blob(),i=URL.createObjectURL(t),l=document.createElement("a");l.href=i,l.download=e.file_name||"file.pdf",document.body.appendChild(l),l.click(),l.remove(),setTimeout(()=>URL.revokeObjectURL(i),5e3)}catch{za("Gagal mengunduh file")}},T=e=>{const s=document.getElementById(`replace-${sa(e)}`);s&&s.click()},E=()=>{if(!(y!=null&&y.jabatan_name)||!o)return!0;const e=String(y.jabatan_name).toLowerCase(),s=String(o).toLowerCase();return e!==s?(N("Jabatan Tidak Sesuai",`Jenis jabatan yang Anda pilih tidak sama dengan yang diajukan oleh operator.

• Diajukan operator: ${y.jabatan_name}
• Dipilih admin wilayah: ${o}

Silakan pilih jenis jabatan yang sesuai terlebih dahulu, lalu ulangi upload.`),!1):!0},N=(e,s)=>{ua(e),da(s),z(!0)},Ta=(e,s)=>{s.preventDefault(),s.stopPropagation(),S(e),A(!0)},Da=(e,s)=>{s.preventDefault(),s.stopPropagation(),s.currentTarget.contains(s.relatedTarget)||(S(null),A(!1))},Ka=e=>{e.preventDefault(),e.stopPropagation()},Aa=(e,s)=>{var i;if(s.preventDefault(),s.stopPropagation(),!E()){S(null),A(!1);return}const t=s.dataTransfer.files;if(t&&t.length>0){const l=t[0],u=[".pdf",".doc",".docx"],x="."+((i=l.name.split(".").pop())==null?void 0:i.toLowerCase());if(!u.includes(x)){N("Format File Tidak Didukung","Hanya file PDF, DOC, dan DOCX yang diizinkan untuk diupload."),S(null),A(!1);return}const O=e==="skp_2_tahun_terakhir"?1.7*1024*1024:500*1024;if(l.size>O){N("Ukuran File Terlalu Besar",`Ukuran file maksimal ${e==="skp_2_tahun_terakhir"?"1.7MB":"500KB"}. Silakan kompres file atau pilih file yang lebih kecil.`),S(null),A(!1);return}W(e,l)}S(null),A(!1)};return ia?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3"}),a.jsx("div",{className:"space-y-3",children:[...Array(5)].map((e,s)=>a.jsx("div",{className:"h-20 bg-gray-200 rounded"},s))})]})}):H?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"text-center py-8",children:[a.jsx(Ba,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Files"}),a.jsx("p",{className:"text-gray-600 mb-4",children:H}),a.jsxs(U,{onClick:$,className:"flex items-center gap-2",children:[a.jsx(ka,{className:"h-4 w-4"}),"Retry"]})]})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Upload File Admin Wilayah"}),a.jsxs(U,{onClick:()=>{$(),Y()},variant:"outline",size:"sm",children:[a.jsx(ka,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Dokumen Wajib Admin Wilayah"}),a.jsx("div",{className:"text-sm text-gray-600",children:`${P.filter(s=>f.some(t=>t.file_type===s.file_type)).length}/${P.length} berkas sudah diupload`})]}),a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:P.map(e=>{const s=aa(e.file_type),t=ea(e.file_type),i=n==="admin_wilayah_rejected",l=(t==null?void 0:t.verification_status)==="approved",u=(t==null?void 0:t.verification_status)==="rejected",x=i&&l,O=i?!x&&u:!0;return i&&!t?null:a.jsx(oa,{className:`border ${x?"border-green-200 bg-green-50":u?"border-red-200 bg-red-50":"border-gray-200"}`,children:a.jsx(ca,{className:"p-3",children:a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h4",{className:"font-medium text-gray-900 text-sm leading-tight",title:m(e),children:m(e)}),e.is_required&&a.jsx(j,{variant:"destructive",className:"text-[10px] py-0 px-1.5",children:"Wajib"})]}),l?a.jsxs(j,{className:"bg-green-600 text-white flex items-center gap-1 text-xs",children:[a.jsx(G,{className:"h-3 w-3"}),"Sesuai"]}):u?a.jsxs(j,{className:"bg-red-600 text-white flex items-center gap-1 text-xs",children:[a.jsx(ta,{className:"h-3 w-3"}),"Ditolak"]}):s==="uploaded"?a.jsxs(j,{className:"bg-blue-600 text-white flex items-center gap-1 text-xs",children:[a.jsx(I,{className:"h-3 w-3"}),"Uploaded"]}):a.jsxs(j,{variant:"secondary",className:"flex items-center gap-1 text-xs",children:[a.jsx(I,{className:"h-3 w-3"}),"Pending"]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("p",{className:"text-xs text-gray-500",children:["PDF (maks. ",e.file_type==="skp_2_tahun_terakhir"?"1.7MB":"500KB",")"]}),a.jsx(Sa,{progress:L[e.file_type]||0,isUploading:v[e.file_type],className:"mt-2"}),s==="uploaded"&&t&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:`flex items-center gap-1 text-xs ${l?"text-green-600":u?"text-red-600":"text-blue-600"}`,children:[l?a.jsx(G,{className:"h-3 w-3"}):u?a.jsx(ta,{className:"h-3 w-3"}):a.jsx(I,{className:"h-3 w-3"}),a.jsx("span",{className:"truncate",children:t.file_name}),a.jsxs("span",{className:"text-gray-500",children:["(",Z(t.file_size),")"]})]}),u&&t.verification_notes&&a.jsxs("p",{className:"text-xs text-red-600 italic",children:["Catatan: ",t.verification_notes]}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx(U,{size:"sm",variant:"outline",onClick:()=>_(t),className:"h-6 px-2 text-xs",children:a.jsx(Ra,{className:"h-3 w-3"})}),a.jsx(U,{size:"sm",variant:"outline",onClick:()=>w(t),className:"h-6 px-2 text-xs",children:a.jsx(Ea,{className:"h-3 w-3"})}),(!i||u)&&a.jsxs(a.Fragment,{children:[a.jsx(U,{size:"sm",variant:"outline",onClick:()=>T(e.file_type),className:"h-6 px-2 text-xs",children:a.jsx(Ma,{className:"h-3 w-3"})}),a.jsx("input",{id:`replace-${sa(e.file_type)}`,type:"file",className:"hidden",accept:".pdf,.doc,.docx",onChange:g=>{var F;const M=(F=g.target.files)==null?void 0:F[0];M&&(W(e.file_type,M),g.target.value="")}})]})]}),x&&a.jsx("p",{className:"text-xs text-green-600 italic",children:"File ini sudah sesuai dan tidak perlu diperbaiki"})]}),O&&s!=="uploaded"&&a.jsxs("div",{className:`relative border-2 border-dashed rounded-lg p-6 transition-all duration-200 cursor-pointer w-full h-32 ${R===e.file_type?"border-green-500 bg-green-50":"border-gray-300 hover:border-green-400 hover:bg-gray-50"} ${v[e.file_type]?"pointer-events-none opacity-50":""}`,onDragEnter:g=>Ta(e.file_type,g),onDragLeave:g=>Da(e.file_type,g),onDragOver:Ka,onDrop:g=>Aa(e.file_type,g),onClick:()=>{const g=document.getElementById(`file-${sa(e.file_type)}`);g&&!g.disabled&&!v[e.file_type]&&g.click()},children:[a.jsx("div",{className:"flex flex-col items-center justify-center h-full text-center",children:v[e.file_type]?a.jsx("div",{className:"w-full max-w-xs",children:a.jsx(Sa,{progress:L[e.file_type]||0,isUploading:v[e.file_type]})}):R===e.file_type?a.jsxs(a.Fragment,{children:[a.jsx(ya,{className:"h-8 w-8 text-green-500 mb-2"}),a.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Lepaskan file di sini"})]}):a.jsxs(a.Fragment,{children:[a.jsx(ya,{className:"h-6 w-6 text-gray-400 mb-2"}),a.jsx("p",{className:"text-xs text-gray-600 leading-tight",children:"Drag & drop file di sini atau klik untuk memilih"})]})}),a.jsx("input",{type:"file",accept:".pdf,.doc,.docx",onChange:g=>{var F;const M=(F=g.target.files)==null?void 0:F[0];M&&(W(e.file_type,M),g.target.value="")},className:"hidden",id:`file-${sa(e.file_type)}`})]}),i&&!t&&a.jsx("p",{className:"text-xs text-gray-500 italic",children:"File ini belum diupload"})]})]})})},e.id)})})]}),a.jsx(ma,{open:X,onOpenChange:z,children:a.jsxs(ga,{className:"max-w-md",children:[a.jsxs(pa,{children:[a.jsxs(ha,{className:"flex items-center gap-2 text-red-600 text-lg",children:[a.jsx(ta,{className:"h-5 w-5"}),Q]}),a.jsx(_a,{className:"text-gray-700 whitespace-pre-line leading-relaxed",children:la})]}),a.jsx(xa,{children:a.jsx(ja,{onClick:()=>z(!1),className:"bg-red-600 hover:bg-red-700",children:"Tutup"})})]})})]})},ee=({uploaded:c,total:o,isComplete:k,className:h=""})=>{const n=o>0?Math.round(c/o*100):0;return a.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 ${h}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Progress Upload Dokumen"}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:[c," dari ",o," dokumen"]}),a.jsxs("div",{className:"text-lg font-bold text-green-600",children:[n,"%"]})]})]}),a.jsx("div",{className:"mb-4",children:a.jsx(Oa,{value:n,className:"h-3 bg-gray-200"})}),a.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[a.jsx(G,{className:"h-4 w-4"}),a.jsxs("span",{children:[c," Terupload"]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[a.jsx(Fa,{className:"h-4 w-4"}),a.jsxs("span",{children:[o-c," Belum"]})]}),k&&a.jsxs("div",{className:"flex items-center gap-2 text-green-600 font-medium",children:[a.jsx(G,{className:"h-4 w-4"}),a.jsx("span",{children:"Upload Selesai"})]})]})]})},oe=()=>{var W,Z,aa,ea;const{pengajuanId:c}=Wa(),o=Ia(),{token:k,user:h}=wa(),[n,y]=d.useState(null),[b,D]=d.useState(!0);d.useState(!1);const{submitForm:na,isSubmitting:P}=va(),[ra,f]=d.useState(!1),[J,v]=d.useState(!1),[C,L]=d.useState(""),[B,ia]=d.useState([]),[K,H]=d.useState(""),[p,R]=d.useState({required:0,total:0,isComplete:!1}),S=(n==null?void 0:n.status)==="admin_wilayah_rejected"&&!!(n!=null&&n.final_rejected_at),V=async()=>{var r,m;if(!(!k||!c)){D(!0);try{const _=await q(`/api/admin-wilayah/pengajuan/${c}`,k);if(_&&_.success!==!1){y(_.pengajuan||((r=_.data)==null?void 0:r.pengajuan)||_);const w=_.uploadProgress||((m=_.data)==null?void 0:m.uploadProgress);if(w){const T=Number(w.required??0),E=Number(w.total??0),N=typeof w.isComplete=="boolean"?w.isComplete:T>=E;R({required:T,total:E,isComplete:N})}else R({required:0,total:0,isComplete:!1})}else y(null),R({required:0,total:0,isComplete:!1})}catch{y(null)}finally{D(!1)}}},A=async()=>{try{const r=await q("/api/admin-wilayah-file-config",k);if(r!=null&&r.success&&Array.isArray(r.data)){const m=new Map;r.data.forEach(w=>{var N;const T=w.jenis_jabatan_id,E=((N=w.jenis_jabatan)==null?void 0:N.jenis_jabatan)||`Jabatan ${T}`;T&&!m.has(T)&&m.set(T,E)});const _=Array.from(m.values());ia(_),_.length>0&&!K&&H(_[0])}}catch{}};d.useEffect(()=>{V(),A()},[c,k]);const X=r=>new Date(r).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),z=(r,m)=>{switch(r){case"approved":return a.jsx(j,{className:"bg-green-600 text-white",children:"Disetujui Kab/Kota"});case"rejected":return a.jsx(j,{className:"bg-red-600 text-white",children:"Ditolak Admin Wilayah"});case"admin_wilayah_approved":return a.jsx(j,{className:"bg-green-700 text-white",children:"Disetujui Admin Wilayah"});case"admin_wilayah_rejected":return a.jsx(j,{className:"bg-red-600 text-white",children:"Ditolak Superadmin"});case"admin_wilayah_submitted":return a.jsx(j,{className:"bg-blue-600 text-white",children:"Diajukan Admin Wilayah"});case"submitted":return a.jsx(j,{className:"bg-blue-600 text-white",children:"Dikirim ke Superadmin"});default:return a.jsx(j,{className:"bg-gray-600 text-white",children:r})}},la=async()=>{!k||!c||na(async()=>{try{const r=await Na(`/api/admin-wilayah/pengajuan/${c}/submit-to-superadmin`,{},k);(r==null?void 0:r.success)!==!1&&(L("Pengajuan berhasil diajukan ke Superadmin"),f(!0),r.pengajuan&&y(r.pengajuan)),await V()}catch(r){L((r==null?void 0:r.message)||"Terjadi kesalahan saat mengajukan ke Superadmin"),v(!0)}},()=>{},r=>{})};if(b)return a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsx("div",{className:"max-w-6xl mx-auto",children:a.jsxs("div",{className:"animate-pulse space-y-6",children:[a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),a.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})})});if(!n)return a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsx("div",{className:"max-w-6xl mx-auto",children:a.jsxs("div",{className:"text-center py-12",children:[a.jsx(I,{className:"h-16 w-16 mx-auto text-gray-300 mb-4"}),a.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Pengajuan Tidak Ditemukan"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Pengajuan yang Anda cari tidak ditemukan atau tidak memiliki akses."}),a.jsxs(U,{onClick:()=>o("/admin-wilayah/dashboard"),className:"bg-green-600 hover:bg-green-700 text-white",children:[a.jsx(ba,{className:"h-4 w-4 mr-2"}),"Kembali ke Dashboard"]})]})})});const da=(n==null?void 0:n.status)!=="admin_wilayah_rejected"||!(n!=null&&n.files)||!Array.isArray(n.files)?!1:n.files.filter(m=>m.file_category==="admin_wilayah").some(m=>m.verification_status==="rejected"),Q=n.status==="draft"&&n.created_by===(h==null?void 0:h.id),ua=n.status==="admin_wilayah_approved"||n.status==="admin_wilayah_submitted"||n.status==="admin_wilayah_rejected"||S||Q,$=n.status==="admin_wilayah_submitted"||n.status==="admin_wilayah_rejected"&&da||(Q||n.status!=="admin_wilayah_rejected")&&!p.isComplete,Y=n.status==="admin_wilayah_submitted"?"Sudah Diajukan":S||n.status==="admin_wilayah_rejected"?"Ajukan Lagi ke Superadmin":"Ajukan ke Superadmin";return a.jsxs("div",{className:"min-h-screen bg-background p-6",children:[a.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[a.jsx(Za,{title:"Upload File Admin Wilayah",subtitle:"Upload file tambahan untuk pengajuan mutasi pegawai",actions:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(j,{className:"bg-green-100 text-green-800",children:"Admin Wilayah"}),z(n.status),a.jsxs(U,{variant:"outline",onClick:()=>o("/admin-wilayah/dashboard"),className:"border-green-200 text-green-700 hover:bg-green-50",children:[a.jsx(ba,{className:"h-4 w-4 mr-2"}),"Kembali"]})]})}),a.jsxs(oa,{className:"border-green-200 bg-green-50",children:[a.jsx(fa,{children:a.jsxs(Pa,{className:"text-green-800 flex items-center gap-2",children:[a.jsx(I,{className:"h-5 w-5"}),"Informasi Pengajuan"]})}),a.jsx(ca,{children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Ua,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:((W=n.pegawai)==null?void 0:W.nama)||"-"}),a.jsxs("p",{className:"text-sm text-gray-600",children:["NIP: ",((Z=n.pegawai)==null?void 0:Z.nip)||"-"]})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Ja,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:((aa=n.office)==null?void 0:aa.kabkota)||"-"}),a.jsx("p",{className:"text-sm text-gray-600",children:((ea=n.office)==null?void 0:ea.name)||"-"})]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(I,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Jenis Jabatan"}),a.jsx("p",{className:"text-sm text-gray-600",children:n.jenis_jabatan})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Ca,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Tanggal Pengajuan"}),a.jsx("p",{className:"text-sm text-gray-600",children:X(n.created_at)})]})]})]})]})})]}),a.jsxs(oa,{children:[a.jsx(fa,{children:a.jsx(Pa,{className:"text-green-800",children:"Upload File Admin Wilayah"})}),a.jsxs(ca,{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Jenis Berkas Admin Wilayah"}),a.jsxs(qa,{value:K,onValueChange:H,children:[a.jsx(Ga,{className:"w-full max-w-md",children:a.jsx(Va,{placeholder:"Pilih jenis berkas..."})}),a.jsx(Xa,{children:B.map(r=>a.jsx(Qa,{value:r,children:r},r))})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Pilih jenis berkas yang sudah dikonfigurasi oleh superadmin"})]}),K&&p.total>0&&a.jsx(ee,{uploaded:p.required,total:p.total,isComplete:p.isComplete,className:"mb-6"}),(S||n.status==="admin_wilayah_rejected")&&a.jsxs("div",{className:"mb-4 rounded-lg border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[a.jsx("p",{className:"font-semibold mb-1",children:"Dokumen Admin Wilayah Ditolak"}),a.jsx("p",{children:n.final_rejection_reason||n.rejection_reason||"Perbaiki dokumen admin wilayah yang ditolak sebelum mengirim ulang ke Superadmin."}),(n.final_rejected_at||n.rejected_at)&&a.jsxs("p",{className:"text-xs text-red-600 mt-2",children:["Ditolak pada: ",X(n.final_rejected_at||n.rejected_at)]})]}),K&&a.jsx(ae,{pengajuanId:n.id,jenisJabatanId:K,onFilesUploaded:()=>V(),onProgressChange:(r,m)=>R({required:r,total:m,isComplete:r>=m&&m>0}),pengajuanStatus:n.status,pengajuanData:n})]})]}),a.jsx("div",{className:"flex items-center justify-end gap-3",children:ua&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{className:"text-sm text-gray-600 mr-2",children:[p.required,"/",p.total," berkas wajib"]}),a.jsxs(Ya,{onClick:$?()=>{}:la,className:`bg-green-600 hover:bg-green-700 text-white ${$?"opacity-50 cursor-not-allowed":""}`,isProcessing:P,processingText:"Mengirim...",onError:()=>{},onSuccess:()=>{},children:[a.jsx($a,{className:"h-4 w-4 mr-2"}),Y]})]})})]}),a.jsx(ma,{open:ra,onOpenChange:f,children:a.jsxs(ga,{children:[a.jsxs(pa,{children:[a.jsxs(ha,{className:"flex items-center gap-2 text-green-600 text-lg",children:[a.jsx(G,{className:"h-5 w-5"}),"Berhasil!"]}),a.jsx(_a,{className:"text-gray-700",children:C})]}),a.jsx(xa,{children:a.jsx(ja,{onClick:()=>f(!1),className:"bg-green-600 hover:bg-green-700",children:"OK"})})]})}),a.jsx(ma,{open:J,onOpenChange:v,children:a.jsxs(ga,{children:[a.jsxs(pa,{children:[a.jsxs(ha,{className:"flex items-center gap-2 text-red-600 text-lg",children:[a.jsx(ta,{className:"h-5 w-5"}),"Gagal Mengajukan"]}),a.jsx(_a,{className:"text-gray-700",children:C})]}),a.jsx(xa,{children:a.jsx(ja,{onClick:()=>v(!1),className:"bg-red-600 hover:bg-red-700",children:"OK"})})]})})]})};export{oe as default};
