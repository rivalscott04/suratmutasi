import{j as e,F as z,a3 as H,ak as D,aw as S,a8 as se,E as ae,b2 as te,aa as le,al as ie,T as ne}from"./ui-vendor-B7g5fNgE.js";import{r as l}from"./react-vendor-BNG1zHOu.js";import{u as re,d as ce,a as de,I as me,b as f,B as C,D as xe,e as oe,f as he,g as je}from"./index-g1s1_fPK.js";import{C as c,c as d}from"./card-C_egXJqT.js";import{T as ge,a as ue,b as F,c as n,d as pe,e as r}from"./table-DC9DJ01i.js";import{S as Ne,a as fe,b as be,c as ve,d as T}from"./select-CW3QVZlJ.js";import{P as K}from"./PageHeader-BG6jCPR9.js";const Te=()=>{var L,A;const{user:b,token:O}=re(),{toast:$}=ce(),[J,R]=l.useState([]),[V,P]=l.useState(!0),[x,G]=l.useState(""),[j,g]=l.useState(1),[u,U]=l.useState(10),[t,q]=l.useState(null),[Q,I]=l.useState(!1),[p,W]=l.useState({tracked:0,completed:0,inProgress:0,overdue:0});l.useEffect(()=>{X()},[]);const X=async()=>{try{P(!0);const a=(b==null?void 0:b.office_id)===null?"/api/tracking/superadmin":"/api/tracking/admin",i=await de(a,O);i.success&&(R(i.data),Y(i.data))}catch(s){console.error("Error loading tracking data:",s),$({title:"Error",description:"Gagal memuat data tracking",variant:"destructive"})}finally{P(!1)}},Y=s=>{let a=0,i=0,o=0,h=0;s.forEach(k=>{if(k.tracking&&k.tracking.length>0){a++;const N=k.tracking[0];if(N.status_name.includes("Selesai"))i++;else if(o++,N.estimated_days){const _=new Date(N.created_at);_.setDate(_.getDate()+N.estimated_days),new Date>_&&h++}}}),W({tracked:a,completed:i,inProgress:o,overdue:h})},Z=s=>{q(s),I(!0)},m=J.filter(s=>{var a;return s.pegawai_nip.toLowerCase().includes(x.toLowerCase())||s.jenis_jabatan.toLowerCase().includes(x.toLowerCase())||((a=s.office)==null?void 0:a.kabkota.toLowerCase().includes(x.toLowerCase()))});l.useEffect(()=>{g(1)},[x]);const v=Math.max(1,Math.ceil(m.length/u)),y=(j-1)*u,B=y+u,ee=m.slice(y,B),E=s=>s.includes("Selesai")?e.jsx(H,{className:"h-4 w-4 text-green-600"}):s.includes("Diproses")?e.jsx(D,{className:"h-4 w-4 text-blue-600"}):s.includes("Disposisi")?e.jsx(ne,{className:"h-4 w-4 text-orange-600"}):e.jsx(S,{className:"h-4 w-4 text-gray-600"}),M=(s,a=!1)=>s.includes("Selesai")?"bg-green-100 text-green-700 border-green-200":s.includes("Diproses")?`bg-blue-100 text-blue-700 border-blue-200 ${a?"border-red-400 text-red-700":""}`:s.includes("Disposisi")?"bg-orange-100 text-orange-700 border-orange-200":s.includes("Menunggu")?"bg-yellow-100 text-yellow-700 border-yellow-200":"bg-gray-100 text-gray-700 border-gray-200",w=s=>{if(!s.estimated_days)return!1;const a=new Date(s.created_at);return a.setDate(a.getDate()+s.estimated_days),new Date>a&&!s.status_name.includes("Selesai")};return V?e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx(K,{title:"Tracking Dokumen",subtitle:"Monitor progress berkas di pusat"}),e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,a)=>e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"})]})})},a))})]}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx(K,{title:"Tracking Dokumen",subtitle:"Monitor progress berkas di pusat"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Memiliki riwayat tracking"}),e.jsx("p",{className:"text-2xl font-bold",children:p.tracked})]})]})})}),e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Selesai"}),e.jsx("p",{className:"text-2xl font-bold",children:p.completed})]})]})})}),e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(D,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Dalam Proses"}),e.jsx("p",{className:"text-2xl font-bold",children:p.inProgress})]})]})})}),e.jsx(c,{children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(S,{className:"h-8 w-8 text-red-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Terlambat"}),e.jsx("p",{className:"text-2xl font-bold",children:p.overdue})]})]})})})]}),e.jsx(c,{className:"mb-6",children:e.jsx(d,{className:"p-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(me,{placeholder:"Cari berdasarkan NIP, jenis jabatan, atau kabupaten...",value:x,onChange:s=>G(s.target.value),className:"pl-10"})]})})}),e.jsx(c,{children:e.jsx(d,{className:"p-0",children:m.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Tidak ada data tracking"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ge,{children:[e.jsx(ue,{children:e.jsxs(F,{children:[e.jsx(n,{children:"NIP"}),e.jsx(n,{children:"Nama Pegawai"}),e.jsx(n,{children:"Jabatan"}),e.jsx(n,{children:"Kab/Kota"}),e.jsx(n,{children:"Status Terakhir"}),e.jsx(n,{children:"Estimasi"}),e.jsx(n,{children:"Tgl Final"}),e.jsx(n,{children:"Aksi"})]})}),e.jsx(pe,{children:ee.map(s=>{var o,h;const a=s.tracking&&s.tracking.length>0?s.tracking[0]:null,i=s.final_approved_at?new Date(s.final_approved_at).toLocaleDateString("id-ID"):"Belum ditentukan";return e.jsxs(F,{children:[e.jsx(r,{className:"font-medium",children:s.pegawai_nip}),e.jsx(r,{children:((o=s.pegawai)==null?void 0:o.nama)||"â€”"}),e.jsx(r,{children:e.jsx(f,{variant:"outline",children:s.jenis_jabatan})}),e.jsx(r,{children:((h=s.office)==null?void 0:h.kabkota)||"N/A"}),e.jsx(r,{children:a?e.jsxs("div",{className:"flex items-center gap-2",children:[E(a.status_name),e.jsx(f,{title:a.status_name,className:`cursor-default hover:brightness-95 ${M(a.status_name,w(a))}`,children:a.status_name})]}):e.jsx("span",{className:"text-gray-500",children:"Belum ada"})}),e.jsx(r,{children:a!=null&&a.estimated_days?`${a.estimated_days} hari`:"-"}),e.jsx(r,{children:i}),e.jsx(r,{children:e.jsxs(C,{size:"sm",variant:"outline",className:"flex items-center gap-2",onClick:()=>Z(s),children:[e.jsx(ae,{className:"h-4 w-4"})," Detail"]})})]},s.id)})})]})})})}),m.length>0&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Menampilkan ",y+1,"-",Math.min(B,m.length)," dari ",m.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mr-2",children:[e.jsx("span",{children:"Tampilkan"}),e.jsxs(Ne,{value:String(u),onValueChange:s=>{U(Number(s)),g(1)},children:[e.jsx(fe,{className:"h-8 w-[84px]",children:e.jsx(be,{})}),e.jsxs(ve,{children:[e.jsx(T,{value:"10",children:"10"}),e.jsx(T,{value:"25",children:"25"}),e.jsx(T,{value:"50",children:"50"})]})]}),e.jsx("span",{children:"per halaman"})]}),e.jsx(C,{variant:"outline",size:"sm",onClick:()=>g(s=>Math.max(1,s-1)),disabled:j===1,children:"Sebelumnya"}),e.jsxs("span",{className:"text-sm",children:["Hal ",j," / ",v]}),e.jsx(C,{variant:"outline",size:"sm",onClick:()=>g(s=>Math.min(v,s+1)),disabled:j===v,children:"Berikutnya"})]})]}),e.jsx(xe,{open:Q,onOpenChange:I,children:e.jsxs(oe,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(he,{children:e.jsx(je,{children:"Detail Tracking"})}),t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h3",{className:"font-semibold text-xl leading-tight",children:((L=t.pegawai)==null?void 0:L.nama)||"-"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 font-mono",children:["NIP: ",t.pegawai_nip]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Jenis Jabatan:"}),e.jsx("p",{className:"text-gray-600",children:t.jenis_jabatan})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Kabupaten/Kota:"}),e.jsx("p",{className:"text-gray-600",children:((A=t.office)==null?void 0:A.kabkota)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Dokumen:"}),e.jsx("p",{className:"text-gray-600",children:t.total_dokumen})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Final Approved:"}),e.jsx("p",{className:"text-gray-600",children:t.final_approved_at?new Date(t.final_approved_at).toLocaleDateString("id-ID"):"Belum ditentukan"})]})]})]}),t.tracking&&t.tracking.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Riwayat Tracking"}),e.jsxs("div",{className:"relative pl-6",children:[e.jsx("div",{className:"absolute left-2 top-0 bottom-0 w-px bg-gray-200"}),e.jsx("div",{className:"space-y-6",children:t.tracking.map(s=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-[7px] top-1 h-3 w-3 rounded-full bg-green-600 ring-2 ring-white"}),e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[E(s.status_name),e.jsx(f,{title:s.status_name,className:`cursor-default hover:brightness-95 ${M(s.status_name,w(s))}`,children:s.status_name}),w(s)&&e.jsxs(f,{variant:"destructive",className:"text-xs",children:[e.jsx(te,{className:"h-3 w-3 mr-1"})," Terlambat"]})]}),e.jsxs("div",{className:"text-xs text-gray-600 flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(le,{className:"h-3 w-3"}),s.tracked_by_name]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ie,{className:"h-3 w-3"}),new Date(s.created_at).toLocaleString("id-ID")]}),s.estimated_days&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(D,{className:"h-3 w-3"}),"Estimasi: ",s.estimated_days," hari"]})]}),s.notes&&e.jsx("div",{className:"mt-2 text-sm text-gray-700",children:s.notes})]})]},s.id))})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(S,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Belum ada tracking untuk berkas ini"})]})]})]})})]})};export{Te as default};
//# sourceMappingURL=SuperadminTracking-ClvZUo-D.js.map
