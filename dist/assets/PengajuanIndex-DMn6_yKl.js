import{j as e,F as ae,aN as at,ao as oa,as as da,a9 as tt,aO as ye,aP as ca,E as ua,S as ha,a4 as te,aE as he,au as ma,aL as Ge,p as $e,aa as me,at as ga,al as pa}from"./ui-vendor-DQXcJUOU.js";import{e as st,h as nt,r as i,c as lt}from"./react-vendor-DheTkQGW.js";import{C as it,a as rt,b as ot,c as dt}from"./card-BeV_pkaD.js";import{u as ct,d as ut,a as Ee,B as u,I as xa,b as ge,p as ja,q as ba,r as fa,v as y,D as wa,e as va,f as ka,g as ya,l as ht,j as mt}from"./index-CJ4TIgCG.js";import{S as H,a as W,b as Z,c as q,d as g}from"./select-B1BtMOc_.js";import{T as Ie,a as Be,b as se,c as h,d as Me,e as x}from"./table-C2oqLzjl.js";import{A as gt,a as pt,b as xt,c as jt}from"./accordion-8NohyNGJ.js";import{A as bt,a as ft,b as wt,c as vt,d as kt,e as yt,g as Nt,f as St}from"./alert-dialog-BqFpiI6T.js";import{L as pe}from"./label-8uOJF15j.js";import{T as _t}from"./textarea-C0VzcFyF.js";import{f as Na}from"./errorFormatter-D6nNfdnT.js";import{S as Dt}from"./shepherd-lljao8WZ.js";const Re={BASE_URL:"/FE/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},Kt=()=>{const R=st(),[Sa,Ke]=nt(),{user:r,token:G,isAuthenticated:$}=ct(),{toast:k}=ut(),[P,_a]=i.useState([]),[ne,Ue]=i.useState(!0),[Le,xe]=i.useState(null),Y=(a,t)=>{const s=Sa.get(a);if(s!==null)return s;const n=sessionStorage.getItem(`pengajuan_filter_${a}`);return n||t},[v,Da]=i.useState(()=>Y("search","")),[j,Oe]=i.useState(()=>Y("status","all")),[N,Pa]=i.useState(()=>Y("created_by","all")),[S,Ca]=i.useState(()=>Y("jenis_jabatan","all")),[o,b]=i.useState(()=>{const a=Y("page","1");return parseInt(a,10)||1}),[K,Fa]=i.useState(1),[E,Ta]=i.useState(0),[Aa,je]=i.useState(!1),[Je,Ne]=i.useState(null),[Se,ze]=i.useState(!1),[Ga,le]=i.useState(!1),[U,be]=i.useState(null),[ie,re]=i.useState(""),[Ve,oe]=i.useState(""),[He,We]=i.useState(!1),[I,$a]=i.useState({users:[],statuses:[],jenisJabatan:[]}),[B,Ea]=i.useState(()=>Y("kabupaten_group","all")),[fe,Ze]=i.useState({}),L=i.useRef(null),[_e,we]=i.useState(!1),[C,Ia]=i.useState("jabatan"),[O,J]=i.useState(""),[De,qe]=i.useState(!1),[Ye,de]=i.useState(""),[_,Ba]=i.useState({jenisJabatan:[],pegawai:[]}),[M,Qe]=i.useState(!1),[Pe,ce]=i.useState(""),[Ma,Q]=i.useState(!1),[D,ve]=i.useState([]),z=50,c=(r==null?void 0:r.role)==="admin",m=(r==null?void 0:r.role)==="user",Xe=(r==null?void 0:r.role)==="bimas",ea=(r==null?void 0:r.role)==="kanwil",Ra=(r==null?void 0:r.role)==="admin_wilayah",aa=m||Xe,Ce=c||m||Xe,X=lt.useMemo(()=>{if(!Ce)return{};if(Object.keys(fe).length>0)return console.log(" Using server grouping:",fe),fe;if(!P||P.length===0)return{};console.log(" Using client grouping, pengajuanList length:",P.length);const a=P.reduce((t,s)=>{var l;const n=s.office&&(s.office.kabkota||s.office.name)||s.pegawai&&s.pegawai.induk_unit||((l=s.pegawai)==null?void 0:l.unit_kerja)||"Lainnya";return t[n]||(t[n]=[]),t[n].push(s),t},{});return console.log(" Client grouped result:",a),a},[Ce,fe,P]),Fe=i.useCallback(()=>{if(!m){k({title:"Tutorial khusus pengguna tracking",description:"Menu ini hanya tersedia untuk role user yang fokus tracking."});return}if(ne){k({title:"Tunggu sebentar",description:"Kami masih menyiapkan data pengajuan untuk tur."});return}if(Object.values(X).reduce((n,l)=>n+l.length,0)===0){k({title:"Data belum tersedia",description:"Tidak ada pengajuan untuk ditampilkan. Coba sesuaikan filter atau kembali lagi nanti.",variant:"destructive"});return}L.current&&(L.current.cancel(),L.current=null),sessionStorage.removeItem("pending_pengajuan_list_tour"),setTimeout(()=>{const n=document.querySelector('[data-tour-id="pengajuan-accordion"] button');n&&n.getAttribute("aria-expanded")!=="true"&&n.click()},0);const t=new Dt.Tour({useModalOverlay:!0,defaultStepOptions:{cancelIcon:{enabled:!0},classes:"bg-white shadow-xl rounded-lg border border-gray-200 text-gray-800",scrollTo:{behavior:"smooth",block:"center"}}}),s=n=>{const l=[{text:"Lewati",classes:"shepherd-button-secondary text-gray-500",action:async()=>{t.cancel()}}];return n!=null&&n.showBack&&l.push({text:"Kembali",classes:"shepherd-button-secondary",action:async()=>{t.back()}}),l.push({text:n!=null&&n.isFinal?"Selesai":"Lanjut",classes:"shepherd-button-primary bg-green-600 text-white hover:bg-green-700",action:async()=>{n!=null&&n.isFinal?t.complete():t.next()}}),l};t.addStep({id:"intro",title:"Daftar Pengajuan",text:"Halaman ini menampilkan seluruh pengajuan dengan grouping kabupaten/kota agar Anda mudah memilih dokumen mana yang akan dicek.",attachTo:{element:'[data-tour-id="pengajuan-header"]',on:"bottom"},buttons:s()}),t.addStep({id:"filters",title:"Filter & Pencarian",text:"Gunakan pencarian dan filter status untuk mempersempit daftar. Sistem otomatis menyimpan filter Anda.",attachTo:{element:'[data-tour-id="pengajuan-filter"]',on:"top"},buttons:s({showBack:!0})}),document.querySelector('[data-tour-id="pengajuan-jabatan-filter"]')&&t.addStep({id:"jabatan",title:"Filter Jenis Jabatan",text:"Khusus role user, filter ini membantu fokus pada jabatan tertentu (misal Guru, Fungsional).",attachTo:{element:'[data-tour-id="pengajuan-jabatan-filter"]',on:"bottom"},buttons:s({showBack:!0})}),t.addStep({id:"accordion",title:"Kelompok Kabupaten/Kota",text:"Setiap Kanwil memuat daftar kabupaten/kota. Klik untuk membuka tabel pengajuan di dalamnya.",attachTo:{element:'[data-tour-id="pengajuan-accordion"]',on:"top"},buttons:s({showBack:!0})}),t.addStep({id:"row-action",title:"Masuk ke Detail Pengajuan",text:"Gunakan tombol aksi “...” lalu pilih Lihat Detail untuk membuka dokumen dan catatan lengkap.",attachTo:{element:'[data-tour-id="pengajuan-row-action"]',on:"left"},buttons:s({showBack:!0})}),t.addStep({id:"finish",title:"Siap ke Halaman Detail",text:"Setelah menemukan pengajuan yang ingin dicek, buka detailnya. Kami akan menampilkan tur lanjutan otomatis ketika detail terbuka.",buttons:s({showBack:!0,isFinal:!0})}),t.on("complete",()=>{sessionStorage.setItem("pending_pengajuan_detail_tour","true"),sessionStorage.removeItem("pending_pengajuan_list_tour"),k({title:"Langkah berikutnya",description:"Buka salah satu pengajuan lalu klik Lihat Detail untuk melihat tur lanjutan."})}),t.on("cancel",()=>{sessionStorage.removeItem("pending_pengajuan_list_tour"),sessionStorage.removeItem("pending_pengajuan_detail_tour")}),t.start(),L.current=t},[m,ne,X,k]);i.useEffect(()=>{!ne&&m&&sessionStorage.getItem("pending_pengajuan_list_tour")==="true"&&Fe()},[ne,m,Fe]),i.useEffect(()=>()=>{L.current&&(L.current.cancel(),L.current=null)},[]),i.useEffect(()=>{if(!$)return;const a=new URLSearchParams;v&&a.set("search",v),j!=="all"&&a.set("status",j),N!=="all"&&a.set("created_by",N),S!=="all"&&a.set("jenis_jabatan",S),B!=="all"&&a.set("kabupaten_group",B),o>1&&a.set("page",o.toString()),Ke(a,{replace:!0}),sessionStorage.setItem("pengajuan_filter_search",v),sessionStorage.setItem("pengajuan_filter_status",j),sessionStorage.setItem("pengajuan_filter_created_by",N),sessionStorage.setItem("pengajuan_filter_jenis_jabatan",S),sessionStorage.setItem("pengajuan_filter_kabupaten_group",B),sessionStorage.setItem("pengajuan_filter_page",o.toString())},[$,v,j,N,S,B,o,Ke]),i.useEffect(()=>{if(!$){R("/");return}m&&j!=="final_approved"&&Oe("final_approved"),Te()},[$,R,o,j,N,S,B,m,v]),i.useEffect(()=>{$&&Ka()},[$,S,j,N,v]);const ta=i.useCallback(async()=>{if($)try{Qe(!0);const a=await Ee("/api/pengajuan/filter-options?status=final_approved",G);if(a.success){const{jenisJabatan:t=[],kabupatenGroups:s=[],pegawai:n=[]}=a.data||{};Ba({jenisJabatan:t,kabupatenGroups:s,pegawai:n})}}catch(a){console.error("Error fetching generate filter options:",a)}finally{Qe(!1)}},[$,G]);i.useEffect(()=>{_e&&(c||m)&&ta()},[_e,c,m,ta]);const Te=async()=>{var a,t,s;try{Ue(!0);const n=new URLSearchParams({page:o.toString(),limit:z.toString(),...j!=="all"&&{status:j},...S!=="all"&&{jenis_jabatan:S},...v&&{search:v},...c&&N!=="all"&&{created_by:N},...(c||m)&&B!=="all"&&{kabupaten_group:B},...ea&&(r==null?void 0:r.id)&&{created_by:r.id}}),l=await Ee(`/api/pengajuan?${n}`,G);if(l.success){if(_a(l.data),c){const w=l.grouped_by_kabkota;console.log(" Frontend received grouped data:",w),console.log(" Frontend received data length:",(a=l.data)==null?void 0:a.length),Ze(w||{})}const f=((t=l.pagination)==null?void 0:t.totalPages)||1,d=((s=l.pagination)==null?void 0:s.total)||0;Fa(f),Ta(d)}else xe(l.message||"Gagal mengambil data pengajuan")}catch(n){console.error("Error fetching pengajuan data:",n);const l=Na(n);xe(l)}finally{Ue(!1)}},Ka=async()=>{var a,t,s;try{console.log(" Fetching filter options...");const n=new URLSearchParams;S!=="all"&&n.set("jenis_jabatan",S),j!=="all"&&n.set("status",j),c&&N!=="all"&&n.set("created_by",N),v&&n.set("search",v);const l=n.toString(),f=l?`/api/pengajuan/filter-options?${l}`:"/api/pengajuan/filter-options",d=await Ee(f,G);console.log(" Filter options response:",d),d.success?($a(d.data),console.log(" Filter options set:",d.data),console.log(" Kabupaten groups:",(a=d.data)==null?void 0:a.kabupatenGroups),console.log(" Kabupaten groups length:",(s=(t=d.data)==null?void 0:t.kabupatenGroups)==null?void 0:s.length)):console.error(" Filter options failed:",d.message)}catch(n){console.error("Error fetching filter options:",n)}},Ua=a=>{Da(a),b(1)},La=a=>{m||(Oe(a),b(1))},Oa=a=>{Pa(a),b(1)},Ja=a=>{Ca(a),b(1)},za=a=>{Ea(a),b(1)},sa=i.useMemo(()=>{const a=_.pegawai||[],t=Pe.trim().toLowerCase();return t?a.filter(s=>s.nama&&s.nama.toLowerCase().includes(t)||s.nip&&s.nip.toLowerCase().includes(t)):a},[_.pegawai,Pe]),Va=(a,t)=>{if(D.find(n=>n.id===a)){ce(""),Q(!1);return}if(D.length>=20){k({title:"Batas tercapai",description:"Maksimal 20 pegawai per generate.",variant:"destructive"});return}const s=[...D,{id:a,label:t}];ve(s),J(s.map(n=>n.id)),ce(""),Q(!1)},Ha=a=>{const t=D.filter(s=>s.id!==a);ve(t),J(t.map(s=>s.id))},ee=a=>{R(`/pengajuan/${a}`)},Wa=async()=>{if(Je)try{ze(!0);const a=await ht(`/api/pengajuan/${Je}`,G);a.success?(Te(),je(!1),Ne(null)):xe(a.message||"Gagal menghapus pengajuan")}catch(a){console.error("Error deleting pengajuan:",a),xe("Terjadi kesalahan saat menghapus pengajuan")}finally{ze(!1)}},Za=async()=>{if(!(!U||!ie)){We(!0);try{const a=await mt(`/api/pengajuan/${U.id}/update-status`,{status:ie,reason:Ve},G);a.success?(k({title:"Berhasil",description:"Status pengajuan berhasil diubah"}),le(!1),be(null),re(""),oe(""),Te()):k({title:"Error",description:a.message||"Gagal mengubah status",variant:"destructive"})}catch(a){console.error("Error updating status:",a),k({title:"Error",description:"Terjadi kesalahan saat mengubah status",variant:"destructive"})}finally{We(!1)}}},Ae=(a,t)=>{const s=(d,w)=>{var F;return d!=="submitted"||!w?!1:((F=w.files)==null?void 0:F.some(T=>T.file_category==="admin_wilayah"))||!1},l={draft:{label:"Draft",className:"bg-gray-100 text-gray-800 hover:bg-gray-200",icon:pa},submitted:{label:s(a,t)?"Diajukan Admin Wilayah":"Diajukan",className:s(a,t)?"bg-blue-200 text-blue-800 hover:bg-blue-300":"bg-blue-100 text-blue-800 hover:bg-blue-200",icon:ae},approved:{label:"Disetujui",className:"bg-green-100 text-green-800 hover:bg-green-200",icon:te},rejected:{label:"Ditolak Admin Wilayah",className:"bg-red-100 text-red-800 hover:bg-red-200",icon:he},resubmitted:{label:"Diajukan Ulang",className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-200",icon:pa},admin_wilayah_approved:{label:"Disetujui Admin Wilayah",className:"bg-green-200 text-green-800 hover:bg-green-300",icon:te},admin_wilayah_rejected:{label:"Ditolak Superadmin",className:"bg-red-200 text-red-800 hover:bg-red-300",icon:he},admin_wilayah_submitted:{label:"Diajukan Admin Wilayah",className:"bg-blue-200 text-blue-800 hover:bg-blue-300",icon:ae},kanwil_submitted:{label:"Diajukan Kanwil",className:"bg-purple-200 text-purple-800 hover:bg-purple-300",icon:ae},kanwil_approved:{label:"Disetujui Kanwil",className:"bg-purple-300 text-purple-900 hover:bg-purple-400",icon:te},final_approved:{label:"Final Approved",className:"bg-green-600 text-white",icon:te},final_rejected:{label:"Final Rejected",className:"bg-red-600 text-white",icon:he}}[a]||{label:a,className:"bg-gray-100 text-gray-800",icon:ae},f=l.icon;return e.jsxs(ge,{className:l.className,children:[e.jsx(f,{className:"h-3 w-3 mr-1"}),l.label]})},na=a=>({guru:"Guru",eselon_iv:"Eselon IV",fungsional:"Fungsional",pelaksana:"Pelaksana"})[a]||a,la=a=>new Date(a).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),ia=()=>{const a=Object.keys(X).length>0?X:P.reduce((t,s)=>{var l;const n=s.office&&(s.office.kabkota||s.office.name)||s.pegawai&&s.pegawai.induk_unit||((l=s.pegawai)==null?void 0:l.unit_kerja)||"Lainnya";return t[n]||(t[n]=[]),t[n].push(s),t},{});return Object.entries(a).map(([t,s])=>({kabkota:t,total:s.length}))},ra=(a,t)=>{const s=URL.createObjectURL(a),n=document.createElement("a");n.href=s,n.download=t,document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(s)},qa=()=>{const a=ia(),t=new Date,n=`Rekap-final_approved-per-kabkota-${`${t.getFullYear()}${String(t.getMonth()+1).padStart(2,"0")}${String(t.getDate()).padStart(2,"0")}`}.xls`,l=`
      <html>
      <head><meta charset="UTF-8" /></head>
      <body>
        <table border="1">
          <thead>
            <tr><th>Kab/Kota</th><th>Jumlah Pengajuan Final Approved</th></tr>
          </thead>
          <tbody>
            ${a.map(d=>`<tr><td>${d.kabkota}</td><td>${d.total}</td></tr>`).join("")}
          </tbody>
        </table>
      </body>
      </html>`,f=new Blob([l],{type:"application/vnd.ms-excel"});ra(f,n)},Ya=()=>{const a=ia().sort((p,A)=>A.total-p.total),t=a.reduce((p,A)=>p+A.total,0),s=Math.max(1,...a.map(p=>p.total)),n=a.length,l=new Date,f=l.toLocaleString("id-ID",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),w=`Rekap-disetujui-kanwil-per-kabkota-${`${l.getFullYear()}${String(l.getMonth()+1).padStart(2,"0")}${String(l.getDate()).padStart(2,"0")}`}.pdf`,F=(r==null?void 0:r.full_name)||(r==null?void 0:r.email)||"Admin Pusat",T=a.slice(0,5),ue=window.open("","_blank");ue&&(ue.document.write(`
      <html>
        <head>
          <meta charset="UTF-8" />
          <title>${w}</title>
          <style>
            @page { size: A4; margin: 18mm 14mm; }
            * { box-sizing: border-box; }
            body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; color: #111827; }
            .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
            .title { font-size: 18px; font-weight: 700; }
            .meta { font-size: 12px; color: #4b5563; }
            .summary { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 8px; margin: 12px 0 16px; }
            .card { border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px; }
            .card h3 { font-size: 12px; color: #6b7280; margin: 0 0 4px; font-weight: 600; }
            .card .value { font-size: 20px; font-weight: 700; color: #111827; }
            table { border-collapse: collapse; width: 100%; margin-top: 4px; }
            th, td { border: 1px solid #e5e7eb; padding: 8px 10px; font-size: 12px; }
            th { background: #f9fafb; text-align: left; }
            tfoot td { font-weight: 700; background: #f3f4f6; }
            .row { display: flex; align-items: center; gap: 10px; }
            .bar { height: 8px; background: #d1fae5; border-radius: 4px; overflow: hidden; }
            .bar > span { display: block; height: 100%; background: #10b981; }
            .note { margin-top: 12px; font-size: 11px; color: #6b7280; }
            .section-title { margin-top: 16px; font-size: 14px; font-weight: 700; }
          </style>
        </head>
        <body>
          <div class="header">
            <div>
              <div class="title">Rekap Pengajuan Telah Disetujui Kanwil per Kab/Kota</div>
              <div class="meta">Dihasilkan: ${f} • Dibuat oleh: ${F}</div>
            </div>
          </div>

          <div class="summary">
            <div class="card">
              <h3>Total Telah Disetujui Kanwil</h3>
              <div class="value">${t}</div>
            </div>
            <div class="card">
              <h3>Jumlah Kab/Kota</h3>
              <div class="value">${n}</div>
            </div>
            <div class="card">
              <h3>Top Kab/Kota</h3>
              <div style="font-size:12px; color:#111827; line-height:1.4;">
                ${T.map((p,A)=>`${A+1}. ${p.kabkota} (${p.total})`).join("<br/>")||"-"}
              </div>
            </div>
          </div>

          <div class="section-title">Tabel Rekap</div>
          <table>
            <thead>
              <tr>
                <th style="width:36px;">No</th>
                <th>Kab/Kota</th>
                <th style="width:110px;">Jumlah</th>
                <th style="width:80px;">Persen</th>
                <th>Visual</th>
              </tr>
            </thead>
            <tbody>
              ${a.map((p,A)=>{const V=t>0?Math.round(p.total/t*1e3)/10:0,Xa=Math.round(p.total/s*100),ke=140,et=Math.max(1,Math.round(Xa/100*ke));return`
                  <tr>
                    <td>${A+1}</td>
                    <td>${p.kabkota}</td>
                    <td style="text-align:right; font-variant-numeric: tabular-nums;">${p.total}</td>
                    <td style="text-align:right; font-variant-numeric: tabular-nums;">${V.toFixed(1)}%</td>
                    <td>
                      <svg width="${ke}" height="10" viewBox="0 0 ${ke} 10" xmlns="http://www.w3.org/2000/svg">
                        <rect x="0" y="0" width="${ke}" height="10" fill="#E5F6F1" stroke="#D1D5DB" />
                        <rect x="0" y="0" width="${et}" height="10" fill="#10B981" />
                      </svg>
                    </td>
                  </tr>
                `}).join("")}
            </tbody>
            <tfoot>
              <tr>
                <td colspan="2">Total</td>
                <td style="text-align:right; font-variant-numeric: tabular-nums;">${t}</td>
                <td></td>
                <td></td>
              </tr>
            </tfoot>
          </table>

          <div class="note">Catatan: Laporan ini menampilkan pengajuan yang <strong>telah disetujui Kanwil</strong>.</div>

          <script>
            window.onload = function() { window.print(); };
          <\/script>
        </body>
      </html>
    `),ue.document.close())},Qa=async()=>{var n,l,f;if(!(C==="pegawai"?D.length>0:!!O)){k({title:"Error",description:"Pilih filter terlebih dahulu",variant:"destructive"});return}const t=new AbortController,s=setTimeout(()=>t.abort(),5*60*1e3);try{qe(!0),de("Sedang memproses data pengajuan dan membuat file ZIP...");const d=(Re==null?void 0:Re.VITE_API_URL)||(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"http://localhost:3000":""),w=d?`${d}/api/pengajuan/generate-download`:"/api/pengajuan/generate-download",F=await fetch(w,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${G}`},body:JSON.stringify({filter_type:C,filter_value:C==="pegawai"?D.map(V=>V.id):O}),signal:t.signal});if(clearTimeout(s),!F.ok){if(F.status===502)throw new Error("Server sedang sibuk atau timeout. Proses generate ZIP memakan waktu terlalu lama. Silakan coba lagi dengan filter yang lebih spesifik atau hubungi administrator.");const V=await F.json().catch(()=>({message:"Gagal generate download"}));throw new Error(V.message||"Gagal generate download")}const T=await F.json();if(!T.success)throw new Error(T.message||"Gagal generate download");de("File ZIP berhasil di-generate, sedang mengunduh...");const ue=d?`${d}${T.data.download_url}`:T.data.download_url,p=await fetch(ue,{headers:{Authorization:`Bearer ${G}`}});if(!p.ok){const V=await p.json().catch(()=>({message:"Gagal download file"}));throw new Error(V.message||"Gagal download file")}const A=await p.blob();ra(A,T.data.filename),k({title:"Berhasil",description:"File ZIP berhasil di-generate dan di-download"}),we(!1),J(""),de("")}catch(d){clearTimeout(s),console.error("Error generating download:",d);let w=Na(d);(d.name==="AbortError"||(n=d.message)!=null&&n.includes("aborted"))&&(w="Request timeout. Proses generate ZIP memakan waktu terlalu lama. Silakan coba lagi dengan filter yang lebih spesifik atau hubungi administrator."),((l=d.message)!=null&&l.includes("Failed to fetch")||(f=d.message)!=null&&f.includes("NetworkError"))&&(w="Tidak dapat terhubung ke server. Pastikan koneksi internet stabil atau server sedang dalam maintenance."),k({title:"Error",description:w,variant:"destructive"})}finally{qe(!1),de("")}};return console.log(" Debug PengajuanIndex:",{userRole:r==null?void 0:r.role,isAdmin:c,userEmail:r==null?void 0:r.email}),e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs(it,{children:[e.jsx(rt,{children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsxs(ot,{"data-tour-id":"pengajuan-header",className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5"}),"Daftar Pengajuan Mutasi PNS"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:c?"Semua pengajuan mutasi PNS":m?"Semua pengajuan berstatus final_approved (read-only)":ea?"Pengajuan mutasi PNS Anda (Kanwil)":"Pengajuan mutasi PNS Anda"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 w-full sm:w-auto",children:[m&&e.jsxs(u,{variant:"outline",onClick:Fe,className:"w-full sm:w-auto justify-center border-green-200 text-green-700",children:[e.jsx(at,{className:"h-4 w-4 mr-2"}),"Mulai Tutorial"]}),m&&e.jsxs(e.Fragment,{children:[e.jsx(u,{onClick:qa,className:"w-full sm:w-auto justify-center bg-green-600 hover:bg-green-700 text-white",children:"Export Excel"}),e.jsx(u,{onClick:Ya,className:"w-full sm:w-auto justify-center bg-blue-600 hover:bg-blue-700 text-white",children:"Export PDF"})]}),(c||m)&&e.jsxs(u,{onClick:()=>we(!0),className:"w-full sm:w-auto justify-center bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(oa,{className:"h-4 w-4 mr-2"}),"Generate Download"]}),!aa&&e.jsxs(u,{onClick:()=>R("/pengajuan/select"),className:"w-full sm:w-auto justify-center bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(da,{className:"h-4 w-4 mr-2"}),"Tambah Pengajuan"]})]})]})}),e.jsxs(dt,{children:[Le&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600",children:Le})}),e.jsxs("div",{className:"flex flex-col gap-4 mb-6","data-tour-id":"pengajuan-filter",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(tt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(xa,{placeholder:"Cari berdasarkan nama pegawai, jabatan, atau jenis jabatan...",value:v,onChange:a=>Ua(a.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-gray-400"}),e.jsxs(H,{value:j,onValueChange:La,children:[e.jsx(W,{className:"w-48",children:e.jsx(Z,{placeholder:"Filter Status"})}),e.jsxs(q,{children:[e.jsx(g,{value:"all",children:"Semua Status"}),I.statuses.filter(a=>a.count>0).map(a=>e.jsxs(g,{value:a.value,children:[a.label," (",a.count,")"]},a.value))]})]})]}),(m||c||Ra)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-gray-400"}),e.jsxs(H,{value:S,onValueChange:Ja,children:[e.jsx(W,{className:"w-48","data-tour-id":"pengajuan-jabatan-filter",children:e.jsx(Z,{placeholder:"Filter Jenis Jabatan"})}),e.jsxs(q,{children:[e.jsx(g,{value:"all",children:"Semua Jenis Jabatan"}),I.jenisJabatan.filter(a=>a.count>0).map(a=>e.jsxs(g,{value:a.value,children:[a.label," (",a.count,")"]},a.value))]})]})]}),(c||m)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-gray-400"}),e.jsxs(H,{value:B,onValueChange:za,children:[e.jsx(W,{className:"w-48",children:e.jsx(Z,{placeholder:"Filter Pulau/Wilayah"})}),e.jsxs(q,{children:[e.jsx(g,{value:"all",children:"Semua Pulau/Wilayah"}),I.kabupatenGroups&&I.kabupatenGroups.length>0?I.kabupatenGroups.filter(a=>a.count>0||a.groupName==="Sumbawa").map(a=>e.jsxs(g,{value:a.groupName,children:[a.groupName," (",a.count,")"]},a.groupName)):e.jsx(g,{value:"all",disabled:!0,children:"Memuat data..."})]})]})]}),c&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-4 w-4 text-gray-400"}),e.jsxs(H,{value:N,onValueChange:Oa,children:[e.jsx(W,{className:"w-48",children:e.jsx(Z,{placeholder:"Filter Pembuat"})}),e.jsxs(q,{children:[e.jsx(g,{value:"all",children:"Semua Pembuat"}),I.users.map(a=>e.jsx(g,{value:a.id,children:a.full_name||a.email||"Unknown User"},a.id))]})]})]})]})]}),Ce&&Object.keys(X).length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Tergabung berdasarkan kabupaten/kota"}),e.jsx(gt,{type:"multiple",className:"w-full","data-tour-id":"pengajuan-accordion",children:Object.entries(X).map(([a,t])=>e.jsxs(pt,{value:a,className:"border rounded-lg",children:[e.jsx(xt,{className:"px-4 py-3 hover:no-underline",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"font-medium",children:a}),e.jsx(ge,{variant:"secondary",className:"ml-2",children:t.length})]})}),e.jsx(jt,{className:"px-0",children:e.jsx("div",{className:"border-t",children:e.jsxs(Ie,{children:[e.jsx(Be,{children:e.jsxs(se,{children:[e.jsx(h,{children:"Pegawai"}),e.jsx(h,{children:"Jenis Jabatan"}),e.jsx(h,{children:"Status"}),e.jsx(h,{children:"Jumlah Dokumen"}),c&&e.jsx(h,{children:"Pembuat"}),e.jsx(h,{children:"Tanggal Dibuat"}),e.jsx(h,{className:"text-right",children:"Aksi"})]})}),e.jsx(Me,{children:t.map(s=>e.jsxs(se,{className:"hover:bg-gray-50",children:[e.jsx(x,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.pegawai.nama}),e.jsx("div",{className:"text-sm text-gray-500",children:s.pegawai.jabatan})]})}),e.jsx(x,{children:e.jsx(ge,{variant:"outline",children:na(s.jenis_jabatan)})}),e.jsx(x,{children:Ae(s.status,s)}),e.jsx(x,{children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-sm",children:s.files.length})})}),c&&e.jsx(x,{children:e.jsx("div",{className:"text-sm text-gray-600",children:(()=>{var l;const n=I.users.find(f=>f.id===s.created_by);return n?n.full_name||n.email||"Unknown User":(l=s.created_by)!=null&&l.includes("@")?s.created_by:"Unknown User"})()})}),e.jsx(x,{children:e.jsx("div",{className:"text-sm text-gray-600",children:la(s.created_at)})}),e.jsx(x,{className:"text-right",children:e.jsxs(ja,{children:[e.jsx(ba,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"sm","data-tour-id":"pengajuan-row-action",children:e.jsx(ca,{className:"h-4 w-4"})})}),e.jsxs(fa,{align:"end",children:[e.jsxs(y,{onClick:()=>ee(s.id),children:[e.jsx(ua,{className:"h-4 w-4 mr-2"}),"Lihat Detail"]}),c&&e.jsxs(y,{onClick:()=>{be(s),re(s.status),oe(""),le(!0)},children:[e.jsx(ha,{className:"h-4 w-4 mr-2"}),"Ubah Status"]}),c&&s.status==="admin_wilayah_submitted"&&e.jsxs(e.Fragment,{children:[e.jsxs(y,{onClick:()=>ee(s.id),children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Setujui"]}),e.jsxs(y,{onClick:()=>ee(s.id),children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Tolak"]})]}),c&&e.jsxs(y,{onClick:()=>{Ne(s.id),je(!0)},className:"text-red-600",children:[e.jsx(ma,{className:"h-4 w-4 mr-2"}),"Hapus"]})]})]})})]},s.id))})]})})})]},a))}),K>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Menampilkan ",(o-1)*z+1," sampai ",Math.min(o*z,E)," dari ",E," pengajuan"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>b(o-1),disabled:o===1,children:[e.jsx(Ge,{className:"h-4 w-4"}),"Sebelumnya"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:K},(a,t)=>t+1).map(a=>e.jsx(u,{variant:o===a?"default":"outline",size:"sm",onClick:()=>b(a),className:`w-8 h-8 p-0 ${o===a?"bg-green-600 hover:bg-green-700 text-white border-green-600":"bg-white hover:bg-green-50 text-gray-700 border-gray-300 hover:border-green-300"}`,children:a},a))}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>b(o+1),disabled:o===K,children:["Selanjutnya",e.jsx($e,{className:"h-4 w-4"})]})]})]})]}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:ne?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(me,{className:"h-8 w-8 animate-spin mr-2 text-green-600"}),e.jsx("span",{children:"Memuat data pengajuan..."})]}):P.length===0&&E===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ae,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-2",children:v||j!=="all"?"Tidak ada pengajuan yang sesuai dengan filter":"Belum ada pengajuan"}),!v&&j==="all"&&(r==null?void 0:r.role)!=="user"&&e.jsxs(u,{onClick:()=>R("/pengajuan/select"),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(da,{className:"h-4 w-4 mr-2"}),"Buat Pengajuan Pertama"]})]}):P.length===0&&E>0?e.jsxs(e.Fragment,{children:[e.jsxs(Ie,{children:[e.jsx(Be,{children:e.jsxs(se,{children:[e.jsx(h,{children:"Pegawai"}),e.jsx(h,{children:"Jenis Jabatan"}),e.jsx(h,{children:"Status"}),e.jsx(h,{children:"Jumlah Dokumen"}),e.jsx(h,{children:"Tanggal Dibuat"}),e.jsx(h,{children:"Aksi"})]})}),e.jsx(Me,{children:e.jsx(se,{children:e.jsx(x,{colSpan:6,className:"text-center py-8 text-gray-500",children:"Tidak ada data di halaman ini"})})})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Menampilkan ",(o-1)*z+1," sampai ",Math.min(o*z,E)," dari ",E," pengajuan"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>b(o-1),disabled:o===1,children:[e.jsx(Ge,{className:"h-4 w-4"}),"Sebelumnya"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:K},(a,t)=>t+1).map(a=>e.jsx(u,{variant:o===a?"default":"outline",size:"sm",onClick:()=>b(a),className:`w-8 h-8 p-0 ${o===a?"bg-green-600 hover:bg-green-700 text-white border-green-600":"bg-white hover:bg-green-50 text-gray-700 border-gray-300 hover:border-green-300"}`,children:a},a))}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>b(o+1),disabled:o===K,children:["Selanjutnya",e.jsx($e,{className:"h-4 w-4"})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(Ie,{children:[e.jsx(Be,{children:e.jsxs(se,{children:[e.jsx(h,{children:"Pegawai"}),e.jsx(h,{children:"Jenis Jabatan"}),e.jsx(h,{children:"Status"}),e.jsx(h,{children:"Dokumen"}),c&&e.jsx(h,{children:"Pembuat"}),e.jsx(h,{children:"Tanggal Dibuat"}),e.jsx(h,{className:"text-right",children:"Aksi"})]})}),e.jsx(Me,{children:P.map(a=>e.jsxs(se,{className:"hover:bg-gray-50",children:[e.jsx(x,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.pegawai.nama}),e.jsx("div",{className:"text-sm text-gray-500",children:a.pegawai.jabatan})]})}),e.jsx(x,{children:e.jsx(ge,{variant:"outline",children:na(a.jenis_jabatan)})}),e.jsx(x,{children:Ae(a.status,a)}),e.jsx(x,{children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-sm",children:a.files.length})})}),c&&e.jsx(x,{children:e.jsx("div",{className:"text-sm text-gray-600",children:(()=>{var s;const t=I.users.find(n=>n.id===a.created_by);return t?t.full_name||t.email||"Unknown User":(s=a.created_by)!=null&&s.includes("@")?a.created_by:"Unknown User"})()})}),e.jsx(x,{children:e.jsx("div",{className:"text-sm text-gray-600",children:la(a.created_at)})}),e.jsx(x,{className:"text-right",children:e.jsxs(ja,{children:[e.jsx(ba,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"sm",children:e.jsx(ca,{className:"h-4 w-4"})})}),e.jsxs(fa,{align:"end",children:[e.jsxs(y,{onClick:()=>ee(a.id),children:[e.jsx(ua,{className:"h-4 w-4 mr-2"}),"Lihat Detail"]}),!aa&&e.jsxs(e.Fragment,{children:[a.status==="draft"&&e.jsxs(y,{onClick:()=>R(`/pengajuan/${a.id}/upload`),children:[e.jsx(ga,{className:"h-4 w-4 mr-2"}),"Upload Dokumen"]}),a.status==="rejected"&&e.jsxs(y,{onClick:()=>R(`/pengajuan/${a.id}/edit`),children:[e.jsx(ga,{className:"h-4 w-4 mr-2"}),"Perbaiki Dokumen"]})]}),c&&e.jsxs(y,{onClick:()=>{be(a),re(a.status),oe(""),le(!0)},children:[e.jsx(ha,{className:"h-4 w-4 mr-2"}),"Ubah Status"]}),c&&a.status==="admin_wilayah_submitted"&&e.jsxs(e.Fragment,{children:[e.jsxs(y,{onClick:()=>ee(a.id),children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Setujui"]}),e.jsxs(y,{onClick:()=>ee(a.id),children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Tolak"]})]}),(c||a.status==="draft"&&(r==null?void 0:r.role)!=="user")&&e.jsxs(y,{onClick:()=>{console.log(" Debug: Klik hapus untuk pengajuan:",{id:a.id,status:a.status,isAdmin:c,userRole:r==null?void 0:r.role}),Ne(a.id),je(!0)},className:"text-red-600",children:[e.jsx(ma,{className:"h-4 w-4 mr-2"}),"Hapus"]})]})]})})]},a.id))})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Menampilkan ",(o-1)*z+1," sampai ",Math.min(o*z,E)," dari ",E," pengajuan"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>b(o-1),disabled:o===1,children:[e.jsx(Ge,{className:"h-4 w-4"}),"Sebelumnya"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:K},(a,t)=>t+1).map(a=>e.jsx(u,{variant:o===a?"default":"outline",size:"sm",onClick:()=>b(a),className:`w-8 h-8 p-0 ${o===a?"bg-green-600 hover:bg-green-700 text-white border-green-600":"bg-white hover:bg-green-50 text-gray-700 border-gray-300 hover:border-green-300"}`,children:a},a))}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>b(o+1),disabled:o===K,children:["Selanjutnya",e.jsx($e,{className:"h-4 w-4"})]})]})]})]})})]})]}),e.jsx(wa,{open:Ga,onOpenChange:le,children:e.jsxs(va,{className:"sm:max-w-md",children:[e.jsx(ka,{children:e.jsx(ya,{children:"Ubah Status Pengajuan"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(pe,{htmlFor:"status",children:"Status Saat Ini"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-50 rounded-md",children:U&&Ae(U.status,U)})]}),e.jsxs("div",{children:[e.jsx(pe,{htmlFor:"newStatus",children:"Status Baru"}),e.jsxs("select",{id:"newStatus",value:ie,onChange:a=>re(a.target.value),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"submitted",children:"Submitted"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Ditolak Admin Wilayah"}),e.jsx("option",{value:"resubmitted",children:"Resubmitted"}),e.jsx("option",{value:"admin_wilayah_approved",children:"Admin Wilayah Approved"}),e.jsx("option",{value:"admin_wilayah_rejected",children:"Ditolak Superadmin"}),e.jsx("option",{value:"admin_wilayah_submitted",children:"Admin Wilayah Submitted"}),e.jsx("option",{value:"final_approved",children:"Final Approved"}),e.jsx("option",{value:"final_rejected",children:"Final Rejected"})]})]}),e.jsxs("div",{children:[e.jsx(pe,{htmlFor:"reason",children:"Alasan Perubahan (Opsional)"}),e.jsx(_t,{id:"reason",value:Ve,onChange:a=>oe(a.target.value),placeholder:"Masukkan alasan perubahan status...",className:"mt-1",rows:3})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(u,{variant:"outline",onClick:()=>{le(!1),be(null),re(""),oe("")},children:"Batal"}),e.jsx(u,{onClick:Za,disabled:He||!ie||U&&ie===U.status,className:"bg-green-600 hover:bg-green-700 text-white",children:He?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4 mr-2 animate-spin"}),"Memproses..."]}):"Ubah Status"})]})]})}),e.jsx(bt,{open:Aa,onOpenChange:je,children:e.jsxs(ft,{children:[e.jsxs(wt,{children:[e.jsx(vt,{children:"Hapus Pengajuan"}),e.jsx(kt,{children:"Apakah Anda yakin ingin menghapus pengajuan ini? Tindakan ini tidak dapat dibatalkan."})]}),e.jsxs(yt,{children:[e.jsx(Nt,{disabled:Se,children:"Batal"}),e.jsx(St,{onClick:Wa,disabled:Se,className:"bg-red-600 hover:bg-red-700",children:Se?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4 mr-2 animate-spin text-green-600"}),"Menghapus..."]}):"Hapus"})]})]})}),e.jsx(wa,{open:_e,onOpenChange:we,children:e.jsxs(va,{className:"sm:max-w-md",children:[e.jsx(ka,{children:e.jsx(ya,{children:"Generate Download ZIP"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(pe,{htmlFor:"filterType",children:"Filter By"}),e.jsxs(H,{value:C,onValueChange:a=>{Ia(a),J(a==="pegawai"?[]:""),ve([]),ce("")},children:[e.jsx(W,{className:"mt-1",children:e.jsx(Z,{placeholder:"Pilih filter"})}),e.jsxs(q,{children:[e.jsx(g,{value:"jabatan",children:"By Jabatan"}),e.jsx(g,{value:"kabupaten",children:"By Kabupaten"}),e.jsx(g,{value:"pegawai",children:"By Pegawai"})]})]})]}),e.jsxs("div",{children:[e.jsx(pe,{htmlFor:"filterValue",children:C==="jabatan"?"Pilih Jabatan":C==="kabupaten"?"Pilih Kabupaten":"Pilih Pegawai"}),C==="jabatan"?e.jsxs(H,{value:typeof O=="string"?O:"",onValueChange:J,children:[e.jsx(W,{className:"mt-1",children:e.jsx(Z,{placeholder:"Pilih jabatan"})}),e.jsxs(q,{children:[M&&e.jsx(g,{value:"__loading_jabatan",disabled:!0,children:"Memuat data..."}),!M&&_.jenisJabatan.length===0&&e.jsx(g,{value:"__empty_jabatan",disabled:!0,children:"Data tidak tersedia"}),!M&&_.jenisJabatan.length>0&&_.jenisJabatan.filter(a=>a.count>0).map(a=>e.jsxs(g,{value:a.value,children:[a.label," (",a.count,")"]},a.value))]})]}):C==="kabupaten"?e.jsxs(H,{value:typeof O=="string"?O:"",onValueChange:J,children:[e.jsx(W,{className:"mt-1",children:e.jsx(Z,{placeholder:"Pilih kabupaten"})}),e.jsxs(q,{children:[M&&e.jsx(g,{value:"__loading_kabupaten",disabled:!0,children:"Memuat data..."}),!M&&(!_.kabupatenGroups||_.kabupatenGroups.length===0)&&e.jsx(g,{value:"__empty_kabupaten",disabled:!0,children:"Data tidak tersedia"}),!M&&_.kabupatenGroups&&_.kabupatenGroups.length>0&&(()=>{const a=_.kabupatenGroups.filter(t=>t.count>0&&t.kabupaten&&t.kabupaten.length>0).flatMap(t=>t.kabupaten).filter((t,s,n)=>n.indexOf(t)===s).sort();return a.length>0?a.map(t=>e.jsx(g,{value:t,children:t},t)):e.jsx(g,{value:"",disabled:!0,children:"Tidak ada data kabupaten"})})()]})]}):e.jsxs("div",{className:"space-y-2 relative",children:[e.jsx(xa,{placeholder:"Cari pegawai (nama/NIP)...",value:Pe,onChange:a=>{ce(a.target.value),Q(!0)},onFocus:()=>Q(!0)}),e.jsxs("div",{className:"text-xs text-gray-500 flex items-center justify-between",children:[e.jsx("span",{children:"Ketik untuk tambah pegawai lain (maks 20)."}),e.jsxs("span",{children:[D.length,"/20"]})]}),D.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:D.map(a=>e.jsxs(ge,{variant:"secondary",className:"flex items-center gap-1",children:[a.label,e.jsx("button",{type:"button",className:"text-gray-600 hover:text-red-600",onClick:()=>Ha(a.id),children:"×"})]},a.id))}),M&&e.jsx("div",{className:"text-sm text-gray-500",children:"Memuat data..."}),!M&&Ma&&e.jsx("div",{className:"absolute z-20 mt-1 w-full max-h-56 overflow-auto rounded-md border bg-white shadow",children:sa.length===0?e.jsx("div",{className:"px-3 py-2 text-sm text-gray-500",children:"Tidak ada hasil"}):sa.slice(0,20).map(a=>{const t=`${a.nama}${a.nip?` • ${a.nip}`:""}`;return e.jsx("button",{type:"button",className:"w-full px-3 py-2 text-left hover:bg-green-50 text-sm",onMouseDown:s=>s.preventDefault(),onClick:()=>Va(a.id||a.nip||"",t),children:t},a.id||a.nip)})})]})]}),Ye&&e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4 animate-spin text-blue-600"}),e.jsx("p",{className:"text-sm text-blue-800",children:Ye})]})}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Catatan:"})," ",m?e.jsxs(e.Fragment,{children:["Proses generate download mungkin memakan waktu beberapa menit jika data banyak. File ZIP"," ",e.jsx("strong",{children:"khusus berisi pengajuan dengan status final_approved"})," sesuai filter yang dipilih untuk role user (read-only)."]}):e.jsxs(e.Fragment,{children:["Proses generate download mungkin memakan waktu beberapa menit jika data banyak. File ZIP akan berisi semua berkas dari pengajuan dengan status ",e.jsx("strong",{children:"final_approved"})," sesuai filter yang dipilih."]})]})})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(u,{variant:"outline",onClick:()=>{we(!1),J(""),de(""),ce(""),Q(!1),ve([])},disabled:De,children:"Batal"}),e.jsx(u,{onClick:Qa,disabled:De||(C==="pegawai"?D.length===0:!O),className:"bg-green-600 hover:bg-green-700 text-white",onMouseEnter:()=>Q(!1),children:De?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"h-4 w-4 mr-2 animate-spin"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oa,{className:"h-4 w-4 mr-2"}),"Generate ZIP"]})})]})]})})]})};export{Kt as default};
//# sourceMappingURL=PengajuanIndex-DMn6_yKl.js.map
