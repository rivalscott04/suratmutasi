import{j as a,a3 as O,at as ka,F as H,a6 as y,aA as xa,ak as ba,ap as _a,U as fa,X as T,aK as Na}from"./ui-vendor-BBh2_8F_.js";import{d as wa,e as Pa,u as Sa,r as t}from"./react-vendor-BNG1zHOu.js";import{C as D,c as F,a as va,b as ya}from"./card-Bt1JYBqk.js";import{u as Da,a as Y,b as Fa,B as m,P as Aa,D as V,e as X,f as Q,g as W,j as Ka}from"./index-BanrpBGn.js";import{A as Ca,a as Ba,b as Ma,c as Ua,d as Ea,e as za,g as Ia,f as Ra}from"./alert-dialog-C3i5XLvt.js";const Z=i=>String(i).toLowerCase().replace(/[^a-z0-9_-]+/gi,"_").replace(/^_+|_+$/g,""),$a=i=>({surat_pengantar:"Surat Pengantar",surat_permohonan_dari_yang_bersangkutan:"Surat Permohonan Dari Yang Bersangkutan",surat_keputusan_cpns:"Surat Keputusan CPNS",surat_keputusan_pns:"Surat Keputusan PNS",surat_keputusan_kenaikan_pangkat_terakhir:"Surat Keputusan Kenaikan Pangkat Terakhir",surat_keputusan_jabatan_terakhir:"Surat Keputusan Jabatan Terakhir",skp_2_tahun_terakhir:"SKP 2 Tahun Terakhir",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan Yang Diterbitkan Inspektorat Jenderal Kementerian Agama",surat_keterangan_anjab_abk_instansi_asal:"Surat Keterangan Anjab dan ABK terhadap jabatan PNS dari instansi asal",surat_keterangan_anjab_abk_instansi_penerima:"Surat Keterangan Anjab dan ABK terhadap jabatan PNS dari instansi penerima",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan Tidak Pernah Dijatuhi Hukuman Disiplin Tingkat Sedang atau Berat Dalam 1 (satu) Tahun Terakhir Dari PPK",surat_persetujuan_mutasi_asal:"Surat Persetujuan Mutasi dari ASAL dengan menyebutkan jabatan yang akan diduduki",surat_lolos_butuh_ppk:"Surat Lolos Butuh dari Pejabat Pembina Kepegawaian instansi yang dituju",peta_jabatan:"Peta Jabatan",hasil_uji_kompetensi:"Hasil Uji Kompetensi",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",anjab_abk_instansi_asal:"Anjab/Abk Instansi Asal",anjab_abk_instansi_penerima:"Anjab/Abk Instansi Penerima",surat_keterangan_tidak_tugas_belajar:"Surat Keterangan Tidak Sedang Tugas Belajar",sptjm_pimpinan_satker_asal:"SPTJM Pimpinan Satker dari Asal",sptjm_pimpinan_satker_penerima:"SPTJM Pimpinan Satker dari Penerima",surat_rekomendasi_instansi_pembina:"Surat Rekomendasi Instansi Pembina"})[i]||i.replace(/_/g," ").toUpperCase(),Ga=i=>({surat_pengantar:"Dokumen Pengantar",surat_permohonan_dari_yang_bersangkutan:"Dokumen Pengantar",surat_keputusan_cpns:"Dokumen Kepegawaian",surat_keputusan_pns:"Dokumen Kepegawaian",surat_keputusan_kenaikan_pangkat_terakhir:"Dokumen Kepegawaian",surat_keputusan_jabatan_terakhir:"Dokumen Kepegawaian",skp_2_tahun_terakhir:"Dokumen Kepegawaian",surat_keterangan_bebas_temuan_inspektorat:"Dokumen Keterangan",surat_keterangan_anjab_abk_instansi_asal:"Dokumen Keterangan",surat_keterangan_anjab_abk_instansi_penerima:"Dokumen Keterangan",surat_pernyataan_tidak_hukuman_disiplin:"Dokumen Pernyataan",surat_persetujuan_mutasi_asal:"Dokumen Persetujuan",surat_lolos_butuh_ppk:"Dokumen Persetujuan",peta_jabatan:"Dokumen Pendukung",hasil_uji_kompetensi:"Dokumen Pendukung",hasil_evaluasi_pertimbangan_baperjakat:"Dokumen Pendukung",anjab_abk_instansi_asal:"Dokumen Pendukung",anjab_abk_instansi_penerima:"Dokumen Pendukung",surat_keterangan_tidak_tugas_belajar:"Dokumen Keterangan",sptjm_pimpinan_satker_asal:"Dokumen Pernyataan",sptjm_pimpinan_satker_penerima:"Dokumen Pernyataan",surat_rekomendasi_instansi_pembina:"Dokumen Rekomendasi"})[i]||"Dokumen Lainnya",La=i=>({guru:"Guru",eselon_iv:"Eselon IV",fungsional:"Fungsional",pelaksana:"Pelaksana"})[i]||i,Ya=()=>{var G,L;const{pengajuanId:i}=wa(),k=Pa(),A=Sa(),{token:x}=Da(),[d,aa]=t.useState(null),[b,p]=t.useState([]),[ea,K]=t.useState({}),[sa,N]=t.useState({}),[na,C]=t.useState(!1),[ta,w]=t.useState(!1),[ia,B]=t.useState(!0),[M,u]=t.useState(null),[_,U]=t.useState(!1),[c,ra]=t.useState(null),[la,P]=t.useState(!1),[ua,S]=t.useState(null),f=t.useRef({}),E=(G=A.state)==null?void 0:G.jabatan,v=(L=A.state)==null?void 0:L.requiredFiles,[z,I]=t.useState(null);t.useEffect(()=>{i&&R()},[i]),t.useEffect(()=>{(()=>{Object.values(f.current).forEach(s=>{s&&(s.value="")})})()});const R=async()=>{try{B(!0);const e=await Y(`/api/pengajuan/${i}`,x);if(e.success)if(aa(e.data.pengajuan),v&&v.length>0)p(v),E&&I(E);else if(e.data.requiredFiles&&e.data.requiredFiles.length>0)p(e.data.requiredFiles);else if(e.data.pengajuan.jabatan_id)try{const s=await Y(`/api/job-type-configurations/${e.data.pengajuan.jabatan_id}`,x);s.success&&s.data.required_files?(p(s.data.required_files),I(s.data)):(u("Konfigurasi dokumen untuk jabatan ini belum tersedia. Silakan hubungi admin untuk mengkonfigurasi dokumen yang diperlukan."),p([]))}catch(s){console.error("Error fetching job type configuration:",s),u("Gagal mengambil konfigurasi dokumen. Silakan hubungi admin."),p([])}else u("Jabatan belum dikonfigurasi. Silakan hubungi admin untuk mengkonfigurasi dokumen yang diperlukan."),p([]);else u(e.message||"Gagal mengambil data pengajuan")}catch(e){console.error("Error fetching pengajuan data:",e),u("Terjadi kesalahan saat mengambil data pengajuan")}finally{B(!1)}},oa=async(e,s)=>{const n=e==="skp_2_tahun_terakhir"?Math.floor(16777216e-1):512e3;if(s.size>n){u(`File terlalu besar. Maksimal ${e==="skp_2_tahun_terakhir"?"1.6MB":"500KB"}. Ukuran file: ${(s.size/1024).toFixed(1)}KB`);return}K(r=>({...r,[e]:!0})),N(r=>({...r,[e]:0}));const l=new FormData;l.append("file",s),l.append("file_type",e);try{const r=setInterval(()=>{N(o=>({...o,[e]:Math.min(o[e]+10,90)}))},200),g=await fetch(`/api/pengajuan/${i}/upload`,{method:"POST",headers:{Authorization:`Bearer ${x}`},body:l});if(clearInterval(r),N(o=>({...o,[e]:100})),g.ok){const o=await g.json();if(o.success){await R(),u(null);const h=f.current[e];h&&(h.value="")}else u(o.message||"Gagal upload file")}else u("Gagal upload file")}catch(r){console.error("Error uploading file:",r),u("Terjadi kesalahan saat upload file")}finally{K(g=>({...g,[e]:!1})),S(null);const r=f.current[e];r&&(r.value="")}},da=async()=>{try{U(!0);const e=await Ka(`/api/pengajuan/${i}/submit`,{catatan:""},x);e.success?C(!0):u(e.message||"Gagal submit pengajuan")}catch(e){console.error("Error submitting pengajuan:",e),u("Terjadi kesalahan saat submit pengajuan")}finally{U(!1),w(!1)}},ca=async e=>{try{const s=await fetch(`/api/pengajuan/files/${e.id}`,{headers:{Authorization:`Bearer ${x}`}});if(!s.ok)throw new Error("Gagal mengambil file");const n=await s.blob(),l=URL.createObjectURL(n);ra({...e,blobUrl:l}),P(!0)}catch(s){console.error("Error previewing file:",s),u("Gagal preview file. Silakan coba lagi.")}},ma=e=>{window.open(`/api/pengajuan/files/${e.id}`,"_blank")},ga=e=>{S(e)},$=()=>b.every(e=>d==null?void 0:d.files.some(s=>s.file_type===e)),pa=e=>d!=null&&d.files.some(s=>s.file_type===e)?"uploaded":"pending",ha=e=>{const n=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,l)).toFixed(2))+" "+n[l]},ja=b.reduce((e,s)=>{const n=Ga(s);return e[n]||(e[n]=[]),e[n].push(s),e},{});return ia?a.jsx("div",{className:"container mx-auto p-6",children:a.jsx(D,{children:a.jsxs(F,{className:"flex items-center justify-center py-12",children:[a.jsx(O,{className:"h-8 w-8 animate-spin text-green-600"}),a.jsx("span",{className:"ml-2",children:"Memuat data pengajuan..."})]})})}):d?a.jsxs("div",{className:"container mx-auto p-6",children:[a.jsxs(D,{children:[a.jsxs(va,{children:[a.jsx(ya,{children:"Upload Berkas Pengajuan Mutasi PNS"}),a.jsxs("div",{className:"text-sm text-gray-600",children:[d.pegawai.nama," - ",d.pegawai.jabatan]}),a.jsxs("div",{className:"text-sm text-gray-500",children:["Jenis Jabatan: ",La(d.jenis_jabatan)]}),a.jsxs("div",{className:"text-sm text-gray-500",children:["Total Dokumen: ",z?z.max_dokumen:b.length," surat"]})]}),a.jsxs(F,{children:[M&&a.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:a.jsx("p",{className:"text-red-600",children:M})}),b.length===0?a.jsxs("div",{className:"text-center py-12",children:[a.jsx(H,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-500 mb-2",children:"Tidak ada dokumen yang diperlukan"}),a.jsx("p",{className:"text-sm text-gray-400",children:"Silakan hubungi admin untuk mengkonfigurasi dokumen yang diperlukan"})]}):Object.entries(ja).map(([e,s])=>a.jsxs("div",{className:"mb-8",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800 border-b pb-2",children:e}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:s.map(n=>{const l=pa(n),r=ea[n],g=sa[n],o=d.files.find(j=>j.file_type===n),h=ua===n;return a.jsxs("div",{className:"border rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-medium text-sm leading-tight",children:$a(n)}),a.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Upload file PDF (maks. ",n==="skp_2_tahun_terakhir"?"1.6MB":"500KB",")"]})]}),a.jsxs(Fa,{variant:"secondary",className:l==="uploaded"?"bg-green-600 text-white hover:bg-green-700":"",children:[l==="uploaded"?a.jsx(y,{className:"h-3 w-3 mr-1"}):a.jsx(H,{className:"h-3 w-3 mr-1"}),l==="uploaded"?"Uploaded":"Pending"]})]}),l==="uploaded"&&o&&!h?a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"text-sm text-green-600",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(y,{className:"h-4 w-4"}),a.jsx("span",{className:"truncate",children:o.file_name}),a.jsxs("span",{className:"text-gray-500 text-xs",children:["(",ha(o.file_size),")"]})]})}),a.jsxs("div",{className:"flex gap-2 flex-wrap",children:[a.jsxs(m,{size:"sm",variant:"outline",onClick:()=>ca(o),className:"flex items-center gap-1",children:[a.jsx(xa,{className:"h-3 w-3"}),"Preview"]}),a.jsxs(m,{size:"sm",variant:"outline",onClick:()=>ma(o),className:"flex items-center gap-1",children:[a.jsx(ba,{className:"h-3 w-3"}),"Download"]}),a.jsxs(m,{size:"sm",variant:"outline",onClick:()=>ga(n),className:"flex items-center gap-1",children:[a.jsx(_a,{className:"h-3 w-3"}),"Ganti File"]})]})]}):a.jsxs("div",{children:[a.jsx("input",{ref:j=>f.current[n]=j,type:"file",accept:".pdf",onChange:j=>{var J;const q=(J=j.target.files)==null?void 0:J[0];q&&(oa(n,q),j.target.value="")},disabled:r,className:"hidden",id:`file-${Z(n)}`}),a.jsxs("label",{htmlFor:`file-${Z(n)}`,className:"cursor-pointer inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:[a.jsx(fa,{className:"h-4 w-4 mr-2"}),r?"Uploading...":h?"Pilih File Baru":"Pilih File"]}),h&&a.jsxs(m,{size:"sm",variant:"ghost",onClick:()=>S(null),className:"ml-2 text-gray-500",children:[a.jsx(T,{className:"h-3 w-3 mr-1"}),"Batal"]})]}),r&&a.jsxs("div",{className:"mt-2",children:[a.jsx(Aa,{value:g,className:"h-2"}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[g,"% uploaded"]})]})]},n)})})]},e)),b.length>0&&a.jsxs("div",{className:"mt-8 pt-6 border-t",children:[a.jsxs(m,{onClick:()=>w(!0),disabled:!$()||_,className:"w-full bg-green-600 hover:bg-green-700 text-white",size:"lg",children:[a.jsx(Na,{className:"h-4 w-4 mr-2"}),"Submit Pengajuan"]}),!$()&&a.jsx("p",{className:"text-sm text-gray-500 mt-2 text-center",children:"Semua berkas harus diupload sebelum dapat submit"})]})]})]}),a.jsx(Ca,{open:ta,onOpenChange:w,children:a.jsxs(Ba,{children:[a.jsxs(Ma,{children:[a.jsx(Ua,{children:"Submit Pengajuan"}),a.jsx(Ea,{children:"Apakah Anda yakin ingin submit pengajuan ini? Setelah disubmit, pengajuan tidak dapat diedit lagi dan akan diproses oleh admin."})]}),a.jsxs(za,{children:[a.jsx(Ia,{disabled:_,children:"Batal"}),a.jsx(Ra,{onClick:da,disabled:_,className:"bg-green-600 hover:bg-green-700 text-white",children:_?a.jsxs(a.Fragment,{children:[a.jsx(O,{className:"h-4 w-4 mr-2 animate-spin text-green-600"}),"Submitting..."]}):"Submit Pengajuan"})]})]})}),a.jsx(V,{open:na,onOpenChange:C,children:a.jsxs(X,{children:[a.jsx(Q,{children:a.jsx(W,{children:"Pengajuan Berhasil!"})}),a.jsxs("div",{className:"text-center py-6",children:[a.jsx(y,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),a.jsxs("p",{className:"text-lg font-medium mb-2",children:["Pengajuan untuk ",d.pegawai.nama," berhasil disubmit"]}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Pengajuan akan diproses oleh admin. Anda akan mendapat notifikasi ketika status berubah."}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx(m,{onClick:()=>k("/dashboard"),className:"flex-1 bg-green-600 hover:bg-green-700 text-white",children:"Kembali ke Dashboard"}),a.jsx(m,{onClick:()=>k("/pengajuan/select"),variant:"outline",className:"flex-1",children:"Buat Pengajuan Baru"})]})]})]})}),a.jsx(V,{open:la,onOpenChange:e=>{P(e),!e&&(c!=null&&c.blobUrl)&&URL.revokeObjectURL(c.blobUrl)},children:a.jsxs(X,{className:"max-w-4xl",children:[a.jsx(Q,{children:a.jsx(W,{className:"flex items-center justify-between",children:a.jsxs("span",{children:["Preview File: ",c==null?void 0:c.file_name]})})}),a.jsx("div",{className:"mt-4",children:c&&a.jsxs("div",{className:"border rounded-lg overflow-hidden bg-white",children:[a.jsxs("div",{className:"bg-green-600 text-white px-4 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"font-medium",children:c.file_name}),a.jsx(m,{variant:"ghost",size:"sm",onClick:()=>P(!1),className:"text-white hover:bg-green-700",children:a.jsx(T,{className:"h-4 w-4"})})]}),a.jsx("iframe",{src:c.blobUrl||`/api/pengajuan/files/${c.id}`,className:"w-full h-96 border-0",title:"File Preview"})]})})]})})]}):a.jsx("div",{className:"container mx-auto p-6",children:a.jsx(D,{children:a.jsxs(F,{className:"flex items-center justify-center py-12",children:[a.jsx(ka,{className:"h-8 w-8 text-red-500"}),a.jsx("span",{className:"ml-2 text-red-600",children:"Pengajuan tidak ditemukan"})]})})})};export{Ya as default};
//# sourceMappingURL=PengajuanFileUpload-CqZu6rRT.js.map
