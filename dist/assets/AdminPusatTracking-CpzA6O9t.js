import{j as e,aN as ve,a9 as ne,F as ie,a2 as we,am as re,as as Ne,aa as le,a4 as ye,b3 as Se,al as _e,aE as Ce,ax as Te}from"./ui-vendor-DQXcJUOU.js";import{r as i}from"./react-vendor-DheTkQGW.js";import{u as Pe,d as Ie,a as ce,B as j,I as de,b as Le,D as Me,e as Be,f as Ee,g as De,c as Fe}from"./index-Dj82Ze1n.js";import{C as I,c as L}from"./card-Bn44-nXi.js";import{L as $}from"./label-BrF5vusi.js";import{T as Ae}from"./textarea-DcY8o-Tl.js";import{S as M,a as B,b as E,c as D,d as x}from"./select-DflxsUkP.js";import{P as oe}from"./PageHeader-YYZVzvoG.js";import{S as qe}from"./shepherd-lljao8WZ.js";const Qe=()=>{var ee,ae,te;const{user:Je,token:F}=Pe(),{toast:d}=Ie(),[U,ue]=i.useState([]),[V,ge]=i.useState([]),[b,G]=i.useState(!0),[p,z]=i.useState(""),[v,H]=i.useState("all"),[f,Q]=i.useState("all"),[o,me]=i.useState(null),[A,S]=i.useState(!1),[W,X]=i.useState(!1),[u,w]=i.useState(1),[_,he]=i.useState(10),[g,C]=i.useState({tracking_status_id:"",notes:"",estimated_days:""}),m=i.useRef(null);i.useEffect(()=>{Y()},[]);const Y=async()=>{try{G(!0);const a=await ce("/api/tracking/pengajuan",F);a.success&&ue(a.data);const t=await ce("/api/tracking/status-master",F);t.success&&ge(t.data)}catch(a){console.error("Error loading data:",a),d({title:"Error",description:"Gagal memuat data",variant:"destructive"})}finally{G(!1)}},q=a=>{var r;me(a);const t=J(a),n=t?(r=t.tracking_status_id)==null?void 0:r.toString():"";console.log("Latest tracking:",t),console.log("Default status ID:",n),C({tracking_status_id:n||"",notes:"",estimated_days:""}),S(!0)},xe=async()=>{if(!o||!g.tracking_status_id){d({title:"Error",description:"Status tracking harus diisi",variant:"destructive"});return}try{X(!0),(await Fe(`/api/tracking/pengajuan/${o.id}`,{tracking_status_id:parseInt(g.tracking_status_id),notes:g.notes||null,estimated_days:g.estimated_days?parseInt(g.estimated_days):null},F)).success&&(d({title:"Berhasil",description:"Status tracking berhasil disimpan"}),S(!1),Y())}catch(a){console.error("Error submitting tracking:",a),d({title:"Error",description:"Gagal menyimpan status tracking",variant:"destructive"})}finally{X(!1)}},J=a=>!a.tracking||a.tracking.length===0?null:a.tracking[0],T=U.filter(a=>{var h,c,s;const t=a.pegawai_nip.toLowerCase().includes(p.toLowerCase())||a.jenis_jabatan.toLowerCase().includes(p.toLowerCase())||((h=a.office)==null?void 0:h.kabkota.toLowerCase().includes(p.toLowerCase()))||((c=a.office)==null?void 0:c.nama_kantor.toLowerCase().includes(p.toLowerCase()))||((s=a.pegawai)==null?void 0:s.nama.toLowerCase().includes(p.toLowerCase())),n=v==="all"||a.jenis_jabatan===v,r=J(a);let l=!0;return f==="all"?l=!0:f==="no-tracking"?l=r===null:l=(r==null?void 0:r.status_name)===f,t&&n&&l});i.useEffect(()=>{w(1)},[p,v,f]);const P=T.length,k=Math.max(1,Math.ceil(P/_)),K=(u-1)*_,Z=K+_,N=T.slice(K,Z),pe=()=>{if(k<=5)return Array.from({length:k},(r,l)=>l+1);let t=Math.max(1,u-2),n=Math.min(k,u+2);return u<=3?(n=5,t=1):u>=k-2&&(n=k,t=k-5+1),Array.from({length:n-t+1},(r,l)=>t+l)},ke=()=>{const a=new Set(U.map(n=>n.jenis_jabatan)),t=Array.from(a).sort();return console.log("Unique jabatan:",t),t},je=a=>{const t=a.toLowerCase();return t.includes("selesai")||t.includes("completed")?"bg-green-100 text-green-800":t.includes("diterima")||t.includes("received")||t.includes("pusat")?"bg-blue-100 text-blue-800":t.includes("proses")||t.includes("progress")||t.includes("sedang")?"bg-orange-100 text-orange-800":t.includes("menunggu")||t.includes("waiting")||t.includes("pending")?"bg-yellow-100 text-yellow-800":t.includes("ditolak")||t.includes("rejected")||t.includes("gagal")?"bg-red-100 text-red-800":t.includes("review")||t.includes("verifikasi")||t.includes("cek")?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"},fe=a=>{const t=a.toLowerCase();return t.includes("selesai")||t.includes("completed")||t.includes("selesai")?e.jsx(ye,{className:"h-4 w-4"}):t.includes("diterima")||t.includes("received")||t.includes("pusat")?e.jsx(Se,{className:"h-4 w-4"}):t.includes("proses")||t.includes("progress")||t.includes("sedang")?e.jsx(le,{className:"h-4 w-4"}):t.includes("menunggu")||t.includes("waiting")||t.includes("pending")?e.jsx(_e,{className:"h-4 w-4"}):t.includes("ditolak")||t.includes("rejected")||t.includes("gagal")?e.jsx(Ce,{className:"h-4 w-4"}):t.includes("review")||t.includes("verifikasi")||t.includes("cek")?e.jsx(ne,{className:"h-4 w-4"}):e.jsx(Te,{className:"h-4 w-4"})},be=a=>a===1?"1 hari":a<7?`${a} hari`:a<30?`${Math.ceil(a/7)} minggu`:`${Math.ceil(a/30)} bulan`,O=i.useCallback(()=>{if(m.current&&(m.current.cancel(),m.current=null),b){d({title:"Tunggu sebentar",description:"Data tracking sedang dimuat. Coba lagi setelah data tampil."});return}if(N.length===0){d({title:"Belum ada data",description:"Tidak ada pengajuan final approved untuk ditracking saat ini.",variant:"destructive"});return}const a=new qe.Tour({useModalOverlay:!0,defaultStepOptions:{cancelIcon:{enabled:!0},classes:"bg-white shadow-xl rounded-lg border border-gray-200 text-gray-800",scrollTo:{behavior:"smooth",block:"center"}}}),t={},n=[],r=(s,y)=>{t[s]=!1;const R=document.querySelector(y);if(!R)return;const se=()=>{t[s]=!0};R.addEventListener("click",se),n.push(()=>R.removeEventListener("click",se))},l=()=>{n.forEach(s=>s())},h=()=>new Promise(s=>{A?s():(N[0]&&q(N[0]),setTimeout(s,400))}),c=s=>{const y=[{text:"Lewati",classes:"shepherd-button-secondary text-gray-500",action:async()=>{a.cancel()}}];return s!=null&&s.showBack&&y.push({text:"Kembali",classes:"shepherd-button-secondary",action:async()=>{a.back()}}),y.push({text:s!=null&&s.isFinal?"Selesai":"Lanjut",classes:"shepherd-button-primary bg-green-600 text-white hover:bg-green-700",action:async()=>{if(s!=null&&s.requireKey&&!t[s.requireKey]){d({title:"Aksi diperlukan",description:s.requireMessage||"Ikuti instruksi pada langkah ini sebelum melanjutkan.",variant:"destructive"});return}s!=null&&s.isFinal?a.complete():a.next()}}),y};a.addStep({id:"tracking-doc-intro",title:"Tracking Dokumen",text:"Menu ini dipakai untuk mencatat progres pengolahan berkas yang sudah final approved.",attachTo:{element:'[data-tour-id="tracking-doc-header"]',on:"bottom"},buttons:c()}),a.addStep({id:"tracking-filters",title:"Filter & Pencarian",text:"Gunakan pencarian, filter jabatan, atau filter status tracking untuk fokus pada berkas tertentu.",attachTo:{element:'[data-tour-id="tracking-doc-filter"]',on:"top"},buttons:c({showBack:!0})}),a.addStep({id:"tracking-card",title:"Pilih Pegawai",text:"Setiap kartu menampilkan ringkasan pegawai dan status tracking terakhir. Pilih salah satu yang ingin Anda update.",attachTo:{element:'[data-tour-id="tracking-doc-card"]',on:"top"},buttons:c({showBack:!0})}),a.addStep({id:"tracking-input-button",title:"Mulai Input Tracking",text:'Klik tombol "Input Tracking" pada pegawai yang ingin diperbarui.',attachTo:{element:'[data-tour-id="tracking-input-button"]',on:"left"},beforeShowPromise:()=>(r("openTrackingDialog",'[data-tour-id="tracking-input-button"]'),Promise.resolve()),buttons:c({showBack:!0,requireKey:"openTrackingDialog",requireMessage:"Klik tombol Input/Update Tracking terlebih dahulu."})}),a.addStep({id:"tracking-status-select",title:"Pilih Status Tracking",text:"Tentukan status terbaru sesuai progres fisik yang sedang Anda kerjakan.",attachTo:{element:'[data-tour-id="tracking-status-select"]',on:"top"},beforeShowPromise:h,buttons:c({showBack:!0})}),a.addStep({id:"tracking-notes",title:"Catatan & Estimasi",text:"Tambahkan catatan penting dan estimasi penyelesaian (opsional) agar tim lain tahu progresnya.",attachTo:{element:'[data-tour-id="tracking-notes-fields"]',on:"top"},beforeShowPromise:h,buttons:c({showBack:!0})}),a.addStep({id:"tracking-save",title:"Simpan Data Tracking",text:"Klik Simpan untuk mencatat status terbaru. Anda bisa mengulang langkah ini kapan saja.",attachTo:{element:'[data-tour-id="tracking-save-button"]',on:"top"},beforeShowPromise:h,buttons:c({showBack:!0,isFinal:!0})}),a.on("complete",()=>{l(),sessionStorage.removeItem("pending_tracking_doc_tour"),m.current=null,d({title:"Tutorial selesai",description:"Anda siap mencatat progres tracking secara mandiri."})}),a.on("cancel",()=>{l(),sessionStorage.removeItem("pending_tracking_doc_tour"),m.current=null}),a.start(),m.current=a},[q,A,b,N,d]);return i.useEffect(()=>{!b&&sessionStorage.getItem("pending_tracking_doc_tour")==="true"&&O()},[b,O]),i.useEffect(()=>()=>{m.current&&(m.current.cancel(),m.current=null)},[]),b?e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx(oe,{title:"Tracking Dokumen",subtitle:"Input status tracking untuk berkas yang sudah final approved"}),e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((a,t)=>e.jsx(I,{children:e.jsx(L,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"})]})})},t))})]}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-4",children:[e.jsx("div",{"data-tour-id":"tracking-doc-header",className:"flex-1",children:e.jsx(oe,{title:"Tracking Dokumen",subtitle:"Input status tracking untuk berkas yang sudah final approved"})}),e.jsxs(j,{variant:"outline",onClick:O,className:"border-green-200 text-green-700",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Mulai Tutorial Tracking"]})]}),e.jsx(I,{className:"mb-6","data-tour-id":"tracking-doc-filter",children:e.jsx(L,{className:"p-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ne,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(de,{placeholder:"Cari berdasarkan NIP, jenis jabatan, atau kabupaten...",value:p,onChange:a=>z(a.target.value),className:"pl-10"})]}),e.jsx("div",{className:"w-64",children:e.jsxs(M,{value:v,onValueChange:H,children:[e.jsx(B,{children:e.jsx(E,{placeholder:"Filter berdasarkan jabatan"})}),e.jsxs(D,{children:[e.jsx(x,{value:"all",children:"Semua Jabatan"}),ke().map(a=>e.jsx(x,{value:a,children:a},a))]})]})}),e.jsx("div",{className:"w-64",children:e.jsxs(M,{value:f,onValueChange:Q,children:[e.jsx(B,{children:e.jsx(E,{placeholder:"Filter berdasarkan status"})}),e.jsxs(D,{children:[e.jsx(x,{value:"all",children:"Semua Status"}),e.jsx(x,{value:"no-tracking",children:"Belum Ada Tracking"}),V.map(a=>e.jsx(x,{value:a.status_name,children:a.status_name},a.id))]})]})}),(p||v!=="all"||f!=="all")&&e.jsx(j,{variant:"outline",onClick:()=>{z(""),H("all"),Q("all")},className:"px-4",children:"Reset Filter"})]})})}),e.jsx("div",{className:"space-y-4",children:T.length===0?e.jsx(I,{children:e.jsxs(L,{className:"p-6 text-center",children:[e.jsx(ie,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Tidak ada berkas yang perlu ditrack"})]})}):N.map((a,t)=>{var h,c,s;const n=J(a),r=n!==null,l=t===0;return e.jsx(I,{className:"hover:shadow-md transition-shadow","data-tour-id":l?"tracking-doc-card":void 0,children:e.jsx(L,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"font-bold text-xl text-gray-900",children:((h=a.pegawai)==null?void 0:h.nama)||"Nama tidak tersedia"}),e.jsx(Le,{variant:"outline",className:"bg-gray-100 text-gray-700",children:a.jenis_jabatan})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["NIP: ",a.pegawai_nip]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(we,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:((c=a.office)==null?void 0:c.kabkota)||((s=a.office)==null?void 0:s.nama_kantor)||"Lokasi tidak tersedia"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(ie,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{children:[a.total_dokumen," dokumen"]})]}),r?e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(re,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{children:["Estimasi: ",n.estimated_days?be(n.estimated_days):"Belum ada estimasi"]})]}):e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx("span",{children:"Belum ada estimasi"})]})]}),r&&e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${je(n.status_name)}`,children:[fe(n.status_name),e.jsx("span",{children:n.status_name})]})}),r&&n.notes&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 mb-3",children:e.jsxs("p",{className:"text-sm text-gray-700 italic",children:['"',n.notes,'"']})})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(j,{onClick:()=>q(a),className:"bg-green-600 hover:bg-green-700 text-white","data-tour-id":l?"tracking-input-button":void 0,children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),r?"Update Tracking":"Input Tracking"]})})]})})},a.id)})}),T.length>0&&e.jsxs("div",{className:"mt-6 flex flex-col md:flex-row items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Menampilkan ",Math.min(P,K+1),"â€“",Math.min(P,Z)," dari ",P," data"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(M,{value:_.toString(),onValueChange:a=>{he(parseInt(a)),w(1)},children:[e.jsx(B,{className:"w-28",children:e.jsx(E,{placeholder:"Jumlah"})}),e.jsxs(D,{children:[e.jsx(x,{value:"10",children:"10 / halaman"}),e.jsx(x,{value:"25",children:"25 / halaman"}),e.jsx(x,{value:"50",children:"50 / halaman"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{variant:"outline",onClick:()=>w(a=>Math.max(1,a-1)),disabled:u===1,children:"Prev"}),pe().map(a=>e.jsx(j,{variant:a===u?"default":"outline",className:a===u?"bg-green-600 hover:bg-green-700 text-white":"",onClick:()=>w(a),children:a},a)),e.jsx(j,{variant:"outline",onClick:()=>w(a=>Math.min(k,a+1)),disabled:u===k,children:"Next"})]})]})]}),e.jsx(Me,{open:A,onOpenChange:S,children:e.jsxs(Be,{className:"max-w-md",children:[e.jsx(Ee,{children:e.jsx(De,{children:"Input Status Tracking"})}),o&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"font-medium",children:((ee=o.pegawai)==null?void 0:ee.nama)||o.pegawai_nip}),e.jsxs("p",{className:"text-sm text-gray-600",children:["NIP: ",o.pegawai_nip]}),e.jsx("p",{className:"text-sm text-gray-600",children:o.jenis_jabatan}),e.jsx("p",{className:"text-sm text-gray-600",children:((ae=o.office)==null?void 0:ae.kabkota)||((te=o.office)==null?void 0:te.nama_kantor)||"N/A"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{"data-tour-id":"tracking-status-select",children:[e.jsx($,{htmlFor:"status",children:"Update Status Tracking *"}),e.jsxs(M,{value:g.tracking_status_id,onValueChange:a=>C(t=>({...t,tracking_status_id:a})),children:[e.jsx(B,{children:e.jsx(E,{placeholder:"Pilih status tracking baru"})}),e.jsx(D,{children:V.map(a=>e.jsx(x,{value:a.id.toString(),children:a.status_name},a.id))})]})]}),e.jsxs("div",{"data-tour-id":"tracking-notes-fields",className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"notes",children:"Catatan"}),e.jsx(Ae,{id:"notes",placeholder:"Catatan tambahan (opsional)",value:g.notes,onChange:a=>C(t=>({...t,notes:a.target.value})),rows:3})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"estimated_days",children:"Estimasi Penyelesaian (hari)"}),e.jsx(de,{id:"estimated_days",type:"number",placeholder:"Contoh: 2",value:g.estimated_days,onChange:a=>{const t=a.target.value;(t===""||/^\d+$/.test(t))&&C(n=>({...n,estimated_days:t}))},min:"1",step:"1",pattern:"[0-9]*",inputMode:"numeric"})]})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(j,{variant:"outline",onClick:()=>S(!1),className:"flex-1",children:"Batal"}),e.jsx(j,{onClick:xe,disabled:W||!g.tracking_status_id,className:"flex-1 bg-green-600 hover:bg-green-700 text-white","data-tour-id":"tracking-save-button",children:W?e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"h-4 w-4 animate-spin mr-2"}),"Menyimpan..."]}):"Simpan"})]})]})]})})]})};export{Qe as default};
//# sourceMappingURL=AdminPusatTracking-CpzA6O9t.js.map
