import{j as e,_ as ye,ao as ke,a2 as Ce,a3 as k,ap as De,aq as Se,aA as q,aB as K,w as C,aI as D,ae as J}from"./ui-vendor-CkT_OuiB.js";import{r as l}from"./react-vendor-BNG1zHOu.js";import{u as _e,a as Ae,t as g,B as r,I as o,b as Ue,D as Q,e as X,f as Y,g as Z,h as ee,i as se,j as Pe,c as Te,l as Le}from"./index-ynhbw0d5.js";import{L as n}from"./label-BBVbt29F.js";import{S as ae,a as le,b as re,c as te,d}from"./select-Cpq5npyw.js";import{T as Me,a as Be,b as L,c as f,d as Fe,e as m}from"./table-C6aST78v.js";import{A as Ee,a as ze,b as Ie,c as Ge,d as Oe,e as Re,g as He,f as We}from"./alert-dialog-D8VE3Rqn.js";import{C as ie,c as ne,a as Ve,b as $e,d as qe}from"./card-JzP8L83f.js";const as=()=>{const{user:S,token:c}=_e(),[oe,de]=l.useState([]),[ce,M]=l.useState(!0),[w,he]=l.useState(""),[me,b]=l.useState(!1),[xe,v]=l.useState(!1),[ue,_]=l.useState(!1),[h,A]=l.useState(null),[a,t]=l.useState({email:"",full_name:"",password:"",role:"user",office_id:""}),[x,B]=l.useState(!1),[u,N]=l.useState(!1),[je,F]=l.useState(!1),[pe,U]=l.useState(null),[E,P]=l.useState(""),[j,z]=l.useState(!1),ge=()=>{const i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let p="";const R="abcdefghijklmnopqrstuvwxyz",H="ABCDEFGHIJKLMNOPQRSTUVWXYZ",W="0123456789",V="!@#$%^&*";p+=R[Math.floor(Math.random()*R.length)],p+=H[Math.floor(Math.random()*H.length)],p+=W[Math.floor(Math.random()*W.length)],p+=V[Math.floor(Math.random()*V.length)];for(let $=4;$<12;$++)p+=i[Math.floor(Math.random()*i.length)];return p.split("").sort(()=>Math.random()-.5).join("")},y=async s=>{try{await navigator.clipboard.writeText(s),z(!0),g({title:"Password disalin",description:"Password telah disalin ke clipboard"}),setTimeout(()=>z(!1),2e3)}catch{g({title:"Gagal menyalin",description:"Tidak dapat menyalin password ke clipboard",variant:"destructive"})}},I=()=>{const s=ge();t({...a,password:s}),g({title:"Password di-generate",description:"Password secure telah di-generate"})};if((S==null?void 0:S.role)!=="admin")return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(ie,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-600 mb-2",children:"Akses Ditolak"}),e.jsx("p",{className:"text-gray-600",children:"Anda tidak memiliki akses ke halaman ini."})]})})})});l.useEffect(()=>{T()},[]);const T=async()=>{if(c){M(!0);try{const s=await Ae("/api/users",c);de(s.users||[])}catch(s){console.error("Failed to fetch users:",s),g({title:"Error",description:"Gagal mengambil data user",variant:"destructive"})}finally{M(!1)}}},fe=()=>{t({email:"",full_name:"",password:"",role:"user",office_id:""}),b(!0)},we=s=>{A(s),t({email:s.email,full_name:s.full_name,password:"",role:s.role,office_id:s.office_id||""}),v(!0)},be=s=>{A(s),_(!0)},G=async(s=!1)=>{if(c){N(!0);try{if(s&&h){const i={...a};i.password||delete i.password,await Pe(`/api/users/${h.id}`,i,c),U(!0),P("User berhasil diperbarui.")}else await Te("/api/users",a,c),U(!0),P("User berhasil ditambahkan.");T(),b(!1),v(!1),t({email:"",full_name:"",password:"",role:"user",office_id:""})}catch(i){U(!1),P((i==null?void 0:i.message)||"Gagal menyimpan user.")}finally{N(!1),b(!1),v(!1),F(!0)}}},ve=async()=>{if(!(!c||!h)){N(!0);try{await Le(`/api/users/${h.id}`,c),g({title:"Sukses",description:"User berhasil dihapus"}),T(),_(!1),A(null)}catch(s){console.error("Failed to delete user:",s),g({title:"Error",description:"Gagal menghapus user",variant:"destructive"})}finally{N(!1)}}},O=oe.filter(s=>s.full_name.toLowerCase().includes(w.toLowerCase())||s.email.toLowerCase().includes(w.toLowerCase())||s.role.toLowerCase().includes(w.toLowerCase())),Ne=s=>{switch(s){case"admin":return"bg-red-100 text-red-800";case"operator":return"bg-blue-100 text-blue-800";case"user":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[je&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/20 backdrop-blur-sm animate-in fade-in-0 duration-200",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full flex flex-col items-center animate-in zoom-in-95 duration-200",children:[pe?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-10 h-10 text-green-600",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Berhasil"}),e.jsx("p",{className:"text-gray-600 mb-6 text-center",children:E})]}):e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-10 h-10 text-red-600",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Gagal"}),e.jsx("p",{className:"text-gray-600 mb-6 text-center",children:E})]}),e.jsx("button",{className:"w-full py-3 rounded-lg bg-green-600 hover:bg-green-700 text-white text-lg font-semibold shadow transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-400",onClick:()=>F(!1),children:"Tutup"})]})}),e.jsxs(ie,{children:[e.jsx(Ve,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs($e,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Management User"]}),e.jsx(qe,{children:"Kelola user dan akses sistem"})]}),e.jsxs(r,{onClick:fe,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Tambah User"]})]})}),e.jsxs(ne,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(o,{placeholder:"Cari user...",value:w,onChange:s=>he(s.target.value),className:"pl-10"})]})}),ce?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(k,{className:"w-6 h-6 animate-spin mr-2"}),e.jsx("span",{children:"Loading users..."})]}):e.jsx("div",{className:"border rounded-lg",children:e.jsxs(Me,{children:[e.jsx(Be,{children:e.jsxs(L,{children:[e.jsx(f,{children:"Nama"}),e.jsx(f,{children:"Email"}),e.jsx(f,{children:"Role"}),e.jsx(f,{children:"Office ID"}),e.jsx(f,{children:"Created At"}),e.jsx(f,{className:"text-right",children:"Aksi"})]})}),e.jsx(Fe,{children:O.length===0?e.jsx(L,{children:e.jsx(m,{colSpan:6,className:"text-center py-8 text-gray-500",children:w?"Tidak ada user yang ditemukan":"Belum ada user"})}):O.map(s=>e.jsxs(L,{children:[e.jsx(m,{className:"font-medium",children:s.full_name}),e.jsx(m,{children:s.email}),e.jsx(m,{children:e.jsx(Ue,{className:Ne(s.role),children:s.role})}),e.jsx(m,{children:s.office_id||"-"}),e.jsx(m,{children:s.created_at?new Date(s.created_at).toLocaleDateString("id-ID"):"-"}),e.jsx(m,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(r,{variant:"outline",size:"sm",onClick:()=>we(s),children:e.jsx(De,{className:"w-4 h-4"})}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>be(s),className:"text-red-600 hover:text-red-700",children:e.jsx(Se,{className:"w-4 h-4"})})]})})]},s.id))})]})})]})]}),e.jsx(Q,{open:me,onOpenChange:b,children:e.jsxs(X,{className:"sm:max-w-md",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Tambah User Baru"}),e.jsx(ee,{children:"Masukkan informasi user yang akan ditambahkan ke sistem."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"email",children:"Email"}),e.jsx(o,{id:"email",type:"email",value:a.email,onChange:s=>t({...a,email:s.target.value}),placeholder:"user@example.com"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"full_name",children:"Nama Lengkap"}),e.jsx(o,{id:"full_name",value:a.full_name,onChange:s=>t({...a,full_name:s.target.value}),placeholder:"Nama lengkap user"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(o,{id:"password",type:x?"text":"password",value:a.password,onChange:s=>t({...a,password:s.target.value}),placeholder:"Password"}),e.jsxs("div",{className:"absolute right-0 top-0 h-full flex items-center gap-1 pr-2",children:[e.jsx(r,{type:"button",variant:"ghost",size:"sm",className:"h-full px-2 hover:bg-transparent",onClick:()=>B(!x),children:x?e.jsx(q,{className:"h-4 w-4"}):e.jsx(K,{className:"h-4 w-4"})}),a.password&&e.jsx(r,{type:"button",variant:"ghost",size:"sm",className:"h-full px-2 hover:bg-transparent",onClick:()=>y(a.password),children:j?e.jsx(C,{className:"h-4 w-4 text-green-600"}):e.jsx(D,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{type:"button",variant:"outline",size:"sm",onClick:I,className:"flex items-center gap-2 border-green-600 text-green-600 hover:bg-green-50",children:[e.jsx(J,{className:"h-4 w-4"}),"Generate Password"]}),a.password&&e.jsxs(r,{type:"button",variant:"outline",size:"sm",onClick:()=>y(a.password),className:"flex items-center gap-2 border-blue-600 text-blue-600 hover:bg-blue-50",children:[j?e.jsx(C,{className:"h-4 w-4"}):e.jsx(D,{className:"h-4 w-4"}),j?"Disalin!":"Copy Password"]})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"role",children:"Role"}),e.jsxs(ae,{value:a.role,onValueChange:s=>t({...a,role:s}),children:[e.jsx(le,{children:e.jsx(re,{placeholder:"Pilih role"})}),e.jsxs(te,{children:[e.jsx(d,{value:"user",children:"User"}),e.jsx(d,{value:"operator",children:"Operator"}),e.jsx(d,{value:"admin",children:"Admin"}),e.jsx(d,{value:"admin_wilayah",children:"Admin Wilayah"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"office_id",children:"Office ID"}),e.jsx(o,{id:"office_id",value:a.office_id,onChange:s=>t({...a,office_id:s.target.value}),placeholder:"ID kantor (opsional)"})]})]}),e.jsxs(se,{children:[e.jsx(r,{variant:"outline",onClick:()=>b(!1),children:"Batal"}),e.jsxs(r,{onClick:()=>G(!1),disabled:u||!a.email||!a.full_name||!a.password,className:"bg-green-600 hover:bg-green-700",children:[u?e.jsx(k,{className:"w-4 h-4 animate-spin mr-2"}):null,"Tambah User"]})]})]})}),e.jsx(Q,{open:xe,onOpenChange:v,children:e.jsxs(X,{className:"sm:max-w-md",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Edit User"}),e.jsx(ee,{children:"Perbarui informasi user."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"edit-email",children:"Email"}),e.jsx(o,{id:"edit-email",type:"email",value:a.email,onChange:s=>t({...a,email:s.target.value}),placeholder:"user@example.com"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"edit-full_name",children:"Nama Lengkap"}),e.jsx(o,{id:"edit-full_name",value:a.full_name,onChange:s=>t({...a,full_name:s.target.value}),placeholder:"Nama lengkap user"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"edit-password",children:"Password Baru (opsional)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(o,{id:"edit-password",type:x?"text":"password",value:a.password,onChange:s=>t({...a,password:s.target.value}),placeholder:"Kosongkan jika tidak ingin mengubah password"}),e.jsxs("div",{className:"absolute right-0 top-0 h-full flex items-center gap-1 pr-2",children:[e.jsx(r,{type:"button",variant:"ghost",size:"sm",className:"h-full px-2 hover:bg-transparent",onClick:()=>B(!x),children:x?e.jsx(q,{className:"h-4 w-4"}):e.jsx(K,{className:"h-4 w-4"})}),a.password&&e.jsx(r,{type:"button",variant:"ghost",size:"sm",className:"h-full px-2 hover:bg-transparent",onClick:()=>y(a.password),children:j?e.jsx(C,{className:"h-4 w-4 text-green-600"}):e.jsx(D,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{type:"button",variant:"outline",size:"sm",onClick:I,className:"flex items-center gap-2 border-green-600 text-green-600 hover:bg-green-50",children:[e.jsx(J,{className:"h-4 w-4"}),"Generate Password"]}),a.password&&e.jsxs(r,{type:"button",variant:"outline",size:"sm",onClick:()=>y(a.password),className:"flex items-center gap-2 border-blue-600 text-blue-600 hover:bg-blue-50",children:[j?e.jsx(C,{className:"h-4 w-4"}):e.jsx(D,{className:"h-4 w-4"}),j?"Disalin!":"Copy Password"]})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"edit-role",children:"Role"}),e.jsxs(ae,{value:a.role,onValueChange:s=>t({...a,role:s}),children:[e.jsx(le,{children:e.jsx(re,{placeholder:"Pilih role"})}),e.jsxs(te,{children:[e.jsx(d,{value:"user",children:"User"}),e.jsx(d,{value:"operator",children:"Operator"}),e.jsx(d,{value:"admin",children:"Admin"}),e.jsx(d,{value:"admin_wilayah",children:"Admin Wilayah"})]})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"edit-office_id",children:"Office ID"}),e.jsx(o,{id:"edit-office_id",value:a.office_id,onChange:s=>t({...a,office_id:s.target.value}),placeholder:"ID kantor (opsional)"})]})]}),e.jsxs(se,{children:[e.jsx(r,{variant:"outline",onClick:()=>v(!1),children:"Batal"}),e.jsxs(r,{onClick:()=>G(!0),disabled:u||!a.email||!a.full_name,className:"bg-green-600 hover:bg-green-700 text-white",children:[u?e.jsx(k,{className:"w-4 h-4 animate-spin mr-2"}):null,"Update User"]})]})]})}),e.jsx(Ee,{open:ue,onOpenChange:_,children:e.jsxs(ze,{children:[e.jsxs(Ie,{children:[e.jsx(Ge,{children:"Hapus User"}),e.jsxs(Oe,{children:['Apakah Anda yakin ingin menghapus user "',h==null?void 0:h.full_name,'"? Tindakan ini tidak dapat dibatalkan.']})]}),e.jsxs(Re,{children:[e.jsx(He,{children:"Batal"}),e.jsxs(We,{onClick:ve,disabled:u,className:"bg-red-600 hover:bg-red-700",children:[u?e.jsx(k,{className:"w-4 h-4 animate-spin mr-2"}):null,"Hapus"]})]})]})})]})};export{as as default};
//# sourceMappingURL=Users-BF_WaEmx.js.map
