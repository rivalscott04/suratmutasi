{"version":3,"file":"protected-button-CSOY3iL9.js","sources":["../../src/hooks/useDoubleClickProtection.ts","../../src/components/ui/protected-button.tsx"],"sourcesContent":["import { useState, useCallback, useRef } from 'react';\r\n\r\ninterface UseDoubleClickProtectionOptions {\r\n  delay?: number; // Delay in milliseconds before allowing next click\r\n  showWarning?: boolean; // Whether to show warning on rapid clicks\r\n  warningMessage?: string; // Custom warning message\r\n}\r\n\r\ninterface UseDoubleClickProtectionReturn {\r\n  isProcessing: boolean;\r\n  execute: (fn: () => void | Promise<void>) => Promise<void>;\r\n  executeSync: (fn: () => void) => void;\r\n  reset: () => void;\r\n}\r\n\r\nexport function useDoubleClickProtection(\r\n  options: UseDoubleClickProtectionOptions = {}\r\n): UseDoubleClickProtectionReturn {\r\n  const {\r\n    delay = 1000, // Default 1 second delay\r\n    showWarning = true,\r\n    warningMessage = \"Tunggu sebentar, proses sedang berjalan...\"\r\n  } = options;\r\n\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const lastClickTime = useRef<number>(0);\r\n  const timeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  const reset = useCallback(() => {\r\n    setIsProcessing(false);\r\n    lastClickTime.current = 0;\r\n    if (timeoutRef.current) {\r\n      clearTimeout(timeoutRef.current);\r\n      timeoutRef.current = null;\r\n    }\r\n  }, []);\r\n\r\n  const execute = useCallback(async (fn: () => void | Promise<void>) => {\r\n    const now = Date.now();\r\n    const timeSinceLastClick = now - lastClickTime.current;\r\n\r\n    // If still processing or too soon since last click\r\n    if (isProcessing || (timeSinceLastClick < delay && timeSinceLastClick > 0)) {\r\n      if (showWarning) {\r\n        console.warn(warningMessage);\r\n        // You can integrate with toast notification here if needed\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Set processing state\r\n    setIsProcessing(true);\r\n    lastClickTime.current = now;\r\n\r\n    try {\r\n      // Execute the function\r\n      await fn();\r\n    } catch (error) {\r\n      // Reset immediately on error\r\n      reset();\r\n      throw error;\r\n    } finally {\r\n      // Set timeout to reset processing state\r\n      timeoutRef.current = setTimeout(() => {\r\n        setIsProcessing(false);\r\n      }, delay);\r\n    }\r\n  }, [isProcessing, delay, showWarning, warningMessage, reset]);\r\n\r\n  const executeSync = useCallback((fn: () => void) => {\r\n    const now = Date.now();\r\n    const timeSinceLastClick = now - lastClickTime.current;\r\n\r\n    // If still processing or too soon since last click\r\n    if (isProcessing || (timeSinceLastClick < delay && timeSinceLastClick > 0)) {\r\n      if (showWarning) {\r\n        console.warn(warningMessage);\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Set processing state\r\n    setIsProcessing(true);\r\n    lastClickTime.current = now;\r\n\r\n    try {\r\n      // Execute the function\r\n      fn();\r\n    } catch (error) {\r\n      // Reset immediately on error\r\n      reset();\r\n      throw error;\r\n    } finally {\r\n      // Set timeout to reset processing state\r\n      timeoutRef.current = setTimeout(() => {\r\n        setIsProcessing(false);\r\n      }, delay);\r\n    }\r\n  }, [isProcessing, delay, showWarning, warningMessage, reset]);\r\n\r\n  return {\r\n    isProcessing,\r\n    execute,\r\n    executeSync,\r\n    reset\r\n  };\r\n}\r\n\r\n// Hook untuk form submissions dengan double-click protection\r\nexport function useFormSubmissionProtection(\r\n  options: UseDoubleClickProtectionOptions = {}\r\n) {\r\n  const protection = useDoubleClickProtection({\r\n    delay: 2000, // Longer delay for form submissions\r\n    showWarning: true,\r\n    warningMessage: \"Form sedang diproses, tunggu sebentar...\",\r\n    ...options\r\n  });\r\n\r\n  const submitForm = useCallback(async (\r\n    submitFn: () => void | Promise<void>,\r\n    onSuccess?: () => void,\r\n    onError?: (error: any) => void\r\n  ) => {\r\n    try {\r\n      await protection.execute(submitFn);\r\n      onSuccess?.();\r\n    } catch (error) {\r\n      onError?.(error);\r\n    }\r\n  }, [protection]);\r\n\r\n  return {\r\n    isSubmitting: protection.isProcessing,\r\n    submitForm,\r\n    resetSubmission: protection.reset\r\n  };\r\n}\r\n\r\n// Hook untuk delete actions dengan double-click protection\r\nexport function useDeleteProtection(\r\n  options: UseDoubleClickProtectionOptions = {}\r\n) {\r\n  const protection = useDoubleClickProtection({\r\n    delay: 1500, // Medium delay for delete actions\r\n    showWarning: true,\r\n    warningMessage: \"Penghapusan sedang diproses, tunggu sebentar...\",\r\n    ...options\r\n  });\r\n\r\n  const deleteItem = useCallback(async (\r\n    deleteFn: () => void | Promise<void>,\r\n    onSuccess?: () => void,\r\n    onError?: (error: any) => void\r\n  ) => {\r\n    try {\r\n      await protection.execute(deleteFn);\r\n      onSuccess?.();\r\n    } catch (error) {\r\n      onError?.(error);\r\n    }\r\n  }, [protection]);\r\n\r\n  return {\r\n    isDeleting: protection.isProcessing,\r\n    deleteItem,\r\n    resetDelete: protection.reset\r\n  };\r\n}\r\n\r\n// Hook untuk save actions dengan double-click protection\r\nexport function useSaveProtection(\r\n  options: UseDoubleClickProtectionOptions = {}\r\n) {\r\n  const protection = useDoubleClickProtection({\r\n    delay: 1000, // Standard delay for save actions\r\n    showWarning: true,\r\n    warningMessage: \"Penyimpanan sedang diproses, tunggu sebentar...\",\r\n    ...options\r\n  });\r\n\r\n  const saveData = useCallback(async (\r\n    saveFn: () => void | Promise<void>,\r\n    onSuccess?: () => void,\r\n    onError?: (error: any) => void\r\n  ) => {\r\n    try {\r\n      await protection.execute(saveFn);\r\n      onSuccess?.();\r\n    } catch (error) {\r\n      onError?.(error);\r\n    }\r\n  }, [protection]);\r\n\r\n  return {\r\n    isSaving: protection.isProcessing,\r\n    saveData,\r\n    resetSave: protection.reset\r\n  };\r\n}\r\n\r\n// Utility function untuk debounce clicks\r\nexport function debounce<T extends (...args: any[]) => any>(\r\n  func: T,\r\n  wait: number\r\n): (...args: Parameters<T>) => void {\r\n  let timeout: NodeJS.Timeout;\r\n  \r\n  return (...args: Parameters<T>) => {\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(() => func(...args), wait);\r\n  };\r\n}\r\n\r\n// Utility function untuk throttle clicks\r\nexport function throttle<T extends (...args: any[]) => any>(\r\n  func: T,\r\n  limit: number\r\n): (...args: Parameters<T>) => void {\r\n  let inThrottle: boolean;\r\n  \r\n  return (...args: Parameters<T>) => {\r\n    if (!inThrottle) {\r\n      func(...args);\r\n      inThrottle = true;\r\n      setTimeout(() => inThrottle = false, limit);\r\n    }\r\n  };\r\n}\r\n","import React from 'react';\r\nimport { Button, ButtonProps } from '@/components/ui/button';\r\nimport { Loader2 } from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\n\r\ninterface ProtectedButtonProps extends Omit<ButtonProps, 'onClick' | 'disabled'> {\r\n  onClick?: () => void | Promise<void>;\r\n  isProcessing?: boolean;\r\n  processingText?: string;\r\n  processingIcon?: React.ReactNode;\r\n  protectionDelay?: number;\r\n  showProcessingState?: boolean;\r\n  onSuccess?: () => void;\r\n  onError?: (error: any) => void;\r\n}\r\n\r\nexport const ProtectedButton: React.FC<ProtectedButtonProps> = ({\r\n  onClick,\r\n  isProcessing = false,\r\n  processingText = \"Memproses...\",\r\n  processingIcon,\r\n  protectionDelay = 1000,\r\n  showProcessingState = true,\r\n  onSuccess,\r\n  onError,\r\n  children,\r\n  className,\r\n  disabled,\r\n  ...props\r\n}) => {\r\n  const [internalProcessing, setInternalProcessing] = React.useState(false);\r\n  const [lastClickTime, setLastClickTime] = React.useState(0);\r\n  const timeoutRef = React.useRef<NodeJS.Timeout | null>(null);\r\n\r\n  const isActuallyProcessing = isProcessing || internalProcessing;\r\n\r\n  const handleClick = React.useCallback(async () => {\r\n    if (!onClick) return;\r\n\r\n    const now = Date.now();\r\n    const timeSinceLastClick = now - lastClickTime;\r\n\r\n    // Check if we're already processing or clicked too recently\r\n    if (isActuallyProcessing || (timeSinceLastClick < protectionDelay && timeSinceLastClick > 0)) {\r\n      return; // Ignore the click\r\n    }\r\n\r\n    // Set processing state\r\n    setInternalProcessing(true);\r\n    setLastClickTime(now);\r\n\r\n    try {\r\n      await onClick();\r\n      onSuccess?.();\r\n    } catch (error) {\r\n      onError?.(error);\r\n    } finally {\r\n      // Clear timeout if it exists\r\n      if (timeoutRef.current) {\r\n        clearTimeout(timeoutRef.current);\r\n      }\r\n      \r\n      // Set timeout to reset processing state\r\n      timeoutRef.current = setTimeout(() => {\r\n        setInternalProcessing(false);\r\n      }, protectionDelay);\r\n    }\r\n  }, [\r\n    onClick,\r\n    isActuallyProcessing,\r\n    lastClickTime,\r\n    protectionDelay,\r\n    onSuccess,\r\n    onError\r\n  ]);\r\n\r\n  // Cleanup timeout on unmount\r\n  React.useEffect(() => {\r\n    return () => {\r\n      if (timeoutRef.current) {\r\n        clearTimeout(timeoutRef.current);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  const defaultProcessingIcon = <Loader2 className=\"h-4 w-4 animate-spin text-green-600\" />;\r\n\r\n  return (\r\n    <Button\r\n      {...props}\r\n      onClick={handleClick}\r\n      disabled={disabled || isActuallyProcessing}\r\n      className={cn(\r\n        \"transition-all duration-200\",\r\n        isActuallyProcessing && \"cursor-not-allowed\",\r\n        className\r\n      )}\r\n    >\r\n      {isActuallyProcessing && showProcessingState ? (\r\n        <>\r\n          {processingIcon || defaultProcessingIcon}\r\n          {processingText}\r\n        </>\r\n      ) : (\r\n        children\r\n      )}\r\n    </Button>\r\n  );\r\n};\r\n\r\n// Specialized button components for common use cases\r\nexport const SubmitButton: React.FC<ProtectedButtonProps> = (props) => (\r\n  <ProtectedButton\r\n    {...props}\r\n    processingText=\"Menyimpan...\"\r\n    protectionDelay={2000}\r\n  />\r\n);\r\n\r\nexport const DeleteButton: React.FC<ProtectedButtonProps> = (props) => (\r\n  <ProtectedButton\r\n    {...props}\r\n    processingText=\"Menghapus...\"\r\n    protectionDelay={1500}\r\n    variant=\"destructive\"\r\n  />\r\n);\r\n\r\nexport const SaveButton: React.FC<ProtectedButtonProps> = (props) => (\r\n  <ProtectedButton\r\n    {...props}\r\n    processingText=\"Menyimpan...\"\r\n    protectionDelay={1000}\r\n  />\r\n);\r\n\r\nexport const ConfirmButton: React.FC<ProtectedButtonProps> = (props) => (\r\n  <ProtectedButton\r\n    {...props}\r\n    processingText=\"Mengkonfirmasi...\"\r\n    protectionDelay={1000}\r\n  />\r\n);\r\n\r\nexport default ProtectedButton;\r\n"],"names":["useDoubleClickProtection","options","delay","showWarning","warningMessage","isProcessing","setIsProcessing","useState","lastClickTime","useRef","timeoutRef","reset","useCallback","execute","fn","now","timeSinceLastClick","error","executeSync","useFormSubmissionProtection","protection","submitForm","submitFn","onSuccess","onError","useSaveProtection","saveData","saveFn","ProtectedButton","onClick","processingText","processingIcon","protectionDelay","showProcessingState","children","className","disabled","props","internalProcessing","setInternalProcessing","React","setLastClickTime","isActuallyProcessing","handleClick","defaultProcessingIcon","jsx","Loader2","Button","cn","jsxs","Fragment","SubmitButton","SaveButton"],"mappings":"oJAegB,SAAAA,EACdC,EAA2C,GACX,CAC1B,KAAA,CACJ,MAAAC,EAAQ,IACR,YAAAC,EAAc,GACd,eAAAC,EAAiB,4CACf,EAAAH,EAEE,CAACI,EAAcC,CAAe,EAAIC,WAAS,EAAK,EAChDC,EAAgBC,SAAe,CAAC,EAChCC,EAAaD,SAA8B,IAAI,EAE/CE,EAAQC,EAAAA,YAAY,IAAM,CAC9BN,EAAgB,EAAK,EACrBE,EAAc,QAAU,EACpBE,EAAW,UACb,aAAaA,EAAW,OAAO,EAC/BA,EAAW,QAAU,KAEzB,EAAG,CAAE,CAAA,EAECG,EAAUD,cAAY,MAAOE,GAAmC,CAC9D,MAAAC,EAAM,KAAK,MACXC,EAAqBD,EAAMP,EAAc,QAG/C,GAAIH,GAAiBW,EAAqBd,GAASc,EAAqB,EAAI,CACtEb,GACF,QAAQ,KAAKC,CAAc,EAG7B,MACF,CAGAE,EAAgB,EAAI,EACpBE,EAAc,QAAUO,EAEpB,GAAA,CAEF,MAAMD,EAAG,QACFG,EAAO,CAER,MAAAN,IACAM,CAAA,QACN,CAEWP,EAAA,QAAU,WAAW,IAAM,CACpCJ,EAAgB,EAAK,GACpBJ,CAAK,CACV,CAAA,EACC,CAACG,EAAcH,EAAOC,EAAaC,EAAgBO,CAAK,CAAC,EAEtDO,EAAcN,cAAaE,GAAmB,CAC5C,MAAAC,EAAM,KAAK,MACXC,EAAqBD,EAAMP,EAAc,QAG/C,GAAIH,GAAiBW,EAAqBd,GAASc,EAAqB,EAAI,CACtEb,GACF,QAAQ,KAAKC,CAAc,EAE7B,MACF,CAGAE,EAAgB,EAAI,EACpBE,EAAc,QAAUO,EAEpB,GAAA,CAECD,UACIG,EAAO,CAER,MAAAN,IACAM,CAAA,QACN,CAEWP,EAAA,QAAU,WAAW,IAAM,CACpCJ,EAAgB,EAAK,GACpBJ,CAAK,CACV,CAAA,EACC,CAACG,EAAcH,EAAOC,EAAaC,EAAgBO,CAAK,CAAC,EAErD,MAAA,CACL,aAAAN,EACA,QAAAQ,EACA,YAAAK,EACA,MAAAP,CAAA,CAEJ,CAGgB,SAAAQ,EACdlB,EAA2C,GAC3C,CACA,MAAMmB,EAAapB,EAAyB,CAC1C,MAAO,IACP,YAAa,GACb,eAAgB,2CAChB,GAAGC,CAAA,CACJ,EAEKoB,EAAaT,EAAA,YAAY,MAC7BU,EACAC,EACAC,IACG,CACC,GAAA,CACI,MAAAJ,EAAW,QAAQE,CAAQ,EACrBC,GAAA,MAAAA,UACLN,EAAO,CACdO,GAAA,MAAAA,EAAUP,EACZ,CAAA,EACC,CAACG,CAAU,CAAC,EAER,MAAA,CACL,aAAcA,EAAW,aACzB,WAAAC,EACA,gBAAiBD,EAAW,KAAA,CAEhC,CAkCgB,SAAAK,EACdxB,EAA2C,GAC3C,CACA,MAAMmB,EAAapB,EAAyB,CAC1C,MAAO,IACP,YAAa,GACb,eAAgB,kDAChB,GAAGC,CAAA,CACJ,EAEKyB,EAAWd,EAAA,YAAY,MAC3Be,EACAJ,EACAC,IACG,CACC,GAAA,CACI,MAAAJ,EAAW,QAAQO,CAAM,EACnBJ,GAAA,MAAAA,UACLN,EAAO,CACdO,GAAA,MAAAA,EAAUP,EACZ,CAAA,EACC,CAACG,CAAU,CAAC,EAER,MAAA,CACL,SAAUA,EAAW,aACrB,SAAAM,EACA,UAAWN,EAAW,KAAA,CAE1B,CCvLO,MAAMQ,EAAkD,CAAC,CAC9D,QAAAC,EACA,aAAAxB,EAAe,GACf,eAAAyB,EAAiB,eACjB,eAAAC,EACA,gBAAAC,EAAkB,IAClB,oBAAAC,EAAsB,GACtB,UAAAV,EACA,QAAAC,EACA,SAAAU,EACA,UAAAC,EACA,SAAAC,EACA,GAAGC,CACL,IAAM,CACJ,KAAM,CAACC,EAAoBC,CAAqB,EAAIC,EAAM,SAAS,EAAK,EAClE,CAAChC,EAAeiC,CAAgB,EAAID,EAAM,SAAS,CAAC,EACpD9B,EAAa8B,EAAM,OAA8B,IAAI,EAErDE,EAAuBrC,GAAgBiC,EAEvCK,EAAcH,EAAM,YAAY,SAAY,CAChD,GAAI,CAACX,EAAS,OAER,MAAAd,EAAM,KAAK,MACXC,EAAqBD,EAAMP,EAGjC,GAAI,EAAAkC,GAAyB1B,EAAqBgB,GAAmBhB,EAAqB,GAK1F,CAAAuB,EAAsB,EAAI,EAC1BE,EAAiB1B,CAAG,EAEhB,GAAA,CACF,MAAMc,EAAQ,EACFN,GAAA,MAAAA,UACLN,EAAO,CACdO,GAAA,MAAAA,EAAUP,EAAK,QACf,CAEIP,EAAW,SACb,aAAaA,EAAW,OAAO,EAItBA,EAAA,QAAU,WAAW,IAAM,CACpC6B,EAAsB,EAAK,GAC1BP,CAAe,CACpB,EAAA,EACC,CACDH,EACAa,EACAlC,EACAwB,EACAT,EACAC,CAAA,CACD,EAGDgB,EAAM,UAAU,IACP,IAAM,CACP9B,EAAW,SACb,aAAaA,EAAW,OAAO,CACjC,EAED,CAAE,CAAA,EAEL,MAAMkC,EAAwBC,EAAAA,IAACC,EAAQ,CAAA,UAAU,qCAAsC,CAAA,EAGrF,OAAAD,EAAA,IAACE,EAAA,CACE,GAAGV,EACJ,QAASM,EACT,SAAUP,GAAYM,EACtB,UAAWM,EACT,8BACAN,GAAwB,qBACxBP,CACF,EAEC,SAAAO,GAAwBT,EAEpBgB,EAAA,KAAAC,EAAA,SAAA,CAAA,SAAA,CAAkBnB,GAAAa,EAClBd,CAAA,CAAA,CACH,EAEAI,CAAA,CAAA,CAIR,EAGaiB,EAAgDd,GAC3DQ,EAAA,IAACjB,EAAA,CACE,GAAGS,EACJ,eAAe,eACf,gBAAiB,GAAA,CACnB,EAYWe,EAA8Cf,GACzDQ,EAAA,IAACjB,EAAA,CACE,GAAGS,EACJ,eAAe,eACf,gBAAiB,GAAA,CACnB"}