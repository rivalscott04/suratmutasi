import{j as e,Z as se,K as te,aL as ne,V as re,W as A,au as ie,aM as le,k as ce,aN as de}from"./ui-vendor-BCnv6AUJ.js";import{d as me,r as n}from"./react-vendor-C8WR5ETM.js";import{C as B,a as G,b as z,c as F}from"./card-BdJnS6vC.js";import{u as oe,a as q,B as o,b as v,I as xe,k as he}from"./index-C-x3Fahl.js";import{C as H}from"./checkbox-C1yZdyyL.js";import{T as ue,a as je,b as w,c as d,d as ge,e as r}from"./table-oFnwtDne.js";const Ce=()=>{const u=me(),{user:pe,token:p,isAuthenticated:C}=oe(),[K,O]=n.useState({}),[m,x]=n.useState(null),[i,R]=n.useState(""),[U,P]=n.useState(!0),[j,l]=n.useState(null),[S,T]=n.useState(!1),[c,_]=n.useState(1),[b]=n.useState(5),[L,$]=n.useState([]),[t,J]=n.useState(null);n.useEffect(()=>{if(!C){u("/");return}V()},[C,u]);const V=async()=>{try{const a=await q("/api/job-type-configurations?active_only=true",p);a.success&&$(a.data)}catch(a){console.error("Error fetching job types:",a),l("Gagal mengambil data jabatan")}},W=a=>{J(a),Z(a.id)},Z=async a=>{try{P(!0),l(null);const s=await q("/api/pengajuan/pegawai-grouped",p);if(s.success){const k={};Object.entries(s.data).forEach(([ee,ae])=>{const M=ae.filter(be=>!0);M.length>0&&(k[ee]=M)}),O(k),Object.keys(k).length===0&&l("Tidak ada pegawai yang tersedia untuk jabatan ini")}else l(s.message||"Gagal mengambil data pegawai")}catch(s){console.error("Error fetching pegawai by jabatan:",s),l("Terjadi kesalahan saat mengambil data pegawai")}finally{P(!1)}},Q=async()=>{if(!(!m||!t))try{T(!0);const a=await he("/api/pengajuan",{pegawai_nip:m,jabatan_id:t.id,jenis_jabatan:t.jenis_jabatan},p);a.success?u(`/pengajuan/${a.data.id}/upload`,{state:{jabatan:t,requiredFiles:t.required_files}}):l(a.message||"Gagal membuat pengajuan")}catch(a){console.error("Error creating pengajuan:",a),l("Terjadi kesalahan saat membuat pengajuan")}finally{T(!1)}},D=()=>{const a=[];return Object.values(K).forEach(s=>{a.push(...s)}),i?a.filter(s=>s.nama.toLowerCase().includes(i.toLowerCase())||s.jabatan.toLowerCase().includes(i.toLowerCase())||s.unit_kerja.toLowerCase().includes(i.toLowerCase())||s.nip.includes(i)):a},X=a=>{if(a){const s=D();s.length>0&&x(s[0].nip)}else x(null)},h=D(),f=h.length,g=Math.ceil(f/b),N=(c-1)*b,E=N+b,I=h.slice(N,E),y=a=>{_(a),x(null)},Y=a=>{R(a),_(1),x(null)};return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs(o,{variant:"outline",onClick:()=>u("/pengajuan"),className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-4 w-4"}),"Kembali ke Data Pengajuan"]})}),e.jsxs(B,{children:[e.jsxs(G,{children:[e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Pilih Pegawai untuk Pengajuan"]}),e.jsx("div",{className:"text-sm text-gray-600",children:t?`Pilih pegawai untuk pengajuan jabatan: ${t.jenis_jabatan}`:"Pilih jabatan terlebih dahulu, kemudian pilih pegawai yang akan diajukan"})]}),e.jsxs(F,{children:[j&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600",children:j})}),!t&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Pilih Jabatan untuk Pengajuan"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:L.map(a=>e.jsxs(B,{className:"cursor-pointer transition-all duration-200 hover:shadow-md hover:border-green-300",onClick:()=>W(a),children:[e.jsx(G,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(z,{className:"text-lg font-semibold text-gray-800",children:a.jenis_jabatan}),e.jsx(v,{variant:"secondary",className:"bg-green-100 text-green-800 border-green-200",children:"Aktif"})]})}),e.jsx(F,{className:"pt-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Dokumen:"}),e.jsx("span",{className:"font-semibold text-green-600",children:a.max_dokumen})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Min Dokumen:"}),e.jsx("span",{className:"text-sm text-gray-500",children:a.min_dokumen})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Jenis File:"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[a.required_files.length," jenis"]})]})]})})]},a.id))}),L.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ne,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Tidak ada jabatan yang tersedia"})]})]}),t&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-green-800",children:["Jabatan: ",t.jenis_jabatan]}),e.jsxs("p",{className:"text-sm text-green-600",children:[t.required_files.length," jenis dokumen diperlukan"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(v,{className:"bg-green-600 text-white",children:[t.max_dokumen," dokumen"]}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>J(null),className:"border-green-600 text-green-600 hover:bg-green-50",children:"Pilih Jabatan Lain"})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(xe,{placeholder:"Cari pegawai berdasarkan nama, jabatan, unit kerja, atau NIP...",value:i,onChange:a=>Y(a.target.value),className:"pl-10"})]}),h.length>0&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Menampilkan ",h.length," pegawai (halaman ",c," dari ",g,")"]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:t?U?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(A,{className:"h-8 w-8 animate-spin mr-2"}),e.jsx("span",{children:"Memuat data pegawai..."})]}):j?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(ie,{className:"h-12 w-12 text-red-400 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 mb-2",children:j}),e.jsx("p",{className:"text-sm text-gray-500",children:"Pastikan sudah ada surat yang dibuat untuk pegawai di menu Template Generator"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(ue,{children:[e.jsx(je,{children:e.jsxs(w,{children:[e.jsx(d,{className:"w-12",children:e.jsx(H,{checked:m!==null,onCheckedChange:X})}),e.jsx(d,{children:"NIP"}),e.jsx(d,{children:"Nama"}),e.jsx(d,{children:"Jabatan"}),e.jsx(d,{children:"Unit Kerja"}),e.jsx(d,{children:"Induk Unit"}),e.jsx(d,{className:"text-center",children:"Total Surat"})]})}),e.jsx(ge,{children:I.length===0?e.jsx(w,{children:e.jsx(r,{colSpan:7,className:"text-center py-8 text-gray-500",children:i?"Tidak ada pegawai yang sesuai dengan pencarian":e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"Tidak ada pegawai yang tersedia"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Pastikan sudah ada surat yang dibuat untuk pegawai di menu Template Generator"})]})})}):I.map(a=>e.jsxs(w,{className:"hover:bg-gray-50",children:[e.jsx(r,{children:e.jsx(H,{checked:m===a.nip,onCheckedChange:s=>{x(s?a.nip:null)}})}),e.jsx(r,{className:"font-mono text-sm",children:a.nip}),e.jsx(r,{className:"font-medium",children:a.nama}),e.jsx(r,{children:a.jabatan}),e.jsx(r,{children:a.unit_kerja}),e.jsx(r,{children:a.induk_unit}),e.jsx(r,{className:"text-center",children:e.jsxs(v,{variant:"secondary",children:[a.total_surat," surat"]})})]},a.nip))})]}),g>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Menampilkan ",N+1," sampai ",Math.min(E,f)," dari ",f," pegawai"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>y(c-1),disabled:c===1,children:[e.jsx(le,{className:"h-4 w-4"}),"Sebelumnya"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:g},(a,s)=>s+1).map(a=>e.jsx(o,{variant:c===a?"default":"outline",size:"sm",onClick:()=>y(a),className:"w-8 h-8 p-0",children:a},a))}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>y(c+1),disabled:c===g,children:["Selanjutnya",e.jsx(ce,{className:"h-4 w-4"})]})]})]})]}):null}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(o,{onClick:Q,disabled:!m||!t||S,size:"lg",className:"bg-green-600 hover:bg-green-700 text-white",children:S?e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"h-4 w-4 mr-2 animate-spin"}),"Membuat Pengajuan..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"h-4 w-4 mr-2"}),"Proses Pengajuan"]})})}),!m&&t&&h.length>0&&e.jsx("p",{className:"text-sm text-gray-500 mt-2 text-center",children:"Pilih satu pegawai untuk melanjutkan proses pengajuan"})]})]})]})};export{Ce as default};
//# sourceMappingURL=PengajuanSelect-Boy1H61u.js.map
