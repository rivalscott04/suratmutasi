import{j as e,a0 as h,ac as W,K,ad as X,ae as Z,af as ee,ag as ae,ah as te}from"./ui-vendor-Bk6Wi0va.js";import{d as se,r as l,L as U}from"./react-vendor-C8WR5ETM.js";import{u as re,a as y,S as w,B as Y,b as v}from"./index-C8QR7mAl.js";import{C as g,a as x,b as m,c as u}from"./card-DGWpsVST.js";import{T as ne,a as le,b as A,c as j,d as ce,e as d}from"./table-DDZlzQH8.js";const me=()=>{const{user:r,token:o,loading:S}=re(),M=se(),[c,G]=l.useState([]),[p,D]=l.useState([]),[T,H]=l.useState(null),[q,R]=l.useState(!1),[ie,B]=l.useState(!1),[f,z]=l.useState(""),[C,k]=l.useState([]),[F,b]=l.useState(!1),P=c.filter(a=>{var t,s,n;return((t=a.letter_number)==null?void 0:t.toLowerCase().includes(f.toLowerCase()))||((s=a.subject)==null?void 0:s.toLowerCase().includes(f.toLowerCase()))||((n=a.template_name)==null?void 0:n.toLowerCase().includes(f.toLowerCase()))});if(l.useEffect(()=>{!S&&!r&&M("/")},[r,S,M]),l.useEffect(()=>{r&&o&&(R(!0),y("/api/letters",o).then(t=>G(t.letters||[])).catch(t=>H(t.message||"Gagal fetch surat")).finally(()=>R(!1)),B(!0),y("/api/pengajuan",o).then(t=>D(t.pengajuan||[])).catch(()=>D([])).finally(()=>B(!1)),(async()=>{var t;try{b(!0);const s=await y("/api/pengajuan/rekap/aggregate",o),n=((t=s==null?void 0:s.data)==null?void 0:t.aggregation)||(s==null?void 0:s.aggregation)||[];k(Array.isArray(n)?n:[])}catch{k([])}finally{b(!1)}})())},[r,o]),S)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen",children:[e.jsx(w,{className:"h-8 w-1/2 mb-4"}),e.jsx(w,{className:"h-10 w-1/3 mb-2"}),e.jsx(w,{className:"h-10 w-1/3 mb-2"}),e.jsx(w,{className:"h-10 w-1/3 mb-2"})]});const N=(a,t)=>{if(t===0)return a>0?"+100%":"0%";const s=(a-t)/t*100;return`${s>=0?"+":""}${Math.round(s)}%`},_=(a,t)=>{const s=new Date;return s.setMonth(s.getMonth()-1),a.filter(n=>{const i=new Date(n[t]);return i.getMonth()===s.getMonth()&&i.getFullYear()===s.getFullYear()})},$=(a,t)=>{const s=new Date;return a.filter(n=>{const i=new Date(n[t]);return i.getMonth()===s.getMonth()&&i.getFullYear()===s.getFullYear()})},E=$(c,"createdAt"),L=_(c,"createdAt");$(p,"createdAt");const J=_(p,"createdAt"),O=[{title:"Total Surat",value:c.length,change:N(c.length,L.length),icon:h,color:"text-blue-600"},{title:"Surat Bulan Ini",value:E.length,change:N(E.length,L.length),icon:W,color:"text-green-600"},{title:"Pengajuan Aktif",value:p.filter(a=>a.status==="active"||a.status==="pending").length,change:N(p.filter(a=>a.status==="active"||a.status==="pending").length,J.filter(a=>a.status==="active"||a.status==="pending").length),icon:K,color:"text-purple-600"},{title:"Surat Pending",value:c.filter(a=>a.status==="draft").length,change:N(c.filter(a=>a.status==="draft").length,L.filter(a=>a.status==="draft").length),icon:X,color:"text-orange-600"}],I=Array.from(new Set(c.map(a=>a.template_name))).filter(Boolean),Q=[{title:"Buat Surat Baru",description:"Mulai membuat surat dengan template yang tersedia",icon:h,href:"/generator",color:"bg-blue-500",showForRoles:["admin","operator"]},{title:"Pengajuan",description:"Buat pengajuan jabatan untuk pegawai",icon:K,href:"/pengajuan/select",color:"bg-green-500",showForRoles:["admin","operator"]},{title:"Lihat Laporan",description:"Analisis penggunaan surat",icon:te,href:"/reports",color:"bg-purple-500",showForRoles:["admin","operator","user"]}],V=a=>a==="generated"?e.jsx(v,{className:"bg-green-100 text-green-700 border-green-200",children:"Generated"}):a==="draft"?e.jsx(v,{className:"bg-orange-100 text-orange-700 border-orange-200",children:"Draft"}):a==="signed"?e.jsx(v,{className:"bg-blue-100 text-blue-700 border-blue-200",children:"Signed"}):e.jsx(v,{className:"bg-gray-100 text-gray-700 border-gray-200",children:a});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),e.jsxs("p",{className:"text-gray-600",children:["Selamat datang, ",(r==null?void 0:r.full_name)||(r==null?void 0:r.email)||"User"," - ",(r==null?void 0:r.role)||"Operator"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:new Date().toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:O.map((a,t)=>{const s=a.icon;return e.jsxs(g,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium text-gray-600",children:a.title}),e.jsx(s,{className:`h-4 w-4 ${a.color}`})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:a.value}),e.jsxs("p",{className:"text-xs text-gray-500",children:[e.jsx("span",{className:"text-green-600",children:a.change})," dari bulan lalu"]})]})]},t)})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Q.filter(a=>a.showForRoles.includes((r==null?void 0:r.role)||"")).map((a,t)=>{const s=a.icon;return e.jsxs(g,{className:"hover:shadow-md transition-shadow cursor-pointer",children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-lg ${a.color}`,children:e.jsx(s,{className:"h-5 w-5 text-white"})}),e.jsx("div",{children:e.jsx(m,{className:"text-lg",children:a.title})})]})}),e.jsxs(u,{children:[e.jsx("p",{className:"text-gray-600 mb-4",children:a.description}),e.jsx(Y,{asChild:!0,variant:"outline",className:"w-full",children:e.jsxs(U,{to:a.href,children:["Akses ",e.jsx(ee,{className:"ml-2 h-4 w-4"})]})})]})]},t)})}),e.jsxs(g,{children:[e.jsx(x,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{className:"text-xl font-semibold",children:"Rekap Status per Kabupaten"}),e.jsxs(Y,{variant:"outline",size:"sm",className:"border-green-200 text-green-700 hover:bg-green-50",onClick:async()=>{var a;if(o)try{b(!0);const t=await y("/api/pengajuan/rekap/aggregate",o),s=((a=t==null?void 0:t.data)==null?void 0:a.aggregation)||(t==null?void 0:t.aggregation)||[];k(Array.isArray(s)?s:[])}finally{b(!1)}},children:[e.jsx(ae,{className:`h-4 w-4 mr-2 ${F?"animate-spin":""}`})," Refresh"]})]})}),e.jsx(u,{children:F?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Memuat rekap..."}):C.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"Tidak ada data"}):(()=>{const a=Array.from(new Set(C.flatMap(t=>t.statuses.map(s=>s.status))));return e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-3 pr-4 font-medium",children:"Kabupaten"}),a.map(t=>e.jsx("th",{className:"py-3 pr-4 font-medium whitespace-nowrap",children:t.replaceAll("_"," ").toUpperCase()},t)),e.jsx("th",{className:"py-3 pr-4 font-medium",children:"Total"})]})}),e.jsx("tbody",{children:C.map(t=>{const s=t.statuses.reduce((n,i)=>(n[i.status]=i.count,n),{});return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 pr-4 font-medium",children:t.kabupaten}),a.map(n=>e.jsx("td",{className:"py-3 pr-4",children:s[n]||0},n)),e.jsx("td",{className:"py-3 pr-4 font-semibold",children:t.total})]},t.kabupaten)})})]})})})()})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:e.jsxs(g,{children:[e.jsx(x,{children:e.jsxs(m,{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-5 h-5 text-green-700"})," Jenis Template"]})}),e.jsx(u,{children:e.jsx("div",{className:"space-y-3",children:I.length===0?e.jsx("div",{className:"text-center text-gray-500",children:"Belum ada template surat"}):I.map((a,t)=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-gray-50 rounded-lg",children:[e.jsx(h,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{className:"font-medium text-gray-900",children:a})]},t))})})]})}),e.jsxs(g,{className:"mb-4",children:[e.jsx(x,{children:e.jsx(m,{className:"text-xl font-semibold",children:"Daftar Surat"})}),e.jsxs(u,{children:[e.jsx("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-2",children:e.jsx("input",{type:"text",className:"input input-bordered w-full md:w-64",placeholder:"Cari nomor, perihal, atau template...",value:f,onChange:a=>z(a.target.value)})}),q?e.jsx("div",{children:"Loading surat..."}):T?e.jsx("div",{className:"text-error",children:T}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ne,{children:[e.jsx(le,{children:e.jsxs(A,{children:[e.jsx(j,{children:"No."}),e.jsx(j,{children:"Nomor Surat"}),e.jsx(j,{children:"Perihal"}),e.jsx(j,{children:"Status"}),e.jsx(j,{children:"Aksi"})]})}),e.jsx(ce,{children:P.length===0?e.jsx(A,{children:e.jsx(d,{colSpan:5,className:"text-center",children:"Tidak ada surat"})}):P.slice(0,5).map((a,t)=>e.jsxs(A,{children:[e.jsx(d,{children:t+1}),e.jsx(d,{children:a.letter_number}),e.jsx(d,{children:a.subject}),e.jsx(d,{children:V(a.status)}),e.jsx(d,{children:e.jsxs(U,{to:`/letters/${a.id}`,className:"btn btn-xs btn-outline flex items-center gap-1",children:[e.jsx(h,{className:"w-4 h-4"})," Detail"]})})]},a.id))})]})})]})]})]})};export{me as default};
//# sourceMappingURL=Dashboard-BC-U7mfu.js.map
