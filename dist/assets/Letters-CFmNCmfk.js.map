{"version":3,"file":"Letters-CFmNCmfk.js","sources":["../../src/pages/Letters.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { apiGet, apiDelete, apiPut } from '@/lib/api';\r\nimport { generateUrl } from '@/lib/utils';\r\nimport { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { FileText, Printer, ExternalLink, Eye, ChevronRight, Building2, Inbox, Search, Filter, Lock, Trash2, RefreshCw, Users, ClipboardList, Info, Edit3, X, Download } from 'lucide-react';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Table, TableHeader, TableBody, TableRow, TableHead, TableCell } from '@/components/ui/table';\r\nimport { Dialog, DialogContent, DialogTitle } from '@/components/ui/dialog';\r\nimport { Template1 } from '@/components/templates/Template1';\r\nimport { Template2 } from '@/components/templates/Template2';\r\nimport { Template3 } from '@/components/templates/Template3';\r\nimport { Template4 } from '@/components/templates/Template4';\r\nimport { Template5 } from '@/components/templates/Template5';\r\nimport { Template6 } from '@/components/templates/Template6';\r\nimport { Template7 } from '@/components/templates/Template7';\r\nimport { Template8 } from '@/components/templates/Template8';\r\nimport { Template9 } from '@/components/templates/Template9';\r\nimport { apiPost } from '@/lib/api';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport SuratPreviewContainer from '@/components/SuratPreviewContainer';\r\nimport { Skeleton } from '@/components/ui/skeleton';\r\nimport { Accordion, AccordionContent, AccordionItem, AccordionTrigger } from '@/components/ui/accordion';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { PegawaiSearchInput } from '@/components/PegawaiSearchInput';\r\nimport * as XLSX from 'xlsx';\r\nimport { Label } from '@/components/ui/label';\r\n\r\nconst Letters: React.FC = () => {\r\n  const { token, user } = useAuth();\r\n  const [letters, setLetters] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [search, setSearch] = useState('');\r\n  const [sortBy, setSortBy] = useState<'letter_number'|'template_name'|'tanggal'|'status'>('letter_number');\r\n  const [sortDir, setSortDir] = useState<'asc'|'desc'>('asc');\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [pageSize, setPageSize] = useState(10);\r\n  const [activeTab, setActiveTab] = useState<'all'|'with-employee'|'without-employee'>('all');\r\n  \r\n  const { toast } = useToast();\r\n  const [selectedPegawaiNip, setSelectedPegawaiNip] = useState<string | null>(null);\r\n  const [selectedLetterId, setSelectedLetterId] = useState<string | null>(null);\r\n  const [pegawaiLetters, setPegawaiLetters] = useState<any[]>([]);\r\n  const [modalOpen, setModalOpen] = useState(false);\r\n  const [selectedLetterForPreview, setSelectedLetterForPreview] = useState<any>(null);\r\n  const [pdfLoading, setPdfLoading] = useState(false);\r\n  const [pdfUrl, setPdfUrl] = useState<string | null>(null);\r\n  const [expandedPegawai, setExpandedPegawai] = useState<string | null>(null);\r\n  const [expandedSurat, setExpandedSurat] = useState<string | null>(null);\r\n\r\n  // State untuk pagination per kantor\r\n  const [officePaging, setOfficePaging] = useState<Record<string, { currentPage: number; pageSize: number }>>({});\r\n  // State untuk mapping officeId -> nama kantor/kabkota\r\n  const [officeMap, setOfficeMap] = useState<Record<string, { namakantor?: string; kabkota?: string }>>({});\r\n\r\n  // Tambahkan state untuk modal edit pejabat & pegawai\r\n  const [editLetter, setEditLetter] = useState<any>(null);\r\n  const [editPejabat, setEditPejabat] = useState<any>(null);\r\n  const [editPegawai, setEditPegawai] = useState<any>(null);\r\n  const [editSaving, setEditSaving] = useState(false);\r\n\r\n  const navigate = useNavigate();\r\n  const [showSessionExpiredModal, setShowSessionExpiredModal] = useState(false);\r\n  const [showDeleteModal, setShowDeleteModal] = useState(false);\r\n  const [letterToDelete, setLetterToDelete] = useState<any>(null);\r\n  const [deleting, setDeleting] = useState(false);\r\n  \r\n  // Bulk selection state\r\n  const [selectedLetters, setSelectedLetters] = useState<string[]>([]);\r\n  const [selectAll, setSelectAll] = useState(false);\r\n  const [showBulkDeleteModal, setShowBulkDeleteModal] = useState(false);\r\n  const [bulkDeleting, setBulkDeleting] = useState(false);\r\n\r\n  // Export Excel state\r\n  const [showExportModal, setShowExportModal] = useState(false);\r\n  const [exportTemplateFilter, setExportTemplateFilter] = useState<string>('all');\r\n  const [exportOfficeFilter, setExportOfficeFilter] = useState<string>('all');\r\n  const [offices, setOffices] = useState<any[]>([]);\r\n  const [exporting, setExporting] = useState(false);\r\n\r\n  // Filter letters berdasarkan search\r\n  const filteredLetters = letters.filter(l =>\r\n    l.letter_number?.toLowerCase().includes(search.toLowerCase()) ||\r\n    l.template_name?.toLowerCase().includes(search.toLowerCase()) ||\r\n    l.office?.namakantor?.toLowerCase().includes(search.toLowerCase()) ||\r\n    l.office?.kabkota?.toLowerCase().includes(search.toLowerCase())\r\n  );\r\n\r\n  // Filter letters berdasarkan tab\r\n  const getFilteredLettersByTab = () => {\r\n    switch (activeTab) {\r\n      case 'with-employee':\r\n        return filteredLetters.filter(l => ![2, 9].includes(l.template_id));\r\n      case 'without-employee':\r\n        return filteredLetters.filter(l => [2, 9].includes(l.template_id));\r\n      default:\r\n        return filteredLetters;\r\n    }\r\n  };\r\n\r\n  const tabFilteredLetters = getFilteredLettersByTab();\r\n\r\n  // Sort letters\r\n  const sortedLetters = [...tabFilteredLetters].sort((a, b) => {\r\n    let aVal = a[sortBy] || '';\r\n    let bVal = b[sortBy] || '';\r\n    if (sortBy === 'tanggal') {\r\n      aVal = a.form_data?.tanggal || '';\r\n      bVal = b.form_data?.tanggal || '';\r\n    }\r\n    if (sortDir === 'asc') return String(aVal).localeCompare(String(bVal));\r\n    return String(bVal).localeCompare(String(aVal));\r\n  });\r\n\r\n  // Group surat by office (dengan fallback mapping office_id)\r\n  const groupedByOffice: Record<string, any[]> = sortedLetters.reduce((acc, surat) => {\r\n    let officeName = surat.office?.namakantor || surat.office?.kabkota;\r\n    if (!officeName && surat.office_id && officeMap[surat.office_id]) {\r\n      officeName = officeMap[surat.office_id].namakantor || officeMap[surat.office_id].kabkota;\r\n    }\r\n    if (!officeName) officeName = 'Kantor Tidak Diketahui';\r\n    if (!acc[officeName]) acc[officeName] = [];\r\n    acc[officeName].push(surat);\r\n    return acc;\r\n  }, {});\r\n \r\n  // Filter grouped by search\r\n  const filteredGrouped: [string, any[]][] = Object.entries(groupedByOffice).filter(([officeName, suratList]) => {\r\n    if (!search) return true;\r\n    return officeName.toLowerCase().includes(search.toLowerCase()) ||\r\n      suratList.some(surat => surat.letter_number.toLowerCase().includes(search.toLowerCase()));\r\n  });\r\n  \r\n  useEffect(() => {\r\n    if (!token) return;\r\n    setLoading(true);\r\n    apiGet('/api/letters', token)\r\n      .then(res => setLetters(res.letters || []))\r\n      .catch((err) => {\r\n        if (err.message && (err.message.includes('Invalid or expired token') || err.message.includes('401'))) {\r\n          setShowSessionExpiredModal(true);\r\n        } else {\r\n          setError('Gagal mengambil data surat');\r\n        }\r\n      })\r\n      .finally(() => setLoading(false));\r\n  }, [token]);\r\n\r\n  // Fetch offices saat mount\r\n  useEffect(() => {\r\n    if (!token) return;\r\n    apiGet('/api/offices', token)\r\n      .then(res => {\r\n        const map: Record<string, { namakantor?: string; kabkota?: string }> = {};\r\n        const officesList = res.offices || [];\r\n        officesList.forEach((office: any) => {\r\n          map[office.id] = { namakantor: office.namakantor, kabkota: office.kabkota };\r\n        });\r\n        setOfficeMap(map);\r\n        setOffices(officesList);\r\n      })\r\n      .catch(() => {});\r\n  }, [token]);\r\n\r\n  // Get unique templates for export filter\r\n  const uniqueTemplates = Array.from(new Set(letters.map(l => l.template_name))).sort();\r\n\r\n  // Ringkasan\r\n  const byStatus = (status: string) => letters.filter(l => l.status === status).length;\r\n  const total = letters.length;\r\n  const mostTemplate = letters.length > 0 ? \r\n    letters.reduce((acc, l) => {\r\n      acc[l.template_name] = (acc[l.template_name] || 0) + 1;\r\n      return acc;\r\n    }, {} as Record<string, number>) : {};\r\n  const mostTemplateName = Object.keys(mostTemplate).length > 0 ? \r\n    Object.entries(mostTemplate).sort(([,a], [,b]) => (b as number) - (a as number))[0][0] : 'Tidak ada data';\r\n  \r\n  // Find most recent letter\r\n  const getMostRecentLetter = () => {\r\n    if (letters.length === 0) return null;\r\n    return letters.reduce((latest, current) => {\r\n      const latestDate = new Date(latest.created_at || 0);\r\n      const currentDate = new Date(current.created_at || 0);\r\n      return currentDate > latestDate ? current : latest;\r\n    });\r\n  };\r\n  \r\n  const mostRecentLetter = getMostRecentLetter();\r\n  const getMostRecentOffice = () => {\r\n    if (!mostRecentLetter) return 'Tidak ada data';\r\n    \r\n    // Get office name from kode_kabko\r\n    const getOfficeNameFromKode = (kode: string) => {\r\n      const officeMap: Record<string, string> = {\r\n        '01': 'KOTA MATARAM',\r\n        '02': 'KABUPATEN LOMBOK BARAT',\r\n        '03': 'KABUPATEN LOMBOK TENGAH',\r\n        '04': 'KABUPATEN LOMBOK TIMUR',\r\n        '05': 'KABUPATEN SUMBAWA',\r\n        '06': 'KABUPATEN DOMPU',\r\n        '07': 'KOTA MATARAM',\r\n        '08': 'KABUPATEN BIMA',\r\n        '09': 'KOTA BIMA',\r\n        '10': 'KABUPATEN SUMBAWA BARAT',\r\n        '11': 'KABUPATEN LOMBOK UTARA',\r\n        '12': 'KABUPATEN LOMBOK TENGAH',\r\n        '13': 'KABUPATEN LOMBOK TIMUR',\r\n        '14': 'KABUPATEN SUMBAWA',\r\n        '15': 'KABUPATEN DOMPU',\r\n        '16': 'KABUPATEN BIMA',\r\n        '17': 'KOTA BIMA',\r\n        '18': 'KABUPATEN SUMBAWA BARAT',\r\n        '19': 'KABUPATEN LOMBOK UTARA',\r\n        '20': 'KABUPATEN LOMBOK TENGAH'\r\n      };\r\n      return officeMap[kode] || 'Kantor Tidak Diketahui';\r\n    };\r\n    \r\n    const officeName = mostRecentLetter.office?.namakantor || \r\n                      mostRecentLetter.office?.kabkota || \r\n                      getOfficeNameFromKode(mostRecentLetter.form_data?.kode_kabko || mostRecentLetter.office?.kode_kabko || '') ||\r\n                      'Kantor Tidak Diketahui';\r\n    \r\n    const timeAgo = mostRecentLetter.created_at ? \r\n      new Date(mostRecentLetter.created_at).toLocaleDateString('id-ID', { \r\n        day: 'numeric', \r\n        month: 'short', \r\n        hour: '2-digit', \r\n        minute: '2-digit' \r\n      }) : 'Tidak diketahui';\r\n    return `${officeName} (${timeAgo})`;\r\n  };\r\n\r\n  // Helper badge status\r\n  const getStatusBadge = (status: string) => {\r\n    if (status === 'generated') return <Badge className=\"bg-green-100 text-green-700 border-green-200\">Generated</Badge>;\r\n    if (status === 'signed') return <Badge className=\"bg-blue-100 text-blue-700 border-blue-200\">Signed</Badge>;\r\n    return null; // Hilangkan badge Draft\r\n  };\r\n\r\n  const handleShowPegawaiLetters = async (nip: string, letterId: string) => {\r\n    if (selectedPegawaiNip === nip && selectedLetterId === letterId) {\r\n      setSelectedPegawaiNip(null);\r\n      setSelectedLetterId(null);\r\n      setPegawaiLetters([]);\r\n      return;\r\n    }\r\n    setSelectedPegawaiNip(nip);\r\n    setSelectedLetterId(letterId);\r\n    try {\r\n      const res = await apiGet(`/api/letters?recipient_employee_nip=${nip}`, token);\r\n      setPegawaiLetters(res.letters || []);\r\n    } catch (err) {\r\n      toast({ title: 'Gagal mengambil data surat pegawai', description: 'Terjadi kesalahan saat mengambil data', variant: 'destructive' });\r\n    }\r\n  };\r\n\r\n  // Render preview surat sesuai template\r\n  const renderPreviewByTemplate = (letter: any) => {\r\n    let data = letter.form_data;\r\n    if (typeof data === 'string') {\r\n      try { data = JSON.parse(data); } catch { data = {}; }\r\n    }\r\n    if (!data) return <div className=\"text-error\">Data surat tidak ditemukan</div>;\r\n    \r\n\r\n    \r\n    const id = String(letter.template_id);\r\n    // Fallback nomor surat universal (pakai regex agar tidak kosong setelah B-)\r\n    const nomorParts = (letter.letter_number || '').split('/');\r\n    const matchNoSurat = letter.letter_number?.match(/^B-([^/]+)/);\r\n    const fallback = {\r\n      nosrt: data.nosrt || (matchNoSurat ? matchNoSurat[1] : ''),\r\n      nosurat: data.nosurat || (matchNoSurat ? matchNoSurat[1] : ''),\r\n      blnno: data.blnno || nomorParts[5] || '',\r\n      blnnomor: data.blnnomor || nomorParts[5] || '',\r\n      thnno: data.thnno || nomorParts[6] || '',\r\n      tahunskrg: data.tahunskrg || nomorParts[6] || '',\r\n    };\r\n    const mergedData = { ...data, ...fallback };\r\n    \r\n    // Ensure unitkerja is preserved for Template 2\r\n    if (letter.template_id === 2 && data.unitkerja) {\r\n      mergedData.unitkerja = data.unitkerja;\r\n    }\r\n    \r\n    if (id === '1') return <Template1 data={mergedData} />;\r\n    if (id === '2') return <Template2 data={mergedData} />;\r\n    if (id === '3') return <Template3 data={mergedData} />;\r\n    if (id === '4') return <Template4 data={mergedData} />;\r\n    if (id === '5') return <Template5 data={mergedData} />;\r\n    if (id === '6') return <Template6 data={mergedData} />;\r\n    if (id === '7') return <Template7 data={mergedData} />;\r\n    if (id === '8') return <Template8 data={mergedData} />;\r\n    if (id === '9') return <Template9 data={mergedData} />;\r\n    return <div className=\"text-error\">Template tidak dikenali</div>;\r\n  };\r\n\r\n  const handleGeneratePdf = async (letterId: string) => {\r\n    setPdfLoading(true);\r\n    try {\r\n      const res = await apiPost(`/api/letters/${letterId}/generate-pdf`, {}, token);\r\n      setPdfUrl(res.file?.file_path || res.file_path);\r\n      toast({ title: 'PDF berhasil digenerate', description: 'Klik link untuk mengunduh.' });\r\n    } catch (err: any) {\r\n      toast({ title: 'Gagal generate PDF', description: err.message || 'Terjadi kesalahan', variant: 'destructive' });\r\n    } finally {\r\n      setPdfLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDeleteLetter = async (letter: any) => {\r\n    // Check if user can delete this letter\r\n    const canDelete = user?.role === 'admin' || letter.created_by === user?.id;\r\n    \r\n    if (!canDelete) {\r\n      toast({ \r\n        title: 'Tidak dapat menghapus surat', \r\n        description: 'Anda hanya dapat menghapus surat yang Anda buat sendiri.',\r\n        variant: 'destructive'\r\n      });\r\n      return;\r\n    }\r\n    \r\n    setLetterToDelete(letter);\r\n    setShowDeleteModal(true);\r\n  };\r\n\r\n  // Fungsi untuk handle edit\r\n  const handleEditPejabatPegawai = (letter: any) => {\r\n    setEditLetter(letter);\r\n    setEditPejabat(null);\r\n    setEditPegawai(null);\r\n  };\r\n\r\n  // Fungsi untuk simpan perubahan\r\n  const handleSaveEditPejabatPegawai = async () => {\r\n    if (!editLetter || !editPejabat) return;\r\n    // Untuk template 2 dan 9, tidak perlu pegawai\r\n    if (editLetter.template_id !== 2 && editLetter.template_id !== 9 && !editPegawai) return;\r\n    setEditSaving(true);\r\n    try {\r\n      // Ambil data surat yang ada\r\n      const currentFormData = editLetter.form_data;\r\n      const templateId = editLetter.template_id;\r\n      \r\n      // Update data sesuai kebutuhan template\r\n      const updatedFormData = {\r\n        ...currentFormData,\r\n        // Update data pejabat (selalu ada untuk semua template)\r\n        namapejabat: editPejabat.nama || '',\r\n        nippejabat: editPejabat.nip || '',\r\n        pangkatgolpejabat: editPejabat.pangkat_gol || '',\r\n        jabatanpejabat: editPejabat.jabatan || '',\r\n      };\r\n\r\n      // Update data pegawai sesuai template (kecuali template 2 & 9)\r\n      if (templateId !== 2 && templateId !== 9 && editPegawai) {\r\n        updatedFormData.namapegawai = editPegawai.nama || '';\r\n        updatedFormData.nippegawai = editPegawai.nip || '';\r\n        updatedFormData.pangkatgolpegawai = editPegawai.pangkat_gol || '';\r\n        updatedFormData.jabatanpegawai = editPegawai.jabatan || '';\r\n      }\r\n      \r\n      // Untuk template 2 dan 9, hapus field pegawai jika ada\r\n      if (templateId === 2 || templateId === 9) {\r\n        delete updatedFormData.namapegawai;\r\n        delete updatedFormData.nippegawai;\r\n        delete updatedFormData.pangkatgolpegawai;\r\n        delete updatedFormData.jabatanpegawai;\r\n        delete updatedFormData.ukerpegawai;\r\n      }\r\n\r\n             // Update field spesifik sesuai template\r\n       switch (templateId) {\r\n         case 1: // Template 1: Surat Pernyataan Tidak Sedang Menjalani Tugas Belajar\r\n           updatedFormData.ukerpejabat = editPejabat.unit_kerja || '';\r\n           if (editPegawai) updatedFormData.ukerpegawai = editPegawai.unit_kerja || '';\r\n           break;\r\n         \r\n         case 2: // Template 2: Surat Keterangan Analisis Jabatan (tanpa pegawai)\r\n           // Template 2 tidak memerlukan update field pegawai\r\n           break;\r\n         \r\n         case 3: // Template 3: Surat Keterangan Pengalaman Mengajar\r\n           if (editPegawai) updatedFormData.tempattugas = editPegawai.tempat_tugas || '';\r\n           break;\r\n         \r\n         case 4: // Template 4: Surat Permohonan SKBT\r\n           if (editPegawai) updatedFormData.unitkerja = editPegawai.unit_kerja || '';\r\n           break;\r\n         \r\n         case 5: // Template 5: Surat Pernyataan Tidak Sedang Dalam Proses Hukuman Disiplin\r\n           updatedFormData.ukerpejabat = editPejabat.unit_kerja || '';\r\n           if (editPegawai) updatedFormData.tempattugas = editPegawai.tempat_tugas || '';\r\n           break;\r\n         \r\n         case 6: // Template 6: Surat Pernyataan Tidak Sedang Menjalani Proses Pidana\r\n           updatedFormData.ukerpejabat = editPejabat.unit_kerja || '';\r\n           if (editPegawai) updatedFormData.ukerpegawai = editPegawai.unit_kerja || '';\r\n           break;\r\n         \r\n         case 7: // Template 7: Surat Persetujuan Pelepasan\r\n           if (editPegawai) updatedFormData.tempattugas = editPegawai.tempat_tugas || '';\r\n           break;\r\n         \r\n         case 8: // Template 8: Surat Keterangan Jabatan Baru\r\n           if (editPegawai) updatedFormData.tempattugas = editPegawai.tempat_tugas || '';\r\n           break;\r\n         \r\n         case 9: // Template 9: Surat Pernyataan (tanpa pegawai)\r\n           updatedFormData.ukerpejabat = editPejabat.unit_kerja || '';\r\n           break;\r\n       }\r\n\r\n      // Kirim update ke backend\r\n      await apiPut(`/api/letters/${editLetter.id}`, {\r\n        form_data: updatedFormData\r\n      }, token);\r\n\r\n      // Refresh data\r\n      await refreshData();\r\n      \r\n      // Reset state\r\n      setEditLetter(null);\r\n      setEditPejabat(null);\r\n      setEditPegawai(null);\r\n      \r\n      // Show success message\r\n      toast({\r\n        title: \"Berhasil\",\r\n        description: \"Data pejabat dan pegawai berhasil diperbarui\",\r\n      });\r\n    } catch (error) {\r\n      console.error('Error updating letter:', error);\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Gagal memperbarui data surat\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setEditSaving(false);\r\n    }\r\n  };\r\n\r\n  // Bulk selection functions\r\n  const handleSelectLetter = (letterId: string, checked: boolean) => {\r\n    if (checked) {\r\n      setSelectedLetters(prev => [...prev, letterId]);\r\n    } else {\r\n      setSelectedLetters(prev => prev.filter(id => id !== letterId));\r\n    }\r\n  };\r\n\r\n  const handleSelectAll = (checked: boolean) => {\r\n    setSelectAll(checked);\r\n    if (checked) {\r\n      // Get all letters from all visible offices that user can delete\r\n      const allVisibleLetters = filteredGrouped.flatMap(([officeName, officeLetters]) => officeLetters);\r\n      const deletableLetters = allVisibleLetters.filter(letter => \r\n        user?.role === 'admin' || letter.created_by === user?.id\r\n      );\r\n      setSelectedLetters(deletableLetters.map(letter => letter.id));\r\n    } else {\r\n      setSelectedLetters([]);\r\n    }\r\n  };\r\n\r\n  const handleBulkDelete = () => {\r\n    if (selectedLetters.length === 0) {\r\n      toast({ \r\n        title: 'Tidak ada surat dipilih', \r\n        description: 'Pilih surat yang akan dihapus terlebih dahulu.',\r\n        variant: 'destructive'\r\n      });\r\n      return;\r\n    }\r\n    setShowBulkDeleteModal(true);\r\n  };\r\n\r\n  const confirmBulkDelete = async () => {\r\n    setBulkDeleting(true);\r\n    try {\r\n      // Delete letters one by one\r\n      for (const letterId of selectedLetters) {\r\n        await apiDelete(`/api/letters/${letterId}`, token);\r\n      }\r\n      \r\n      toast({ \r\n        title: 'Surat berhasil dihapus', \r\n        description: `${selectedLetters.length} surat telah dihapus dari sistem.`,\r\n        duration: 3000\r\n      });\r\n      \r\n      // Reset selection\r\n      setSelectedLetters([]);\r\n      setSelectAll(false);\r\n      setShowBulkDeleteModal(false);\r\n      \r\n      // Refresh data\r\n      await refreshData();\r\n      \r\n      // Reset pagination state\r\n      setOfficePaging({});\r\n      \r\n      // Reset search jika ada\r\n      if (search) {\r\n        setSearch('');\r\n      }\r\n    } catch (err: any) {\r\n      toast({ \r\n        title: 'Gagal menghapus surat', \r\n        description: err.message || 'Terjadi kesalahan', \r\n        variant: 'destructive',\r\n        duration: 5000\r\n      });\r\n    } finally {\r\n      setBulkDeleting(false);\r\n    }\r\n  };\r\n\r\n  const refreshData = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const res = await apiGet('/api/letters', token);\r\n      setLetters(res.letters || []);\r\n    } catch (err: any) {\r\n      setError('Gagal mengambil data surat');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const confirmDelete = async () => {\r\n    if (!letterToDelete) return;\r\n    \r\n    setDeleting(true);\r\n    try {\r\n      await apiDelete(`/api/letters/${letterToDelete.id}`, token);\r\n      \r\n      toast({ \r\n        title: 'Surat berhasil dihapus', \r\n        description: 'Surat telah dihapus dari sistem.',\r\n        duration: 3000\r\n      });\r\n      \r\n      // Refresh data\r\n      await refreshData();\r\n      \r\n      // Reset pagination state\r\n      setOfficePaging({});\r\n      \r\n      // Reset search jika ada\r\n      if (search) {\r\n        setSearch('');\r\n      }\r\n      \r\n      setShowDeleteModal(false);\r\n      setLetterToDelete(null);\r\n    } catch (err: any) {\r\n      toast({ \r\n        title: 'Gagal menghapus surat', \r\n        description: err.message || 'Terjadi kesalahan', \r\n        variant: 'destructive',\r\n        duration: 5000\r\n      });\r\n    } finally {\r\n      setDeleting(false);\r\n    }\r\n  };\r\n\r\n  // Export Excel function\r\n  const handleExportExcel = async () => {\r\n    setExporting(true);\r\n    try {\r\n      // Filter letters berdasarkan filter yang dipilih\r\n      let filteredData = [...letters];\r\n\r\n      // Filter by template\r\n      if (exportTemplateFilter !== 'all') {\r\n        filteredData = filteredData.filter(l => l.template_name === exportTemplateFilter);\r\n      }\r\n\r\n      // Filter by office (hanya untuk admin)\r\n      if (user?.role === 'admin' && exportOfficeFilter !== 'all') {\r\n        filteredData = filteredData.filter(l => l.office_id === exportOfficeFilter);\r\n      }\r\n\r\n      // Pisahkan data: yang punya NIP dan yang tidak (Template 9)\r\n      const lettersWithNip = filteredData.filter(l => l.template_id !== 9 && l.recipient_employee_nip);\r\n      const lettersWithoutNip = filteredData.filter(l => l.template_id === 9 || !l.recipient_employee_nip);\r\n\r\n      // Get semua unique template names untuk kolom dinamis\r\n      const allTemplateNames = Array.from(new Set(filteredData.map(l => l.template_name))).sort();\r\n      \r\n      // Group by NIP untuk data yang punya NIP\r\n      const groupedByNip: Record<string, any> = {};\r\n      \r\n      lettersWithNip.forEach(letter => {\r\n        let parsedFormData = letter.form_data;\r\n        if (typeof parsedFormData === 'string') {\r\n          try {\r\n            parsedFormData = JSON.parse(parsedFormData);\r\n          } catch {\r\n            parsedFormData = {};\r\n          }\r\n        }\r\n\r\n        const nip = letter.recipient_employee_nip || '';\r\n        const nama = parsedFormData.namapegawai || letter.recipient?.nama || '';\r\n        const jabatan = parsedFormData.jabatan || letter.recipient?.jabatan || '';\r\n        const templateName = letter.template_name || '';\r\n        \r\n        if (!groupedByNip[nip]) {\r\n          groupedByNip[nip] = {\r\n            'NIP': nip,\r\n            'Nama': nama,\r\n            'Jabatan Pegawai': jabatan,\r\n            'NIP Penandatangan': letter.signing_official_nip || '',\r\n            'Nama Penandatangan': letter.signing_official?.nama || ''\r\n          };\r\n          // Initialize semua kolom template dengan kosong\r\n          allTemplateNames.forEach(tmpl => {\r\n            groupedByNip[nip][tmpl] = '';\r\n          });\r\n        }\r\n        \r\n        // Set nomor surat untuk template ini\r\n        groupedByNip[nip][templateName] = letter.letter_number || '';\r\n      });\r\n\r\n      // Convert grouped data ke array (data dengan NIP)\r\n      const excelDataWithNip = Object.values(groupedByNip);\r\n\r\n      // Handle data tanpa NIP (Template 9) - baris terpisah di bawah\r\n      const excelDataWithoutNip = lettersWithoutNip.map(letter => {\r\n        let parsedFormData = letter.form_data;\r\n        if (typeof parsedFormData === 'string') {\r\n          try {\r\n            parsedFormData = JSON.parse(parsedFormData);\r\n          } catch {\r\n            parsedFormData = {};\r\n          }\r\n        }\r\n\r\n        const row: any = {\r\n          'NIP': '',\r\n          'Nama': '',\r\n          'Jabatan Pegawai': '',\r\n          'NIP Penandatangan': letter.signing_official_nip || '',\r\n          'Nama Penandatangan': letter.signing_official?.nama || ''\r\n        };\r\n        \r\n        // Initialize semua kolom template dengan kosong\r\n        allTemplateNames.forEach(tmpl => {\r\n          row[tmpl] = '';\r\n        });\r\n        \r\n        // Set nomor surat untuk template ini\r\n        row[letter.template_name || ''] = letter.letter_number || '';\r\n        \r\n        return row;\r\n      });\r\n\r\n      // Gabungkan: data dengan NIP dulu, kemudian tanpa NIP\r\n      const excelData = [...excelDataWithNip, ...excelDataWithoutNip]; // Remove helper fields\r\n\r\n      // Buat workbook\r\n      const wb = XLSX.utils.book_new();\r\n      const ws = XLSX.utils.json_to_sheet(excelData);\r\n      \r\n      // Set column widths - dinamis berdasarkan jumlah template\r\n      const colWidths = [\r\n        { wch: 20 }, // NIP\r\n        { wch: 40 }, // Nama\r\n        { wch: 40 }, // Jabatan Pegawai\r\n        ...allTemplateNames.map(() => ({ wch: 50 })), // Kolom template (dinamis)\r\n        { wch: 20 }, // NIP Penandatangan\r\n        { wch: 40 }  // Nama Penandatangan\r\n      ];\r\n      ws['!cols'] = colWidths;\r\n\r\n      XLSX.utils.book_append_sheet(wb, ws, 'Data Surat');\r\n\r\n      // Generate filename dengan timestamp\r\n      const now = new Date();\r\n      const timestamp = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}`;\r\n      \r\n      let filename = `Export_Surat_${timestamp}.xlsx`;\r\n      if (exportTemplateFilter !== 'all') {\r\n        const templateName = exportTemplateFilter.replace(/[^a-zA-Z0-9]/g, '_');\r\n        filename = `Export_Surat_${templateName}_${timestamp}.xlsx`;\r\n      }\r\n      if (user?.role === 'admin' && exportOfficeFilter !== 'all') {\r\n        const office = offices.find(o => o.id === exportOfficeFilter);\r\n        const officeName = office?.kabkota || office?.namakantor || 'Office';\r\n        const officeNameClean = officeName.replace(/[^a-zA-Z0-9]/g, '_');\r\n        filename = `Export_Surat_${officeNameClean}_${timestamp}.xlsx`;\r\n      }\r\n\r\n      // Download file\r\n      XLSX.writeFile(wb, filename);\r\n\r\n      toast({\r\n        title: 'Export berhasil',\r\n        description: `Data surat berhasil diekspor ke Excel (${filteredData.length} data)`,\r\n        duration: 3000\r\n      });\r\n\r\n      setShowExportModal(false);\r\n    } catch (error: any) {\r\n      console.error('Error exporting Excel:', error);\r\n      toast({\r\n        title: 'Gagal export Excel',\r\n        description: error.message || 'Terjadi kesalahan saat mengekspor data',\r\n        variant: 'destructive',\r\n        duration: 5000\r\n      });\r\n    } finally {\r\n      setExporting(false);\r\n    }\r\n  };\r\n\r\n  // Helper untuk update paging per kantor\r\n  const setOfficePage = (officeName: string, page: number) => {\r\n    setOfficePaging(prev => ({\r\n      ...prev,\r\n      [officeName]: {\r\n        ...(prev[officeName] || { currentPage: 1, pageSize: 10 }),\r\n        currentPage: page,\r\n      },\r\n    }));\r\n  };\r\n  const setOfficePageSize = (officeName: string, size: number) => {\r\n    setOfficePaging(prev => ({\r\n      ...prev,\r\n      [officeName]: {\r\n        ...(prev[officeName] || { currentPage: 1, pageSize: 10 }),\r\n        pageSize: size,\r\n        currentPage: 1,\r\n      },\r\n    }));\r\n  };\r\n\r\n  // Empty state component\r\n  const EmptyState = () => (\r\n    <div className=\"flex flex-col items-center justify-center py-16 px-4\">\r\n      <div className=\"relative mb-6\">\r\n        <div className=\"w-24 h-24 bg-gradient-to-br from-green-100 to-blue-100 rounded-full flex items-center justify-center\">\r\n          <Inbox className=\"w-12 h-12 text-green-600\" />\r\n        </div>\r\n        <div className=\"absolute -top-2 -right-2 w-8 h-8 bg-red-100 rounded-full flex items-center justify-center\">\r\n          <span className=\"text-xs font-bold text-red-600\">0</span>\r\n        </div>\r\n      </div>\r\n      <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">Belum Ada Surat</h3>\r\n      <p className=\"text-gray-600 text-center max-w-md mb-6\">\r\n        Riwayat surat masih kosong. Mulai buat surat pertama Anda untuk melihat data di sini.\r\n      </p>\r\n      <div className=\"flex gap-3\">\r\n        <Button asChild className=\"bg-green-600 hover:bg-green-700\">\r\n          <Link to=\"/generator\">\r\n            <FileText className=\"w-4 h-4 mr-2\" />\r\n            Buat Surat Baru\r\n          </Link>\r\n        </Button>\r\n        <Button variant=\"outline\" onClick={refreshData} disabled={loading}>\r\n          <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\r\n          {loading ? 'Loading...' : 'Refresh Data'}\r\n        </Button>\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  // Loading state\r\n  if (loading) {\r\n    return (\r\n      <div className=\"max-w-7xl mx-auto p-6\">\r\n        <div className=\"mb-8\">\r\n          <Skeleton className=\"h-8 w-1/3 mb-4\" />\r\n          <Skeleton className=\"h-6 w-1/2\" />\r\n        </div>\r\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\r\n          <Skeleton className=\"h-32\" />\r\n          <Skeleton className=\"h-32\" />\r\n          <Skeleton className=\"h-32\" />\r\n        </div>\r\n        <div className=\"space-y-4\">\r\n          <Skeleton className=\"h-16\" />\r\n          <Skeleton className=\"h-16\" />\r\n          <Skeleton className=\"h-16\" />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Error state\r\n  if (error) {\r\n    return (\r\n      <div className=\"max-w-7xl mx-auto p-6\">\r\n        <div className=\"flex flex-col items-center justify-center py-16\">\r\n          <div className=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4\">\r\n            <FileText className=\"w-8 h-8 text-red-600\" />\r\n          </div>\r\n          <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">Gagal Memuat Data</h3>\r\n          <p className=\"text-gray-600 mb-6\">{error}</p>\r\n          <Button onClick={refreshData} disabled={loading}>\r\n            <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\r\n            {loading ? 'Loading...' : 'Coba Lagi'}\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"max-w-7xl mx-auto p-6\">\r\n      {/* Header */}\r\n      <div className=\"mb-8\">\r\n        <div className=\"flex items-center justify-between mb-4\">\r\n          <div>\r\n            <h1 className=\"text-3xl font-bold text-gray-900\">Riwayat Surat</h1>\r\n            <p className=\"text-gray-600 mt-1\">Kelola dan pantau semua surat yang telah dibuat</p>\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <Button \r\n              variant=\"outline\" \r\n              onClick={refreshData}\r\n              disabled={loading}\r\n            >\r\n              <RefreshCw className={`w-4 h-4 mr-2 ${loading ? 'animate-spin' : ''}`} />\r\n              {loading ? 'Loading...' : 'Refresh'}\r\n            </Button>\r\n            <Button \r\n              variant=\"outline\" \r\n              onClick={() => setShowExportModal(true)}\r\n              disabled={loading || letters.length === 0}\r\n              className=\"border-green-200 text-green-700 hover:bg-green-50\"\r\n            >\r\n              <Download className=\"w-4 h-4 mr-2\" />\r\n              Export Excel\r\n            </Button>\r\n            {tabFilteredLetters.length > 0 && (() => {\r\n              const deletableLettersCount = tabFilteredLetters.filter(letter => \r\n                user?.role === 'admin' || letter.created_by === user?.id\r\n              ).length;\r\n              return deletableLettersCount > 0 ? (\r\n                <Button\r\n                  variant={selectAll ? \"destructive\" : \"outline\"}\r\n                  onClick={() => handleSelectAll(!selectAll)}\r\n                  className={selectAll ? \"bg-red-600 hover:bg-red-700\" : \"border-green-200 text-green-700 hover:bg-green-50\"}\r\n                >\r\n                  {selectAll ? (\r\n                    <>\r\n                      <Trash2 className=\"w-4 h-4 mr-2\" />\r\n                      Batal Pilih Semua\r\n                    </>\r\n                  ) : (\r\n                    <>\r\n                      <FileText className=\"w-4 h-4 mr-2\" />\r\n                      Pilih Semua ({deletableLettersCount})\r\n                    </>\r\n                  )}\r\n                </Button>\r\n              ) : null;\r\n            })()}\r\n            {/* Only show \"Buat Surat Baru\" button for admin and operator, not for user role */}\r\n            {user?.role !== 'user' && (\r\n              <Button asChild className=\"bg-green-600 hover:bg-green-700\">\r\n                <Link to=\"/generator\">\r\n                  <FileText className=\"w-4 h-4 mr-2\" />\r\n                  Buat Surat Baru\r\n                </Link>\r\n              </Button>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Search and Filter */}\r\n        <div className=\"flex flex-col sm:flex-row gap-4 mb-6\">\r\n          <div className=\"relative flex-1\">\r\n            <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\r\n            <Input\r\n              placeholder=\"Cari surat, nomor surat, atau kantor...\"\r\n              value={search}\r\n              onChange={(e) => setSearch(e.target.value)}\r\n              className=\"pl-10\"\r\n            />\r\n          </div>\r\n          <div className=\"flex gap-2\">\r\n            <Select value={sortBy} onValueChange={(value: any) => setSortBy(value)}>\r\n              <SelectTrigger className=\"w-40\">\r\n                <SelectValue placeholder=\"Urutkan\" />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                <SelectItem value=\"letter_number\">Nomor Surat</SelectItem>\r\n                <SelectItem value=\"template_name\">Template</SelectItem>\r\n                <SelectItem value=\"tanggal\">Tanggal</SelectItem>\r\n                <SelectItem value=\"status\">Status</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n            <Button\r\n              variant=\"outline\"\r\n              onClick={() => setSortDir(sortDir === 'asc' ? 'desc' : 'asc')}\r\n            >\r\n              {sortDir === 'asc' ? '↑' : '↓'}\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Bulk Selection UI */}\r\n      {selectedLetters.length > 0 && (\r\n        <div className=\"mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg shadow-sm\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center\">\r\n                  <span className=\"text-sm font-bold text-blue-600\">{selectedLetters.length}</span>\r\n                </div>\r\n                <div>\r\n                  <h3 className=\"font-semibold text-blue-900\">\r\n                    {selectedLetters.length} surat dipilih\r\n                  </h3>\r\n                  <p className=\"text-sm text-blue-700\">\r\n                    Siap untuk dihapus\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n            <div className=\"flex gap-3\">\r\n              <Button\r\n                variant=\"outline\"\r\n                size=\"sm\"\r\n                onClick={() => {\r\n                  setSelectedLetters([]);\r\n                  setSelectAll(false);\r\n                }}\r\n                className=\"border-green-300 text-green-700 hover:bg-green-50\"\r\n              >\r\n                Batal Pilih\r\n              </Button>\r\n              <Button\r\n                variant=\"destructive\"\r\n                size=\"sm\"\r\n                onClick={handleBulkDelete}\r\n                className=\"bg-red-600 hover:bg-red-700 shadow-sm\"\r\n              >\r\n                <Trash2 className=\"w-4 h-4 mr-2\" />\r\n                Hapus {selectedLetters.length} Surat\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Floating Action Button for Bulk Delete */}\r\n      {selectedLetters.length > 0 && (\r\n        <div className=\"fixed bottom-6 right-6 z-50\">\r\n          <div className=\"flex flex-col gap-2\">\r\n            <Button\r\n              size=\"lg\"\r\n              onClick={handleBulkDelete}\r\n              className=\"bg-red-600 hover:bg-red-700 shadow-lg rounded-full w-16 h-16\"\r\n            >\r\n              <Trash2 className=\"w-6 h-6\" />\r\n            </Button>\r\n            <div className=\"bg-white rounded-full px-3 py-1 shadow-lg text-sm font-medium text-gray-700\">\r\n              {selectedLetters.length} surat\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Tab Navigation */}\r\n      <div className=\"mb-8\">\r\n        <div className=\"bg-white rounded-lg border border-gray-200 p-1\">\r\n          <nav className=\"flex space-x-1\">\r\n            <button\r\n              onClick={() => setActiveTab('all')}\r\n              className={`flex-1 flex items-center justify-center py-3 px-4 rounded-md font-medium text-sm transition-all duration-200 ${\r\n                activeTab === 'all'\r\n                  ? 'bg-green-50 text-green-700 border border-green-200 shadow-sm'\r\n                  : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'\r\n              }`}\r\n            >\r\n              <FileText className=\"w-4 h-4 mr-2\" />\r\n              Semua Surat\r\n              <span className=\"ml-2 bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs\">\r\n                {filteredLetters.length}\r\n              </span>\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveTab('with-employee')}\r\n              className={`flex-1 flex items-center justify-center py-3 px-4 rounded-md font-medium text-sm transition-all duration-200 ${\r\n                activeTab === 'with-employee'\r\n                  ? 'bg-green-50 text-green-700 border border-green-200 shadow-sm'\r\n                  : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'\r\n              }`}\r\n            >\r\n              <Users className=\"w-4 h-4 mr-2\" />\r\n              Surat dengan Pegawai\r\n              <span className=\"ml-2 bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs\">\r\n                {filteredLetters.filter(l => ![2, 9].includes(l.template_id)).length}\r\n              </span>\r\n            </button>\r\n            <button\r\n              onClick={() => setActiveTab('without-employee')}\r\n              className={`flex-1 flex items-center justify-center py-3 px-4 rounded-md font-medium text-sm transition-all duration-200 ${\r\n                activeTab === 'without-employee'\r\n                  ? 'bg-orange-50 text-orange-700 border border-orange-200 shadow-sm'\r\n                  : 'text-gray-600 hover:text-gray-900 hover:bg-gray-50'\r\n              }`}\r\n            >\r\n              <ClipboardList className=\"w-4 h-4 mr-2\" />\r\n              Analisis & Pernyataan\r\n              <span className=\"ml-2 bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs\">\r\n                {filteredLetters.filter(l => [2, 9].includes(l.template_id)).length}\r\n              </span>\r\n            </button>\r\n          </nav>\r\n        </div>\r\n        \r\n        {/* Tab Description */}\r\n        <div className=\"mt-3 text-sm text-gray-600\">\r\n          {activeTab === 'all' && (\r\n            <div className=\"flex items-center\">\r\n              <Info className=\"w-4 h-4 mr-2 text-green-500\" />\r\n              Menampilkan semua surat yang telah dibuat dalam sistem\r\n            </div>\r\n          )}\r\n          {activeTab === 'with-employee' && (\r\n            <div className=\"flex items-center\">\r\n              <Info className=\"w-4 h-4 mr-2 text-green-500\" />\r\n              Surat yang memerlukan data pegawai tertentu (Template 1, 3-8)\r\n            </div>\r\n          )}\r\n          {activeTab === 'without-employee' && (\r\n            <div className=\"flex items-center\">\r\n              <Info className=\"w-4 h-4 mr-2 text-orange-500\" />\r\n              Surat analisis jabatan dan pernyataan (Template 2 & 9)\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Summary Cards */}\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\r\n        <Card>\r\n          <CardContent className=\"p-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">Total Surat</p>\r\n                <p className=\"text-2xl font-bold text-gray-900\">{total}</p>\r\n              </div>\r\n              <div className=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center\">\r\n                <FileText className=\"w-6 h-6 text-blue-600\" />\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        <Card>\r\n          <CardContent className=\"p-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">Generated</p>\r\n                <p className=\"text-2xl font-bold text-green-600\">{byStatus('generated')}</p>\r\n              </div>\r\n              <div className=\"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center\">\r\n                <Printer className=\"w-6 h-6 text-green-600\" />\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n        <Card>\r\n          <CardContent className=\"p-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm font-medium text-gray-600\">Surat Terbaru</p>\r\n                <p className=\"text-lg font-bold text-gray-900\">{mostRecentLetter ? `${mostRecentLetter.letter_number} - ${getMostRecentOffice()}` : 'Tidak ada data'}</p>\r\n              </div>\r\n              <div className=\"w-12 h-12 bg-teal-100 rounded-lg flex items-center justify-center\">\r\n                <Eye className=\"w-6 h-6 text-teal-600\" />\r\n              </div>\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n      </div>\r\n\r\n      {/* Main Content */}\r\n      {letters.length === 0 ? (\r\n        <Card>\r\n          <CardContent className=\"p-0\">\r\n            <EmptyState />\r\n          </CardContent>\r\n        </Card>\r\n      ) : (\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle className=\"flex items-center gap-2\">\r\n              <Building2 className=\"w-5 h-5\" />\r\n              {activeTab === 'all' && `Surat Berdasarkan Kantor (${Object.keys(groupedByOffice).length} Kantor)`}\r\n              {activeTab === 'with-employee' && `Surat dengan Pegawai (${Object.keys(groupedByOffice).length} Kantor)`}\r\n              {activeTab === 'without-employee' && `Surat Analisis & Pernyataan (${Object.keys(groupedByOffice).length} Kantor)`}\r\n            </CardTitle>\r\n          </CardHeader>\r\n          <CardContent>\r\n            {filteredGrouped.length === 0 ? (\r\n              <div className=\"text-center py-8\">\r\n                <Search className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\r\n                <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Tidak Ada Hasil</h3>\r\n                <p className=\"text-gray-600\">Coba ubah kata kunci pencarian Anda</p>\r\n              </div>\r\n            ) : (\r\n              <Accordion type=\"multiple\" className=\"space-y-2\">\r\n                {filteredGrouped.map(([officeName, officeLetters], officeIndex) => {\r\n                  // Paging state per kantor\r\n                  const paging = officePaging[officeName] || { currentPage: 1, pageSize: 10 };\r\n                  const totalPages = Math.ceil(officeLetters.length / paging.pageSize);\r\n                  const pagedLetters = officeLetters.slice((paging.currentPage - 1) * paging.pageSize, paging.currentPage * paging.pageSize);\r\n                  return (\r\n                    <AccordionItem key={officeIndex} value={`office-${officeIndex}`} className=\"border rounded-lg\">\r\n                      <AccordionTrigger className=\"px-6 py-4 hover:bg-gray-50 rounded-lg\">\r\n                        <div className=\"flex items-center justify-between w-full\">\r\n                          <div className=\"flex items-center gap-3\">\r\n                            <div className=\"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center\">\r\n                              <Building2 className=\"w-4 h-4 text-green-600\" />\r\n                            </div>\r\n                            <div className=\"text-left\">\r\n                              <h3 className=\"font-semibold text-gray-900\">{officeName}</h3>\r\n                              <p className=\"text-sm text-gray-600\">{officeLetters.length} surat</p>\r\n                            </div>\r\n                          </div>\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <Badge variant=\"secondary\">{officeLetters.length}</Badge>\r\n                          </div>\r\n                        </div>\r\n                      </AccordionTrigger>\r\n                      <AccordionContent className=\"px-6 pb-4\">\r\n                        <div className=\"flex flex-col md:flex-row md:items-center md:justify-between mb-2 gap-2\">\r\n                          <div className=\"flex items-center gap-2\">\r\n                            <label htmlFor={`pageSize-${officeIndex}`} className=\"text-sm\">Tampilkan</label>\r\n                            <select\r\n                              id={`pageSize-${officeIndex}`}\r\n                              value={paging.pageSize}\r\n                              onChange={e => setOfficePageSize(officeName, Number(e.target.value))}\r\n                              className=\"border rounded px-2 py-1 text-sm\"\r\n                            >\r\n                              {[10, 20, 50, 100].map(size => (\r\n                                <option key={size} value={size}>{size}</option>\r\n                              ))}\r\n                            </select>\r\n                            <span className=\"text-sm\">data per halaman</span>\r\n                          </div>\r\n                          <div className=\"text-sm text-muted-foreground\">\r\n                            Menampilkan {officeLetters.length === 0 ? 0 : ((paging.currentPage - 1) * paging.pageSize + 1)}–{Math.min(paging.currentPage * paging.pageSize, officeLetters.length)} dari {officeLetters.length} surat\r\n                          </div>\r\n                        </div>\r\n                        <div className=\"overflow-x-auto\">\r\n                          <Table>\r\n                            <TableHeader className=\"bg-gray-50\">\r\n                              <TableRow>\r\n                                <TableHead className=\"w-12\">\r\n                                  <div className=\"flex items-center gap-2\">\r\n                                    {(() => {\r\n                                      const allVisibleLetters = filteredGrouped.flatMap(([officeName, officeLetters]) => officeLetters);\r\n                                      const deletableLettersCount = allVisibleLetters.filter(letter => \r\n                                        user?.role === 'admin' || letter.created_by === user?.id\r\n                                      ).length;\r\n                                      return (\r\n                                        <>\r\n                                          <input\r\n                                            type=\"checkbox\"\r\n                                            checked={selectAll}\r\n                                            onChange={(e) => handleSelectAll(e.target.checked)}\r\n                                            disabled={deletableLettersCount === 0}\r\n                                            className=\"w-4 h-4 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50\"\r\n                                          />\r\n                                          {selectedLetters.length > 0 && (\r\n                                            <span className=\"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full\">\r\n                                              {selectedLetters.length}\r\n                                            </span>\r\n                                          )}\r\n                                        </>\r\n                                      );\r\n                                    })()}\r\n                                  </div>\r\n                                </TableHead>\r\n                                <TableHead>No.</TableHead>\r\n                                <TableHead>Nomor Surat</TableHead>\r\n                                <TableHead>Template</TableHead>\r\n                                <TableHead>Pegawai</TableHead>\r\n                                <TableHead>Tanggal</TableHead>\r\n                                <TableHead>Status</TableHead>\r\n                                <TableHead>Aksi</TableHead>\r\n                              </TableRow>\r\n                            </TableHeader>\r\n                            <TableBody>\r\n                              {pagedLetters.map((letter, idx) => {\r\n                                let parsedFormData = letter.form_data;\r\n                                if (typeof parsedFormData === 'string') {\r\n                                  try {\r\n                                    parsedFormData = JSON.parse(parsedFormData);\r\n                                  } catch {\r\n                                    parsedFormData = {};\r\n                                  }\r\n                                }\r\n                                \r\n                                // Check if user can delete this letter\r\n                                const canDelete = user?.role === 'admin' || letter.created_by === user?.id;\r\n                                const isSelected = selectedLetters.includes(letter.id);\r\n                                \r\n                                return (\r\n                                  <TableRow \r\n                                    key={letter.id}\r\n                                    className={isSelected ? 'bg-blue-50 border-blue-200' : ''}\r\n                                  >\r\n                                    <TableCell>\r\n                                      <input\r\n                                        type=\"checkbox\"\r\n                                        checked={isSelected}\r\n                                        onChange={(e) => handleSelectLetter(letter.id, e.target.checked)}\r\n                                        disabled={!canDelete}\r\n                                        className=\"w-4 h-4 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50\"\r\n                                      />\r\n                                    </TableCell>\r\n                                    <TableCell>{(paging.currentPage - 1) * paging.pageSize + idx + 1}</TableCell>\r\n                                    <TableCell className=\"font-mono text-sm\">{letter.letter_number}</TableCell>\r\n                                    <TableCell>{letter.template_name}</TableCell>\r\n                                    <TableCell>\r\n                                      {letter.template_id === 9 ? (\r\n                                        <span className=\"text-gray-500\">Tanpa Pegawai</span>\r\n                                      ) : (\r\n                                        <div>\r\n                                          <div className=\"font-medium\">{parsedFormData.namapegawai}</div>\r\n                                          <div className=\"text-sm text-gray-500\">{letter.recipient_employee_nip}</div>\r\n                                        </div>\r\n                                      )}\r\n                                    </TableCell>\r\n                                    <TableCell>{parsedFormData.tanggal || '-'}</TableCell>\r\n                                    <TableCell>{getStatusBadge(letter.status)}</TableCell>\r\n                                    <TableCell>\r\n                                      <div className=\"flex gap-2\">\r\n                                        <Button\r\n                                          variant=\"outline\"\r\n                                          size=\"sm\"\r\n                                          onClick={() => {\r\n                                            setSelectedLetterForPreview(letter);\r\n                                            setModalOpen(true);\r\n                                          }}\r\n                                        >\r\n                                          <Eye className=\"w-4 h-4\" />\r\n                                        </Button>\r\n                                        {/* Only show edit buttons for admin/operator */}\r\n                                        {user?.role !== 'user' && (user?.role === 'admin' || letter.created_by === user?.id) && letter.template_id !== 2 && letter.template_id !== 9 && (\r\n                                          <Button\r\n                                            variant=\"outline\"\r\n                                            size=\"sm\"\r\n                                            onClick={() => handleEditPejabatPegawai(letter)}\r\n                                            className=\"text-blue-600 hover:text-blue-700 hover:bg-blue-50\"\r\n                                          >\r\n                                            <Edit3 className=\"w-4 h-4 mr-2\" />\r\n                                            Edit Pejabat & Pegawai\r\n                                          </Button>\r\n                                        )}\r\n                                        {user?.role !== 'user' && (user?.role === 'admin' || letter.created_by === user?.id) && (letter.template_id === 2 || letter.template_id === 9) && (\r\n                                          <Button\r\n                                            variant=\"outline\"\r\n                                            size=\"sm\"\r\n                                            onClick={() => handleEditPejabatPegawai(letter)}\r\n                                            className=\"text-blue-600 hover:text-blue-700 hover:bg-blue-50\"\r\n                                          >\r\n                                            <Edit3 className=\"w-4 h-4 mr-2\" />\r\n                                            Edit Pejabat\r\n                                          </Button>\r\n                                        )}\r\n                                        {/* Only show delete button for admin */}\r\n                                        {user?.role === 'admin' && (user?.role === 'admin' || letter.created_by === user?.id) && (\r\n                                          <Button\r\n                                            variant=\"outline\"\r\n                                            size=\"sm\"\r\n                                            onClick={() => handleDeleteLetter(letter)}\r\n                                            className=\"text-red-600 hover:text-red-700 hover:bg-red-50\"\r\n                                          >\r\n                                            <Trash2 className=\"w-4 h-4\" />\r\n                                          </Button>\r\n                                        )}\r\n                                      </div>\r\n                                    </TableCell>\r\n                                  </TableRow>\r\n                                );\r\n                              })}\r\n                            </TableBody>\r\n                          </Table>\r\n                        </div>\r\n                        {/* Pagination per kantor */}\r\n                        {totalPages > 1 && (\r\n                          <div className=\"flex justify-center items-center gap-2 mt-4\">\r\n                            <Button size=\"sm\" variant=\"outline\" onClick={() => setOfficePage(officeName, Math.max(1, paging.currentPage - 1))} disabled={paging.currentPage === 1}>Prev</Button>\r\n                            {Array.from({ length: totalPages }, (_, i) => i + 1).map(page => (\r\n                              <Button\r\n                                key={page}\r\n                                size=\"sm\"\r\n                                variant={page === paging.currentPage ? 'default' : 'outline'}\r\n                                onClick={() => setOfficePage(officeName, page)}\r\n                              >\r\n                                {page}\r\n                              </Button>\r\n                            ))}\r\n                            <Button size=\"sm\" variant=\"outline\" onClick={() => setOfficePage(officeName, Math.min(totalPages, paging.currentPage + 1))} disabled={paging.currentPage === totalPages}>Next</Button>\r\n                          </div>\r\n                        )}\r\n                      </AccordionContent>\r\n                    </AccordionItem>\r\n                  );\r\n                })}\r\n              </Accordion>\r\n            )}\r\n          </CardContent>\r\n        </Card>\r\n      )}\r\n\r\n      {/* Preview Modal */}\r\n      <Dialog open={modalOpen} onOpenChange={setModalOpen}>\r\n        <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\r\n          <div className=\"flex justify-between items-center mb-2\">\r\n            <DialogTitle>Preview Surat</DialogTitle>\r\n            {selectedLetterForPreview && (\r\n              <Button\r\n                size=\"sm\"\r\n                className=\"bg-green-600 hover:bg-green-700 text-white\"\r\n                onClick={() => window.open(generateUrl(`/letters/${selectedLetterForPreview.id}/preview`), '_blank')}\r\n              >\r\n                Open in New Tab\r\n              </Button>\r\n            )}\r\n          </div>\r\n          {selectedLetterForPreview && (\r\n            <div className=\"mt-4\">\r\n              {renderPreviewByTemplate(selectedLetterForPreview)}\r\n            </div>\r\n          )}\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      {/* Session Expired Modal */}\r\n      {showSessionExpiredModal && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm\">\r\n          <div className=\"bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full flex flex-col items-center animate-fade-in\">\r\n            <Lock className=\"w-16 h-16 text-yellow-500 mb-4\" />\r\n            <h2 className=\"text-2xl font-bold mb-2 text-gray-900\">Sesi Berakhir</h2>\r\n            <p className=\"text-gray-600 mb-6 text-center\">Sesi Anda telah habis. Silakan login kembali untuk melanjutkan.</p>\r\n            <button\r\n              className=\"w-full py-3 rounded-lg bg-green-600 hover:bg-green-700 text-white text-lg font-semibold shadow transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-400\"\r\n              onClick={() => {\r\n                localStorage.removeItem('token');\r\n                setShowSessionExpiredModal(false);\r\n                navigate('/login', { replace: true });\r\n              }}\r\n            >\r\n              Login Ulang\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Delete Confirmation Modal */}\r\n      {showDeleteModal && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm\">\r\n          <div className=\"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full flex flex-col items-center animate-fade-in\">\r\n            <div className=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4\">\r\n              <Trash2 className=\"w-8 h-8 text-red-600\" />\r\n            </div>\r\n            <h2 className=\"text-2xl font-bold mb-2 text-gray-900\">Hapus Surat</h2>\r\n            <p className=\"text-gray-600 mb-6 text-center\">\r\n              Apakah Anda yakin ingin menghapus surat <strong>{letterToDelete?.letter_number}</strong>? \r\n              Tindakan ini tidak dapat dibatalkan.\r\n            </p>\r\n            <div className=\"flex gap-3 w-full\">\r\n              <Button\r\n                variant=\"outline\"\r\n                onClick={() => {\r\n                  setShowDeleteModal(false);\r\n                  setLetterToDelete(null);\r\n                }}\r\n                disabled={deleting}\r\n                className=\"flex-1\"\r\n              >\r\n                Batal\r\n              </Button>\r\n              <Button\r\n                onClick={confirmDelete}\r\n                disabled={deleting}\r\n                className=\"flex-1 bg-red-600 hover:bg-red-700\"\r\n              >\r\n                {deleting ? 'Menghapus...' : 'Hapus'}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Bulk Delete Confirmation Modal */}\r\n      {showBulkDeleteModal && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm\">\r\n          <div className=\"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full flex flex-col items-center animate-fade-in\">\r\n            <div className=\"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4\">\r\n              <Trash2 className=\"w-8 h-8 text-red-600\" />\r\n            </div>\r\n            <h2 className=\"text-2xl font-bold mb-2 text-gray-900\">Hapus Surat</h2>\r\n            <p className=\"text-gray-600 mb-6 text-center\">\r\n              Apakah Anda yakin ingin menghapus {selectedLetters.length} surat yang dipilih? \r\n              Tindakan ini tidak dapat dibatalkan.\r\n            </p>\r\n            <div className=\"flex gap-3 w-full\">\r\n              <Button\r\n                variant=\"outline\"\r\n                onClick={() => {\r\n                  setShowBulkDeleteModal(false);\r\n                  setSelectedLetters([]);\r\n                  setSelectAll(false);\r\n                }}\r\n                disabled={bulkDeleting}\r\n                className=\"flex-1\"\r\n              >\r\n                Batal\r\n              </Button>\r\n              <Button\r\n                onClick={confirmBulkDelete}\r\n                disabled={bulkDeleting}\r\n                className=\"flex-1 bg-red-600 hover:bg-red-700\"\r\n              >\r\n                {bulkDeleting ? 'Menghapus...' : 'Hapus'}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n             {/* Edit Pejabat & Pegawai Modal */}\r\n       {editLetter && (\r\n         <Dialog open={!!editLetter} onOpenChange={v => { if (!v) setEditLetter(null); }}>\r\n           <DialogContent className=\"max-w-2xl\">\r\n             <DialogTitle>\r\n               {editLetter.template_id === 2 || editLetter.template_id === 9 \r\n                 ? 'Edit Pejabat' \r\n                 : 'Edit Pejabat & Pegawai'\r\n               }\r\n             </DialogTitle>\r\n             \r\n             <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n               {/* Search Section */}\r\n               <div className=\"space-y-4\">\r\n                 <div>\r\n                   <PegawaiSearchInput\r\n                     label=\"Cari Pejabat\"\r\n                     placeholder=\"Masukkan nama atau NIP pejabat...\"\r\n                     onSelect={setEditPejabat}\r\n                     selectedPegawai={editPejabat}\r\n                   />\r\n                 </div>\r\n                 \r\n                 {(editLetter.template_id !== 2 && editLetter.template_id !== 9) && (\r\n                   <div>\r\n                     <PegawaiSearchInput\r\n                       label=\"Cari Pegawai\"\r\n                       placeholder=\"Masukkan nama atau NIP pegawai...\"\r\n                       onSelect={setEditPegawai}\r\n                       selectedPegawai={editPegawai}\r\n                     />\r\n                   </div>\r\n                 )}\r\n               </div>\r\n               \r\n               {/* Preview Section */}\r\n               <div className=\"space-y-4\">\r\n                 {/* Preview Pejabat */}\r\n                 {editPejabat && (\r\n                   <div className=\"border rounded-lg p-4 bg-blue-50\">\r\n                     <div className=\"flex justify-between items-start mb-2\">\r\n                       <h4 className=\"font-semibold text-blue-900 flex items-center\">\r\n                         <Users className=\"w-4 h-4 mr-2\" />\r\n                         Preview Pejabat\r\n                       </h4>\r\n                       <Button\r\n                         variant=\"ghost\"\r\n                         size=\"sm\"\r\n                         onClick={() => setEditPejabat(null)}\r\n                         className=\"text-blue-600 hover:text-blue-700 hover:bg-blue-100\"\r\n                       >\r\n                         <X className=\"w-3 h-3\" />\r\n                       </Button>\r\n                     </div>\r\n                     <div className=\"space-y-1 text-sm\">\r\n                       <div><span className=\"font-medium\">Nama:</span> {editPejabat.nama}</div>\r\n                       <div><span className=\"font-medium\">NIP:</span> {editPejabat.nip}</div>\r\n                       <div><span className=\"font-medium\">Pangkat/Gol:</span> {editPejabat.pangkat_gol}</div>\r\n                       <div><span className=\"font-medium\">Jabatan:</span> {editPejabat.jabatan}</div>\r\n                       <div><span className=\"font-medium\">Unit Kerja:</span> {editPejabat.unit_kerja}</div>\r\n                     </div>\r\n                   </div>\r\n                 )}\r\n                 \r\n                 {/* Preview Pegawai */}\r\n                 {editPegawai && (editLetter.template_id !== 2 && editLetter.template_id !== 9) && (\r\n                   <div className=\"border rounded-lg p-4 bg-green-50\">\r\n                     <div className=\"flex justify-between items-start mb-2\">\r\n                       <h4 className=\"font-semibold text-green-900 flex items-center\">\r\n                         <Users className=\"w-4 h-4 mr-2\" />\r\n                         Preview Pegawai\r\n                       </h4>\r\n                       <Button\r\n                         variant=\"ghost\"\r\n                         size=\"sm\"\r\n                         onClick={() => setEditPegawai(null)}\r\n                         className=\"text-green-600 hover:text-green-700 hover:bg-green-100\"\r\n                       >\r\n                         <X className=\"w-3 h-3\" />\r\n                       </Button>\r\n                     </div>\r\n                     <div className=\"space-y-1 text-sm\">\r\n                       <div><span className=\"font-medium\">Nama:</span> {editPegawai.nama}</div>\r\n                       <div><span className=\"font-medium\">NIP:</span> {editPegawai.nip}</div>\r\n                       <div><span className=\"font-medium\">Pangkat/Gol:</span> {editPegawai.pangkat_gol}</div>\r\n                       <div><span className=\"font-medium\">Jabatan:</span> {editPegawai.jabatan}</div>\r\n                       <div><span className=\"font-medium\">Unit Kerja:</span> {editPegawai.unit_kerja}</div>\r\n                       {editPegawai.tempat_tugas && (\r\n                         <div><span className=\"font-medium\">Tempat Tugas:</span> {editPegawai.tempat_tugas}</div>\r\n                       )}\r\n                     </div>\r\n                   </div>\r\n                 )}\r\n                 \r\n                 {/* Empty State */}\r\n                 {!editPejabat && (editLetter.template_id === 2 || editLetter.template_id === 9) && (\r\n                   <div className=\"border rounded-lg p-4 bg-gray-50 text-center text-gray-500\">\r\n                     <Users className=\"w-8 h-8 mx-auto mb-2 text-gray-400\" />\r\n                     <p>Pilih pejabat untuk melihat preview</p>\r\n                   </div>\r\n                 )}\r\n                 \r\n                 {!editPejabat && !editPegawai && (editLetter.template_id !== 2 && editLetter.template_id !== 9) && (\r\n                   <div className=\"border rounded-lg p-4 bg-gray-50 text-center text-gray-500\">\r\n                     <Users className=\"w-8 h-8 mx-auto mb-2 text-gray-400\" />\r\n                     <p>Pilih pejabat dan pegawai untuk melihat preview</p>\r\n                   </div>\r\n                 )}\r\n               </div>\r\n             </div>\r\n             \r\n             <div className=\"flex gap-2 justify-end mt-4\">\r\n               <Button variant=\"outline\" onClick={() => setEditLetter(null)} disabled={editSaving}>\r\n                 Batal\r\n               </Button>\r\n               <Button \r\n                 onClick={handleSaveEditPejabatPegawai} \r\n                 disabled={editSaving || !editPejabat || ((editLetter.template_id !== 2 && editLetter.template_id !== 9) && !editPegawai)} \r\n                 className=\"bg-green-600 hover:bg-green-700 text-white\"\r\n               >\r\n                 {editSaving ? 'Menyimpan...' : 'Simpan'}\r\n               </Button>\r\n             </div>\r\n           </DialogContent>\r\n         </Dialog>\r\n       )}\r\n\r\n      {/* Export Excel Modal */}\r\n      <Dialog open={showExportModal} onOpenChange={setShowExportModal}>\r\n        <DialogContent className=\"max-w-2xl\">\r\n          <DialogTitle>Export Data ke Excel</DialogTitle>\r\n          <div className=\"space-y-4 mt-4\">\r\n            {/* Filter by Template */}\r\n            <div className=\"space-y-2\">\r\n              <Label htmlFor=\"template-filter\">Filter by Jenis Surat/Template</Label>\r\n              <Select value={exportTemplateFilter} onValueChange={setExportTemplateFilter}>\r\n                <SelectTrigger id=\"template-filter\">\r\n                  <SelectValue placeholder=\"Pilih template\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"all\">Semua Template</SelectItem>\r\n                  {uniqueTemplates.map(template => (\r\n                    <SelectItem key={template} value={template}>\r\n                      {template}\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n\r\n            {/* Filter by Office (hanya untuk admin) */}\r\n            {user?.role === 'admin' && (\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"office-filter\">Filter by Kabupaten/Kota</Label>\r\n                <Select value={exportOfficeFilter} onValueChange={setExportOfficeFilter}>\r\n                  <SelectTrigger id=\"office-filter\">\r\n                    <SelectValue placeholder=\"Pilih kabupaten/kota\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"all\">Semua Kabupaten/Kota</SelectItem>\r\n                    {offices.map(office => (\r\n                      <SelectItem key={office.id} value={office.id}>\r\n                        {office.kabkota || office.namakantor || office.name || 'Kantor Tidak Diketahui'}\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"flex justify-end gap-2 pt-4\">\r\n              <Button\r\n                variant=\"outline\"\r\n                onClick={() => {\r\n                  setShowExportModal(false);\r\n                  setExportTemplateFilter('all');\r\n                  setExportOfficeFilter('all');\r\n                }}\r\n                disabled={exporting}\r\n              >\r\n                Batal\r\n              </Button>\r\n              <Button\r\n                onClick={handleExportExcel}\r\n                disabled={exporting}\r\n                className=\"bg-green-600 hover:bg-green-700\"\r\n              >\r\n                {exporting ? (\r\n                  <>\r\n                    <RefreshCw className=\"w-4 h-4 mr-2 animate-spin\" />\r\n                    Mengekspor...\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <Download className=\"w-4 h-4 mr-2\" />\r\n                    Export\r\n                  </>\r\n                )}\r\n              </Button>\r\n            </div>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Letters; "],"names":["Letters","token","user","useAuth","letters","setLetters","useState","loading","setLoading","error","setError","search","setSearch","sortBy","setSortBy","sortDir","setSortDir","activeTab","setActiveTab","toast","useToast","modalOpen","setModalOpen","selectedLetterForPreview","setSelectedLetterForPreview","officePaging","setOfficePaging","officeMap","setOfficeMap","editLetter","setEditLetter","editPejabat","setEditPejabat","editPegawai","setEditPegawai","editSaving","setEditSaving","navigate","useNavigate","showSessionExpiredModal","setShowSessionExpiredModal","showDeleteModal","setShowDeleteModal","letterToDelete","setLetterToDelete","deleting","setDeleting","selectedLetters","setSelectedLetters","selectAll","setSelectAll","showBulkDeleteModal","setShowBulkDeleteModal","bulkDeleting","setBulkDeleting","showExportModal","setShowExportModal","exportTemplateFilter","setExportTemplateFilter","exportOfficeFilter","setExportOfficeFilter","offices","setOffices","exporting","setExporting","filteredLetters","_a","l","_b","_d","_c","_f","_e","tabFilteredLetters","groupedByOffice","b","aVal","bVal","acc","surat","officeName","filteredGrouped","suratList","useEffect","apiGet","res","err","map","officesList","office","uniqueTemplates","byStatus","status","total","mostTemplate","mostRecentLetter","latest","current","latestDate","getMostRecentOffice","getOfficeNameFromKode","kode","timeAgo","getStatusBadge","Badge","renderPreviewByTemplate","letter","data","id","nomorParts","matchNoSurat","fallback","mergedData","jsx","Template1","Template2","Template3","Template4","Template5","Template6","Template7","Template8","Template9","handleDeleteLetter","handleEditPejabatPegawai","handleSaveEditPejabatPegawai","currentFormData","templateId","updatedFormData","apiPut","refreshData","handleSelectLetter","letterId","checked","prev","handleSelectAll","deletableLetters","officeLetters","handleBulkDelete","confirmBulkDelete","apiDelete","confirmDelete","handleExportExcel","filteredData","lettersWithNip","lettersWithoutNip","allTemplateNames","groupedByNip","parsedFormData","nip","nama","jabatan","templateName","tmpl","excelDataWithNip","excelDataWithoutNip","row","excelData","wb","XLSX.utils","ws","colWidths","now","timestamp","filename","o","XLSX.writeFile","setOfficePage","page","setOfficePageSize","size","EmptyState","jsxs","Inbox","Button","Link","FileText","RefreshCw","Skeleton","Download","deletableLettersCount","Fragment","Trash2","Search","Input","e","Select","value","SelectTrigger","SelectValue","SelectContent","SelectItem","Users","ClipboardList","Info","Card","CardContent","Printer","Eye","CardHeader","CardTitle","Building2","Accordion","officeIndex","paging","totalPages","pagedLetters","AccordionItem","AccordionTrigger","AccordionContent","Table","TableHeader","TableRow","TableHead","TableBody","idx","canDelete","isSelected","TableCell","Edit3","_","i","Dialog","DialogContent","DialogTitle","generateUrl","Lock","v","PegawaiSearchInput","X","Label","template"],"mappings":"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"}