import{j as e,au as xe,aF as A,aX as me,K as he,ad as oe,_ as je,a0 as P,af as ue,ac as pe}from"./ui-vendor-B_XfOB1H.js";import{r as n,L as g}from"./react-vendor-C8WR5ETM.js";import{C as x,a as m,b as h,c as o}from"./card-DYQN_kNz.js";import{u as ge,B as r,b,I as be,a as T,k as Ne}from"./index-0A4KrUtf.js";import{P as X}from"./progress-tdnH1uIb.js";import{S as Y,a as Z,b as ee,c as ae,d as c}from"./select-CNd4aHc0.js";const De=()=>{const{token:u}=ge(),[p,C]=n.useState("process"),[d,se]=n.useState({totalPengajuan:0,pendingUpload:0,completedUpload:0,totalFiles:0,verifiedFiles:0,rejectedFiles:0}),[U,te]=n.useState([]),[le,L]=n.useState(!0),[K,D]=n.useState(null),[z,ie]=n.useState([]),[R,I]=n.useState(null),[$,E]=n.useState([]),[f,W]=n.useState([]),[q,B]=n.useState([]),[_,J]=n.useState(!1),[j,V]=n.useState(""),[v,M]=n.useState("all"),[w,G]=n.useState("all"),k=async()=>{var a,s,l;try{L(!0),D(null);const t=await T("/api/admin-wilayah/dashboard",u),i=((a=t==null?void 0:t.data)==null?void 0:a.stats)||(t==null?void 0:t.stats),N=((s=t==null?void 0:t.data)==null?void 0:s.recentUploads)||(t==null?void 0:t.recentUploads)||[],y=((l=t==null?void 0:t.data)==null?void 0:l.pengajuan)||(t==null?void 0:t.pengajuan)||[];i?(se({totalPengajuan:Number(i.total_pengajuan||i.totalPengajuan||0),pendingUpload:Number(i.pending_upload||i.pendingUpload||0),completedUpload:Number(i.completed_upload||i.completedUpload||0),totalFiles:Number(i.total_files||i.totalFiles||0),verifiedFiles:Number(i.verified_files||i.verifiedFiles||0),rejectedFiles:Number(i.rejected_files||i.rejectedFiles||0)}),te(Array.isArray(N)?N:[]),ie(Array.isArray(y)?y:[])):D("Failed to fetch dashboard data")}catch(t){console.error("Error fetching dashboard data:",t),D("Error connecting to server")}finally{L(!1)}},ne=async()=>{var a;try{const s=await T("/api/admin-wilayah/history",u),l=((a=s==null?void 0:s.data)==null?void 0:a.pengajuan)||(s==null?void 0:s.pengajuan)||[];E(Array.isArray(l)?l:[])}catch{E([])}},H=async()=>{try{J(!0);const a=await T("/api/admin-wilayah/pengajuan-datatable",u);a!=null&&a.success&&(a!=null&&a.data)&&(W(a.data.pengajuan||[]),B(a.data.aggregation||[]))}catch(a){console.error("Error fetching data table:",a),W([]),B([])}finally{J(!1)}},re=async a=>{if(u){I(a);try{const s=await Ne(`/api/admin-wilayah/pengajuan/${a}/submit-to-superadmin`,{},u);(s==null?void 0:s.success)!==!1&&await k()}finally{I(null)}}};n.useEffect(()=>{k(),ne(),H()},[u]);const de=()=>d.totalFiles===0?0:d.verifiedFiles/d.totalFiles*100,S=a=>new Date(a).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),O=a=>{const l={draft:{label:"Draft",className:"bg-gray-100 text-gray-800"},submitted:{label:"Diajukan",className:"bg-blue-100 text-blue-800"},approved:{label:"Disetujui",className:"bg-green-100 text-green-800"},rejected:{label:"Ditolak",className:"bg-red-100 text-red-800"},resubmitted:{label:"Diajukan Ulang",className:"bg-yellow-100 text-yellow-800"},admin_wilayah_approved:{label:"Disetujui Admin Wilayah",className:"bg-green-200 text-green-800"},admin_wilayah_rejected:{label:"Ditolak Admin Wilayah",className:"bg-red-200 text-red-800"},final_approved:{label:"Disetujui Final",className:"bg-green-600 text-white"},final_rejected:{label:"Ditolak Final",className:"bg-red-600 text-white"}}[a]||{label:a.toUpperCase(),className:"bg-gray-100 text-gray-800"};return e.jsx(b,{className:l.className,children:l.label})},F=f.filter(a=>{const s=j===""||a.nama.toLowerCase().includes(j.toLowerCase())||a.nip.toLowerCase().includes(j.toLowerCase())||a.kabupaten.toLowerCase().includes(j.toLowerCase())||a.jenis_jabatan.toLowerCase().includes(j.toLowerCase()),l=v==="all"||a.status===v,t=w==="all"||a.kabupaten===w;return s&&l&&t}),ce=Array.from(new Set(f.map(a=>a.kabupaten))).sort();return le?e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[...Array(4)].map((a,s)=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},s))})]})})}):K?e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(xe,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error Loading Dashboard"}),e.jsx("p",{className:"text-gray-600 mb-4",children:K}),e.jsxs(r,{onClick:k,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(A,{className:"h-4 w-4"}),"Retry"]})]})})}):e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard Admin Wilayah"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Monitoring aktivitas upload file dan progress pengajuan"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(r,{onClick:k,variant:"outline",size:"sm",className:"border-green-200 text-green-700 hover:bg-green-50",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsx(me,{className:"h-6 w-6 text-green-600"}),e.jsx(b,{className:"bg-green-100 text-green-800",children:"Admin Wilayah"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{variant:p==="process"?"default":"outline",size:"sm",onClick:()=>C("process"),children:"Dalam Proses"}),e.jsx(r,{variant:p==="archive"?"default":"outline",size:"sm",onClick:()=>C("archive"),children:"Arsip"}),e.jsx(r,{variant:p==="datatable"?"default":"outline",size:"sm",onClick:()=>C("datatable"),children:"Data Table"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(x,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Total Pengajuan"}),e.jsx(he,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.totalPengajuan}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pengajuan yang sudah di-ACC admin wilayah"})]})]}),e.jsxs(x,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Pending Upload"}),e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:d.pendingUpload}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Menunggu upload file admin wilayah"})]})]}),e.jsxs(x,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Completed Upload"}),e.jsx(je,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:d.completedUpload}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"File admin wilayah sudah lengkap"})]})]}),e.jsxs(x,{children:[e.jsxs(m,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(h,{className:"text-sm font-medium",children:"Total Files"}),e.jsx(P,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.totalFiles}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"File yang sudah diupload"})]})]})]}),e.jsxs(x,{children:[e.jsx(m,{children:e.jsx(h,{children:"Progress Overview"})}),e.jsx(o,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"File Verification Progress"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[d.verifiedFiles," of ",d.totalFiles," files verified"]})]}),e.jsx(X,{value:de(),className:"h-2"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Pending: ",d.totalFiles-d.verifiedFiles-d.rejectedFiles]}),e.jsxs("span",{children:["Verified: ",d.verifiedFiles]}),e.jsxs("span",{children:["Rejected: ",d.rejectedFiles]})]})]})})]}),p==="process"&&e.jsxs(x,{children:[e.jsx(m,{children:e.jsx(h,{children:"Pengajuan yang Sudah Di-ACC Admin Wilayah"})}),e.jsx(o,{children:z.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Tidak ada data"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-2 pr-4",children:"Pegawai"}),e.jsx("th",{className:"py-2 pr-4",children:"NIP"}),e.jsx("th",{className:"py-2 pr-4",children:"Jenis Jabatan"}),e.jsx("th",{className:"py-2 pr-4",children:"Berkas Kab/Kota"}),e.jsx("th",{className:"py-2 pr-4",children:"Progress Kanwil"}),e.jsx("th",{className:"py-2 pr-4",children:"Aksi"})]})}),e.jsx("tbody",{children:z.map(a=>{var N,y,Q;const s=a.pegawai||{},l=a.progress_admin_wilayah||{required:0,approved:0},t=`${l.approved}/${l.required}`,i=a.status==="admin_wilayah_approved"&&(((N=a.progress_admin_wilayah)==null?void 0:N.required)||0)>0&&(((y=a.progress_admin_wilayah)==null?void 0:y.approved)||0)>=(((Q=a.progress_admin_wilayah)==null?void 0:Q.required)||0);return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 pr-4",children:s.nama||"-"}),e.jsx("td",{className:"py-2 pr-4",children:s.nip||"-"}),e.jsx("td",{className:"py-2 pr-4",children:a.jenis_jabatan}),e.jsx("td",{className:"py-2 pr-4",children:a.kabupaten_files_count}),e.jsx("td",{className:"py-2 pr-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t}),e.jsx(X,{value:l.required?l.approved/l.required*100:0,className:"h-2 w-32"})]})}),e.jsx("td",{className:"py-2 pr-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(r,{asChild:!0,variant:"outline",size:"sm",className:"border-green-200 text-green-700 hover:bg-green-50",children:e.jsx(g,{to:`/pengajuan/${a.id}`,children:"Detail"})}),e.jsx(r,{asChild:!0,size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",children:e.jsx(g,{to:`/admin-wilayah/upload/${a.id}`,children:"Upload Kanwil"})}),e.jsx(r,{size:"sm",disabled:!i||R===a.id,onClick:()=>re(a.id),className:`text-white ${i?"bg-blue-600 hover:bg-blue-700":"bg-blue-300 cursor-not-allowed"}`,children:R===a.id?"Mengajukan...":"Ajukan ke Superadmin"})]})})]},a.id)})})]})})})]}),p==="archive"&&e.jsxs(x,{children:[e.jsx(m,{children:e.jsx(h,{children:"Arsip (Keputusan Superadmin)"})}),e.jsx(o,{children:$.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Belum ada arsip"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-2 pr-4",children:"Pegawai"}),e.jsx("th",{className:"py-2 pr-4",children:"NIP"}),e.jsx("th",{className:"py-2 pr-4",children:"Jenis Jabatan"}),e.jsx("th",{className:"py-2 pr-4",children:"Status"}),e.jsx("th",{className:"py-2 pr-4",children:"Tanggal"}),e.jsx("th",{className:"py-2 pr-4",children:"Aksi"})]})}),e.jsx("tbody",{children:$.map(a=>{var s,l;return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 pr-4",children:((s=a.pegawai)==null?void 0:s.nama)||"-"}),e.jsx("td",{className:"py-2 pr-4",children:((l=a.pegawai)==null?void 0:l.nip)||"-"}),e.jsx("td",{className:"py-2 pr-4",children:a.jenis_jabatan}),e.jsx("td",{className:"py-2 pr-4",children:e.jsx(b,{className:a.status==="approved"?"bg-green-600 text-white":"bg-red-600 text-white",children:a.status==="approved"?"Disetujui":"Ditolak"})}),e.jsx("td",{className:"py-2 pr-4",children:S(a.updated_at)}),e.jsx("td",{className:"py-2 pr-4",children:e.jsx(r,{asChild:!0,variant:"outline",size:"sm",children:e.jsx(g,{to:`/pengajuan/${a.id}`,children:"Detail"})})})]},a.id)})})]})})})]}),p==="datatable"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(x,{children:[e.jsx(m,{children:e.jsx(h,{children:"Rekapan Status per Kabupaten"})}),e.jsx(o,{children:q.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Tidak ada data"}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:q.map(a=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-lg mb-3",children:a.kabupaten}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:"Total:"}),e.jsx(b,{className:"bg-blue-100 text-blue-800",children:a.total})]}),a.statuses.map(s=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm",children:[O(s.status).props.children,":"]}),e.jsx(b,{variant:"outline",children:s.count})]},s.status))]})]},a.kabupaten))})})]}),e.jsxs(x,{children:[e.jsx(m,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(h,{children:["Data Pengajuan (",F.length," dari ",f.length,")"]}),e.jsxs(r,{onClick:H,variant:"outline",size:"sm",disabled:_,children:[e.jsx(A,{className:`h-4 w-4 mr-2 ${_?"animate-spin":""}`}),"Refresh"]})]})}),e.jsxs(o,{children:[e.jsxs("div",{className:"mb-6 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Cari"}),e.jsx(be,{placeholder:"Cari nama, NIP, kabupaten, atau jenis jabatan...",value:j,onChange:a=>V(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Filter Status"}),e.jsxs(Y,{value:v,onValueChange:M,children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:"Pilih status"})}),e.jsxs(ae,{children:[e.jsx(c,{value:"all",children:"Semua Status"}),e.jsx(c,{value:"draft",children:"Draft"}),e.jsx(c,{value:"submitted",children:"Diajukan"}),e.jsx(c,{value:"approved",children:"Disetujui"}),e.jsx(c,{value:"rejected",children:"Ditolak"}),e.jsx(c,{value:"resubmitted",children:"Diajukan Ulang"}),e.jsx(c,{value:"admin_wilayah_approved",children:"Disetujui Admin Wilayah"}),e.jsx(c,{value:"admin_wilayah_rejected",children:"Ditolak Admin Wilayah"}),e.jsx(c,{value:"final_approved",children:"Disetujui Final"}),e.jsx(c,{value:"final_rejected",children:"Ditolak Final"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Filter Kabupaten"}),e.jsxs(Y,{value:w,onValueChange:G,children:[e.jsx(Z,{children:e.jsx(ee,{placeholder:"Pilih kabupaten"})}),e.jsxs(ae,{children:[e.jsx(c,{value:"all",children:"Semua Kabupaten"}),ce.map(a=>e.jsx(c,{value:a,children:a},a))]})]})]})]}),(j||v!=="all"||w!=="all")&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(r,{variant:"outline",size:"sm",onClick:()=>{V(""),M("all"),G("all")},children:"Reset Filter"})})]}),_?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto"}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Memuat data..."})]}):f.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Tidak ada data pengajuan"}):F.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Tidak ada data yang sesuai dengan filter"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-3 pr-4 font-medium",children:"Nama"}),e.jsx("th",{className:"py-3 pr-4 font-medium",children:"NIP"}),e.jsx("th",{className:"py-3 pr-4 font-medium",children:"Kabupaten"}),e.jsx("th",{className:"py-3 pr-4 font-medium",children:"Jenis Jabatan"}),e.jsx("th",{className:"py-3 pr-4 font-medium",children:"Status"}),e.jsx("th",{className:"py-3 pr-4 font-medium",children:"Tanggal Dibuat"}),e.jsx("th",{className:"py-3 pr-4 font-medium",children:"Aksi"})]})}),e.jsx("tbody",{children:F.map(a=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"py-3 pr-4 font-medium",children:a.nama}),e.jsx("td",{className:"py-3 pr-4 text-gray-600",children:a.nip}),e.jsx("td",{className:"py-3 pr-4",children:a.kabupaten}),e.jsx("td",{className:"py-3 pr-4",children:a.jenis_jabatan}),e.jsx("td",{className:"py-3 pr-4",children:O(a.status)}),e.jsx("td",{className:"py-3 pr-4 text-gray-600",children:S(a.created_at)}),e.jsx("td",{className:"py-3 pr-4",children:e.jsx(r,{asChild:!0,variant:"outline",size:"sm",children:e.jsx(g,{to:`/pengajuan/${a.id}`,children:"Detail"})})})]},a.id))})]})})]})]})]}),e.jsxs(x,{children:[e.jsx(m,{children:e.jsx(h,{children:"Recent Uploads"})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-4",children:U.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(P,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Belum ada file yang diupload"})]}):U.map(a=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.pengajuan.pegawai.nama}),e.jsxs("div",{className:"text-sm text-gray-500",children:[a.pengajuan.jenis_jabatan," • ",a.file_type]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{variant:a.status==="approved"?"default":"secondary",children:a.status}),e.jsx(r,{size:"sm",variant:"outline",asChild:!0,children:e.jsx(g,{to:`/admin-wilayah/upload/${a.pengajuan.id}`,children:e.jsx(ue,{className:"h-4 w-4"})})})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-400",children:["Uploaded by: ",e.jsx("strong",{children:a.uploaded_by_name}),"(",a.uploaded_by_office,") - ",S(a.uploaded_at)]})]},a.id))})})]}),e.jsxs(x,{children:[e.jsx(m,{children:e.jsx(h,{children:"Quick Actions"})}),e.jsx(o,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(r,{asChild:!0,className:"flex-1",children:e.jsxs(g,{to:"/admin-wilayah/pengajuan",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"View All Pengajuan"]})}),e.jsxs(r,{variant:"outline",className:"flex-1",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Generate Report"]})]})})]})]})})};export{De as default};
//# sourceMappingURL=AdminWilayahDashboard-DrY1sy_X.js.map
