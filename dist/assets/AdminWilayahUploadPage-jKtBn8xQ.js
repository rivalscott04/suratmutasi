import{j as a,at as Ka,ae as ga,a6 as H,F as G,aA as Aa,ak as Ba,ap as Ra,U as pa,aB as ka,ag as Ea,a5 as ha,a4 as Fa,a$ as Ma,ai as Ua,aK as Ja}from"./ui-vendor-BBh2_8F_.js";import{r as o,d as Ca,e as Ia}from"./react-vendor-BNG1zHOu.js";import{C as Z,c as aa,a as _a,b as xa}from"./card-B_3dahyp.js";import{u as ja,d as Wa,B,b,a as $,c as ya,y as $a,z as Ha,P as La}from"./index-B2VxBcIH.js";import{S as za,a as Oa,b as qa,c as Ga,d as Va}from"./select-CtveXM1O.js";import{u as Xa,S as Qa}from"./protected-button-NsSO6Yvm.js";import{P as Ya}from"./PageHeader-DGlrxesY.js";import{A as ea,a as sa,b as na,c as ta,d as ra,e as ia,f as la}from"./alert-dialog-BRwNwkiK.js";const q=u=>String(u).toLowerCase().replace(/[^a-z0-9_-]+/gi,"_").replace(/^_+|_+$/g,""),Za=({pengajuanId:u,jenisJabatanId:c,onFilesUploaded:x,onProgressChange:d,pengajuanStatus:S,pengajuanData:T})=>{const{token:k,user:J}=ja(),{toast:V}=Wa(),[h,C]=o.useState([]),[f,w]=o.useState([]);o.useState([]),o.useState("");const[D,R]=o.useState({}),[X,K]=o.useState({}),[A,I]=o.useState(!0),[j,_]=o.useState(null),[E,N]=o.useState(null),[da,v]=o.useState(!1),[Q,F]=o.useState(!1),[L,z]=o.useState(""),[O,r]=o.useState("Error"),g=async()=>{try{I(!0),_(null);let e;if(isNaN(Number(c)))try{const n=await $("/api/job-type-configurations",k);if(n!=null&&n.success&&Array.isArray(n.data)){const t=n.data.find(i=>i.jenis_jabatan===c);if(t)e=t.id;else{_("Jenis jabatan tidak ditemukan");return}}else{_("Gagal mengambil data jenis jabatan");return}}catch{_("Gagal mencari jenis jabatan");return}else e=parseInt(String(c));const s=await $(`/api/admin-wilayah-file-config/job-type/${e}`,k);if(console.log("🔍 API Response:",s),console.log("🔍 Job Type ID:",e),console.log("🔍 Jenis Jabatan ID:",c),s.success){if(console.log("✅ Setting required files:",s.data),C(s.data),d){const n=f.filter(t=>s.data.some(i=>i.file_type===t.file_type)).length;d(n,s.data.length||0)}}else _("Failed to fetch file configurations")}catch(e){console.error("Error fetching file configs:",e),_("Error connecting to server")}finally{I(!1)}},m=async()=>{var e;try{const s=await $(`/api/admin-wilayah/pengajuan/${u}`,k);if(s!=null&&s.success){const t=(s.uploadedAdminWilayahFiles||((e=s.data)==null?void 0:e.uploadedAdminWilayahFiles)||[]).map(i=>({id:i.id,pengajuan_id:u,file_type:i.file_type,file_name:i.file_name,file_path:i.file_path,file_size:i.file_size,verification_status:i.verification_status||"pending",created_at:i.created_at,updated_at:i.updated_at}));w(t)}else w([])}catch(s){console.error("Error fetching uploaded files:",s),w([])}};o.useEffect(()=>{c&&(g(),m())},[c,k]),o.useEffect(()=>{if(d){const e=h.length,s=f.filter(n=>h.some(t=>t.file_type===n.file_type)).length;d(s,e)}},[h,f]);const p=async(e,s)=>{console.log("🚀 START UPLOAD - fileType:",e,"fileName:",s.name),R(n=>({...n,[e]:!0})),K(n=>({...n,[e]:0}));try{if(!ca()){R(l=>({...l,[e]:!1})),K(l=>({...l,[e]:0}));return}console.log("🔍 Uploading file:",{fileType:e,fileName:s.name,pengajuanId:u,jenisJabatanId:c,requiredFiles:h.map(l=>({file_type:l.file_type,display_name:l.display_name}))});const n=new FormData;n.append("file",s),n.append("pengajuan_id",u),n.append("file_type",e),n.append("file_category","admin_wilayah"),n.append("uploaded_by_role","admin_wilayah"),n.append("uploaded_by_name",(J==null?void 0:J.full_name)||"Admin Wilayah"),n.append("uploaded_by_office","Kanwil Provinsi"),console.log("📦 FormData created:",{file:s.name,pengajuan_id:u,file_type:e,file_category:"admin_wilayah"});for(let[l,y]of n.entries())console.log("📋 FormData entry:",l,y);const t=setInterval(()=>{K(l=>{const y=l[e]||0;return y<90?{...l,[e]:y+Math.random()*20}:l})},200),i=await ya(`/api/admin-wilayah/pengajuan/${u}/upload`,n,k);if(clearInterval(t),K(l=>({...l,[e]:100})),i.success){const l={id:i.data.id,pengajuan_id:u,file_type:e,file_name:s.name,file_path:i.data.file_path,file_size:s.size,verification_status:"pending",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},y=[...f,l];if(w(y),x(y),d){const Y=h.length,ma=y.filter(Ta=>h.some(Da=>Da.file_type===Ta.file_type)).length;d(ma,Y)}V({title:"Success",description:`Upload berhasil: ${s.name}`,variant:"default",duration:3e3})}else{const l=i.message||"Terjadi kesalahan saat mengupload file. Silakan coba lagi.";W("Upload Gagal",l)}}catch(n){console.error("Error uploading file:",n),W("Upload Gagal","Terjadi kesalahan saat mengupload file. Periksa koneksi internet Anda dan coba lagi.")}finally{R(n=>({...n,[e]:!1})),K(n=>({...n,[e]:0}))}},P=e=>{if(e===0)return"0 Bytes";const s=1024,n=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,t)).toFixed(2))+" "+n[t]},M=e=>f.find(n=>n.file_type===e)?"uploaded":"pending",U=e=>f.find(s=>s.file_type===e),oa=(e,s)=>{var t;return((t={Guru:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Madrasah":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Wakil Kepala Madrasah":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala TU":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Seksi":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Sub Bagian":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Urusan":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},Staff:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},Pelaksana:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"}}[e])==null?void 0:t[s])||null},ua=e=>{const{file_type:s,display_name:n}=e;if(s==="surat_rekomendasi_kanwil")return oa(c,s)||"Surat Rekomendasi dari Instansi Pembina - Varian 6.1-6.9";const t=oa(c,s);return t||n},ba=async e=>{try{const s=await fetch(`/api/pengajuan/files/${e.id}`,{headers:{Authorization:`Bearer ${k}`}});if(!s.ok)throw new Error("Gagal mengambil file");const n=await s.blob(),t=URL.createObjectURL(n);window.open(t,"_blank"),setTimeout(()=>URL.revokeObjectURL(t),5e3)}catch{$a("OPERATION_FAILED","Gagal membuka preview file")}},fa=async e=>{try{const s=await fetch(`/api/pengajuan/files/${e.id}`,{headers:{Authorization:`Bearer ${k}`}});if(!s.ok)throw new Error("Gagal mengambil file");const n=await s.blob(),t=URL.createObjectURL(n),i=document.createElement("a");i.href=t,i.download=e.file_name||"file.pdf",document.body.appendChild(i),i.click(),i.remove(),setTimeout(()=>URL.revokeObjectURL(t),5e3)}catch{Ha("Gagal mengunduh file")}},Pa=e=>{const s=document.getElementById(`replace-${q(e)}`);s&&s.click()},ca=()=>{if(!(T!=null&&T.jabatan_name)||!c)return!0;const e=String(T.jabatan_name).toLowerCase(),s=String(c).toLowerCase();return e!==s?(W("Jabatan Tidak Sesuai",`Jenis jabatan yang Anda pilih tidak sama dengan yang diajukan oleh operator.

• Diajukan operator: ${T.jabatan_name}
• Dipilih admin wilayah: ${c}

Silakan pilih jenis jabatan yang sesuai terlebih dahulu, lalu ulangi upload.`),!1):!0},W=(e,s)=>{r(e),z(s),F(!0)},Sa=(e,s)=>{s.preventDefault(),s.stopPropagation(),N(e),v(!0)},wa=(e,s)=>{s.preventDefault(),s.stopPropagation(),s.currentTarget.contains(s.relatedTarget)||(N(null),v(!1))},Na=e=>{e.preventDefault(),e.stopPropagation()},va=(e,s)=>{var t;if(s.preventDefault(),s.stopPropagation(),!ca()){N(null),v(!1);return}const n=s.dataTransfer.files;if(n&&n.length>0){const i=n[0],l=[".pdf",".doc",".docx"],y="."+((t=i.name.split(".").pop())==null?void 0:t.toLowerCase());if(!l.includes(y)){W("Format File Tidak Didukung","Hanya file PDF, DOC, dan DOCX yang diizinkan untuk diupload."),N(null),v(!1);return}const Y=e==="skp_2_tahun_terakhir"?1.6*1024*1024:500*1024;if(i.size>Y){W("Ukuran File Terlalu Besar",`Ukuran file maksimal ${e==="skp_2_tahun_terakhir"?"1.6MB":"500KB"}. Silakan kompres file atau pilih file yang lebih kecil.`),N(null),v(!1);return}p(e,i)}N(null),v(!1)};return A?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3"}),a.jsx("div",{className:"space-y-3",children:[...Array(5)].map((e,s)=>a.jsx("div",{className:"h-20 bg-gray-200 rounded"},s))})]})}):j?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"text-center py-8",children:[a.jsx(Ka,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Files"}),a.jsx("p",{className:"text-gray-600 mb-4",children:j}),a.jsxs(B,{onClick:g,className:"flex items-center gap-2",children:[a.jsx(ga,{className:"h-4 w-4"}),"Retry"]})]})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Upload File Admin Wilayah"}),a.jsxs(B,{onClick:()=>{g(),m()},variant:"outline",size:"sm",children:[a.jsx(ga,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Dokumen Wajib Admin Wilayah"}),a.jsx("div",{className:"text-sm text-gray-600",children:`${h.filter(s=>f.some(n=>n.file_type===s.file_type)).length}/${h.length} berkas sudah diupload`})]}),a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:h.map(e=>{console.log("🔧 Rendering fileConfig:",e);const s=M(e.file_type),n=U(e.file_type);return a.jsx(Z,{className:"border border-gray-200",children:a.jsx(aa,{className:"p-3",children:a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h4",{className:"font-medium text-gray-900 text-sm leading-tight",title:ua(e),children:ua(e)}),e.is_required&&a.jsx(b,{variant:"destructive",className:"text-[10px] py-0 px-1.5",children:"Wajib"})]}),s==="uploaded"?a.jsxs(b,{className:"bg-green-600 text-white flex items-center gap-1 text-xs",children:[a.jsx(H,{className:"h-3 w-3"}),"Uploaded"]}):a.jsxs(b,{variant:"secondary",className:"flex items-center gap-1 text-xs",children:[a.jsx(G,{className:"h-3 w-3"}),"Pending"]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("p",{className:"text-xs text-gray-500",children:["PDF (maks. ",e.file_type==="skp_2_tahun_terakhir"?"1.6MB":"500KB",")"]}),D[e.file_type]&&a.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[a.jsx("div",{className:"animate-spin h-3 w-3 border border-green-600 border-t-transparent rounded-full"}),a.jsxs("span",{className:"text-green-600",children:["Uploading... ",X[e.file_type]||0,"%"]})]}),s==="uploaded"&&n&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-1 text-green-600 text-xs",children:[a.jsx(H,{className:"h-3 w-3"}),a.jsx("span",{className:"truncate",children:n.file_name}),a.jsxs("span",{className:"text-gray-500",children:["(",P(n.file_size),")"]})]}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx(B,{size:"sm",variant:"outline",onClick:()=>ba(n),className:"h-6 px-2 text-xs",children:a.jsx(Aa,{className:"h-3 w-3"})}),a.jsx(B,{size:"sm",variant:"outline",onClick:()=>fa(n),className:"h-6 px-2 text-xs",children:a.jsx(Ba,{className:"h-3 w-3"})}),a.jsx(B,{size:"sm",variant:"outline",onClick:()=>Pa(e.file_type),className:"h-6 px-2 text-xs",children:a.jsx(Ra,{className:"h-3 w-3"})}),a.jsx("input",{id:`replace-${q(e.file_type)}`,type:"file",className:"hidden",accept:".pdf,.doc,.docx",onChange:t=>{var l;const i=(l=t.target.files)==null?void 0:l[0];i&&(p(e.file_type,i),t.target.value="")}})]})]}),s!=="uploaded"&&a.jsxs("div",{className:`relative border-2 border-dashed rounded-lg p-6 transition-all duration-200 cursor-pointer w-full h-32 ${E===e.file_type?"border-green-500 bg-green-50":"border-gray-300 hover:border-green-400 hover:bg-gray-50"} ${D[e.file_type]?"pointer-events-none opacity-50":""}`,onDragEnter:t=>Sa(e.file_type,t),onDragLeave:t=>wa(e.file_type,t),onDragOver:Na,onDrop:t=>va(e.file_type,t),onClick:()=>{const t=document.getElementById(`file-${q(e.file_type)}`);t&&!t.disabled&&!D[e.file_type]&&t.click()},children:[a.jsx("div",{className:"flex flex-col items-center justify-center h-full text-center",children:D[e.file_type]?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin h-6 w-6 border-2 border-green-600 border-t-transparent rounded-full mb-2"}),a.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Uploading..."})]}):E===e.file_type?a.jsxs(a.Fragment,{children:[a.jsx(pa,{className:"h-8 w-8 text-green-500 mb-2"}),a.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Lepaskan file di sini"})]}):a.jsxs(a.Fragment,{children:[a.jsx(pa,{className:"h-6 w-6 text-gray-400 mb-2"}),a.jsx("p",{className:"text-xs text-gray-600 leading-tight",children:"Drag & drop file di sini atau klik untuk memilih"})]})}),a.jsx("input",{type:"file",accept:".pdf,.doc,.docx",onChange:t=>{var l;console.log("📁 File input changed:",t.target.files);const i=(l=t.target.files)==null?void 0:l[0];i?(console.log("📄 File selected:",i.name,"fileConfig.file_type:",e.file_type),p(e.file_type,i),t.target.value=""):console.log("❌ No file selected")},className:"hidden",id:`file-${q(e.file_type)}`})]})]})]})})},e.id)})})]}),a.jsx(ea,{open:Q,onOpenChange:F,children:a.jsxs(sa,{className:"max-w-md",children:[a.jsxs(na,{children:[a.jsxs(ta,{className:"flex items-center gap-2 text-red-600 text-lg",children:[a.jsx(ka,{className:"h-5 w-5"}),O]}),a.jsx(ra,{className:"text-gray-700 whitespace-pre-line leading-relaxed",children:L})]}),a.jsx(ia,{children:a.jsx(la,{onClick:()=>F(!1),className:"bg-red-600 hover:bg-red-700",children:"Tutup"})})]})})]})},ae=({uploaded:u,total:c,isComplete:x,className:d=""})=>{const S=c>0?Math.round(u/c*100):0;return a.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 ${d}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Progress Upload Dokumen"}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:[u," dari ",c," dokumen"]}),a.jsxs("div",{className:"text-lg font-bold text-green-600",children:[S,"%"]})]})]}),a.jsx("div",{className:"mb-4",children:a.jsx(La,{value:S,className:"h-3 bg-gray-200"})}),a.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[a.jsx(H,{className:"h-4 w-4"}),a.jsxs("span",{children:[u," Terupload"]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[a.jsx(Ea,{className:"h-4 w-4"}),a.jsxs("span",{children:[c-u," Belum"]})]}),x&&a.jsxs("div",{className:"flex items-center gap-2 text-green-600 font-medium",children:[a.jsx(H,{className:"h-4 w-4"}),a.jsx("span",{children:"Upload Selesai"})]})]})]})},oe=()=>{var F,L,z,O;const{pengajuanId:u}=Ca(),c=Ia(),{token:x}=ja(),[d,S]=o.useState(null),[T,k]=o.useState(!0);o.useState(!1);const{submitForm:J,isSubmitting:V}=Xa(),[h,C]=o.useState(!1),[f,w]=o.useState(!1),[D,R]=o.useState(""),[X,K]=o.useState([]),[A,I]=o.useState(""),[j,_]=o.useState({required:0,total:0,isComplete:!1}),E=async()=>{var r,g;if(!(!x||!u)){k(!0);try{const m=await $(`/api/admin-wilayah/pengajuan/${u}`,x);if(m&&m.success!==!1){S(m.pengajuan||((r=m.data)==null?void 0:r.pengajuan)||m);const p=m.uploadProgress||((g=m.data)==null?void 0:g.uploadProgress);if(p){const P=Number(p.required??0),M=Number(p.total??0),U=typeof p.isComplete=="boolean"?p.isComplete:P>=M;_({required:P,total:M,isComplete:U})}else _({required:0,total:0,isComplete:!1})}else S(null),_({required:0,total:0,isComplete:!1})}catch(m){console.error("Failed to fetch pengajuan detail",m),S(null)}finally{k(!1)}}},N=async()=>{try{const r=await $("/api/admin-wilayah-file-config",x);if(r!=null&&r.success&&Array.isArray(r.data)){const g=new Map;r.data.forEach(p=>{var U;const P=p.jenis_jabatan_id,M=((U=p.jenis_jabatan)==null?void 0:U.jenis_jabatan)||`Jabatan ${P}`;P&&!g.has(P)&&g.set(P,M)});const m=Array.from(g.values());K(m),m.length>0&&!A&&I(m[0])}}catch(r){console.error("Failed to fetch job types:",r)}};o.useEffect(()=>{E(),N()},[u,x]);const da=r=>new Date(r).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),v=(r,g)=>{switch(r){case"approved":return a.jsx(b,{className:"bg-green-600 text-white",children:"Disetujui Kab/Kota"});case"admin_wilayah_approved":return a.jsx(b,{className:"bg-green-700 text-white",children:"Disetujui Admin Wilayah"});case"admin_wilayah_rejected":return a.jsx(b,{className:"bg-red-600 text-white",children:"Ditolak Admin Wilayah"});case"admin_wilayah_submitted":return a.jsx(b,{className:"bg-blue-600 text-white",children:"Diajukan Admin Wilayah"});case"submitted":return a.jsx(b,{className:"bg-blue-600 text-white",children:"Dikirim ke Superadmin"});default:return a.jsx(b,{className:"bg-gray-600 text-white",children:r})}},Q=async()=>{!x||!u||J(async()=>{try{const r=await ya(`/api/admin-wilayah/pengajuan/${u}/submit-to-superadmin`,{},x);(r==null?void 0:r.success)!==!1&&(R("Pengajuan berhasil diajukan ke Superadmin"),C(!0),r.pengajuan&&S(r.pengajuan)),await E()}catch(r){console.error("Error submitting to superadmin:",r),R((r==null?void 0:r.message)||"Terjadi kesalahan saat mengajukan ke Superadmin"),w(!0)}},()=>{},r=>{console.error("Error submitting to superadmin:",r)})};return T?a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsx("div",{className:"max-w-6xl mx-auto",children:a.jsxs("div",{className:"animate-pulse space-y-6",children:[a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),a.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})})}):d?a.jsxs("div",{className:"min-h-screen bg-background p-6",children:[a.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[a.jsx(Ya,{title:"Upload File Admin Wilayah",subtitle:"Upload file tambahan untuk pengajuan mutasi pegawai",actions:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(b,{className:"bg-green-100 text-green-800",children:"Admin Wilayah"}),v(d.status),a.jsxs(B,{variant:"outline",onClick:()=>c("/admin-wilayah/dashboard"),className:"border-green-200 text-green-700 hover:bg-green-50",children:[a.jsx(ha,{className:"h-4 w-4 mr-2"}),"Kembali"]})]})}),a.jsxs(Z,{className:"border-green-200 bg-green-50",children:[a.jsx(_a,{children:a.jsxs(xa,{className:"text-green-800 flex items-center gap-2",children:[a.jsx(G,{className:"h-5 w-5"}),"Informasi Pengajuan"]})}),a.jsx(aa,{children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Fa,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:((F=d.pegawai)==null?void 0:F.nama)||"-"}),a.jsxs("p",{className:"text-sm text-gray-600",children:["NIP: ",((L=d.pegawai)==null?void 0:L.nip)||"-"]})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Ma,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:((z=d.office)==null?void 0:z.kabkota)||"-"}),a.jsx("p",{className:"text-sm text-gray-600",children:((O=d.office)==null?void 0:O.name)||"-"})]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(G,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Jenis Jabatan"}),a.jsx("p",{className:"text-sm text-gray-600",children:d.jenis_jabatan})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Ua,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Tanggal Pengajuan"}),a.jsx("p",{className:"text-sm text-gray-600",children:da(d.created_at)})]})]})]})]})})]}),a.jsxs(Z,{children:[a.jsx(_a,{children:a.jsx(xa,{className:"text-green-800",children:"Upload File Admin Wilayah"})}),a.jsxs(aa,{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Jenis Berkas Admin Wilayah"}),a.jsxs(za,{value:A,onValueChange:I,children:[a.jsx(Oa,{className:"w-full max-w-md",children:a.jsx(qa,{placeholder:"Pilih jenis berkas..."})}),a.jsx(Ga,{children:X.map(r=>a.jsx(Va,{value:r,children:r},r))})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Pilih jenis berkas yang sudah dikonfigurasi oleh superadmin"})]}),A&&j.total>0&&a.jsx(ae,{uploaded:j.required,total:j.total,isComplete:j.isComplete,className:"mb-6"}),A&&a.jsx(Za,{pengajuanId:d.id,jenisJabatanId:A,onFilesUploaded:()=>E(),onProgressChange:(r,g)=>_({required:r,total:g,isComplete:r>=g&&g>0}),pengajuanStatus:d.status,pengajuanData:d})]})]}),a.jsx("div",{className:"flex items-center justify-end gap-3",children:(d.status==="admin_wilayah_approved"||d.status==="admin_wilayah_submitted")&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{className:"text-sm text-gray-600 mr-2",children:[j.required,"/",j.total," berkas wajib"]}),a.jsxs(Qa,{onClick:d.status==="admin_wilayah_submitted"?()=>{}:Q,className:`bg-green-600 hover:bg-green-700 text-white ${d.status==="admin_wilayah_submitted"||!j.isComplete?"opacity-50 cursor-not-allowed":""}`,isProcessing:V,processingText:"Mengirim...",onError:()=>{},onSuccess:()=>{},children:[a.jsx(Ja,{className:"h-4 w-4 mr-2"}),d.status==="admin_wilayah_submitted"?"Sudah Diajukan":"Ajukan ke Superadmin"]})]})})]}),a.jsx(ea,{open:h,onOpenChange:C,children:a.jsxs(sa,{children:[a.jsxs(na,{children:[a.jsxs(ta,{className:"flex items-center gap-2 text-green-600 text-lg",children:[a.jsx(H,{className:"h-5 w-5"}),"Berhasil!"]}),a.jsx(ra,{className:"text-gray-700",children:D})]}),a.jsx(ia,{children:a.jsx(la,{onClick:()=>C(!1),className:"bg-green-600 hover:bg-green-700",children:"OK"})})]})}),a.jsx(ea,{open:f,onOpenChange:w,children:a.jsxs(sa,{children:[a.jsxs(na,{children:[a.jsxs(ta,{className:"flex items-center gap-2 text-red-600 text-lg",children:[a.jsx(ka,{className:"h-5 w-5"}),"Gagal Mengajukan"]}),a.jsx(ra,{className:"text-gray-700",children:D})]}),a.jsx(ia,{children:a.jsx(la,{onClick:()=>w(!1),className:"bg-red-600 hover:bg-red-700",children:"OK"})})]})})]}):a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsx("div",{className:"max-w-6xl mx-auto",children:a.jsxs("div",{className:"text-center py-12",children:[a.jsx(G,{className:"h-16 w-16 mx-auto text-gray-300 mb-4"}),a.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Pengajuan Tidak Ditemukan"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Pengajuan yang Anda cari tidak ditemukan atau tidak memiliki akses."}),a.jsxs(B,{onClick:()=>c("/admin-wilayah/dashboard"),className:"bg-green-600 hover:bg-green-700 text-white",children:[a.jsx(ha,{className:"h-4 w-4 mr-2"}),"Kembali ke Dashboard"]})]})})})};export{oe as default};
//# sourceMappingURL=AdminWilayahUploadPage-jKtBn8xQ.js.map
