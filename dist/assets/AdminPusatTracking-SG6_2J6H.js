import{j as e,a8 as R,F as V,aa as re,a1 as le,al as q,ar as ce,a9 as G,a3 as de,b1 as oe,ak as ue,aD as me,aw as ge}from"./ui-vendor-sDPVfCnv.js";import{r as n}from"./react-vendor-BNG1zHOu.js";import{u as xe,d as he,a as H,I as X,B as j,b as pe,D as je,e as fe,f as ke,g as Ne,c as ve}from"./index-BfFoZe-y.js";import{C as f,c as k}from"./card-gcIfCSez.js";import{L as b}from"./label-D4rybsK0.js";import{T as be}from"./textarea-C807XanX.js";import{S as w,a as y,b as _,c as S,d as o}from"./select-BMwxGI-g.js";import{P as z}from"./PageHeader-DxtRMcFK.js";const Ee=()=>{var J,$,U;const{user:we,token:N}=xe(),{toast:g}=he(),[C,K]=n.useState([]),[L,Q]=n.useState([]),[W,T]=n.useState(!0),[c,I]=n.useState(""),[x,P]=n.useState("all"),[u,E]=n.useState("all"),[r,Y]=n.useState(null),[Z,h]=n.useState(!1),[B,F]=n.useState(!1),[l,p]=n.useState({tracking_status_id:"",notes:"",estimated_days:""});n.useEffect(()=>{D()},[]);const D=async()=>{try{T(!0);const s=await H("/api/tracking/pengajuan",N);s.success&&K(s.data);const a=await H("/api/tracking/status-master",N);a.success&&Q(a.data)}catch(s){console.error("Error loading data:",s),g({title:"Error",description:"Gagal memuat data",variant:"destructive"})}finally{T(!1)}},ee=s=>{var i;Y(s);const a=v(s),t=a?(i=a.tracking_status_id)==null?void 0:i.toString():"";console.log("Latest tracking:",a),console.log("Default status ID:",t),p({tracking_status_id:t||"",notes:"",estimated_days:""}),h(!0)},ae=async()=>{if(!r||!l.tracking_status_id){g({title:"Error",description:"Status tracking harus diisi",variant:"destructive"});return}try{F(!0),(await ve(`/api/tracking/pengajuan/${r.id}`,{tracking_status_id:parseInt(l.tracking_status_id),notes:l.notes||null,estimated_days:l.estimated_days?parseInt(l.estimated_days):null},N)).success&&(g({title:"Berhasil",description:"Status tracking berhasil disimpan"}),h(!1),D())}catch(s){console.error("Error submitting tracking:",s),g({title:"Error",description:"Gagal menyimpan status tracking",variant:"destructive"})}finally{F(!1)}},v=s=>!s.tracking||s.tracking.length===0?null:s.tracking[0],A=C.filter(s=>{var m,M,O;const a=s.pegawai_nip.toLowerCase().includes(c.toLowerCase())||s.jenis_jabatan.toLowerCase().includes(c.toLowerCase())||((m=s.office)==null?void 0:m.kabkota.toLowerCase().includes(c.toLowerCase()))||((M=s.office)==null?void 0:M.nama_kantor.toLowerCase().includes(c.toLowerCase()))||((O=s.pegawai)==null?void 0:O.nama.toLowerCase().includes(c.toLowerCase())),t=x==="all"||s.jenis_jabatan===x,i=v(s);let d=!0;return u==="all"?d=!0:u==="no-tracking"?d=i===null:d=(i==null?void 0:i.status_name)===u,a&&t&&d}),se=()=>{const s=new Set(C.map(t=>t.jenis_jabatan)),a=Array.from(s).sort();return console.log("Unique jabatan:",a),a},te=s=>{const a=s.toLowerCase();return a.includes("selesai")||a.includes("completed")?"bg-green-100 text-green-800":a.includes("diterima")||a.includes("received")||a.includes("pusat")?"bg-blue-100 text-blue-800":a.includes("proses")||a.includes("progress")||a.includes("sedang")?"bg-orange-100 text-orange-800":a.includes("menunggu")||a.includes("waiting")||a.includes("pending")?"bg-yellow-100 text-yellow-800":a.includes("ditolak")||a.includes("rejected")||a.includes("gagal")?"bg-red-100 text-red-800":a.includes("review")||a.includes("verifikasi")||a.includes("cek")?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"},ne=s=>{const a=s.toLowerCase();return a.includes("selesai")||a.includes("completed")||a.includes("selesai")?e.jsx(de,{className:"h-4 w-4"}):a.includes("diterima")||a.includes("received")||a.includes("pusat")?e.jsx(oe,{className:"h-4 w-4"}):a.includes("proses")||a.includes("progress")||a.includes("sedang")?e.jsx(G,{className:"h-4 w-4"}):a.includes("menunggu")||a.includes("waiting")||a.includes("pending")?e.jsx(ue,{className:"h-4 w-4"}):a.includes("ditolak")||a.includes("rejected")||a.includes("gagal")?e.jsx(me,{className:"h-4 w-4"}):a.includes("review")||a.includes("verifikasi")||a.includes("cek")?e.jsx(R,{className:"h-4 w-4"}):e.jsx(ge,{className:"h-4 w-4"})},ie=s=>s===1?"1 hari":s<7?`${s} hari`:s<30?`${Math.ceil(s/7)} minggu`:`${Math.ceil(s/30)} bulan`;return W?e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx(z,{title:"Tracking Dokumen",subtitle:"Input status tracking untuk berkas yang sudah final approved"}),e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,a)=>e.jsx(f,{children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"})]})})},a))})]}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx(z,{title:"Tracking Dokumen",subtitle:"Input status tracking untuk berkas yang sudah final approved"}),e.jsx(f,{className:"mb-6",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(X,{placeholder:"Cari berdasarkan NIP, jenis jabatan, atau kabupaten...",value:c,onChange:s=>I(s.target.value),className:"pl-10"})]}),e.jsx("div",{className:"w-64",children:e.jsxs(w,{value:x,onValueChange:P,children:[e.jsx(y,{children:e.jsx(_,{placeholder:"Filter berdasarkan jabatan"})}),e.jsxs(S,{children:[e.jsx(o,{value:"all",children:"Semua Jabatan"}),se().map(s=>e.jsx(o,{value:s,children:s},s))]})]})}),e.jsx("div",{className:"w-64",children:e.jsxs(w,{value:u,onValueChange:E,children:[e.jsx(y,{children:e.jsx(_,{placeholder:"Filter berdasarkan status"})}),e.jsxs(S,{children:[e.jsx(o,{value:"all",children:"Semua Status"}),e.jsx(o,{value:"no-tracking",children:"Belum Ada Tracking"}),L.map(s=>e.jsx(o,{value:s.status_name,children:s.status_name},s.id))]})]})}),(c||x!=="all"||u!=="all")&&e.jsx(j,{variant:"outline",onClick:()=>{I(""),P("all"),E("all")},className:"px-4",children:"Reset Filter"})]})})}),e.jsx("div",{className:"space-y-4",children:A.length===0?e.jsx(f,{children:e.jsxs(k,{className:"p-6 text-center",children:[e.jsx(V,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Tidak ada berkas yang perlu ditrack"})]})}):A.map(s=>{var i,d,m;const a=v(s),t=a!==null;return e.jsx(f,{className:"hover:shadow-md transition-shadow",children:e.jsx(k,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("h3",{className:"font-bold text-xl text-gray-900",children:s.pegawai_nip}),e.jsx(pe,{variant:"outline",className:"bg-gray-100 text-gray-700",children:s.jenis_jabatan})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(re,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{className:"font-medium",children:((i=s.pegawai)==null?void 0:i.nama)||"Nama tidak tersedia"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(le,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:((d=s.office)==null?void 0:d.kabkota)||((m=s.office)==null?void 0:m.nama_kantor)||"Lokasi tidak tersedia"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(V,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{children:[s.total_dokumen," dokumen"]})]}),t?e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(q,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{children:["Estimasi: ",a.estimated_days?ie(a.estimated_days):"Belum ada estimasi"]})]}):e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(q,{className:"h-4 w-4"}),e.jsx("span",{children:"Belum ada estimasi"})]})]}),t&&e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${te(a.status_name)}`,children:[ne(a.status_name),e.jsx("span",{children:a.status_name})]})}),t&&a.notes&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 mb-3",children:e.jsxs("p",{className:"text-sm text-gray-700 italic",children:['"',a.notes,'"']})})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(j,{onClick:()=>ee(s),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),t?"Update Tracking":"Input Tracking"]})})]})})},s.id)})}),e.jsx(je,{open:Z,onOpenChange:h,children:e.jsxs(fe,{className:"max-w-md",children:[e.jsx(ke,{children:e.jsx(Ne,{children:"Input Status Tracking"})}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"font-medium",children:((J=r.pegawai)==null?void 0:J.nama)||r.pegawai_nip}),e.jsxs("p",{className:"text-sm text-gray-600",children:["NIP: ",r.pegawai_nip]}),e.jsx("p",{className:"text-sm text-gray-600",children:r.jenis_jabatan}),e.jsx("p",{className:"text-sm text-gray-600",children:(($=r.office)==null?void 0:$.kabkota)||((U=r.office)==null?void 0:U.nama_kantor)||"N/A"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"status",children:"Update Status Tracking *"}),e.jsxs(w,{value:l.tracking_status_id,onValueChange:s=>p(a=>({...a,tracking_status_id:s})),children:[e.jsx(y,{children:e.jsx(_,{placeholder:"Pilih status tracking baru"})}),e.jsx(S,{children:L.map(s=>e.jsx(o,{value:s.id.toString(),children:s.status_name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"notes",children:"Catatan"}),e.jsx(be,{id:"notes",placeholder:"Catatan tambahan (opsional)",value:l.notes,onChange:s=>p(a=>({...a,notes:s.target.value})),rows:3})]}),e.jsxs("div",{children:[e.jsx(b,{htmlFor:"estimated_days",children:"Estimasi Penyelesaian (hari)"}),e.jsx(X,{id:"estimated_days",type:"number",placeholder:"Contoh: 2",value:l.estimated_days,onChange:s=>{const a=s.target.value;(a===""||/^\d+$/.test(a))&&p(t=>({...t,estimated_days:a}))},min:"1",step:"1",pattern:"[0-9]*",inputMode:"numeric"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(j,{variant:"outline",onClick:()=>h(!1),className:"flex-1",children:"Batal"}),e.jsx(j,{onClick:ae,disabled:B||!l.tracking_status_id,className:"flex-1 bg-green-600 hover:bg-green-700 text-white",children:B?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4 animate-spin mr-2"}),"Menyimpan..."]}):"Simpan"})]})]})]})})]})};export{Ee as default};
//# sourceMappingURL=AdminPusatTracking-SG6_2J6H.js.map
