import{j as e,F,a4 as O,al as C,ax as P,a9 as me,E as oe,b4 as xe,ab as he,am as ge,T as je}from"./ui-vendor-DQXcJUOU.js";import{r as i}from"./react-vendor-DheTkQGW.js";import{u as ue,d as pe,a as fe,I as Ne,b as p,B,D as be,e as ve,f as we,g as ye}from"./index-D6E2VSYf.js";import{C as h,c as g}from"./card-CIXpXv1o.js";import{T as ke,a as _e,b as U,c as m,d as Se,e as o}from"./table-dFGBjE7J.js";import{S as V,a as $,b as R,c as G,d as f}from"./select-BlUcE-vT.js";import{P as q}from"./PageHeader-DwmejLgZ.js";const Ee=()=>{var H,K;const{user:c,token:Q}=ue(),{toast:W}=pe(),[I,X]=i.useState([]),[Y,L]=i.useState(!0),[k,Z]=i.useState(""),[N,ee]=i.useState("all"),[b,v]=i.useState(1),[w,ae]=i.useState(10),[n,se]=i.useState(null),[te,M]=i.useState(!1),[y,ne]=i.useState({tracked:0,completed:0,inProgress:0,overdue:0});i.useEffect(()=>{le()},[]);const le=async()=>{try{L(!0);const s=(c==null?void 0:c.office_id)===null?"/api/tracking/superadmin":"/api/tracking/admin",t=await fe(s,Q);t.success&&(X(t.data),ie(t.data))}catch(a){console.error("Error loading tracking data:",a),W({title:"Error",description:"Gagal memuat data tracking",variant:"destructive"})}finally{L(!1)}},ie=a=>{let s=0,t=0,r=0,l=0;a.forEach(d=>{if(d.tracking&&d.tracking.length>0){s++;const x=d.tracking[0];if(x.status_name.includes("Selesai"))t++;else if(r++,x.estimated_days){const u=new Date(x.created_at);u.setDate(u.getDate()+x.estimated_days),new Date>u&&l++}}}),ne({tracked:s,completed:t,inProgress:r,overdue:l})},re=a=>{se(a),M(!0)},_=I.filter(a=>{var l,d;const s=k.toLowerCase(),t=a.pegawai_nip.toLowerCase().includes(s)||a.jenis_jabatan.toLowerCase().includes(s)||(((l=a.office)==null?void 0:l.kabkota)||"").toLowerCase().includes(s)||(((d=a.pegawai)==null?void 0:d.nama)||"").toLowerCase().includes(s),r=N==="all"||a.jenis_jabatan===N;return t&&r}),j=i.useMemo(()=>(c==null?void 0:c.office_id)===null?[..._].sort((s,t)=>{var d,x;const r=s.tracking&&s.tracking.length>0,l=t.tracking&&t.tracking.length>0;if(r&&!l)return-1;if(!r&&l)return 1;if(r&&l){const u=(d=s.tracking[0])!=null&&d.created_at?new Date(s.tracking[0].created_at).getTime():0;return((x=t.tracking[0])!=null&&x.created_at?new Date(t.tracking[0].created_at).getTime():0)-u}return 0}):_,[_,c==null?void 0:c.office_id]);i.useEffect(()=>{v(1)},[k,N]);const ce=Array.from(new Set(I.map(a=>a.jenis_jabatan))).sort(),S=Math.max(1,Math.ceil(j.length/w)),D=(b-1)*w,E=D+w,de=j.slice(D,E),J=a=>a.toUpperCase()==="BTS"?"bg-yellow-100 text-yellow-800 border-yellow-300":"bg-gray-100 text-gray-700 border-gray-200",A=a=>a.includes("Selesai")?e.jsx(O,{className:"h-4 w-4 text-green-600"}):a.includes("Diproses")?e.jsx(C,{className:"h-4 w-4 text-blue-600"}):a.includes("Disposisi")?e.jsx(je,{className:"h-4 w-4 text-orange-600"}):e.jsx(P,{className:"h-4 w-4 text-gray-600"}),z=(a,s=!1)=>(a==null?void 0:a.trim().toUpperCase())==="BTS"?"bg-yellow-100 text-yellow-800 border-yellow-300":a.includes("Selesai")?"bg-green-100 text-green-700 border-green-200":a.includes("Diproses")?`bg-blue-100 text-blue-700 border-blue-200 ${s?"border-red-400 text-red-700":""}`:a.includes("Disposisi")?"bg-orange-100 text-orange-700 border-orange-200":a.includes("Menunggu")?"bg-yellow-100 text-yellow-700 border-yellow-200":"bg-gray-100 text-gray-700 border-gray-200",T=a=>{if(!a.estimated_days)return!1;const s=new Date(a.created_at);return s.setDate(s.getDate()+a.estimated_days),new Date>s&&!a.status_name.includes("Selesai")};return Y?e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx(q,{title:"Tracking Dokumen",subtitle:"Monitor progress berkas di pusat"}),e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((a,s)=>e.jsx(h,{children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"})]})})},s))})]}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx(q,{title:"Tracking Dokumen",subtitle:"Monitor progress berkas di pusat"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(h,{children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(F,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Memiliki riwayat tracking"}),e.jsx("p",{className:"text-2xl font-bold",children:y.tracked})]})]})})}),e.jsx(h,{children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Selesai"}),e.jsx("p",{className:"text-2xl font-bold",children:y.completed})]})]})})}),e.jsx(h,{children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Dalam Proses"}),e.jsx("p",{className:"text-2xl font-bold",children:y.inProgress})]})]})})}),e.jsx(h,{children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"h-8 w-8 text-red-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Terlambat"}),e.jsx("p",{className:"text-2xl font-bold",children:y.overdue})]})]})})})]}),e.jsx(h,{className:"mb-6",children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(me,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(Ne,{placeholder:"Cari NIP/Nama/Jabatan/Kabupaten...",value:k,onChange:a=>Z(a.target.value),className:"pl-10"})]}),e.jsx("div",{className:"w-full md:w-64",children:e.jsxs(V,{value:N,onValueChange:ee,children:[e.jsx($,{children:e.jsx(R,{placeholder:"Semua Jabatan"})}),e.jsxs(G,{children:[e.jsx(f,{value:"all",children:"Semua Jabatan"}),ce.map(a=>e.jsx(f,{value:a,children:a},a))]})]})})]})})}),e.jsx(h,{children:e.jsx(g,{className:"p-0",children:j.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(F,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Tidak ada data tracking"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ke,{children:[e.jsx(_e,{children:e.jsxs(U,{children:[e.jsx(m,{children:"NIP"}),e.jsx(m,{children:"Nama Pegawai"}),e.jsx(m,{children:"Jabatan"}),e.jsx(m,{children:"Kab/Kota"}),e.jsx(m,{children:"Status Terakhir"}),e.jsx(m,{children:"Estimasi"}),e.jsx(m,{children:"Tgl Final"}),e.jsx(m,{children:"Aksi"})]})}),e.jsx(Se,{children:de.map(a=>{var r,l;const s=a.tracking&&a.tracking.length>0?a.tracking[0]:null,t=a.final_approved_at?new Date(a.final_approved_at).toLocaleDateString("id-ID"):"Belum ditentukan";return e.jsxs(U,{children:[e.jsx(o,{className:"font-medium",children:a.pegawai_nip}),e.jsx(o,{children:((r=a.pegawai)==null?void 0:r.nama)||"â€”"}),e.jsx(o,{children:e.jsx(p,{variant:"outline",className:J(a.jenis_jabatan),children:a.jenis_jabatan})}),e.jsx(o,{children:((l=a.office)==null?void 0:l.kabkota)||"N/A"}),e.jsx(o,{children:s?e.jsxs("div",{className:"flex items-center gap-2",children:[A(s.status_name),e.jsx(p,{title:s.status_name,className:`cursor-default hover:brightness-95 ${z(s.status_name,T(s))}`,children:s.status_name})]}):e.jsx("span",{className:"text-gray-500",children:"Belum ada"})}),e.jsx(o,{children:s!=null&&s.estimated_days?`${s.estimated_days} hari`:"-"}),e.jsx(o,{children:t}),e.jsx(o,{children:e.jsxs(B,{size:"sm",variant:"outline",className:"flex items-center gap-2",onClick:()=>re(a),children:[e.jsx(oe,{className:"h-4 w-4"})," Detail"]})})]},a.id)})})]})})})}),j.length>0&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Menampilkan ",D+1,"-",Math.min(E,j.length)," dari ",j.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mr-2",children:[e.jsx("span",{children:"Tampilkan"}),e.jsxs(V,{value:String(w),onValueChange:a=>{ae(Number(a)),v(1)},children:[e.jsx($,{className:"h-8 w-[84px]",children:e.jsx(R,{})}),e.jsxs(G,{children:[e.jsx(f,{value:"10",children:"10"}),e.jsx(f,{value:"25",children:"25"}),e.jsx(f,{value:"50",children:"50"})]})]}),e.jsx("span",{children:"per halaman"})]}),e.jsx(B,{variant:"outline",size:"sm",onClick:()=>v(a=>Math.max(1,a-1)),disabled:b===1,children:"Sebelumnya"}),e.jsxs("span",{className:"text-sm",children:["Hal ",b," / ",S]}),e.jsx(B,{variant:"outline",size:"sm",onClick:()=>v(a=>Math.min(S,a+1)),disabled:b===S,children:"Berikutnya"})]})]}),e.jsx(be,{open:te,onOpenChange:M,children:e.jsxs(ve,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(we,{children:e.jsx(ye,{children:"Detail Tracking"})}),n&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h3",{className:"font-semibold text-xl leading-tight",children:((H=n.pegawai)==null?void 0:H.nama)||"-"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 font-mono",children:["NIP: ",n.pegawai_nip]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Jenis Jabatan:"}),e.jsx("div",{className:"mt-1",children:e.jsx(p,{variant:"outline",className:J(n.jenis_jabatan),children:n.jenis_jabatan})})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Kabupaten/Kota:"}),e.jsx("p",{className:"text-gray-600",children:((K=n.office)==null?void 0:K.kabkota)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Dokumen:"}),e.jsx("p",{className:"text-gray-600",children:n.total_dokumen})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Final Approved:"}),e.jsx("p",{className:"text-gray-600",children:n.final_approved_at?new Date(n.final_approved_at).toLocaleDateString("id-ID"):"Belum ditentukan"})]})]})]}),n.tracking&&n.tracking.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Riwayat Tracking"}),e.jsxs("div",{className:"relative pl-6",children:[e.jsx("div",{className:"absolute left-2 top-0 bottom-0 w-px bg-gray-200"}),e.jsx("div",{className:"space-y-6",children:n.tracking.map(a=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-[7px] top-1 h-3 w-3 rounded-full bg-green-600 ring-2 ring-white"}),e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[A(a.status_name),e.jsx(p,{title:a.status_name,className:`cursor-default hover:brightness-95 ${z(a.status_name,T(a))}`,children:a.status_name}),T(a)&&e.jsxs(p,{variant:"destructive",className:"text-xs",children:[e.jsx(xe,{className:"h-3 w-3 mr-1"})," Terlambat"]})]}),e.jsxs("div",{className:"text-xs text-gray-600 flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"h-3 w-3"}),a.tracked_by_name]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ge,{className:"h-3 w-3"}),new Date(a.created_at).toLocaleString("id-ID")]}),a.estimated_days&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"h-3 w-3"}),"Estimasi: ",a.estimated_days," hari"]})]}),a.notes&&e.jsx("div",{className:"mt-2 text-sm text-gray-700",children:a.notes})]})]},a.id))})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Belum ada tracking untuk berkas ini"})]})]})]})})]})};export{Ee as default};
//# sourceMappingURL=SuperadminTracking-Bf4JAVCT.js.map
