import{j as e,F as L,a2 as ae,an as Re,at as D,a8 as Ge,a4 as $,aE as _a,aF as ge,aA as Ta,E as He,a1 as Ve,aG as Ze,aj as Aa,X as Je,aH as Pa}from"./ui-vendor-B7g5fNgE.js";import{r,e as Ca,L as We}from"./react-vendor-BNG1zHOu.js";import{u as Ba,d as Ea,a as pe,S as T,B as o,I as Ma,b as je,D as fe,e as be,g as Ne,m as La,j as Da,l as qe}from"./index-MC2kddcs.js";import{C as z,c as I,a as Oa,b as Ka}from"./card-Dgq8iKgH.js";import{T as Fa,a as Ua,b as Xe,c as A,d as $a,e as P}from"./table-1vahjQE-.js";import{T as za,a as Ia,b as Ra,c as Ga,d as Ha,e as Va,f as Za,g as Ja,h as Wa}from"./Template9-BmjAqe2o.js";import{A as qa,a as Xa,b as Ya,c as Qa}from"./accordion-DHLEyqZW.js";import{S as we,a as ve,b as ke,c as ye,d as C}from"./select-zf5navUN.js";import{P as Ye}from"./PegawaiSearchInput-CKyPKH_M.js";import{u as Se,w as et}from"./xlsx-DjuO7_Ju.js";import{L as Qe}from"./label-CKFt3K8V.js";const gt=()=>{const{token:v,user:l}=Ba(),[b,_e]=r.useState([]),[N,R]=r.useState(!0),[Te,Ae]=r.useState(null),[k,te]=r.useState(""),[G,ea]=r.useState("letter_number"),[se,aa]=r.useState("asc");r.useState(1),r.useState(10);const[y,le]=r.useState("all"),{toast:S}=Ea();r.useState(null),r.useState(null),r.useState([]);const[ta,Pe]=r.useState(!1),[H,sa]=r.useState(null);r.useState(!1),r.useState(null),r.useState(null),r.useState(null);const[la,V]=r.useState({}),[ne,na]=r.useState({}),[x,Z]=r.useState(null),[h,J]=r.useState(null),[c,W]=r.useState(null),[ie,Ce]=r.useState(!1),ia=Ca(),[ra,Be]=r.useState(!1),[ca,re]=r.useState(!1),[O,ce]=r.useState(null),[de,Ee]=r.useState(!1),[j,B]=r.useState([]),[K,q]=r.useState(!1),[da,oe]=r.useState(!1),[me,Me]=r.useState(!1),[oa,X]=r.useState(!1),[F,Le]=r.useState("all"),[U,De]=r.useState("all"),[Oe,ma]=r.useState([]),[xe,Ke]=r.useState(!1),E=b.filter(a=>{var s,t,i,m,g,n;return((s=a.letter_number)==null?void 0:s.toLowerCase().includes(k.toLowerCase()))||((t=a.template_name)==null?void 0:t.toLowerCase().includes(k.toLowerCase()))||((m=(i=a.office)==null?void 0:i.namakantor)==null?void 0:m.toLowerCase().includes(k.toLowerCase()))||((n=(g=a.office)==null?void 0:g.kabkota)==null?void 0:n.toLowerCase().includes(k.toLowerCase()))}),he=(()=>{switch(y){case"with-employee":return E.filter(a=>![2,9].includes(a.template_id));case"without-employee":return E.filter(a=>[2,9].includes(a.template_id));default:return E}})(),Y=[...he].sort((a,s)=>{var m,g;let t=a[G]||"",i=s[G]||"";return G==="tanggal"&&(t=((m=a.form_data)==null?void 0:m.tanggal)||"",i=((g=s.form_data)==null?void 0:g.tanggal)||""),se==="asc"?String(t).localeCompare(String(i)):String(i).localeCompare(String(t))}).reduce((a,s)=>{var i,m;let t=((i=s.office)==null?void 0:i.namakantor)||((m=s.office)==null?void 0:m.kabkota);return!t&&s.office_id&&ne[s.office_id]&&(t=ne[s.office_id].namakantor||ne[s.office_id].kabkota),t||(t="Kantor Tidak Diketahui"),a[t]||(a[t]=[]),a[t].push(s),a},{}),Q=Object.entries(Y).filter(([a,s])=>k?a.toLowerCase().includes(k.toLowerCase())||s.some(t=>t.letter_number.toLowerCase().includes(k.toLowerCase())):!0);r.useEffect(()=>{v&&(R(!0),pe("/api/letters",v).then(a=>_e(a.letters||[])).catch(a=>{a.message&&(a.message.includes("Invalid or expired token")||a.message.includes("401"))?Be(!0):Ae("Gagal mengambil data surat")}).finally(()=>R(!1)))},[v]),r.useEffect(()=>{v&&pe("/api/offices",v).then(a=>{const s={},t=a.offices||[];t.forEach(i=>{s[i.id]={namakantor:i.namakantor,kabkota:i.kabkota}}),na(s),ma(t)}).catch(()=>{})},[v]);const xa=Array.from(new Set(b.map(a=>a.template_name))).sort(),ha=a=>b.filter(s=>s.status===a).length,ua=b.length,Fe=b.length>0?b.reduce((a,s)=>(a[s.template_name]=(a[s.template_name]||0)+1,a),{}):{};Object.keys(Fe).length>0&&Object.entries(Fe).sort(([,a],[,s])=>s-a)[0][0];const _=b.length===0?null:b.reduce((a,s)=>{const t=new Date(a.created_at||0);return new Date(s.created_at||0)>t?s:a}),ga=()=>{var i,m,g,n;if(!_)return"Tidak ada data";const a=p=>({"01":"KOTA MATARAM","02":"KABUPATEN LOMBOK BARAT","03":"KABUPATEN LOMBOK TENGAH","04":"KABUPATEN LOMBOK TIMUR","05":"KABUPATEN SUMBAWA","06":"KABUPATEN DOMPU","07":"KOTA MATARAM","08":"KABUPATEN BIMA","09":"KOTA BIMA",10:"KABUPATEN SUMBAWA BARAT",11:"KABUPATEN LOMBOK UTARA",12:"KABUPATEN LOMBOK TENGAH",13:"KABUPATEN LOMBOK TIMUR",14:"KABUPATEN SUMBAWA",15:"KABUPATEN DOMPU",16:"KABUPATEN BIMA",17:"KOTA BIMA",18:"KABUPATEN SUMBAWA BARAT",19:"KABUPATEN LOMBOK UTARA",20:"KABUPATEN LOMBOK TENGAH"})[p]||"Kantor Tidak Diketahui",s=((i=_.office)==null?void 0:i.namakantor)||((m=_.office)==null?void 0:m.kabkota)||a(((g=_.form_data)==null?void 0:g.kode_kabko)||((n=_.office)==null?void 0:n.kode_kabko)||"")||"Kantor Tidak Diketahui",t=_.created_at?new Date(_.created_at).toLocaleDateString("id-ID",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}):"Tidak diketahui";return`${s} (${t})`},pa=a=>a==="generated"?e.jsx(je,{className:"bg-green-100 text-green-700 border-green-200",children:"Generated"}):a==="signed"?e.jsx(je,{className:"bg-blue-100 text-blue-700 border-blue-200",children:"Signed"}):null,ja=a=>{var p;let s=a.form_data;if(typeof s=="string")try{s=JSON.parse(s)}catch{s={}}if(!s)return e.jsx("div",{className:"text-error",children:"Data surat tidak ditemukan"});const t=String(a.template_id),i=(a.letter_number||"").split("/"),m=(p=a.letter_number)==null?void 0:p.match(/^B-([^/]+)/),g={nosrt:s.nosrt||(m?m[1]:""),nosurat:s.nosurat||(m?m[1]:""),blnno:s.blnno||i[5]||"",blnnomor:s.blnnomor||i[5]||"",thnno:s.thnno||i[6]||"",tahunskrg:s.tahunskrg||i[6]||""},n={...s,...g};return a.template_id===2&&s.unitkerja&&(n.unitkerja=s.unitkerja),t==="1"?e.jsx(za,{data:n}):t==="2"?e.jsx(Ia,{data:n}):t==="3"?e.jsx(Ra,{data:n}):t==="4"?e.jsx(Ga,{data:n}):t==="5"?e.jsx(Ha,{data:n}):t==="6"?e.jsx(Va,{data:n}):t==="7"?e.jsx(Za,{data:n}):t==="8"?e.jsx(Ja,{data:n}):t==="9"?e.jsx(Wa,{data:n}):e.jsx("div",{className:"text-error",children:"Template tidak dikenali"})},fa=async a=>{if(!((l==null?void 0:l.role)==="admin"||a.created_by===(l==null?void 0:l.id))){S({title:"Tidak dapat menghapus surat",description:"Anda hanya dapat menghapus surat yang Anda buat sendiri.",variant:"destructive"});return}ce(a),re(!0)},Ue=a=>{Z(a),J(null),W(null)},ba=async()=>{if(!(!x||!h)&&!(x.template_id!==2&&x.template_id!==9&&!c)){Ce(!0);try{const a=x.form_data,s=x.template_id,t={...a,namapejabat:h.nama||"",nippejabat:h.nip||"",pangkatgolpejabat:h.pangkat_gol||"",jabatanpejabat:h.jabatan||""};switch(s!==2&&s!==9&&c&&(t.namapegawai=c.nama||"",t.nippegawai=c.nip||"",t.pangkatgolpegawai=c.pangkat_gol||"",t.jabatanpegawai=c.jabatan||""),(s===2||s===9)&&(delete t.namapegawai,delete t.nippegawai,delete t.pangkatgolpegawai,delete t.jabatanpegawai,delete t.ukerpegawai),s){case 1:t.ukerpejabat=h.unit_kerja||"",c&&(t.ukerpegawai=c.unit_kerja||"");break;case 2:break;case 3:c&&(t.tempattugas=c.tempat_tugas||"");break;case 4:c&&(t.unitkerja=c.unit_kerja||"");break;case 5:t.ukerpejabat=h.unit_kerja||"",c&&(t.tempattugas=c.tempat_tugas||"");break;case 6:t.ukerpejabat=h.unit_kerja||"",c&&(t.ukerpegawai=c.unit_kerja||"");break;case 7:c&&(t.tempattugas=c.tempat_tugas||"");break;case 8:c&&(t.tempattugas=c.tempat_tugas||"");break;case 9:t.ukerpejabat=h.unit_kerja||"";break}await Da(`/api/letters/${x.id}`,{form_data:t},v),await M(),Z(null),J(null),W(null),S({title:"Berhasil",description:"Data pejabat dan pegawai berhasil diperbarui"})}catch(a){console.error("Error updating letter:",a),S({title:"Error",description:"Gagal memperbarui data surat",variant:"destructive"})}finally{Ce(!1)}}},Na=(a,s)=>{B(s?t=>[...t,a]:t=>t.filter(i=>i!==a))},$e=a=>{if(q(a),a){const t=Q.flatMap(([i,m])=>m).filter(i=>(l==null?void 0:l.role)==="admin"||i.created_by===(l==null?void 0:l.id));B(t.map(i=>i.id))}else B([])},ze=()=>{if(j.length===0){S({title:"Tidak ada surat dipilih",description:"Pilih surat yang akan dihapus terlebih dahulu.",variant:"destructive"});return}oe(!0)},wa=async()=>{Me(!0);try{for(const a of j)await qe(`/api/letters/${a}`,v);S({title:"Surat berhasil dihapus",description:`${j.length} surat telah dihapus dari sistem.`,duration:3e3}),B([]),q(!1),oe(!1),await M(),V({}),k&&te("")}catch(a){S({title:"Gagal menghapus surat",description:a.message||"Terjadi kesalahan",variant:"destructive",duration:5e3})}finally{Me(!1)}},M=async()=>{R(!0);try{const a=await pe("/api/letters",v);_e(a.letters||[])}catch{Ae("Gagal mengambil data surat")}finally{R(!1)}},va=async()=>{if(O){Ee(!0);try{await qe(`/api/letters/${O.id}`,v),S({title:"Surat berhasil dihapus",description:"Surat telah dihapus dari sistem.",duration:3e3}),await M(),V({}),k&&te(""),re(!1),ce(null)}catch(a){S({title:"Gagal menghapus surat",description:a.message||"Terjadi kesalahan",variant:"destructive",duration:5e3})}finally{Ee(!1)}}},ka=async()=>{Ke(!0);try{let a=[...b];F!=="all"&&(a=a.filter(d=>d.template_name===F)),(l==null?void 0:l.role)==="admin"&&U!=="all"&&(a=a.filter(d=>d.office_id===U));const t=a.map(d=>{var ee,Ie;let f=d.form_data;if(typeof f=="string")try{f=JSON.parse(f)}catch{f={}}const w=d.template_id===9;return{NIP:w?"":d.recipient_employee_nip||"",Nama:w?"":f.namapegawai||((ee=d.recipient)==null?void 0:ee.nama)||"","No Surat":d.letter_number||"","Jenis Surat/Template":d.template_name||"","NIP Penandatangan":d.signing_official_nip||"","Nama Penandatangan":((Ie=d.signing_official)==null?void 0:Ie.nama)||"",_nipForSort:w?"ZZZ_NO_NIP":d.recipient_employee_nip||"ZZZ_NO_NIP",_templateId:d.template_id||0}}).sort((d,f)=>{const w=d._nipForSort.localeCompare(f._nipForSort);return w!==0?w:(d._templateId||0)-(f._templateId||0)}).map(({_nipForSort:d,_templateId:f,...w})=>w),i=Se.book_new(),m=Se.json_to_sheet(t),g=[{wch:20},{wch:40},{wch:50},{wch:50},{wch:20},{wch:40}];m["!cols"]=g,Se.book_append_sheet(i,m,"Data Surat");const n=new Date,p=`${n.getFullYear()}${String(n.getMonth()+1).padStart(2,"0")}${String(n.getDate()).padStart(2,"0")}_${String(n.getHours()).padStart(2,"0")}${String(n.getMinutes()).padStart(2,"0")}`;let u=`Export_Surat_${p}.xlsx`;if(F!=="all"&&(u=`Export_Surat_${F.replace(/[^a-zA-Z0-9]/g,"_")}_${p}.xlsx`),(l==null?void 0:l.role)==="admin"&&U!=="all"){const d=Oe.find(ee=>ee.id===U);u=`Export_Surat_${((d==null?void 0:d.kabkota)||(d==null?void 0:d.namakantor)||"Office").replace(/[^a-zA-Z0-9]/g,"_")}_${p}.xlsx`}et(i,u),S({title:"Export berhasil",description:`Data surat berhasil diekspor ke Excel (${a.length} data)`,duration:3e3}),X(!1)}catch(a){console.error("Error exporting Excel:",a),S({title:"Gagal export Excel",description:a.message||"Terjadi kesalahan saat mengekspor data",variant:"destructive",duration:5e3})}finally{Ke(!1)}},ue=(a,s)=>{V(t=>({...t,[a]:{...t[a]||{currentPage:1,pageSize:10},currentPage:s}}))},ya=(a,s)=>{V(t=>({...t,[a]:{...t[a]||{currentPage:1,pageSize:10},pageSize:s,currentPage:1}}))},Sa=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-green-100 to-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Pa,{className:"w-12 h-12 text-green-600"})}),e.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-red-600",children:"0"})})]}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Belum Ada Surat"}),e.jsx("p",{className:"text-gray-600 text-center max-w-md mb-6",children:"Riwayat surat masih kosong. Mulai buat surat pertama Anda untuk melihat data di sini."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(o,{asChild:!0,className:"bg-green-600 hover:bg-green-700",children:e.jsxs(We,{to:"/generator",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Buat Surat Baru"]})}),e.jsxs(o,{variant:"outline",onClick:M,disabled:N,children:[e.jsx(ae,{className:`w-4 h-4 mr-2 ${N?"animate-spin":""}`}),N?"Loading...":"Refresh Data"]})]})]});return N?e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(T,{className:"h-8 w-1/3 mb-4"}),e.jsx(T,{className:"h-6 w-1/2"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(T,{className:"h-32"}),e.jsx(T,{className:"h-32"}),e.jsx(T,{className:"h-32"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(T,{className:"h-16"}),e.jsx(T,{className:"h-16"}),e.jsx(T,{className:"h-16"})]})]}):Te?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(L,{className:"w-8 h-8 text-red-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Gagal Memuat Data"}),e.jsx("p",{className:"text-gray-600 mb-6",children:Te}),e.jsxs(o,{onClick:M,disabled:N,children:[e.jsx(ae,{className:`w-4 h-4 mr-2 ${N?"animate-spin":""}`}),N?"Loading...":"Coba Lagi"]})]})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Riwayat Surat"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Kelola dan pantau semua surat yang telah dibuat"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",onClick:M,disabled:N,children:[e.jsx(ae,{className:`w-4 h-4 mr-2 ${N?"animate-spin":""}`}),N?"Loading...":"Refresh"]}),e.jsxs(o,{variant:"outline",onClick:()=>X(!0),disabled:N||b.length===0,className:"border-green-200 text-green-700 hover:bg-green-50",children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Export Excel"]}),he.length>0&&(()=>{const a=he.filter(s=>(l==null?void 0:l.role)==="admin"||s.created_by===(l==null?void 0:l.id)).length;return a>0?e.jsx(o,{variant:K?"destructive":"outline",onClick:()=>$e(!K),className:K?"bg-red-600 hover:bg-red-700":"border-green-200 text-green-700 hover:bg-green-50",children:K?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Batal Pilih Semua"]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Pilih Semua (",a,")"]})}):null})(),(l==null?void 0:l.role)!=="user"&&e.jsx(o,{asChild:!0,className:"bg-green-600 hover:bg-green-700",children:e.jsxs(We,{to:"/generator",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Buat Surat Baru"]})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ge,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Ma,{placeholder:"Cari surat, nomor surat, atau kantor...",value:k,onChange:a=>te(a.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(we,{value:G,onValueChange:a=>ea(a),children:[e.jsx(ve,{className:"w-40",children:e.jsx(ke,{placeholder:"Urutkan"})}),e.jsxs(ye,{children:[e.jsx(C,{value:"letter_number",children:"Nomor Surat"}),e.jsx(C,{value:"template_name",children:"Template"}),e.jsx(C,{value:"tanggal",children:"Tanggal"}),e.jsx(C,{value:"status",children:"Status"})]})]}),e.jsx(o,{variant:"outline",onClick:()=>aa(se==="asc"?"desc":"asc"),children:se==="asc"?"↑":"↓"})]})]})]}),j.length>0&&e.jsx("div",{className:"mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-blue-600",children:j.length})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-blue-900",children:[j.length," surat dipilih"]}),e.jsx("p",{className:"text-sm text-blue-700",children:"Siap untuk dihapus"})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{B([]),q(!1)},className:"border-green-300 text-green-700 hover:bg-green-50",children:"Batal Pilih"}),e.jsxs(o,{variant:"destructive",size:"sm",onClick:ze,className:"bg-red-600 hover:bg-red-700 shadow-sm",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Hapus ",j.length," Surat"]})]})]})}),j.length>0&&e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(o,{size:"lg",onClick:ze,className:"bg-red-600 hover:bg-red-700 shadow-lg rounded-full w-16 h-16",children:e.jsx(D,{className:"w-6 h-6"})}),e.jsxs("div",{className:"bg-white rounded-full px-3 py-1 shadow-lg text-sm font-medium text-gray-700",children:[j.length," surat"]})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-1",children:e.jsxs("nav",{className:"flex space-x-1",children:[e.jsxs("button",{onClick:()=>le("all"),className:`flex-1 flex items-center justify-center py-3 px-4 rounded-md font-medium text-sm transition-all duration-200 ${y==="all"?"bg-green-50 text-green-700 border border-green-200 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Semua Surat",e.jsx("span",{className:"ml-2 bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs",children:E.length})]}),e.jsxs("button",{onClick:()=>le("with-employee"),className:`flex-1 flex items-center justify-center py-3 px-4 rounded-md font-medium text-sm transition-all duration-200 ${y==="with-employee"?"bg-green-50 text-green-700 border border-green-200 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Surat dengan Pegawai",e.jsx("span",{className:"ml-2 bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs",children:E.filter(a=>![2,9].includes(a.template_id)).length})]}),e.jsxs("button",{onClick:()=>le("without-employee"),className:`flex-1 flex items-center justify-center py-3 px-4 rounded-md font-medium text-sm transition-all duration-200 ${y==="without-employee"?"bg-orange-50 text-orange-700 border border-orange-200 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(_a,{className:"w-4 h-4 mr-2"}),"Analisis & Pernyataan",e.jsx("span",{className:"ml-2 bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs",children:E.filter(a=>[2,9].includes(a.template_id)).length})]})]})}),e.jsxs("div",{className:"mt-3 text-sm text-gray-600",children:[y==="all"&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(ge,{className:"w-4 h-4 mr-2 text-green-500"}),"Menampilkan semua surat yang telah dibuat dalam sistem"]}),y==="with-employee"&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(ge,{className:"w-4 h-4 mr-2 text-green-500"}),"Surat yang memerlukan data pegawai tertentu (Template 1, 3-8)"]}),y==="without-employee"&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(ge,{className:"w-4 h-4 mr-2 text-orange-500"}),"Surat analisis jabatan dan pernyataan (Template 2 & 9)"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(z,{children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Surat"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ua})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(L,{className:"w-6 h-6 text-blue-600"})})]})})}),e.jsx(z,{children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Generated"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:ha("generated")})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(Ta,{className:"w-6 h-6 text-green-600"})})]})})}),e.jsx(z,{children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Surat Terbaru"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:_?`${_.letter_number} - ${ga()}`:"Tidak ada data"})]}),e.jsx("div",{className:"w-12 h-12 bg-teal-100 rounded-lg flex items-center justify-center",children:e.jsx(He,{className:"w-6 h-6 text-teal-600"})})]})})})]}),b.length===0?e.jsx(z,{children:e.jsx(I,{className:"p-0",children:e.jsx(Sa,{})})}):e.jsxs(z,{children:[e.jsx(Oa,{children:e.jsxs(Ka,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5"}),y==="all"&&`Surat Berdasarkan Kantor (${Object.keys(Y).length} Kantor)`,y==="with-employee"&&`Surat dengan Pegawai (${Object.keys(Y).length} Kantor)`,y==="without-employee"&&`Surat Analisis & Pernyataan (${Object.keys(Y).length} Kantor)`]})}),e.jsx(I,{children:Q.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ge,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Tidak Ada Hasil"}),e.jsx("p",{className:"text-gray-600",children:"Coba ubah kata kunci pencarian Anda"})]}):e.jsx(qa,{type:"multiple",className:"space-y-2",children:Q.map(([a,s],t)=>{const i=la[a]||{currentPage:1,pageSize:10},m=Math.ceil(s.length/i.pageSize),g=s.slice((i.currentPage-1)*i.pageSize,i.currentPage*i.pageSize);return e.jsxs(Xa,{value:`office-${t}`,className:"border rounded-lg",children:[e.jsx(Ya,{className:"px-6 py-4 hover:bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Ve,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:a}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.length," surat"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(je,{variant:"secondary",children:s.length})})]})}),e.jsxs(Qa,{className:"px-6 pb-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-2 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:`pageSize-${t}`,className:"text-sm",children:"Tampilkan"}),e.jsx("select",{id:`pageSize-${t}`,value:i.pageSize,onChange:n=>ya(a,Number(n.target.value)),className:"border rounded px-2 py-1 text-sm",children:[10,20,50,100].map(n=>e.jsx("option",{value:n,children:n},n))}),e.jsx("span",{className:"text-sm",children:"data per halaman"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Menampilkan ",s.length===0?0:(i.currentPage-1)*i.pageSize+1,"–",Math.min(i.currentPage*i.pageSize,s.length)," dari ",s.length," surat"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Fa,{children:[e.jsx(Ua,{className:"bg-gray-50",children:e.jsxs(Xe,{children:[e.jsx(A,{className:"w-12",children:e.jsx("div",{className:"flex items-center gap-2",children:(()=>{const p=Q.flatMap(([u,d])=>d).filter(u=>(l==null?void 0:l.role)==="admin"||u.created_by===(l==null?void 0:l.id)).length;return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"checkbox",checked:K,onChange:u=>$e(u.target.checked),disabled:p===0,className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50"}),j.length>0&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:j.length})]})})()})}),e.jsx(A,{children:"No."}),e.jsx(A,{children:"Nomor Surat"}),e.jsx(A,{children:"Template"}),e.jsx(A,{children:"Pegawai"}),e.jsx(A,{children:"Tanggal"}),e.jsx(A,{children:"Status"}),e.jsx(A,{children:"Aksi"})]})}),e.jsx($a,{children:g.map((n,p)=>{let u=n.form_data;if(typeof u=="string")try{u=JSON.parse(u)}catch{u={}}const d=(l==null?void 0:l.role)==="admin"||n.created_by===(l==null?void 0:l.id),f=j.includes(n.id);return e.jsxs(Xe,{className:f?"bg-blue-50 border-blue-200":"",children:[e.jsx(P,{children:e.jsx("input",{type:"checkbox",checked:f,onChange:w=>Na(n.id,w.target.checked),disabled:!d,className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50"})}),e.jsx(P,{children:(i.currentPage-1)*i.pageSize+p+1}),e.jsx(P,{className:"font-mono text-sm",children:n.letter_number}),e.jsx(P,{children:n.template_name}),e.jsx(P,{children:n.template_id===9?e.jsx("span",{className:"text-gray-500",children:"Tanpa Pegawai"}):e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:u.namapegawai}),e.jsx("div",{className:"text-sm text-gray-500",children:n.recipient_employee_nip})]})}),e.jsx(P,{children:u.tanggal||"-"}),e.jsx(P,{children:pa(n.status)}),e.jsx(P,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{sa(n),Pe(!0)},children:e.jsx(He,{className:"w-4 h-4"})}),(l==null?void 0:l.role)!=="user"&&((l==null?void 0:l.role)==="admin"||n.created_by===(l==null?void 0:l.id))&&n.template_id!==2&&n.template_id!==9&&e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>Ue(n),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(Ze,{className:"w-4 h-4 mr-2"}),"Edit Pejabat & Pegawai"]}),(l==null?void 0:l.role)!=="user"&&((l==null?void 0:l.role)==="admin"||n.created_by===(l==null?void 0:l.id))&&(n.template_id===2||n.template_id===9)&&e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>Ue(n),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(Ze,{className:"w-4 h-4 mr-2"}),"Edit Pejabat"]}),(l==null?void 0:l.role)==="admin"&&((l==null?void 0:l.role)==="admin"||n.created_by===(l==null?void 0:l.id))&&e.jsx(o,{variant:"outline",size:"sm",onClick:()=>fa(n),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(D,{className:"w-4 h-4"})})]})})]},n.id)})})]})}),m>1&&e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[e.jsx(o,{size:"sm",variant:"outline",onClick:()=>ue(a,Math.max(1,i.currentPage-1)),disabled:i.currentPage===1,children:"Prev"}),Array.from({length:m},(n,p)=>p+1).map(n=>e.jsx(o,{size:"sm",variant:n===i.currentPage?"default":"outline",onClick:()=>ue(a,n),children:n},n)),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>ue(a,Math.min(m,i.currentPage+1)),disabled:i.currentPage===m,children:"Next"})]})]})]},t)})})})]}),e.jsx(fe,{open:ta,onOpenChange:Pe,children:e.jsxs(be,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(Ne,{children:"Preview Surat"}),H&&e.jsx(o,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>window.open(La(`/letters/${H.id}/preview`),"_blank"),children:"Open in New Tab"})]}),H&&e.jsx("div",{className:"mt-4",children:ja(H)})]})}),ra&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full flex flex-col items-center animate-fade-in",children:[e.jsx(Aa,{className:"w-16 h-16 text-yellow-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Sesi Berakhir"}),e.jsx("p",{className:"text-gray-600 mb-6 text-center",children:"Sesi Anda telah habis. Silakan login kembali untuk melanjutkan."}),e.jsx("button",{className:"w-full py-3 rounded-lg bg-green-600 hover:bg-green-700 text-white text-lg font-semibold shadow transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-400",onClick:()=>{localStorage.removeItem("token"),Be(!1),ia("/login",{replace:!0})},children:"Login Ulang"})]})}),ca&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full flex flex-col items-center animate-fade-in",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(D,{className:"w-8 h-8 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Hapus Surat"}),e.jsxs("p",{className:"text-gray-600 mb-6 text-center",children:["Apakah Anda yakin ingin menghapus surat ",e.jsx("strong",{children:O==null?void 0:O.letter_number}),"? Tindakan ini tidak dapat dibatalkan."]}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx(o,{variant:"outline",onClick:()=>{re(!1),ce(null)},disabled:de,className:"flex-1",children:"Batal"}),e.jsx(o,{onClick:va,disabled:de,className:"flex-1 bg-red-600 hover:bg-red-700",children:de?"Menghapus...":"Hapus"})]})]})}),da&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full flex flex-col items-center animate-fade-in",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(D,{className:"w-8 h-8 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Hapus Surat"}),e.jsxs("p",{className:"text-gray-600 mb-6 text-center",children:["Apakah Anda yakin ingin menghapus ",j.length," surat yang dipilih? Tindakan ini tidak dapat dibatalkan."]}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx(o,{variant:"outline",onClick:()=>{oe(!1),B([]),q(!1)},disabled:me,className:"flex-1",children:"Batal"}),e.jsx(o,{onClick:wa,disabled:me,className:"flex-1 bg-red-600 hover:bg-red-700",children:me?"Menghapus...":"Hapus"})]})]})}),x&&e.jsx(fe,{open:!!x,onOpenChange:a=>{a||Z(null)},children:e.jsxs(be,{className:"max-w-2xl",children:[e.jsx(Ne,{children:x.template_id===2||x.template_id===9?"Edit Pejabat":"Edit Pejabat & Pegawai"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx(Ye,{label:"Cari Pejabat",placeholder:"Masukkan nama atau NIP pejabat...",onSelect:J,selectedPegawai:h})}),x.template_id!==2&&x.template_id!==9&&e.jsx("div",{children:e.jsx(Ye,{label:"Cari Pegawai",placeholder:"Masukkan nama atau NIP pegawai...",onSelect:W,selectedPegawai:c})})]}),e.jsxs("div",{className:"space-y-4",children:[h&&e.jsxs("div",{className:"border rounded-lg p-4 bg-blue-50",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 flex items-center",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Preview Pejabat"]}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>J(null),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-100",children:e.jsx(Je,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Nama:"})," ",h.nama]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"NIP:"})," ",h.nip]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Pangkat/Gol:"})," ",h.pangkat_gol]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Jabatan:"})," ",h.jabatan]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Unit Kerja:"})," ",h.unit_kerja]})]})]}),c&&x.template_id!==2&&x.template_id!==9&&e.jsxs("div",{className:"border rounded-lg p-4 bg-green-50",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("h4",{className:"font-semibold text-green-900 flex items-center",children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Preview Pegawai"]}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>W(null),className:"text-green-600 hover:text-green-700 hover:bg-green-100",children:e.jsx(Je,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Nama:"})," ",c.nama]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"NIP:"})," ",c.nip]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Pangkat/Gol:"})," ",c.pangkat_gol]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Jabatan:"})," ",c.jabatan]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Unit Kerja:"})," ",c.unit_kerja]}),c.tempat_tugas&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Tempat Tugas:"})," ",c.tempat_tugas]})]})]}),!h&&(x.template_id===2||x.template_id===9)&&e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 text-center text-gray-500",children:[e.jsx($,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"Pilih pejabat untuk melihat preview"})]}),!h&&!c&&x.template_id!==2&&x.template_id!==9&&e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 text-center text-gray-500",children:[e.jsx($,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"Pilih pejabat dan pegawai untuk melihat preview"})]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-4",children:[e.jsx(o,{variant:"outline",onClick:()=>Z(null),disabled:ie,children:"Batal"}),e.jsx(o,{onClick:ba,disabled:ie||!h||x.template_id!==2&&x.template_id!==9&&!c,className:"bg-green-600 hover:bg-green-700 text-white",children:ie?"Menyimpan...":"Simpan"})]})]})}),e.jsx(fe,{open:oa,onOpenChange:X,children:e.jsxs(be,{className:"max-w-2xl",children:[e.jsx(Ne,{children:"Export Data ke Excel"}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Qe,{htmlFor:"template-filter",children:"Filter by Jenis Surat/Template"}),e.jsxs(we,{value:F,onValueChange:Le,children:[e.jsx(ve,{id:"template-filter",children:e.jsx(ke,{placeholder:"Pilih template"})}),e.jsxs(ye,{children:[e.jsx(C,{value:"all",children:"Semua Template"}),xa.map(a=>e.jsx(C,{value:a,children:a},a))]})]})]}),(l==null?void 0:l.role)==="admin"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Qe,{htmlFor:"office-filter",children:"Filter by Kabupaten/Kota"}),e.jsxs(we,{value:U,onValueChange:De,children:[e.jsx(ve,{id:"office-filter",children:e.jsx(ke,{placeholder:"Pilih kabupaten/kota"})}),e.jsxs(ye,{children:[e.jsx(C,{value:"all",children:"Semua Kabupaten/Kota"}),Oe.map(a=>e.jsx(C,{value:a.id,children:a.kabkota||a.namakantor||a.name||"Kantor Tidak Diketahui"},a.id))]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(o,{variant:"outline",onClick:()=>{X(!1),Le("all"),De("all")},disabled:xe,children:"Batal"}),e.jsx(o,{onClick:ka,disabled:xe,className:"bg-green-600 hover:bg-green-700",children:xe?e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-4 h-4 mr-2 animate-spin"}),"Mengekspor..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Export"]})})]})]})]})})]})};export{gt as default};
//# sourceMappingURL=Letters-DVwIpKHC.js.map
