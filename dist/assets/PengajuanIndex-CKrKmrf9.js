import{j as e,F as L,aN as ya,as as Me,a9 as wa,aO as te,aP as Le,E as Ee,S as Je,a4 as E,aE as V,au as ze,aL as pe,p as je,aa as be,at as Oe,al as Ge}from"./ui-vendor-DQXcJUOU.js";import{e as Na,h as Sa,r as o,c as _a}from"./react-vendor-DheTkQGW.js";import{C as Da,a as Ca,b as Ta,c as Fa}from"./card-CIXpXv1o.js";import{u as Pa,d as Aa,a as He,B as u,I as $a,b as se,p as We,q as Ve,r as qe,v as f,D as Ka,e as Ba,f as Ua,g as Ia,l as Ra,j as Ma}from"./index-D6E2VSYf.js";import{S as ne,a as ie,b as le,c as re,d as N}from"./select-BlUcE-vT.js";import{T as fe,a as ve,b as J,c,d as ke,e as g}from"./table-dFGBjE7J.js";import{A as La,a as Ea,b as Ja,c as za}from"./accordion-B0QrDSHO.js";import{A as Oa,a as Ga,b as Ha,c as Wa,d as Va,e as qa,g as Ya,f as Qa}from"./alert-dialog-D274NJeZ.js";import{L as ye}from"./label-BknveL_L.js";import{T as Xa}from"./textarea-B2rTZJ3c.js";import{S as Za}from"./shepherd-lljao8WZ.js";const ut=()=>{const F=Na(),[Ye,we]=Sa(),{user:i,token:q,isAuthenticated:U}=Pa(),{toast:S}=Aa(),[w,Qe]=o.useState([]),[z,Ne]=o.useState(!0),[Se,Y]=o.useState(null),I=(a,s)=>{const t=Ye.get(a);if(t!==null)return t;const n=sessionStorage.getItem(`pengajuan_filter_${a}`);return n||s},[j,Xe]=o.useState(()=>I("search","")),[x,_e]=o.useState(()=>I("status","all")),[v,Ze]=o.useState(()=>I("created_by","all")),[k,ea]=o.useState(()=>I("jenis_jabatan","all")),[r,p]=o.useState(()=>{const a=I("page","1");return parseInt(a,10)||1}),[P,aa]=o.useState(1),[_,ta]=o.useState(0),[sa,Q]=o.useState(!1),[De,oe]=o.useState(null),[de,Ce]=o.useState(!1),[na,O]=o.useState(!1),[A,X]=o.useState(null),[G,H]=o.useState(""),[Te,W]=o.useState(""),[Fe,Pe]=o.useState(!1),[D,ia]=o.useState({users:[],statuses:[],jenisJabatan:[]}),[C,la]=o.useState(()=>I("kabupaten_group","all")),[Z,Ae]=o.useState({}),$=o.useRef(null),K=50,d=(i==null?void 0:i.role)==="admin",h=(i==null?void 0:i.role)==="user",$e=(i==null?void 0:i.role)==="bimas",Ke=(i==null?void 0:i.role)==="kanwil",ra=(i==null?void 0:i.role)==="admin_wilayah",Be=h||$e,ce=d||h||$e,R=_a.useMemo(()=>{if(!ce)return{};if(Object.keys(Z).length>0)return console.log("ðŸ” Using server grouping:",Z),Z;if(!w||w.length===0)return{};console.log("ðŸ” Using client grouping, pengajuanList length:",w.length);const a=w.reduce((s,t)=>{var l;const n=t.office&&(t.office.kabkota||t.office.name)||t.pegawai&&t.pegawai.induk_unit||((l=t.pegawai)==null?void 0:l.unit_kerja)||"Lainnya";return s[n]||(s[n]=[]),s[n].push(t),s},{});return console.log("ðŸ” Client grouped result:",a),a},[ce,Z,w]),ue=o.useCallback(()=>{if(!h){S({title:"Tutorial khusus pengguna tracking",description:"Menu ini hanya tersedia untuk role user yang fokus tracking."});return}if(z){S({title:"Tunggu sebentar",description:"Kami masih menyiapkan data pengajuan untuk tur."});return}if(Object.values(R).reduce((n,l)=>n+l.length,0)===0){S({title:"Data belum tersedia",description:"Tidak ada pengajuan untuk ditampilkan. Coba sesuaikan filter atau kembali lagi nanti.",variant:"destructive"});return}$.current&&($.current.cancel(),$.current=null),sessionStorage.removeItem("pending_pengajuan_list_tour"),setTimeout(()=>{const n=document.querySelector('[data-tour-id="pengajuan-accordion"] button');n&&n.getAttribute("aria-expanded")!=="true"&&n.click()},0);const s=new Za.Tour({useModalOverlay:!0,defaultStepOptions:{cancelIcon:{enabled:!0},classes:"bg-white shadow-xl rounded-lg border border-gray-200 text-gray-800",scrollTo:{behavior:"smooth",block:"center"}}}),t=n=>{const l=[{text:"Lewati",classes:"shepherd-button-secondary text-gray-500",action:async()=>{s.cancel()}}];return n!=null&&n.showBack&&l.push({text:"Kembali",classes:"shepherd-button-secondary",action:async()=>{s.back()}}),l.push({text:n!=null&&n.isFinal?"Selesai":"Lanjut",classes:"shepherd-button-primary bg-green-600 text-white hover:bg-green-700",action:async()=>{n!=null&&n.isFinal?s.complete():s.next()}}),l};s.addStep({id:"intro",title:"Daftar Pengajuan",text:"Halaman ini menampilkan seluruh pengajuan dengan grouping kabupaten/kota agar Anda mudah memilih dokumen mana yang akan dicek.",attachTo:{element:'[data-tour-id="pengajuan-header"]',on:"bottom"},buttons:t()}),s.addStep({id:"filters",title:"Filter & Pencarian",text:"Gunakan pencarian dan filter status untuk mempersempit daftar. Sistem otomatis menyimpan filter Anda.",attachTo:{element:'[data-tour-id="pengajuan-filter"]',on:"top"},buttons:t({showBack:!0})}),document.querySelector('[data-tour-id="pengajuan-jabatan-filter"]')&&s.addStep({id:"jabatan",title:"Filter Jenis Jabatan",text:"Khusus role user, filter ini membantu fokus pada jabatan tertentu (misal Guru, Fungsional).",attachTo:{element:'[data-tour-id="pengajuan-jabatan-filter"]',on:"bottom"},buttons:t({showBack:!0})}),s.addStep({id:"accordion",title:"Kelompok Kabupaten/Kota",text:"Setiap Kanwil memuat daftar kabupaten/kota. Klik untuk membuka tabel pengajuan di dalamnya.",attachTo:{element:'[data-tour-id="pengajuan-accordion"]',on:"top"},buttons:t({showBack:!0})}),s.addStep({id:"row-action",title:"Masuk ke Detail Pengajuan",text:"Gunakan tombol aksi â€œ...â€ lalu pilih Lihat Detail untuk membuka dokumen dan catatan lengkap.",attachTo:{element:'[data-tour-id="pengajuan-row-action"]',on:"left"},buttons:t({showBack:!0})}),s.addStep({id:"finish",title:"Siap ke Halaman Detail",text:"Setelah menemukan pengajuan yang ingin dicek, buka detailnya. Kami akan menampilkan tur lanjutan otomatis ketika detail terbuka.",buttons:t({showBack:!0,isFinal:!0})}),s.on("complete",()=>{sessionStorage.setItem("pending_pengajuan_detail_tour","true"),sessionStorage.removeItem("pending_pengajuan_list_tour"),S({title:"Langkah berikutnya",description:"Buka salah satu pengajuan lalu klik Lihat Detail untuk melihat tur lanjutan."})}),s.on("cancel",()=>{sessionStorage.removeItem("pending_pengajuan_list_tour"),sessionStorage.removeItem("pending_pengajuan_detail_tour")}),s.start(),$.current=s},[h,z,R,S]);o.useEffect(()=>{!z&&h&&sessionStorage.getItem("pending_pengajuan_list_tour")==="true"&&ue()},[z,h,ue]),o.useEffect(()=>()=>{$.current&&($.current.cancel(),$.current=null)},[]),o.useEffect(()=>{if(!U)return;const a=new URLSearchParams;j&&a.set("search",j),x!=="all"&&a.set("status",x),v!=="all"&&a.set("created_by",v),k!=="all"&&a.set("jenis_jabatan",k),C!=="all"&&a.set("kabupaten_group",C),r>1&&a.set("page",r.toString()),we(a,{replace:!0}),sessionStorage.setItem("pengajuan_filter_search",j),sessionStorage.setItem("pengajuan_filter_status",x),sessionStorage.setItem("pengajuan_filter_created_by",v),sessionStorage.setItem("pengajuan_filter_jenis_jabatan",k),sessionStorage.setItem("pengajuan_filter_kabupaten_group",C),sessionStorage.setItem("pengajuan_filter_page",r.toString())},[U,j,x,v,k,C,r,we]),o.useEffect(()=>{if(!U){F("/");return}h&&x!=="final_approved"&&_e("final_approved"),he()},[U,F,r,x,v,k,C,h,j]),o.useEffect(()=>{U&&oa()},[U,k,x,v,j]);const he=async()=>{var a,s,t;try{Ne(!0);const n=new URLSearchParams({page:r.toString(),limit:K.toString(),...x!=="all"&&{status:x},...k!=="all"&&{jenis_jabatan:k},...j&&{search:j},...d&&v!=="all"&&{created_by:v},...(d||h)&&C!=="all"&&{kabupaten_group:C},...Ke&&(i==null?void 0:i.id)&&{created_by:i.id}}),l=await He(`/api/pengajuan?${n}`,q);if(l.success){if(Qe(l.data),d){const T=l.grouped_by_kabkota;console.log("ðŸ” Frontend received grouped data:",T),console.log("ðŸ” Frontend received data length:",(a=l.data)==null?void 0:a.length),Ae(T||{})}const y=((s=l.pagination)==null?void 0:s.totalPages)||1,m=((t=l.pagination)==null?void 0:t.total)||0;aa(y),ta(m)}else Y(l.message||"Gagal mengambil data pengajuan")}catch(n){console.error("Error fetching pengajuan data:",n),Y("Terjadi kesalahan saat mengambil data pengajuan")}finally{Ne(!1)}},oa=async()=>{var a,s,t;try{console.log("ðŸ” Fetching filter options...");const n=new URLSearchParams;k!=="all"&&n.set("jenis_jabatan",k),x!=="all"&&n.set("status",x),d&&v!=="all"&&n.set("created_by",v),j&&n.set("search",j);const l=n.toString(),y=l?`/api/pengajuan/filter-options?${l}`:"/api/pengajuan/filter-options",m=await He(y,q);console.log("ðŸ” Filter options response:",m),m.success?(ia(m.data),console.log("ðŸ” Filter options set:",m.data),console.log("ðŸ” Kabupaten groups:",(a=m.data)==null?void 0:a.kabupatenGroups),console.log("ðŸ” Kabupaten groups length:",(t=(s=m.data)==null?void 0:s.kabupatenGroups)==null?void 0:t.length)):console.error("ðŸ” Filter options failed:",m.message)}catch(n){console.error("Error fetching filter options:",n)}},da=a=>{Xe(a),p(1)},ca=a=>{h||(_e(a),p(1))},ua=a=>{Ze(a),p(1)},ha=a=>{ea(a),p(1)},ma=a=>{la(a),p(1)},M=a=>{F(`/pengajuan/${a}`)},ga=async()=>{if(De)try{Ce(!0);const a=await Ra(`/api/pengajuan/${De}`,q);a.success?(he(),Q(!1),oe(null)):Y(a.message||"Gagal menghapus pengajuan")}catch(a){console.error("Error deleting pengajuan:",a),Y("Terjadi kesalahan saat menghapus pengajuan")}finally{Ce(!1)}},xa=async()=>{if(!(!A||!G)){Pe(!0);try{const a=await Ma(`/api/pengajuan/${A.id}/update-status`,{status:G,reason:Te},q);a.success?(S({title:"Berhasil",description:"Status pengajuan berhasil diubah"}),O(!1),X(null),H(""),W(""),he()):S({title:"Error",description:a.message||"Gagal mengubah status",variant:"destructive"})}catch(a){console.error("Error updating status:",a),S({title:"Error",description:"Terjadi kesalahan saat mengubah status",variant:"destructive"})}finally{Pe(!1)}}},me=(a,s)=>{const t=(m,T)=>{var ee;return m!=="submitted"||!T?!1:((ee=T.files)==null?void 0:ee.some(ge=>ge.file_category==="admin_wilayah"))||!1},l={draft:{label:"Draft",className:"bg-gray-100 text-gray-800 hover:bg-gray-200",icon:Ge},submitted:{label:t(a,s)?"Diajukan Admin Wilayah":"Diajukan",className:t(a,s)?"bg-blue-200 text-blue-800 hover:bg-blue-300":"bg-blue-100 text-blue-800 hover:bg-blue-200",icon:L},approved:{label:"Disetujui",className:"bg-green-100 text-green-800 hover:bg-green-200",icon:E},rejected:{label:"Ditolak Admin Wilayah",className:"bg-red-100 text-red-800 hover:bg-red-200",icon:V},resubmitted:{label:"Diajukan Ulang",className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-200",icon:Ge},admin_wilayah_approved:{label:"Disetujui Admin Wilayah",className:"bg-green-200 text-green-800 hover:bg-green-300",icon:E},admin_wilayah_rejected:{label:"Ditolak Superadmin",className:"bg-red-200 text-red-800 hover:bg-red-300",icon:V},admin_wilayah_submitted:{label:"Diajukan Admin Wilayah",className:"bg-blue-200 text-blue-800 hover:bg-blue-300",icon:L},kanwil_submitted:{label:"Diajukan Kanwil",className:"bg-purple-200 text-purple-800 hover:bg-purple-300",icon:L},kanwil_approved:{label:"Disetujui Kanwil",className:"bg-purple-300 text-purple-900 hover:bg-purple-400",icon:E},final_approved:{label:"Final Approved",className:"bg-green-600 text-white",icon:E},final_rejected:{label:"Final Rejected",className:"bg-red-600 text-white",icon:V}}[a]||{label:a,className:"bg-gray-100 text-gray-800",icon:L},y=l.icon;return e.jsxs(se,{className:l.className,children:[e.jsx(y,{className:"h-3 w-3 mr-1"}),l.label]})},Ue=a=>({guru:"Guru",eselon_iv:"Eselon IV",fungsional:"Fungsional",pelaksana:"Pelaksana"})[a]||a,Ie=a=>new Date(a).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),Re=()=>{const a=Object.keys(R).length>0?R:w.reduce((s,t)=>{var l;const n=t.office&&(t.office.kabkota||t.office.name)||t.pegawai&&t.pegawai.induk_unit||((l=t.pegawai)==null?void 0:l.unit_kerja)||"Lainnya";return s[n]||(s[n]=[]),s[n].push(t),s},{});return Object.entries(a).map(([s,t])=>({kabkota:s,total:t.length}))},pa=(a,s)=>{const t=URL.createObjectURL(a),n=document.createElement("a");n.href=t,n.download=s,document.body.appendChild(n),n.click(),n.remove(),URL.revokeObjectURL(t)},ja=()=>{const a=Re(),s=new Date,n=`Rekap-final_approved-per-kabkota-${`${s.getFullYear()}${String(s.getMonth()+1).padStart(2,"0")}${String(s.getDate()).padStart(2,"0")}`}.xls`,l=`
      <html>
      <head><meta charset="UTF-8" /></head>
      <body>
        <table border="1">
          <thead>
            <tr><th>Kab/Kota</th><th>Jumlah Pengajuan Final Approved</th></tr>
          </thead>
          <tbody>
            ${a.map(m=>`<tr><td>${m.kabkota}</td><td>${m.total}</td></tr>`).join("")}
          </tbody>
        </table>
      </body>
      </html>`,y=new Blob([l],{type:"application/vnd.ms-excel"});pa(y,n)},ba=()=>{const a=Re().sort((b,B)=>B.total-b.total),s=a.reduce((b,B)=>b+B.total,0),t=Math.max(1,...a.map(b=>b.total)),n=a.length,l=new Date,y=l.toLocaleString("id-ID",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),T=`Rekap-disetujui-kanwil-per-kabkota-${`${l.getFullYear()}${String(l.getMonth()+1).padStart(2,"0")}${String(l.getDate()).padStart(2,"0")}`}.pdf`,ee=(i==null?void 0:i.full_name)||(i==null?void 0:i.email)||"Admin Pusat",ge=a.slice(0,5),xe=window.open("","_blank");xe&&(xe.document.write(`
      <html>
        <head>
          <meta charset="UTF-8" />
          <title>${T}</title>
          <style>
            @page { size: A4; margin: 18mm 14mm; }
            * { box-sizing: border-box; }
            body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; color: #111827; }
            .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
            .title { font-size: 18px; font-weight: 700; }
            .meta { font-size: 12px; color: #4b5563; }
            .summary { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 8px; margin: 12px 0 16px; }
            .card { border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px; }
            .card h3 { font-size: 12px; color: #6b7280; margin: 0 0 4px; font-weight: 600; }
            .card .value { font-size: 20px; font-weight: 700; color: #111827; }
            table { border-collapse: collapse; width: 100%; margin-top: 4px; }
            th, td { border: 1px solid #e5e7eb; padding: 8px 10px; font-size: 12px; }
            th { background: #f9fafb; text-align: left; }
            tfoot td { font-weight: 700; background: #f3f4f6; }
            .row { display: flex; align-items: center; gap: 10px; }
            .bar { height: 8px; background: #d1fae5; border-radius: 4px; overflow: hidden; }
            .bar > span { display: block; height: 100%; background: #10b981; }
            .note { margin-top: 12px; font-size: 11px; color: #6b7280; }
            .section-title { margin-top: 16px; font-size: 14px; font-weight: 700; }
          </style>
        </head>
        <body>
          <div class="header">
            <div>
              <div class="title">Rekap Pengajuan Telah Disetujui Kanwil per Kab/Kota</div>
              <div class="meta">Dihasilkan: ${y} â€¢ Dibuat oleh: ${ee}</div>
            </div>
          </div>

          <div class="summary">
            <div class="card">
              <h3>Total Telah Disetujui Kanwil</h3>
              <div class="value">${s}</div>
            </div>
            <div class="card">
              <h3>Jumlah Kab/Kota</h3>
              <div class="value">${n}</div>
            </div>
            <div class="card">
              <h3>Top Kab/Kota</h3>
              <div style="font-size:12px; color:#111827; line-height:1.4;">
                ${ge.map((b,B)=>`${B+1}. ${b.kabkota} (${b.total})`).join("<br/>")||"-"}
              </div>
            </div>
          </div>

          <div class="section-title">Tabel Rekap</div>
          <table>
            <thead>
              <tr>
                <th style="width:36px;">No</th>
                <th>Kab/Kota</th>
                <th style="width:110px;">Jumlah</th>
                <th style="width:80px;">Persen</th>
                <th>Visual</th>
              </tr>
            </thead>
            <tbody>
              ${a.map((b,B)=>{const fa=s>0?Math.round(b.total/s*1e3)/10:0,va=Math.round(b.total/t*100),ae=140,ka=Math.max(1,Math.round(va/100*ae));return`
                  <tr>
                    <td>${B+1}</td>
                    <td>${b.kabkota}</td>
                    <td style="text-align:right; font-variant-numeric: tabular-nums;">${b.total}</td>
                    <td style="text-align:right; font-variant-numeric: tabular-nums;">${fa.toFixed(1)}%</td>
                    <td>
                      <svg width="${ae}" height="10" viewBox="0 0 ${ae} 10" xmlns="http://www.w3.org/2000/svg">
                        <rect x="0" y="0" width="${ae}" height="10" fill="#E5F6F1" stroke="#D1D5DB" />
                        <rect x="0" y="0" width="${ka}" height="10" fill="#10B981" />
                      </svg>
                    </td>
                  </tr>
                `}).join("")}
            </tbody>
            <tfoot>
              <tr>
                <td colspan="2">Total</td>
                <td style="text-align:right; font-variant-numeric: tabular-nums;">${s}</td>
                <td></td>
                <td></td>
              </tr>
            </tfoot>
          </table>

          <div class="note">Catatan: Laporan ini menampilkan pengajuan yang <strong>telah disetujui Kanwil</strong>.</div>

          <script>
            window.onload = function() { window.print(); };
          <\/script>
        </body>
      </html>
    `),xe.document.close())};return console.log("ðŸ” Debug PengajuanIndex:",{userRole:i==null?void 0:i.role,isAdmin:d,userEmail:i==null?void 0:i.email}),e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs(Da,{children:[e.jsx(Ca,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Ta,{"data-tour-id":"pengajuan-header",className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5"}),"Daftar Pengajuan Mutasi PNS"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:d?"Semua pengajuan mutasi PNS":h?"Semua pengajuan berstatus final_approved (read-only)":Ke?"Pengajuan mutasi PNS Anda (Kanwil)":"Pengajuan mutasi PNS Anda"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h&&e.jsxs(u,{variant:"outline",onClick:ue,className:"border-green-200 text-green-700",children:[e.jsx(ya,{className:"h-4 w-4 mr-2"}),"Mulai Tutorial"]}),h&&e.jsxs(e.Fragment,{children:[e.jsx(u,{onClick:ja,className:"bg-green-600 hover:bg-green-700 text-white",children:"Export Excel"}),e.jsx(u,{onClick:ba,className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Export PDF"})]}),!Be&&e.jsxs(u,{onClick:()=>F("/pengajuan/select"),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Tambah Pengajuan"]})]})]})}),e.jsxs(Fa,{children:[Se&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600",children:Se})}),e.jsxs("div",{className:"flex flex-col gap-4 mb-6","data-tour-id":"pengajuan-filter",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(wa,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx($a,{placeholder:"Cari berdasarkan nama pegawai, jabatan, atau jenis jabatan...",value:j,onChange:a=>da(a.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-gray-400"}),e.jsxs(ne,{value:x,onValueChange:ca,children:[e.jsx(ie,{className:"w-48",children:e.jsx(le,{placeholder:"Filter Status"})}),e.jsxs(re,{children:[e.jsx(N,{value:"all",children:"Semua Status"}),D.statuses.filter(a=>a.count>0).map(a=>e.jsxs(N,{value:a.value,children:[a.label," (",a.count,")"]},a.value))]})]})]}),(h||d||ra)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-gray-400"}),e.jsxs(ne,{value:k,onValueChange:ha,children:[e.jsx(ie,{className:"w-48","data-tour-id":"pengajuan-jabatan-filter",children:e.jsx(le,{placeholder:"Filter Jenis Jabatan"})}),e.jsxs(re,{children:[e.jsx(N,{value:"all",children:"Semua Jenis Jabatan"}),D.jenisJabatan.filter(a=>a.count>0).map(a=>e.jsxs(N,{value:a.value,children:[a.label," (",a.count,")"]},a.value))]})]})]}),(d||h)&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-gray-400"}),e.jsxs(ne,{value:C,onValueChange:ma,children:[e.jsx(ie,{className:"w-48",children:e.jsx(le,{placeholder:"Filter Pulau/Wilayah"})}),e.jsxs(re,{children:[e.jsx(N,{value:"all",children:"Semua Pulau/Wilayah"}),D.kabupatenGroups&&D.kabupatenGroups.length>0?D.kabupatenGroups.filter(a=>a.count>0||a.groupName==="Sumbawa").map(a=>e.jsxs(N,{value:a.groupName,children:[a.groupName," (",a.count,")"]},a.groupName)):e.jsx(N,{value:"all",disabled:!0,children:"Memuat data..."})]})]})]}),d&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-4 w-4 text-gray-400"}),e.jsxs(ne,{value:v,onValueChange:ua,children:[e.jsx(ie,{className:"w-48",children:e.jsx(le,{placeholder:"Filter Pembuat"})}),e.jsxs(re,{children:[e.jsx(N,{value:"all",children:"Semua Pembuat"}),D.users.map(a=>e.jsx(N,{value:a.id,children:a.full_name||a.email||"Unknown User"},a.id))]})]})]})]})]}),ce&&Object.keys(R).length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Tergabung berdasarkan kabupaten/kota"}),e.jsx(La,{type:"multiple",className:"w-full","data-tour-id":"pengajuan-accordion",children:Object.entries(R).map(([a,s])=>e.jsxs(Ea,{value:a,className:"border rounded-lg",children:[e.jsx(Ja,{className:"px-4 py-3 hover:no-underline",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"font-medium",children:a}),e.jsx(se,{variant:"secondary",className:"ml-2",children:s.length})]})}),e.jsx(za,{className:"px-0",children:e.jsx("div",{className:"border-t",children:e.jsxs(fe,{children:[e.jsx(ve,{children:e.jsxs(J,{children:[e.jsx(c,{children:"Pegawai"}),e.jsx(c,{children:"Jenis Jabatan"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Jumlah Dokumen"}),d&&e.jsx(c,{children:"Pembuat"}),e.jsx(c,{children:"Tanggal Dibuat"}),e.jsx(c,{className:"text-right",children:"Aksi"})]})}),e.jsx(ke,{children:s.map(t=>e.jsxs(J,{className:"hover:bg-gray-50",children:[e.jsx(g,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.pegawai.nama}),e.jsx("div",{className:"text-sm text-gray-500",children:t.pegawai.jabatan})]})}),e.jsx(g,{children:e.jsx(se,{variant:"outline",children:Ue(t.jenis_jabatan)})}),e.jsx(g,{children:me(t.status,t)}),e.jsx(g,{children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-sm",children:t.files.length})})}),d&&e.jsx(g,{children:e.jsx("div",{className:"text-sm text-gray-600",children:(()=>{var l;const n=D.users.find(y=>y.id===t.created_by);return n?n.full_name||n.email||"Unknown User":(l=t.created_by)!=null&&l.includes("@")?t.created_by:"Unknown User"})()})}),e.jsx(g,{children:e.jsx("div",{className:"text-sm text-gray-600",children:Ie(t.created_at)})}),e.jsx(g,{className:"text-right",children:e.jsxs(We,{children:[e.jsx(Ve,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"sm","data-tour-id":"pengajuan-row-action",children:e.jsx(Le,{className:"h-4 w-4"})})}),e.jsxs(qe,{align:"end",children:[e.jsxs(f,{onClick:()=>M(t.id),children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Lihat Detail"]}),d&&e.jsxs(f,{onClick:()=>{X(t),H(t.status),W(""),O(!0)},children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Ubah Status"]}),d&&t.status==="admin_wilayah_submitted"&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{onClick:()=>M(t.id),children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Setujui"]}),e.jsxs(f,{onClick:()=>M(t.id),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Tolak"]})]}),d&&e.jsxs(f,{onClick:()=>{oe(t.id),Q(!0)},className:"text-red-600",children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Hapus"]})]})]})})]},t.id))})]})})})]},a))}),P>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Menampilkan ",(r-1)*K+1," sampai ",Math.min(r*K,_)," dari ",_," pengajuan"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>p(r-1),disabled:r===1,children:[e.jsx(pe,{className:"h-4 w-4"}),"Sebelumnya"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:P},(a,s)=>s+1).map(a=>e.jsx(u,{variant:r===a?"default":"outline",size:"sm",onClick:()=>p(a),className:`w-8 h-8 p-0 ${r===a?"bg-green-600 hover:bg-green-700 text-white border-green-600":"bg-white hover:bg-green-50 text-gray-700 border-gray-300 hover:border-green-300"}`,children:a},a))}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>p(r+1),disabled:r===P,children:["Selanjutnya",e.jsx(je,{className:"h-4 w-4"})]})]})]})]}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:z?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(be,{className:"h-8 w-8 animate-spin mr-2 text-green-600"}),e.jsx("span",{children:"Memuat data pengajuan..."})]}):w.length===0&&_===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(L,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-2",children:j||x!=="all"?"Tidak ada pengajuan yang sesuai dengan filter":"Belum ada pengajuan"}),!j&&x==="all"&&(i==null?void 0:i.role)!=="user"&&e.jsxs(u,{onClick:()=>F("/pengajuan/select"),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"Buat Pengajuan Pertama"]})]}):w.length===0&&_>0?e.jsxs(e.Fragment,{children:[e.jsxs(fe,{children:[e.jsx(ve,{children:e.jsxs(J,{children:[e.jsx(c,{children:"Pegawai"}),e.jsx(c,{children:"Jenis Jabatan"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Jumlah Dokumen"}),e.jsx(c,{children:"Tanggal Dibuat"}),e.jsx(c,{children:"Aksi"})]})}),e.jsx(ke,{children:e.jsx(J,{children:e.jsx(g,{colSpan:6,className:"text-center py-8 text-gray-500",children:"Tidak ada data di halaman ini"})})})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Menampilkan ",(r-1)*K+1," sampai ",Math.min(r*K,_)," dari ",_," pengajuan"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>p(r-1),disabled:r===1,children:[e.jsx(pe,{className:"h-4 w-4"}),"Sebelumnya"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:P},(a,s)=>s+1).map(a=>e.jsx(u,{variant:r===a?"default":"outline",size:"sm",onClick:()=>p(a),className:`w-8 h-8 p-0 ${r===a?"bg-green-600 hover:bg-green-700 text-white border-green-600":"bg-white hover:bg-green-50 text-gray-700 border-gray-300 hover:border-green-300"}`,children:a},a))}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>p(r+1),disabled:r===P,children:["Selanjutnya",e.jsx(je,{className:"h-4 w-4"})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(fe,{children:[e.jsx(ve,{children:e.jsxs(J,{children:[e.jsx(c,{children:"Pegawai"}),e.jsx(c,{children:"Jenis Jabatan"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Dokumen"}),d&&e.jsx(c,{children:"Pembuat"}),e.jsx(c,{children:"Tanggal Dibuat"}),e.jsx(c,{className:"text-right",children:"Aksi"})]})}),e.jsx(ke,{children:w.map(a=>e.jsxs(J,{className:"hover:bg-gray-50",children:[e.jsx(g,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.pegawai.nama}),e.jsx("div",{className:"text-sm text-gray-500",children:a.pegawai.jabatan})]})}),e.jsx(g,{children:e.jsx(se,{variant:"outline",children:Ue(a.jenis_jabatan)})}),e.jsx(g,{children:me(a.status,a)}),e.jsx(g,{children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-sm",children:a.files.length})})}),d&&e.jsx(g,{children:e.jsx("div",{className:"text-sm text-gray-600",children:(()=>{var t;const s=D.users.find(n=>n.id===a.created_by);return s?s.full_name||s.email||"Unknown User":(t=a.created_by)!=null&&t.includes("@")?a.created_by:"Unknown User"})()})}),e.jsx(g,{children:e.jsx("div",{className:"text-sm text-gray-600",children:Ie(a.created_at)})}),e.jsx(g,{className:"text-right",children:e.jsxs(We,{children:[e.jsx(Ve,{asChild:!0,children:e.jsx(u,{variant:"ghost",size:"sm",children:e.jsx(Le,{className:"h-4 w-4"})})}),e.jsxs(qe,{align:"end",children:[e.jsxs(f,{onClick:()=>M(a.id),children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Lihat Detail"]}),!Be&&e.jsxs(e.Fragment,{children:[a.status==="draft"&&e.jsxs(f,{onClick:()=>F(`/pengajuan/${a.id}/upload`),children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Upload Dokumen"]}),a.status==="rejected"&&e.jsxs(f,{onClick:()=>F(`/pengajuan/${a.id}/edit`),children:[e.jsx(Oe,{className:"h-4 w-4 mr-2"}),"Perbaiki Dokumen"]})]}),d&&e.jsxs(f,{onClick:()=>{X(a),H(a.status),W(""),O(!0)},children:[e.jsx(Je,{className:"h-4 w-4 mr-2"}),"Ubah Status"]}),d&&a.status==="admin_wilayah_submitted"&&e.jsxs(e.Fragment,{children:[e.jsxs(f,{onClick:()=>M(a.id),children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Setujui"]}),e.jsxs(f,{onClick:()=>M(a.id),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Tolak"]})]}),(d||a.status==="draft"&&(i==null?void 0:i.role)!=="user")&&e.jsxs(f,{onClick:()=>{console.log("ðŸ” Debug: Klik hapus untuk pengajuan:",{id:a.id,status:a.status,isAdmin:d,userRole:i==null?void 0:i.role}),oe(a.id),Q(!0)},className:"text-red-600",children:[e.jsx(ze,{className:"h-4 w-4 mr-2"}),"Hapus"]})]})]})})]},a.id))})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Menampilkan ",(r-1)*K+1," sampai ",Math.min(r*K,_)," dari ",_," pengajuan"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>p(r-1),disabled:r===1,children:[e.jsx(pe,{className:"h-4 w-4"}),"Sebelumnya"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:P},(a,s)=>s+1).map(a=>e.jsx(u,{variant:r===a?"default":"outline",size:"sm",onClick:()=>p(a),className:`w-8 h-8 p-0 ${r===a?"bg-green-600 hover:bg-green-700 text-white border-green-600":"bg-white hover:bg-green-50 text-gray-700 border-gray-300 hover:border-green-300"}`,children:a},a))}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>p(r+1),disabled:r===P,children:["Selanjutnya",e.jsx(je,{className:"h-4 w-4"})]})]})]})]})})]})]}),e.jsx(Ka,{open:na,onOpenChange:O,children:e.jsxs(Ba,{className:"sm:max-w-md",children:[e.jsx(Ua,{children:e.jsx(Ia,{children:"Ubah Status Pengajuan"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(ye,{htmlFor:"status",children:"Status Saat Ini"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-50 rounded-md",children:A&&me(A.status,A)})]}),e.jsxs("div",{children:[e.jsx(ye,{htmlFor:"newStatus",children:"Status Baru"}),e.jsxs("select",{id:"newStatus",value:G,onChange:a=>H(a.target.value),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"submitted",children:"Submitted"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Ditolak Admin Wilayah"}),e.jsx("option",{value:"resubmitted",children:"Resubmitted"}),e.jsx("option",{value:"admin_wilayah_approved",children:"Admin Wilayah Approved"}),e.jsx("option",{value:"admin_wilayah_rejected",children:"Ditolak Superadmin"}),e.jsx("option",{value:"admin_wilayah_submitted",children:"Admin Wilayah Submitted"}),e.jsx("option",{value:"final_approved",children:"Final Approved"}),e.jsx("option",{value:"final_rejected",children:"Final Rejected"})]})]}),e.jsxs("div",{children:[e.jsx(ye,{htmlFor:"reason",children:"Alasan Perubahan (Opsional)"}),e.jsx(Xa,{id:"reason",value:Te,onChange:a=>W(a.target.value),placeholder:"Masukkan alasan perubahan status...",className:"mt-1",rows:3})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(u,{variant:"outline",onClick:()=>{O(!1),X(null),H(""),W("")},children:"Batal"}),e.jsx(u,{onClick:xa,disabled:Fe||!G||A&&G===A.status,className:"bg-green-600 hover:bg-green-700 text-white",children:Fe?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"h-4 w-4 mr-2 animate-spin"}),"Memproses..."]}):"Ubah Status"})]})]})}),e.jsx(Oa,{open:sa,onOpenChange:Q,children:e.jsxs(Ga,{children:[e.jsxs(Ha,{children:[e.jsx(Wa,{children:"Hapus Pengajuan"}),e.jsx(Va,{children:"Apakah Anda yakin ingin menghapus pengajuan ini? Tindakan ini tidak dapat dibatalkan."})]}),e.jsxs(qa,{children:[e.jsx(Ya,{disabled:de,children:"Batal"}),e.jsx(Qa,{onClick:ga,disabled:de,className:"bg-red-600 hover:bg-red-700",children:de?e.jsxs(e.Fragment,{children:[e.jsx(be,{className:"h-4 w-4 mr-2 animate-spin text-green-600"}),"Menghapus..."]}):"Hapus"})]})]})})]})};export{ut as default};
//# sourceMappingURL=PengajuanIndex-CKrKmrf9.js.map
