import{j as a,at as Ia,ae as ta,a6 as $,F as W,aA as Wa,ak as $a,ap as La,U as ia,aK as ka,aB as Ha,ag as za,a5 as ra,a4 as qa,a$ as Oa,ai as Ga}from"./ui-vendor-BBh2_8F_.js";import{r as u,d as Va,e as Xa}from"./react-vendor-BNG1zHOu.js";import{C as Q,c as Y,a as la,b as da}from"./card-W8vK_Um1.js";import{u as xa,d as Qa,B as v,b as P,a as F,c as ja,s as Ya,y as ua,z as Za,P as ae}from"./index-Bn_NuebI.js";import{S as ee,a as se,b as ne,c as te,d as ie}from"./select-BlzFSF7s.js";import{u as ya,S as ba}from"./protected-button-DXokgwPm.js";import{P as re}from"./PageHeader-dHFSvMEx.js";import{A as oa,a as ca,b as ma,c as pa,d as ga,e as ha,g as le,f as _a}from"./alert-dialog-Bp12f2PB.js";const I=c=>String(c).toLowerCase().replace(/[^a-z0-9_-]+/gi,"_").replace(/^_+|_+$/g,""),de=({pengajuanId:c,jenisJabatanId:m,onFilesUploaded:y,onProgressChange:d,pengajuanStatus:S,pengajuanData:T})=>{const{token:b,user:K}=xa(),{toast:L}=Qa(),[j,H]=u.useState([]),[h,D]=u.useState([]);u.useState([]),u.useState("");const[_,w]=u.useState({}),[B,A]=u.useState({}),[z,R]=u.useState(!1),[U,q]=u.useState(!1),{submitForm:M,isSubmitting:J}=ya(),[C,r]=u.useState(!0),[g,o]=u.useState(null),[k,p]=u.useState(null),[N,x]=u.useState(!1),[fa,O]=u.useState(!1),[Pa,Sa]=u.useState(""),[wa,Na]=u.useState("Error"),G=async()=>{try{r(!0),o(null);let e;if(isNaN(Number(m)))try{const n=await F("/api/job-type-configurations",b);if(n!=null&&n.success&&Array.isArray(n.data)){const t=n.data.find(i=>i.jenis_jabatan===m);if(t)e=t.id;else{o("Jenis jabatan tidak ditemukan");return}}else{o("Gagal mengambil data jenis jabatan");return}}catch{o("Gagal mencari jenis jabatan");return}else e=parseInt(String(m));const s=await F(`/api/admin-wilayah-file-config/job-type/${e}`,b);if(console.log("ðŸ” API Response:",s),console.log("ðŸ” Job Type ID:",e),console.log("ðŸ” Jenis Jabatan ID:",m),s.success){if(console.log("âœ… Setting required files:",s.data),H(s.data),d){const n=h.filter(t=>s.data.some(i=>i.file_type===t.file_type)).length;d(n,s.data.length||0)}}else o("Failed to fetch file configurations")}catch(e){console.error("Error fetching file configs:",e),o("Error connecting to server")}finally{r(!1)}},Z=async()=>{var e;try{const s=await F(`/api/admin-wilayah/pengajuan/${c}`,b);if(s!=null&&s.success){const t=(s.uploadedAdminWilayahFiles||((e=s.data)==null?void 0:e.uploadedAdminWilayahFiles)||[]).map(i=>({id:i.id,pengajuan_id:c,file_type:i.file_type,file_name:i.file_name,file_path:i.file_path,file_size:i.file_size,verification_status:i.verification_status||"pending",created_at:i.created_at,updated_at:i.updated_at}));D(t)}else D([])}catch(s){console.error("Error fetching uploaded files:",s),D([])}};u.useEffect(()=>{m&&(G(),Z())},[m,b]),u.useEffect(()=>{if(d){const e=j.length,s=h.filter(n=>j.some(t=>t.file_type===n.file_type)).length;d(s,e)}},[j,h]);const V=async(e,s)=>{console.log("ðŸš€ START UPLOAD - fileType:",e,"fileName:",s.name),w(n=>({...n,[e]:!0})),A(n=>({...n,[e]:0}));try{if(!sa()){w(l=>({...l,[e]:!1})),A(l=>({...l,[e]:0}));return}console.log("ðŸ” Uploading file:",{fileType:e,fileName:s.name,pengajuanId:c,jenisJabatanId:m,requiredFiles:j.map(l=>({file_type:l.file_type,display_name:l.display_name}))});const n=new FormData;n.append("file",s),n.append("pengajuan_id",c),n.append("file_type",e),n.append("file_category","admin_wilayah"),n.append("uploaded_by_role","admin_wilayah"),n.append("uploaded_by_name",(K==null?void 0:K.full_name)||"Admin Wilayah"),n.append("uploaded_by_office","Kanwil Provinsi"),console.log("ðŸ“¦ FormData created:",{file:s.name,pengajuan_id:c,file_type:e,file_category:"admin_wilayah"});for(let[l,f]of n.entries())console.log("ðŸ“‹ FormData entry:",l,f);const t=setInterval(()=>{A(l=>{const f=l[e]||0;return f<90?{...l,[e]:f+Math.random()*20}:l})},200),i=await ja(`/api/admin-wilayah/pengajuan/${c}/upload`,n,b);if(clearInterval(t),A(l=>({...l,[e]:100})),i.success){const l={id:i.data.id,pengajuan_id:c,file_type:e,file_name:s.name,file_path:i.data.file_path,file_size:s.size,verification_status:"pending",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},f=[...h,l];if(D(f),y(f),d){const X=j.length,na=f.filter(Ja=>j.some(Ca=>Ca.file_type===Ja.file_type)).length;d(na,X)}L({title:"Success",description:`Upload berhasil: ${s.name}`,variant:"default",duration:3e3})}else{const l=i.message||"Terjadi kesalahan saat mengupload file. Silakan coba lagi.";E("Upload Gagal",l)}}catch(n){console.error("Error uploading file:",n),E("Upload Gagal","Terjadi kesalahan saat mengupload file. Periksa koneksi internet Anda dan coba lagi.")}finally{w(n=>({...n,[e]:!1})),A(n=>({...n,[e]:0}))}},va=async()=>{M(async()=>{Ya("SUBMIT_SUCCESS","File berhasil diajukan ke Superadmin"),R(!1)},()=>{},e=>{ua("OPERATION_FAILED","Gagal mengajukan file ke Superadmin")})},Ta=e=>{if(e===0)return"0 Bytes";const s=1024,n=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,t)).toFixed(2))+" "+n[t]},Da=e=>h.find(n=>n.file_type===e)?"uploaded":"pending",Aa=e=>h.find(s=>s.file_type===e),aa=(e,s)=>{var t;return((t={Guru:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Madrasah":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Wakil Kepala Madrasah":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala TU":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Seksi":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Sub Bagian":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Urusan":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},Staff:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},Pelaksana:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"}}[e])==null?void 0:t[s])||null},ea=e=>{const{file_type:s,display_name:n}=e;if(s==="surat_rekomendasi_kanwil")return aa(m,s)||"Surat Rekomendasi dari Instansi Pembina - Varian 6.1-6.9";const t=aa(m,s);return t||n},Ka=async e=>{try{const s=await fetch(`/api/pengajuan/files/${e.id}`,{headers:{Authorization:`Bearer ${b}`}});if(!s.ok)throw new Error("Gagal mengambil file");const n=await s.blob(),t=URL.createObjectURL(n);window.open(t,"_blank"),setTimeout(()=>URL.revokeObjectURL(t),5e3)}catch{ua("OPERATION_FAILED","Gagal membuka preview file")}},Ba=async e=>{try{const s=await fetch(`/api/pengajuan/files/${e.id}`,{headers:{Authorization:`Bearer ${b}`}});if(!s.ok)throw new Error("Gagal mengambil file");const n=await s.blob(),t=URL.createObjectURL(n),i=document.createElement("a");i.href=t,i.download=e.file_name||"file.pdf",document.body.appendChild(i),i.click(),i.remove(),setTimeout(()=>URL.revokeObjectURL(t),5e3)}catch{Za("Gagal mengunduh file")}},Ra=e=>{const s=document.getElementById(`replace-${I(e)}`);s&&s.click()},sa=()=>{if(!(T!=null&&T.jabatan_name)||!m)return!0;const e=String(T.jabatan_name).toLowerCase(),s=String(m).toLowerCase();return e!==s?(E("Jabatan Tidak Sesuai",`Jenis jabatan yang Anda pilih tidak sama dengan yang diajukan oleh operator.

â€¢ Diajukan operator: ${T.jabatan_name}
â€¢ Dipilih admin wilayah: ${m}

Silakan pilih jenis jabatan yang sesuai terlebih dahulu, lalu ulangi upload.`),!1):!0},E=(e,s)=>{Na(e),Sa(s),O(!0)},Ea=(e,s)=>{s.preventDefault(),s.stopPropagation(),p(e),x(!0)},Fa=(e,s)=>{s.preventDefault(),s.stopPropagation(),s.currentTarget.contains(s.relatedTarget)||(p(null),x(!1))},Ua=e=>{e.preventDefault(),e.stopPropagation()},Ma=(e,s)=>{var t;if(s.preventDefault(),s.stopPropagation(),!sa()){p(null),x(!1);return}const n=s.dataTransfer.files;if(n&&n.length>0){const i=n[0],l=[".pdf",".doc",".docx"],f="."+((t=i.name.split(".").pop())==null?void 0:t.toLowerCase());if(!l.includes(f)){E("Format File Tidak Didukung","Hanya file PDF, DOC, dan DOCX yang diizinkan untuk diupload."),p(null),x(!1);return}const X=e==="skp_2_tahun_terakhir"?1.6*1024*1024:500*1024;if(i.size>X){E("Ukuran File Terlalu Besar",`Ukuran file maksimal ${e==="skp_2_tahun_terakhir"?"1.6MB":"500KB"}. Silakan kompres file atau pilih file yang lebih kecil.`),p(null),x(!1);return}V(e,i)}p(null),x(!1)};return C?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3"}),a.jsx("div",{className:"space-y-3",children:[...Array(5)].map((e,s)=>a.jsx("div",{className:"h-20 bg-gray-200 rounded"},s))})]})}):g?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"text-center py-8",children:[a.jsx(Ia,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Files"}),a.jsx("p",{className:"text-gray-600 mb-4",children:g}),a.jsxs(v,{onClick:G,className:"flex items-center gap-2",children:[a.jsx(ta,{className:"h-4 w-4"}),"Retry"]})]})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Upload File Admin Wilayah"}),a.jsxs(v,{onClick:()=>{G(),Z()},variant:"outline",size:"sm",children:[a.jsx(ta,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Dokumen Wajib Admin Wilayah"}),a.jsx("div",{className:"text-sm text-gray-600",children:`${j.filter(s=>h.some(n=>n.file_type===s.file_type)).length}/${j.length} berkas sudah diupload`})]}),a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:j.map(e=>{console.log("ðŸ”§ Rendering fileConfig:",e);const s=Da(e.file_type),n=Aa(e.file_type);return a.jsx(Q,{className:"border border-gray-200",children:a.jsx(Y,{className:"p-3",children:a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h4",{className:"font-medium text-gray-900 text-sm leading-tight",title:ea(e),children:ea(e)}),e.is_required&&a.jsx(P,{variant:"destructive",className:"text-[10px] py-0 px-1.5",children:"Wajib"})]}),s==="uploaded"?a.jsxs(P,{className:"bg-green-600 text-white flex items-center gap-1 text-xs",children:[a.jsx($,{className:"h-3 w-3"}),"Uploaded"]}):a.jsxs(P,{variant:"secondary",className:"flex items-center gap-1 text-xs",children:[a.jsx(W,{className:"h-3 w-3"}),"Pending"]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("p",{className:"text-xs text-gray-500",children:["PDF (maks. ",e.file_type==="skp_2_tahun_terakhir"?"1.6MB":"500KB",")"]}),_[e.file_type]&&a.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[a.jsx("div",{className:"animate-spin h-3 w-3 border border-green-600 border-t-transparent rounded-full"}),a.jsxs("span",{className:"text-green-600",children:["Uploading... ",B[e.file_type]||0,"%"]})]}),s==="uploaded"&&n&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-1 text-green-600 text-xs",children:[a.jsx($,{className:"h-3 w-3"}),a.jsx("span",{className:"truncate",children:n.file_name}),a.jsxs("span",{className:"text-gray-500",children:["(",Ta(n.file_size),")"]})]}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx(v,{size:"sm",variant:"outline",onClick:()=>Ka(n),className:"h-6 px-2 text-xs",children:a.jsx(Wa,{className:"h-3 w-3"})}),a.jsx(v,{size:"sm",variant:"outline",onClick:()=>Ba(n),className:"h-6 px-2 text-xs",children:a.jsx($a,{className:"h-3 w-3"})}),a.jsx(v,{size:"sm",variant:"outline",onClick:()=>Ra(e.file_type),className:"h-6 px-2 text-xs",children:a.jsx(La,{className:"h-3 w-3"})}),a.jsx("input",{id:`replace-${I(e.file_type)}`,type:"file",className:"hidden",accept:".pdf,.doc,.docx",onChange:t=>{var l;const i=(l=t.target.files)==null?void 0:l[0];i&&(V(e.file_type,i),t.target.value="")}})]})]}),s!=="uploaded"&&a.jsxs("div",{className:`relative border-2 border-dashed rounded-lg p-6 transition-all duration-200 cursor-pointer w-full h-32 ${k===e.file_type?"border-green-500 bg-green-50":"border-gray-300 hover:border-green-400 hover:bg-gray-50"} ${_[e.file_type]?"pointer-events-none opacity-50":""}`,onDragEnter:t=>Ea(e.file_type,t),onDragLeave:t=>Fa(e.file_type,t),onDragOver:Ua,onDrop:t=>Ma(e.file_type,t),onClick:()=>{const t=document.getElementById(`file-${I(e.file_type)}`);t&&!t.disabled&&!_[e.file_type]&&t.click()},children:[a.jsx("div",{className:"flex flex-col items-center justify-center h-full text-center",children:_[e.file_type]?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin h-6 w-6 border-2 border-green-600 border-t-transparent rounded-full mb-2"}),a.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Uploading..."})]}):k===e.file_type?a.jsxs(a.Fragment,{children:[a.jsx(ia,{className:"h-8 w-8 text-green-500 mb-2"}),a.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Lepaskan file di sini"})]}):a.jsxs(a.Fragment,{children:[a.jsx(ia,{className:"h-6 w-6 text-gray-400 mb-2"}),a.jsx("p",{className:"text-xs text-gray-600 leading-tight",children:"Drag & drop file di sini atau klik untuk memilih"})]})}),a.jsx("input",{type:"file",accept:".pdf,.doc,.docx",onChange:t=>{var l;console.log("ðŸ“ File input changed:",t.target.files);const i=(l=t.target.files)==null?void 0:l[0];i?(console.log("ðŸ“„ File selected:",i.name,"fileConfig.file_type:",e.file_type),V(e.file_type,i),t.target.value=""):console.log("âŒ No file selected")},className:"hidden",id:`file-${I(e.file_type)}`})]})]})]})})},e.id)})})]}),(()=>{const e=j.every(n=>h.some(t=>t.file_type===n.file_type)),s=S==="submitted";return a.jsx("div",{className:"flex justify-end",children:e?a.jsxs(v,{onClick:()=>!s&&R(!0),className:"bg-green-600 hover:bg-green-700",disabled:U||s,children:[a.jsx(ka,{className:"h-4 w-4 mr-2"}),s?"Sudah Dikirim":"Ajukan ke Superadmin"]}):a.jsx("div",{className:"text-sm text-gray-500 text-center",children:"Tombol ajukan akan muncul setelah semua berkas wajib diupload"})})})(),a.jsx(oa,{open:z,onOpenChange:R,children:a.jsxs(ca,{children:[a.jsxs(ma,{children:[a.jsx(pa,{children:"Ajukan ke Superadmin"}),a.jsx(ga,{children:"Apakah Anda yakin ingin mengajukan semua file yang telah diupload ke Superadmin? Tindakan ini tidak dapat dibatalkan."})]}),a.jsxs(ha,{children:[a.jsx(le,{disabled:U,children:"Batal"}),a.jsx(_a,{asChild:!0,children:a.jsx(ba,{onClick:va,className:"bg-green-600 hover:bg-green-700",isProcessing:J,processingText:"Mengajukan...",children:"Ajukan"})})]})]})}),a.jsx(oa,{open:fa,onOpenChange:O,children:a.jsxs(ca,{className:"max-w-md",children:[a.jsxs(ma,{children:[a.jsxs(pa,{className:"flex items-center gap-2 text-red-600 text-lg",children:[a.jsx(Ha,{className:"h-5 w-5"}),wa]}),a.jsx(ga,{className:"text-gray-700 whitespace-pre-line leading-relaxed",children:Pa})]}),a.jsx(ha,{children:a.jsx(_a,{onClick:()=>O(!1),className:"bg-red-600 hover:bg-red-700",children:"Tutup"})})]})})]})},ue=({uploaded:c,total:m,isComplete:y,className:d=""})=>{const S=m>0?Math.round(c/m*100):0;return a.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 ${d}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Progress Upload Dokumen"}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:[c," dari ",m," dokumen"]}),a.jsxs("div",{className:"text-lg font-bold text-green-600",children:[S,"%"]})]})]}),a.jsx("div",{className:"mb-4",children:a.jsx(ae,{value:S,className:"h-3 bg-gray-200"})}),a.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[a.jsx($,{className:"h-4 w-4"}),a.jsxs("span",{children:[c," Terupload"]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[a.jsx(za,{className:"h-4 w-4"}),a.jsxs("span",{children:[m-c," Belum"]})]}),y&&a.jsxs("div",{className:"flex items-center gap-2 text-green-600 font-medium",children:[a.jsx($,{className:"h-4 w-4"}),a.jsx("span",{children:"Upload Selesai"})]})]})]})},xe=()=>{var q,M,J,C;const{pengajuanId:c}=Va(),m=Xa(),{token:y}=xa(),[d,S]=u.useState(null),[T,b]=u.useState(!0);u.useState(!1);const{submitForm:K,isSubmitting:L}=ya(),[j,H]=u.useState([]),[h,D]=u.useState(""),[_,w]=u.useState({required:0,total:0,isComplete:!1}),B=async()=>{var r,g;if(!(!y||!c)){b(!0);try{const o=await F(`/api/admin-wilayah/pengajuan/${c}`,y);if(o&&o.success!==!1){S(o.pengajuan||((r=o.data)==null?void 0:r.pengajuan)||o);const k=o.uploadProgress||((g=o.data)==null?void 0:g.uploadProgress);if(k){const p=Number(k.required??0),N=Number(k.total??0),x=typeof k.isComplete=="boolean"?k.isComplete:p>=N;w({required:p,total:N,isComplete:x})}else w({required:0,total:0,isComplete:!1})}else S(null),w({required:0,total:0,isComplete:!1})}catch(o){console.error("Failed to fetch pengajuan detail",o),S(null)}finally{b(!1)}}},A=async()=>{try{const r=await F("/api/admin-wilayah-file-config",y);if(r!=null&&r.success&&Array.isArray(r.data)){const g=new Map;r.data.forEach(k=>{var x;const p=k.jenis_jabatan_id,N=((x=k.jenis_jabatan)==null?void 0:x.jenis_jabatan)||`Jabatan ${p}`;p&&!g.has(p)&&g.set(p,N)});const o=Array.from(g.values());H(o),o.length>0&&!h&&D(o[0])}}catch(r){console.error("Failed to fetch job types:",r)}};u.useEffect(()=>{B(),A()},[c,y]);const z=r=>new Date(r).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),R=(r,g)=>{const o=(k,p)=>{var N;return k!=="submitted"||!p?!1:((N=p.files)==null?void 0:N.some(x=>x.file_category==="admin_wilayah"))||!1};switch(r){case"approved":return a.jsx(P,{className:"bg-green-600 text-white",children:"Disetujui Kab/Kota"});case"admin_wilayah_approved":return a.jsx(P,{className:"bg-green-700 text-white",children:"Disetujui Admin Wilayah"});case"admin_wilayah_rejected":return a.jsx(P,{className:"bg-red-600 text-white",children:"Ditolak Admin Wilayah"});case"submitted":return a.jsx(P,{className:"bg-blue-600 text-white",children:o(r,g)?"Diajukan Admin Wilayah":"Dikirim ke Superadmin"});default:return a.jsx(P,{className:"bg-gray-600 text-white",children:r})}},U=async()=>{!y||!c||K(async()=>{await ja(`/api/admin-wilayah/pengajuan/${c}/submit-to-superadmin`,{},y),await B()},()=>{},r=>{console.error("Error submitting to superadmin:",r)})};return T?a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsx("div",{className:"max-w-6xl mx-auto",children:a.jsxs("div",{className:"animate-pulse space-y-6",children:[a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),a.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})})}):d?a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[a.jsx(re,{title:"Upload File Admin Wilayah",subtitle:"Upload file tambahan untuk pengajuan mutasi pegawai",actions:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(P,{className:"bg-green-100 text-green-800",children:"Admin Wilayah"}),R(d.status,d),a.jsxs(v,{variant:"outline",onClick:()=>m("/admin-wilayah/dashboard"),className:"border-green-200 text-green-700 hover:bg-green-50",children:[a.jsx(ra,{className:"h-4 w-4 mr-2"}),"Kembali"]})]})}),a.jsxs(Q,{className:"border-green-200 bg-green-50",children:[a.jsx(la,{children:a.jsxs(da,{className:"text-green-800 flex items-center gap-2",children:[a.jsx(W,{className:"h-5 w-5"}),"Informasi Pengajuan"]})}),a.jsx(Y,{children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(qa,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:((q=d.pegawai)==null?void 0:q.nama)||"-"}),a.jsxs("p",{className:"text-sm text-gray-600",children:["NIP: ",((M=d.pegawai)==null?void 0:M.nip)||"-"]})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Oa,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:((J=d.office)==null?void 0:J.kabkota)||"-"}),a.jsx("p",{className:"text-sm text-gray-600",children:((C=d.office)==null?void 0:C.name)||"-"})]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(W,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Jenis Jabatan"}),a.jsx("p",{className:"text-sm text-gray-600",children:d.jenis_jabatan})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Ga,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Tanggal Pengajuan"}),a.jsx("p",{className:"text-sm text-gray-600",children:z(d.created_at)})]})]})]})]})})]}),a.jsxs(Q,{children:[a.jsx(la,{children:a.jsx(da,{className:"text-green-800",children:"Upload File Admin Wilayah"})}),a.jsxs(Y,{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Jenis Berkas Admin Wilayah"}),a.jsxs(ee,{value:h,onValueChange:D,children:[a.jsx(se,{className:"w-full max-w-md",children:a.jsx(ne,{placeholder:"Pilih jenis berkas..."})}),a.jsx(te,{children:j.map(r=>a.jsx(ie,{value:r,children:r},r))})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Pilih jenis berkas yang sudah dikonfigurasi oleh superadmin"})]}),h&&_.total>0&&a.jsx(ue,{uploaded:_.required,total:_.total,isComplete:_.isComplete,className:"mb-6"}),h&&a.jsx(de,{pengajuanId:d.id,jenisJabatanId:h,onFilesUploaded:()=>B(),onProgressChange:(r,g)=>w({required:r,total:g,isComplete:r>=g&&g>0}),pengajuanStatus:d.status,pengajuanData:d})]})]}),a.jsx("div",{className:"flex items-center justify-end gap-3",children:(d.status==="approved"||d.status==="submitted")&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{className:"text-sm text-gray-600 mr-2",children:[_.required,"/",_.total," berkas wajib"]}),a.jsxs(ba,{onClick:U,className:"bg-green-600 hover:bg-green-700 text-white",isProcessing:L||d.status==="submitted"||_.required<_.total,processingText:"Mengirim...",children:[a.jsx(ka,{className:"h-4 w-4 mr-2"}),d.status==="submitted"?"Sudah Dikirim":"Submit ke Superadmin"]})]})})]})}):a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsx("div",{className:"max-w-6xl mx-auto",children:a.jsxs("div",{className:"text-center py-12",children:[a.jsx(W,{className:"h-16 w-16 mx-auto text-gray-300 mb-4"}),a.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Pengajuan Tidak Ditemukan"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Pengajuan yang Anda cari tidak ditemukan atau tidak memiliki akses."}),a.jsxs(v,{onClick:()=>m("/admin-wilayah/dashboard"),className:"bg-green-600 hover:bg-green-700 text-white",children:[a.jsx(ra,{className:"h-4 w-4 mr-2"}),"Kembali ke Dashboard"]})]})})})};export{xe as default};
//# sourceMappingURL=AdminWilayahUploadPage-D_ZxBq1a.js.map
