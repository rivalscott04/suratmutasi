import{j as e,a5 as ye,as as ke,a9 as Ce,aa as T,at as De,au as Se,aD as $,E as q,x as M,aJ as L,a3 as J}from"./ui-vendor-DQXcJUOU.js";import{r}from"./react-vendor-DheTkQGW.js";import{u as _e,a as Ae,t as x,B as t,I as m,b as Pe,D as Q,e as X,f as Y,g as Z,h as ee,i as se,j as Ue,c as Te,l as Me}from"./index-BmAGkujd.js";import{f as Le}from"./errorFormatter-D6nNfdnT.js";import{L as c}from"./label-tcLH1XzB.js";import{S as ae,a as le,b as re,c as te,d as n}from"./select-BwBDEsG3.js";import{T as Ee,a as Be,b as z,c as v,d as Fe,e as f}from"./table-BrZ3c8ZG.js";import{A as Re,a as Ie,b as ze,c as Ge,d as Oe,e as He,g as Ke,f as We}from"./alert-dialog-DKIh_QML.js";import{C as ie,c as ne,a as Ve,b as $e,d as qe}from"./card-CMmM6-AI.js";const rs=()=>{const{user:E,token:u}=_e(),[oe,de]=r.useState([]),[ce,G]=r.useState(!0),[N,he]=r.useState(""),[me,y]=r.useState(!1),[xe,k]=r.useState(!1),[ue,B]=r.useState(!1),[p,F]=r.useState(null),[a,i]=r.useState({email:"",full_name:"",password:"",role:"user",office_id:""}),[j,O]=r.useState(!1),[g,D]=r.useState(!1),[pe,R]=r.useState(!1),[fe,S]=r.useState(null),[H,_]=r.useState(""),[w,A]=r.useState(!1),je=()=>{const o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let h="";const d="abcdefghijklmnopqrstuvwxyz",l="ABCDEFGHIJKLMNOPQRSTUVWXYZ",U="0123456789",C="!@#$%^&*";h+=d[Math.floor(Math.random()*d.length)],h+=l[Math.floor(Math.random()*l.length)],h+=U[Math.floor(Math.random()*U.length)],h+=C[Math.floor(Math.random()*C.length)];for(let b=4;b<12;b++)h+=o[Math.floor(Math.random()*o.length)];return h.split("").sort(()=>Math.random()-.5).join("")},P=async s=>{if(!s){x({title:"Gagal menyalin",description:"Password kosong",variant:"destructive"});return}const o=d=>{try{const l=document.createElement("textarea");if(l.value=d,l.style.position="fixed",l.style.left="0",l.style.top="0",l.style.opacity="0",l.style.pointerEvents="none",l.setAttribute("readonly",""),document.body.appendChild(l),navigator.userAgent.match(/ipad|iphone/i)){const C=document.createRange();C.selectNodeContents(l);const b=window.getSelection();b&&(b.removeAllRanges(),b.addRange(C)),l.setSelectionRange(0,999999)}else l.select();const U=document.execCommand("copy");return document.body.removeChild(l),U}catch(l){return console.error("Fallback copy failed:",l),!1}};try{if(navigator.clipboard&&window.isSecureContext){await navigator.clipboard.writeText(s),A(!0),x({title:"Password disalin",description:"Password telah disalin ke clipboard"}),setTimeout(()=>A(!1),2e3);return}}catch(d){console.warn("Clipboard API failed, trying fallback:",d)}if(o(s))A(!0),x({title:"Password disalin",description:"Password telah disalin ke clipboard"}),setTimeout(()=>A(!1),2e3);else{x({title:"Gagal menyalin otomatis",description:"Silakan salin password secara manual dari field password",variant:"destructive",duration:5e3});const d=document.querySelector('input[type="password"], input[type="text"][id*="password"]');d&&(d.focus(),d.select())}},K=()=>{const s=je();i({...a,password:s}),x({title:"Password di-generate",description:"Password secure telah di-generate"})};if((E==null?void 0:E.role)!=="admin")return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(ie,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-600 mb-2",children:"Akses Ditolak"}),e.jsx("p",{className:"text-gray-600",children:"Anda tidak memiliki akses ke halaman ini."})]})})})});r.useEffect(()=>{I()},[]);const I=async()=>{if(u){G(!0);try{const s=await Ae("/api/users",u);de(s.users||[])}catch(s){console.error("Failed to fetch users:",s),x({title:"Error",description:"Gagal mengambil data user",variant:"destructive"})}finally{G(!1)}}},ge=()=>{i({email:"",full_name:"",password:"",role:"user",office_id:""}),y(!0)},we=s=>{F(s),i({email:s.email,full_name:s.full_name,password:"",role:s.role,office_id:s.office_id||""}),k(!0)},be=s=>{F(s),B(!0)},W=async(s=!1)=>{if(u){if(a.role==="kanwil"&&(!a.office_id||a.office_id==="")){S(!1),_("Role kanwil wajib memiliki office_id"),R(!0);return}D(!0);try{if(s&&p){const o={...a};o.password||delete o.password,await Ue(`/api/users/${p.id}`,o,u),S(!0),_("User berhasil diperbarui.")}else await Te("/api/users",a,u),S(!0),_("User berhasil ditambahkan.");I(),y(!1),k(!1),i({email:"",full_name:"",password:"",role:"user",office_id:""})}catch(o){S(!1);const h=Le(o);_(h)}finally{D(!1),y(!1),k(!1),R(!0)}}},ve=async()=>{if(!(!u||!p)){D(!0);try{await Me(`/api/users/${p.id}`,u),x({title:"Sukses",description:"User berhasil dihapus"}),I(),B(!1),F(null)}catch(s){console.error("Failed to delete user:",s),x({title:"Error",description:"Gagal menghapus user",variant:"destructive"})}finally{D(!1)}}},V=oe.filter(s=>s.full_name.toLowerCase().includes(N.toLowerCase())||s.email.toLowerCase().includes(N.toLowerCase())||s.role.toLowerCase().includes(N.toLowerCase())),Ne=s=>{switch(s){case"admin":return"bg-red-100 text-red-800";case"operator":return"bg-blue-100 text-blue-800";case"user":return"bg-green-100 text-green-800";case"admin_wilayah":return"bg-purple-100 text-purple-800";case"bimas":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[pe&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/20 backdrop-blur-sm animate-in fade-in-0 duration-200",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full flex flex-col items-center animate-in zoom-in-95 duration-200",children:[fe?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-10 h-10 text-green-600",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Berhasil"}),e.jsx("p",{className:"text-gray-600 mb-6 text-center",children:H})]}):e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-10 h-10 text-red-600",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Gagal"}),e.jsx("p",{className:"text-gray-600 mb-6 text-center",children:H})]}),e.jsx("button",{className:"w-full py-3 rounded-lg bg-green-600 hover:bg-green-700 text-white text-lg font-semibold shadow transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-400",onClick:()=>R(!1),children:"Tutup"})]})}),e.jsxs(ie,{children:[e.jsx(Ve,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs($e,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Management User"]}),e.jsx(qe,{children:"Kelola user dan akses sistem"})]}),e.jsxs(t,{onClick:ge,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Tambah User"]})]})}),e.jsxs(ne,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(m,{placeholder:"Cari user...",value:N,onChange:s=>he(s.target.value),className:"pl-10"})]})}),ce?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(T,{className:"w-6 h-6 animate-spin mr-2 text-green-600"}),e.jsx("span",{children:"Loading users..."})]}):e.jsx("div",{className:"border rounded-lg",children:e.jsxs(Ee,{children:[e.jsx(Be,{children:e.jsxs(z,{children:[e.jsx(v,{children:"Nama"}),e.jsx(v,{children:"Email"}),e.jsx(v,{children:"Role"}),e.jsx(v,{children:"Office ID"}),e.jsx(v,{children:"Created At"}),e.jsx(v,{className:"text-right",children:"Aksi"})]})}),e.jsx(Fe,{children:V.length===0?e.jsx(z,{children:e.jsx(f,{colSpan:6,className:"text-center py-8 text-gray-500",children:N?"Tidak ada user yang ditemukan":"Belum ada user"})}):V.map(s=>e.jsxs(z,{children:[e.jsx(f,{className:"font-medium",children:s.full_name}),e.jsx(f,{children:s.email}),e.jsx(f,{children:e.jsx(Pe,{className:Ne(s.role),children:s.role})}),e.jsx(f,{children:s.office_id||"-"}),e.jsx(f,{children:s.created_at?new Date(s.created_at).toLocaleDateString("id-ID"):"-"}),e.jsx(f,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(t,{variant:"outline",size:"sm",onClick:()=>we(s),children:e.jsx(De,{className:"w-4 h-4"})}),e.jsx(t,{variant:"outline",size:"sm",onClick:()=>be(s),className:"text-red-600 hover:text-red-700",children:e.jsx(Se,{className:"w-4 h-4"})})]})})]},s.id))})]})})]})]}),e.jsx(Q,{open:me,onOpenChange:y,children:e.jsxs(X,{className:"sm:max-w-md",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Tambah User Baru"}),e.jsx(ee,{children:"Masukkan informasi user yang akan ditambahkan ke sistem."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"email",children:"Email"}),e.jsx(m,{id:"email",type:"email",value:a.email,onChange:s=>i({...a,email:s.target.value}),placeholder:"user@example.com"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"full_name",children:"Nama Lengkap"}),e.jsx(m,{id:"full_name",value:a.full_name,onChange:s=>i({...a,full_name:s.target.value}),placeholder:"Nama lengkap user"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(m,{id:"password",type:j?"text":"password",value:a.password,onChange:s=>i({...a,password:s.target.value}),placeholder:"Password"}),e.jsxs("div",{className:"absolute right-0 top-0 h-full flex items-center gap-1 pr-2",children:[e.jsx(t,{type:"button",variant:"ghost",size:"sm",className:"h-full px-2 hover:bg-transparent",onClick:()=>O(!j),children:j?e.jsx($,{className:"h-4 w-4"}):e.jsx(q,{className:"h-4 w-4"})}),a.password&&e.jsx(t,{type:"button",variant:"ghost",size:"sm",className:"h-full px-2 hover:bg-transparent",onClick:()=>P(a.password),children:w?e.jsx(M,{className:"h-4 w-4 text-green-600"}):e.jsx(L,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t,{type:"button",variant:"outline",size:"sm",onClick:K,className:"flex items-center gap-2 border-green-600 text-green-600 hover:bg-green-50",children:[e.jsx(J,{className:"h-4 w-4"}),"Generate Password"]}),a.password&&e.jsxs(t,{type:"button",variant:"outline",size:"sm",onClick:()=>P(a.password),className:"flex items-center gap-2 border-blue-600 text-blue-600 hover:bg-blue-50",children:[w?e.jsx(M,{className:"h-4 w-4"}):e.jsx(L,{className:"h-4 w-4"}),w?"Disalin!":"Copy Password"]})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"role",children:"Role"}),e.jsxs(ae,{value:a.role,onValueChange:s=>i({...a,role:s}),children:[e.jsx(le,{children:e.jsx(re,{placeholder:"Pilih role"})}),e.jsxs(te,{children:[e.jsx(n,{value:"user",children:"User"}),e.jsx(n,{value:"operator",children:"Operator"}),e.jsx(n,{value:"admin",children:"Admin"}),e.jsx(n,{value:"admin_wilayah",children:"Admin Wilayah"}),e.jsx(n,{value:"bimas",children:"Bimas"}),e.jsx(n,{value:"kanwil",children:"Kanwil"})]})]})]}),e.jsxs("div",{children:[e.jsxs(c,{htmlFor:"office_id",children:["Office ID ",a.role==="kanwil"&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(m,{id:"office_id",value:a.office_id,onChange:s=>i({...a,office_id:s.target.value}),placeholder:a.role==="kanwil"?"ID kantor (wajib untuk kanwil)":"ID kantor (opsional)"})]})]}),e.jsxs(se,{children:[e.jsx(t,{variant:"outline",onClick:()=>y(!1),children:"Batal"}),e.jsxs(t,{onClick:()=>W(!1),disabled:g||!a.email||!a.full_name||!a.password,className:"bg-green-600 hover:bg-green-700",children:[g?e.jsx(T,{className:"w-4 h-4 animate-spin mr-2 text-white"}):null,"Tambah User"]})]})]})}),e.jsx(Q,{open:xe,onOpenChange:k,children:e.jsxs(X,{className:"sm:max-w-md",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Edit User"}),e.jsx(ee,{children:"Perbarui informasi user."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-email",children:"Email"}),e.jsx(m,{id:"edit-email",type:"email",value:a.email,onChange:s=>i({...a,email:s.target.value}),placeholder:"user@example.com"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-full_name",children:"Nama Lengkap"}),e.jsx(m,{id:"edit-full_name",value:a.full_name,onChange:s=>i({...a,full_name:s.target.value}),placeholder:"Nama lengkap user"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-password",children:"Password Baru (opsional)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(m,{id:"edit-password",type:j?"text":"password",value:a.password,onChange:s=>i({...a,password:s.target.value}),placeholder:"Kosongkan jika tidak ingin mengubah password"}),e.jsxs("div",{className:"absolute right-0 top-0 h-full flex items-center gap-1 pr-2",children:[e.jsx(t,{type:"button",variant:"ghost",size:"sm",className:"h-full px-2 hover:bg-transparent",onClick:()=>O(!j),children:j?e.jsx($,{className:"h-4 w-4"}):e.jsx(q,{className:"h-4 w-4"})}),a.password&&e.jsx(t,{type:"button",variant:"ghost",size:"sm",className:"h-full px-2 hover:bg-transparent",onClick:()=>P(a.password),children:w?e.jsx(M,{className:"h-4 w-4 text-green-600"}):e.jsx(L,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t,{type:"button",variant:"outline",size:"sm",onClick:K,className:"flex items-center gap-2 border-green-600 text-green-600 hover:bg-green-50",children:[e.jsx(J,{className:"h-4 w-4"}),"Generate Password"]}),a.password&&e.jsxs(t,{type:"button",variant:"outline",size:"sm",onClick:()=>P(a.password),className:"flex items-center gap-2 border-blue-600 text-blue-600 hover:bg-blue-50",children:[w?e.jsx(M,{className:"h-4 w-4"}):e.jsx(L,{className:"h-4 w-4"}),w?"Disalin!":"Copy Password"]})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-role",children:"Role"}),e.jsxs(ae,{value:a.role,onValueChange:s=>i({...a,role:s}),children:[e.jsx(le,{children:e.jsx(re,{placeholder:"Pilih role"})}),e.jsxs(te,{children:[e.jsx(n,{value:"user",children:"User"}),e.jsx(n,{value:"operator",children:"Operator"}),e.jsx(n,{value:"admin",children:"Admin"}),e.jsx(n,{value:"admin_wilayah",children:"Admin Wilayah"}),e.jsx(n,{value:"bimas",children:"Bimas"}),e.jsx(n,{value:"kanwil",children:"Kanwil"})]})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-office_id",children:"Office ID"}),e.jsx(m,{id:"edit-office_id",value:a.office_id,onChange:s=>i({...a,office_id:s.target.value}),placeholder:"ID kantor (opsional)"})]})]}),e.jsxs(se,{children:[e.jsx(t,{variant:"outline",onClick:()=>k(!1),children:"Batal"}),e.jsxs(t,{onClick:()=>W(!0),disabled:g||!a.email||!a.full_name,className:"bg-green-600 hover:bg-green-700 text-white",children:[g?e.jsx(T,{className:"w-4 h-4 animate-spin mr-2 text-white"}):null,"Update User"]})]})]})}),e.jsx(Re,{open:ue,onOpenChange:B,children:e.jsxs(Ie,{children:[e.jsxs(ze,{children:[e.jsx(Ge,{children:"Hapus User"}),e.jsxs(Oe,{children:['Apakah Anda yakin ingin menghapus user "',p==null?void 0:p.full_name,'"? Tindakan ini tidak dapat dibatalkan.']})]}),e.jsxs(He,{children:[e.jsx(Ke,{children:"Batal"}),e.jsxs(We,{onClick:ve,disabled:g,className:"bg-red-600 hover:bg-red-700",children:[g?e.jsx(T,{className:"w-4 h-4 animate-spin mr-2 text-white"}):null,"Hapus"]})]})]})})]})};export{rs as default};
//# sourceMappingURL=Users-BQb9PGzW.js.map
