import{j as e,a8 as K,F as Q,a1 as je,al as W,ar as pe,a9 as Y,a3 as fe,b1 as ke,ak as ve,aD as Ne,aw as be}from"./ui-vendor-B7g5fNgE.js";import{r as n}from"./react-vendor-BNG1zHOu.js";import{u as we,d as ye,a as Z,I as ee,B as x,b as Se,D as _e,e as Ce,f as Pe,g as Te,c as Le}from"./index-BQ3AkV0g.js";import{C as y,c as S}from"./card-BxGrc11R.js";import{L as E}from"./label-CT4N1eM_.js";import{T as Ie}from"./textarea-CixiOszQ.js";import{S as _,a as C,b as P,c as T,d as o}from"./select-Bek3Bytz.js";import{P as ae}from"./PageHeader-D0Oy2vF9.js";const Oe=()=>{var q,G,z;const{user:Me,token:L}=we(),{toast:f}=ye(),[B,se]=n.useState([]),[F,te]=n.useState([]),[ne,A]=n.useState(!0),[u,D]=n.useState(""),[h,J]=n.useState("all"),[g,$]=n.useState("all"),[l,ie]=n.useState(null),[re,k]=n.useState(!1),[V,O]=n.useState(!1),[c,j]=n.useState(1),[v,le]=n.useState(10),[d,N]=n.useState({tracking_status_id:"",notes:"",estimated_days:""});n.useEffect(()=>{R()},[]);const R=async()=>{try{A(!0);const a=await Z("/api/tracking/pengajuan",L);a.success&&se(a.data);const s=await Z("/api/tracking/status-master",L);s.success&&te(s.data)}catch(a){console.error("Error loading data:",a),f({title:"Error",description:"Gagal memuat data",variant:"destructive"})}finally{A(!1)}},ce=a=>{var i;ie(a);const s=I(a),t=s?(i=s.tracking_status_id)==null?void 0:i.toString():"";console.log("Latest tracking:",s),console.log("Default status ID:",t),N({tracking_status_id:t||"",notes:"",estimated_days:""}),k(!0)},de=async()=>{if(!l||!d.tracking_status_id){f({title:"Error",description:"Status tracking harus diisi",variant:"destructive"});return}try{O(!0),(await Le(`/api/tracking/pengajuan/${l.id}`,{tracking_status_id:parseInt(d.tracking_status_id),notes:d.notes||null,estimated_days:d.estimated_days?parseInt(d.estimated_days):null},L)).success&&(f({title:"Berhasil",description:"Status tracking berhasil disimpan"}),k(!1),R())}catch(a){console.error("Error submitting tracking:",a),f({title:"Error",description:"Gagal menyimpan status tracking",variant:"destructive"})}finally{O(!1)}},I=a=>!a.tracking||a.tracking.length===0?null:a.tracking[0],b=B.filter(a=>{var p,H,X;const s=a.pegawai_nip.toLowerCase().includes(u.toLowerCase())||a.jenis_jabatan.toLowerCase().includes(u.toLowerCase())||((p=a.office)==null?void 0:p.kabkota.toLowerCase().includes(u.toLowerCase()))||((H=a.office)==null?void 0:H.nama_kantor.toLowerCase().includes(u.toLowerCase()))||((X=a.pegawai)==null?void 0:X.nama.toLowerCase().includes(u.toLowerCase())),t=h==="all"||a.jenis_jabatan===h,i=I(a);let r=!0;return g==="all"?r=!0:g==="no-tracking"?r=i===null:r=(i==null?void 0:i.status_name)===g,s&&t&&r});n.useEffect(()=>{j(1)},[u,h,g]);const w=b.length,m=Math.max(1,Math.ceil(w/v)),M=(c-1)*v,U=M+v,oe=b.slice(M,U),ue=()=>{if(m<=5)return Array.from({length:m},(i,r)=>r+1);let s=Math.max(1,c-2),t=Math.min(m,c+2);return c<=3?(t=5,s=1):c>=m-2&&(t=m,s=m-5+1),Array.from({length:t-s+1},(i,r)=>s+r)},me=()=>{const a=new Set(B.map(t=>t.jenis_jabatan)),s=Array.from(a).sort();return console.log("Unique jabatan:",s),s},xe=a=>{const s=a.toLowerCase();return s.includes("selesai")||s.includes("completed")?"bg-green-100 text-green-800":s.includes("diterima")||s.includes("received")||s.includes("pusat")?"bg-blue-100 text-blue-800":s.includes("proses")||s.includes("progress")||s.includes("sedang")?"bg-orange-100 text-orange-800":s.includes("menunggu")||s.includes("waiting")||s.includes("pending")?"bg-yellow-100 text-yellow-800":s.includes("ditolak")||s.includes("rejected")||s.includes("gagal")?"bg-red-100 text-red-800":s.includes("review")||s.includes("verifikasi")||s.includes("cek")?"bg-purple-100 text-purple-800":"bg-gray-100 text-gray-800"},ge=a=>{const s=a.toLowerCase();return s.includes("selesai")||s.includes("completed")||s.includes("selesai")?e.jsx(fe,{className:"h-4 w-4"}):s.includes("diterima")||s.includes("received")||s.includes("pusat")?e.jsx(ke,{className:"h-4 w-4"}):s.includes("proses")||s.includes("progress")||s.includes("sedang")?e.jsx(Y,{className:"h-4 w-4"}):s.includes("menunggu")||s.includes("waiting")||s.includes("pending")?e.jsx(ve,{className:"h-4 w-4"}):s.includes("ditolak")||s.includes("rejected")||s.includes("gagal")?e.jsx(Ne,{className:"h-4 w-4"}):s.includes("review")||s.includes("verifikasi")||s.includes("cek")?e.jsx(K,{className:"h-4 w-4"}):e.jsx(be,{className:"h-4 w-4"})},he=a=>a===1?"1 hari":a<7?`${a} hari`:a<30?`${Math.ceil(a/7)} minggu`:`${Math.ceil(a/30)} bulan`;return ne?e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx(ae,{title:"Tracking Dokumen",subtitle:"Input status tracking untuk berkas yang sudah final approved"}),e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((a,s)=>e.jsx(y,{children:e.jsx(S,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"})]})})},s))})]}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx(ae,{title:"Tracking Dokumen",subtitle:"Input status tracking untuk berkas yang sudah final approved"}),e.jsx(y,{className:"mb-6",children:e.jsx(S,{className:"p-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(K,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(ee,{placeholder:"Cari berdasarkan NIP, jenis jabatan, atau kabupaten...",value:u,onChange:a=>D(a.target.value),className:"pl-10"})]}),e.jsx("div",{className:"w-64",children:e.jsxs(_,{value:h,onValueChange:J,children:[e.jsx(C,{children:e.jsx(P,{placeholder:"Filter berdasarkan jabatan"})}),e.jsxs(T,{children:[e.jsx(o,{value:"all",children:"Semua Jabatan"}),me().map(a=>e.jsx(o,{value:a,children:a},a))]})]})}),e.jsx("div",{className:"w-64",children:e.jsxs(_,{value:g,onValueChange:$,children:[e.jsx(C,{children:e.jsx(P,{placeholder:"Filter berdasarkan status"})}),e.jsxs(T,{children:[e.jsx(o,{value:"all",children:"Semua Status"}),e.jsx(o,{value:"no-tracking",children:"Belum Ada Tracking"}),F.map(a=>e.jsx(o,{value:a.status_name,children:a.status_name},a.id))]})]})}),(u||h!=="all"||g!=="all")&&e.jsx(x,{variant:"outline",onClick:()=>{D(""),J("all"),$("all")},className:"px-4",children:"Reset Filter"})]})})}),e.jsx("div",{className:"space-y-4",children:b.length===0?e.jsx(y,{children:e.jsxs(S,{className:"p-6 text-center",children:[e.jsx(Q,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Tidak ada berkas yang perlu ditrack"})]})}):oe.map(a=>{var i,r,p;const s=I(a),t=s!==null;return e.jsx(y,{className:"hover:shadow-md transition-shadow",children:e.jsx(S,{className:"p-6",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"font-bold text-xl text-gray-900",children:((i=a.pegawai)==null?void 0:i.nama)||"Nama tidak tersedia"}),e.jsx(Se,{variant:"outline",className:"bg-gray-100 text-gray-700",children:a.jenis_jabatan})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:["NIP: ",a.pegawai_nip]})]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(je,{className:"h-4 w-4 text-gray-500"}),e.jsx("span",{children:((r=a.office)==null?void 0:r.kabkota)||((p=a.office)==null?void 0:p.nama_kantor)||"Lokasi tidak tersedia"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(Q,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{children:[a.total_dokumen," dokumen"]})]}),t?e.jsxs("div",{className:"flex items-center gap-2 text-gray-700",children:[e.jsx(W,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{children:["Estimasi: ",s.estimated_days?he(s.estimated_days):"Belum ada estimasi"]})]}):e.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{children:"Belum ada estimasi"})]})]}),t&&e.jsx("div",{className:"flex items-center gap-2 mb-3",children:e.jsxs("div",{className:`flex items-center gap-2 px-3 py-1 rounded-full text-sm font-medium ${xe(s.status_name)}`,children:[ge(s.status_name),e.jsx("span",{children:s.status_name})]})}),t&&s.notes&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-3 mb-3",children:e.jsxs("p",{className:"text-sm text-gray-700 italic",children:['"',s.notes,'"']})})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(x,{onClick:()=>ce(a),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),t?"Update Tracking":"Input Tracking"]})})]})})},a.id)})}),b.length>0&&e.jsxs("div",{className:"mt-6 flex flex-col md:flex-row items-center justify-between gap-3",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Menampilkan ",Math.min(w,M+1),"â€“",Math.min(w,U)," dari ",w," data"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(_,{value:v.toString(),onValueChange:a=>{le(parseInt(a)),j(1)},children:[e.jsx(C,{className:"w-28",children:e.jsx(P,{placeholder:"Jumlah"})}),e.jsxs(T,{children:[e.jsx(o,{value:"10",children:"10 / halaman"}),e.jsx(o,{value:"25",children:"25 / halaman"}),e.jsx(o,{value:"50",children:"50 / halaman"})]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(x,{variant:"outline",onClick:()=>j(a=>Math.max(1,a-1)),disabled:c===1,children:"Prev"}),ue().map(a=>e.jsx(x,{variant:a===c?"default":"outline",className:a===c?"bg-green-600 hover:bg-green-700 text-white":"",onClick:()=>j(a),children:a},a)),e.jsx(x,{variant:"outline",onClick:()=>j(a=>Math.min(m,a+1)),disabled:c===m,children:"Next"})]})]})]}),e.jsx(_e,{open:re,onOpenChange:k,children:e.jsxs(Ce,{className:"max-w-md",children:[e.jsx(Pe,{children:e.jsx(Te,{children:"Input Status Tracking"})}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"font-medium",children:((q=l.pegawai)==null?void 0:q.nama)||l.pegawai_nip}),e.jsxs("p",{className:"text-sm text-gray-600",children:["NIP: ",l.pegawai_nip]}),e.jsx("p",{className:"text-sm text-gray-600",children:l.jenis_jabatan}),e.jsx("p",{className:"text-sm text-gray-600",children:((G=l.office)==null?void 0:G.kabkota)||((z=l.office)==null?void 0:z.nama_kantor)||"N/A"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"status",children:"Update Status Tracking *"}),e.jsxs(_,{value:d.tracking_status_id,onValueChange:a=>N(s=>({...s,tracking_status_id:a})),children:[e.jsx(C,{children:e.jsx(P,{placeholder:"Pilih status tracking baru"})}),e.jsx(T,{children:F.map(a=>e.jsx(o,{value:a.id.toString(),children:a.status_name},a.id))})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"notes",children:"Catatan"}),e.jsx(Ie,{id:"notes",placeholder:"Catatan tambahan (opsional)",value:d.notes,onChange:a=>N(s=>({...s,notes:a.target.value})),rows:3})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"estimated_days",children:"Estimasi Penyelesaian (hari)"}),e.jsx(ee,{id:"estimated_days",type:"number",placeholder:"Contoh: 2",value:d.estimated_days,onChange:a=>{const s=a.target.value;(s===""||/^\d+$/.test(s))&&N(t=>({...t,estimated_days:s}))},min:"1",step:"1",pattern:"[0-9]*",inputMode:"numeric"})]})]}),e.jsxs("div",{className:"flex gap-2 pt-4",children:[e.jsx(x,{variant:"outline",onClick:()=>k(!1),className:"flex-1",children:"Batal"}),e.jsx(x,{onClick:de,disabled:V||!d.tracking_status_id,className:"flex-1 bg-green-600 hover:bg-green-700 text-white",children:V?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 animate-spin mr-2"}),"Menyimpan..."]}):"Simpan"})]})]})]})})]})};export{Oe as default};
//# sourceMappingURL=AdminPusatTracking-cQj7K5pN.js.map
