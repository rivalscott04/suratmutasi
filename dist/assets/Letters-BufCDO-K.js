import{j as e,F as K,a2 as le,an as Xe,at as U,a8 as Ye,a4 as R,aE as Oa,aF as we,aA as Ka,E as Qe,a1 as ea,aG as aa,aj as Ua,X as ta,aH as $a}from"./ui-vendor-DipkbOWo.js";import{r,e as za,L as sa}from"./react-vendor-DheTkQGW.js";import{u as Fa,d as Ia,a as ve,S as P,B as m,I as Ra,b as ye,D as ke,e as Se,g as _e,m as Ga,j as Ha,l as la}from"./index-4k6JnYy6.js";import{C as G,c as H,a as Va,b as Ja}from"./card-CDtrjLk7.js";import{T as Wa,a as Za,b as na,c as A,d as qa,e as T}from"./table-BuxEkocT.js";import{T as Xa,a as Ya,b as Qa,c as et,d as at,e as tt,f as st,g as lt,h as nt}from"./Template9-DhqYM5mq.js";import{A as it,a as rt,b as ct,c as dt}from"./accordion-BH4k1kwB.js";import{S as Pe,a as Ae,b as Te,c as Ce,d as C}from"./select-CU5zfeNc.js";import{P as ia}from"./PegawaiSearchInput-DzhTwAKY.js";import{u as Be,w as ot}from"./xlsx-DjuO7_Ju.js";import{L as ra}from"./label-D6QbQqu5.js";const St=()=>{const{token:w,user:l}=Fa(),[b,Ee]=r.useState([]),[N,V]=r.useState(!0),[Me,Le]=r.useState(null),[v,ne]=r.useState(""),[J,ca]=r.useState("letter_number"),[ie,da]=r.useState("asc");r.useState(1),r.useState(10);const[y,re]=r.useState("all"),{toast:k}=Ia();r.useState(null),r.useState(null),r.useState([]);const[oa,De]=r.useState(!1),[W,ma]=r.useState(null);r.useState(!1),r.useState(null),r.useState(null),r.useState(null);const[xa,Z]=r.useState({}),[ce,ha]=r.useState({}),[x,q]=r.useState(null),[h,X]=r.useState(null),[d,Y]=r.useState(null),[de,Oe]=r.useState(!1),ua=za(),[ga,Ke]=r.useState(!1),[pa,oe]=r.useState(!1),[$,me]=r.useState(null),[xe,Ue]=r.useState(!1),[p,B]=r.useState([]),[z,Q]=r.useState(!1),[ja,he]=r.useState(!1),[ue,$e]=r.useState(!1),[fa,ee]=r.useState(!1),[F,ze]=r.useState("all"),[I,Fe]=r.useState("all"),[Ie,ba]=r.useState([]),[ge,Re]=r.useState(!1),M=b.filter(a=>{var s,t,i,o,g,n;return((s=a.letter_number)==null?void 0:s.toLowerCase().includes(v.toLowerCase()))||((t=a.template_name)==null?void 0:t.toLowerCase().includes(v.toLowerCase()))||((o=(i=a.office)==null?void 0:i.namakantor)==null?void 0:o.toLowerCase().includes(v.toLowerCase()))||((n=(g=a.office)==null?void 0:g.kabkota)==null?void 0:n.toLowerCase().includes(v.toLowerCase()))}),pe=(()=>{switch(y){case"with-employee":return M.filter(a=>![2,9].includes(a.template_id));case"without-employee":return M.filter(a=>[2,9].includes(a.template_id));default:return M}})(),ae=[...pe].sort((a,s)=>{var o,g;let t=a[J]||"",i=s[J]||"";return J==="tanggal"&&(t=((o=a.form_data)==null?void 0:o.tanggal)||"",i=((g=s.form_data)==null?void 0:g.tanggal)||""),ie==="asc"?String(t).localeCompare(String(i)):String(i).localeCompare(String(t))}).reduce((a,s)=>{var i,o;let t=((i=s.office)==null?void 0:i.namakantor)||((o=s.office)==null?void 0:o.kabkota);return!t&&s.office_id&&ce[s.office_id]&&(t=ce[s.office_id].namakantor||ce[s.office_id].kabkota),t||(t="Kantor Tidak Diketahui"),a[t]||(a[t]=[]),a[t].push(s),a},{}),te=Object.entries(ae).filter(([a,s])=>v?a.toLowerCase().includes(v.toLowerCase())||s.some(t=>t.letter_number.toLowerCase().includes(v.toLowerCase())):!0);r.useEffect(()=>{w&&(V(!0),ve("/api/letters",w).then(a=>Ee(a.letters||[])).catch(a=>{a.message&&(a.message.includes("Invalid or expired token")||a.message.includes("401"))?Ke(!0):Le("Gagal mengambil data surat")}).finally(()=>V(!1)))},[w]),r.useEffect(()=>{w&&ve("/api/offices",w).then(a=>{const s={},t=a.offices||[];t.forEach(i=>{s[i.id]={namakantor:i.namakantor,kabkota:i.kabkota}}),ha(s),ba(t)}).catch(()=>{})},[w]);const Na=Array.from(new Set(b.map(a=>a.template_name))).sort(),wa=a=>b.filter(s=>s.status===a).length,va=b.length,Ge=b.length>0?b.reduce((a,s)=>(a[s.template_name]=(a[s.template_name]||0)+1,a),{}):{};Object.keys(Ge).length>0&&Object.entries(Ge).sort(([,a],[,s])=>s-a)[0][0];const _=b.length===0?null:b.reduce((a,s)=>{const t=new Date(a.created_at||0);return new Date(s.created_at||0)>t?s:a}),ya=()=>{var i,o,g,n;if(!_)return"Tidak ada data";const a=j=>({"01":"KOTA MATARAM","02":"KABUPATEN LOMBOK BARAT","03":"KABUPATEN LOMBOK TENGAH","04":"KABUPATEN LOMBOK TIMUR","05":"KABUPATEN SUMBAWA","06":"KABUPATEN DOMPU","07":"KOTA MATARAM","08":"KABUPATEN BIMA","09":"KOTA BIMA",10:"KABUPATEN SUMBAWA BARAT",11:"KABUPATEN LOMBOK UTARA",12:"KABUPATEN LOMBOK TENGAH",13:"KABUPATEN LOMBOK TIMUR",14:"KABUPATEN SUMBAWA",15:"KABUPATEN DOMPU",16:"KABUPATEN BIMA",17:"KOTA BIMA",18:"KABUPATEN SUMBAWA BARAT",19:"KABUPATEN LOMBOK UTARA",20:"KABUPATEN LOMBOK TENGAH"})[j]||"Kantor Tidak Diketahui",s=((i=_.office)==null?void 0:i.namakantor)||((o=_.office)==null?void 0:o.kabkota)||a(((g=_.form_data)==null?void 0:g.kode_kabko)||((n=_.office)==null?void 0:n.kode_kabko)||"")||"Kantor Tidak Diketahui",t=_.created_at?new Date(_.created_at).toLocaleDateString("id-ID",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}):"Tidak diketahui";return`${s} (${t})`},ka=a=>a==="generated"?e.jsx(ye,{className:"bg-green-100 text-green-700 border-green-200",children:"Generated"}):a==="signed"?e.jsx(ye,{className:"bg-blue-100 text-blue-700 border-blue-200",children:"Signed"}):null,Sa=a=>{var j;let s=a.form_data;if(typeof s=="string")try{s=JSON.parse(s)}catch{s={}}if(!s)return e.jsx("div",{className:"text-error",children:"Data surat tidak ditemukan"});const t=String(a.template_id),i=(a.letter_number||"").split("/"),o=(j=a.letter_number)==null?void 0:j.match(/^B-([^/]+)/),g={nosrt:s.nosrt||(o?o[1]:""),nosurat:s.nosurat||(o?o[1]:""),blnno:s.blnno||i[5]||"",blnnomor:s.blnnomor||i[5]||"",thnno:s.thnno||i[6]||"",tahunskrg:s.tahunskrg||i[6]||""},n={...s,...g};return a.template_id===2&&s.unitkerja&&(n.unitkerja=s.unitkerja),t==="1"?e.jsx(Xa,{data:n}):t==="2"?e.jsx(Ya,{data:n}):t==="3"?e.jsx(Qa,{data:n}):t==="4"?e.jsx(et,{data:n}):t==="5"?e.jsx(at,{data:n}):t==="6"?e.jsx(tt,{data:n}):t==="7"?e.jsx(st,{data:n}):t==="8"?e.jsx(lt,{data:n}):t==="9"?e.jsx(nt,{data:n}):e.jsx("div",{className:"text-error",children:"Template tidak dikenali"})},_a=async a=>{if(!((l==null?void 0:l.role)==="admin"||a.created_by===(l==null?void 0:l.id))){k({title:"Tidak dapat menghapus surat",description:"Anda hanya dapat menghapus surat yang Anda buat sendiri.",variant:"destructive"});return}me(a),oe(!0)},He=a=>{q(a),X(null),Y(null)},Pa=async()=>{if(!(!x||!h)&&!(x.template_id!==2&&x.template_id!==9&&!d)){Oe(!0);try{const a=x.form_data,s=x.template_id,t={...a,namapejabat:h.nama||"",nippejabat:h.nip||"",pangkatgolpejabat:h.pangkat_gol||"",jabatanpejabat:h.jabatan||""};switch(s!==2&&s!==9&&d&&(t.namapegawai=d.nama||"",t.nippegawai=d.nip||"",t.pangkatgolpegawai=d.pangkat_gol||"",t.jabatanpegawai=d.jabatan||""),(s===2||s===9)&&(delete t.namapegawai,delete t.nippegawai,delete t.pangkatgolpegawai,delete t.jabatanpegawai,delete t.ukerpegawai),s){case 1:t.ukerpejabat=h.unit_kerja||"",d&&(t.ukerpegawai=d.unit_kerja||"");break;case 2:break;case 3:d&&(t.tempattugas=d.tempat_tugas||"");break;case 4:d&&(t.unitkerja=d.unit_kerja||"");break;case 5:t.ukerpejabat=h.unit_kerja||"",d&&(t.tempattugas=d.tempat_tugas||"");break;case 6:t.ukerpejabat=h.unit_kerja||"",d&&(t.ukerpegawai=d.unit_kerja||"");break;case 7:d&&(t.tempattugas=d.tempat_tugas||"");break;case 8:d&&(t.tempattugas=d.tempat_tugas||"");break;case 9:t.ukerpejabat=h.unit_kerja||"";break}await Ha(`/api/letters/${x.id}`,{form_data:t},w),await L(),q(null),X(null),Y(null),k({title:"Berhasil",description:"Data pejabat dan pegawai berhasil diperbarui"})}catch(a){console.error("Error updating letter:",a),k({title:"Error",description:"Gagal memperbarui data surat",variant:"destructive"})}finally{Oe(!1)}}},Aa=(a,s)=>{B(s?t=>[...t,a]:t=>t.filter(i=>i!==a))},Ve=a=>{if(Q(a),a){const t=te.flatMap(([i,o])=>o).filter(i=>(l==null?void 0:l.role)==="admin"||i.created_by===(l==null?void 0:l.id));B(t.map(i=>i.id))}else B([])},Je=()=>{if(p.length===0){k({title:"Tidak ada surat dipilih",description:"Pilih surat yang akan dihapus terlebih dahulu.",variant:"destructive"});return}he(!0)},Ta=async()=>{$e(!0);try{for(const a of p)await la(`/api/letters/${a}`,w);k({title:"Surat berhasil dihapus",description:`${p.length} surat telah dihapus dari sistem.`,duration:3e3}),B([]),Q(!1),he(!1),await L(),Z({}),v&&ne("")}catch(a){k({title:"Gagal menghapus surat",description:a.message||"Terjadi kesalahan",variant:"destructive",duration:5e3})}finally{$e(!1)}},L=async()=>{V(!0);try{const a=await ve("/api/letters",w);Ee(a.letters||[])}catch{Le("Gagal mengambil data surat")}finally{V(!1)}},Ca=async()=>{if($){Ue(!0);try{await la(`/api/letters/${$.id}`,w),k({title:"Surat berhasil dihapus",description:"Surat telah dihapus dari sistem.",duration:3e3}),await L(),Z({}),v&&ne(""),oe(!1),me(null)}catch(a){k({title:"Gagal menghapus surat",description:a.message||"Terjadi kesalahan",variant:"destructive",duration:5e3})}finally{Ue(!1)}}},Ba=async()=>{Re(!0);try{let a=[...b];F!=="all"&&(a=a.filter(c=>c.template_name===F)),(l==null?void 0:l.role)==="admin"&&I!=="all"&&(a=a.filter(c=>c.office_id===I));const s=a.filter(c=>c.template_id!==9&&c.recipient_employee_nip),t=a.filter(c=>c.template_id===9||!c.recipient_employee_nip),i=Array.from(new Set(a.map(c=>c.template_name))).sort(),o={};s.forEach(c=>{var We,Ze,qe;let f=c.form_data;if(typeof f=="string")try{f=JSON.parse(f)}catch{f={}}const S=c.recipient_employee_nip||"",O=f.namapegawai||((We=c.recipient)==null?void 0:We.nama)||"",Ne=f.jabatan||((Ze=c.recipient)==null?void 0:Ze.jabatan)||"",La=c.template_name||"";o[S]||(o[S]={NIP:S,Nama:O,"Jabatan Pegawai":Ne,"NIP Penandatangan":c.signing_official_nip||"","Nama Penandatangan":((qe=c.signing_official)==null?void 0:qe.nama)||""},i.forEach(Da=>{o[S][Da]=""})),o[S][La]=c.letter_number||""});const g=Object.values(o),n=t.map(c=>{var O;let f=c.form_data;if(typeof f=="string")try{f=JSON.parse(f)}catch{f={}}const S={NIP:"",Nama:"","Jabatan Pegawai":"","NIP Penandatangan":c.signing_official_nip||"","Nama Penandatangan":((O=c.signing_official)==null?void 0:O.nama)||""};return i.forEach(Ne=>{S[Ne]=""}),S[c.template_name||""]=c.letter_number||"",S}),j=[...g,...n],u=Be.book_new(),D=Be.json_to_sheet(j),se=[{wch:20},{wch:40},{wch:40},...i.map(()=>({wch:50})),{wch:20},{wch:40}];D["!cols"]=se,Be.book_append_sheet(u,D,"Data Surat");const E=new Date,fe=`${E.getFullYear()}${String(E.getMonth()+1).padStart(2,"0")}${String(E.getDate()).padStart(2,"0")}_${String(E.getHours()).padStart(2,"0")}${String(E.getMinutes()).padStart(2,"0")}`;let be=`Export_Surat_${fe}.xlsx`;if(F!=="all"&&(be=`Export_Surat_${F.replace(/[^a-zA-Z0-9]/g,"_")}_${fe}.xlsx`),(l==null?void 0:l.role)==="admin"&&I!=="all"){const c=Ie.find(O=>O.id===I);be=`Export_Surat_${((c==null?void 0:c.kabkota)||(c==null?void 0:c.namakantor)||"Office").replace(/[^a-zA-Z0-9]/g,"_")}_${fe}.xlsx`}ot(u,be),k({title:"Export berhasil",description:`Data surat berhasil diekspor ke Excel (${a.length} data)`,duration:3e3}),ee(!1)}catch(a){console.error("Error exporting Excel:",a),k({title:"Gagal export Excel",description:a.message||"Terjadi kesalahan saat mengekspor data",variant:"destructive",duration:5e3})}finally{Re(!1)}},je=(a,s)=>{Z(t=>({...t,[a]:{...t[a]||{currentPage:1,pageSize:10},currentPage:s}}))},Ea=(a,s)=>{Z(t=>({...t,[a]:{...t[a]||{currentPage:1,pageSize:10},pageSize:s,currentPage:1}}))},Ma=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-green-100 to-blue-100 rounded-full flex items-center justify-center",children:e.jsx($a,{className:"w-12 h-12 text-green-600"})}),e.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-red-600",children:"0"})})]}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Belum Ada Surat"}),e.jsx("p",{className:"text-gray-600 text-center max-w-md mb-6",children:"Riwayat surat masih kosong. Mulai buat surat pertama Anda untuk melihat data di sini."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{asChild:!0,className:"bg-green-600 hover:bg-green-700",children:e.jsxs(sa,{to:"/generator",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Buat Surat Baru"]})}),e.jsxs(m,{variant:"outline",onClick:L,disabled:N,children:[e.jsx(le,{className:`w-4 h-4 mr-2 ${N?"animate-spin":""}`}),N?"Loading...":"Refresh Data"]})]})]});return N?e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(P,{className:"h-8 w-1/3 mb-4"}),e.jsx(P,{className:"h-6 w-1/2"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(P,{className:"h-32"}),e.jsx(P,{className:"h-32"}),e.jsx(P,{className:"h-32"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(P,{className:"h-16"}),e.jsx(P,{className:"h-16"}),e.jsx(P,{className:"h-16"})]})]}):Me?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(K,{className:"w-8 h-8 text-red-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Gagal Memuat Data"}),e.jsx("p",{className:"text-gray-600 mb-6",children:Me}),e.jsxs(m,{onClick:L,disabled:N,children:[e.jsx(le,{className:`w-4 h-4 mr-2 ${N?"animate-spin":""}`}),N?"Loading...":"Coba Lagi"]})]})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Riwayat Surat"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Kelola dan pantau semua surat yang telah dibuat"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",onClick:L,disabled:N,children:[e.jsx(le,{className:`w-4 h-4 mr-2 ${N?"animate-spin":""}`}),N?"Loading...":"Refresh"]}),e.jsxs(m,{variant:"outline",onClick:()=>ee(!0),disabled:N||b.length===0,className:"border-green-200 text-green-700 hover:bg-green-50",children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Export Excel"]}),pe.length>0&&(()=>{const a=pe.filter(s=>(l==null?void 0:l.role)==="admin"||s.created_by===(l==null?void 0:l.id)).length;return a>0?e.jsx(m,{variant:z?"destructive":"outline",onClick:()=>Ve(!z),className:z?"bg-red-600 hover:bg-red-700":"border-green-200 text-green-700 hover:bg-green-50",children:z?e.jsxs(e.Fragment,{children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Batal Pilih Semua"]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Pilih Semua (",a,")"]})}):null})(),(l==null?void 0:l.role)!=="user"&&e.jsx(m,{asChild:!0,className:"bg-green-600 hover:bg-green-700",children:e.jsxs(sa,{to:"/generator",children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Buat Surat Baru"]})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ye,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Ra,{placeholder:"Cari surat, nomor surat, atau kantor...",value:v,onChange:a=>ne(a.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Pe,{value:J,onValueChange:a=>ca(a),children:[e.jsx(Ae,{className:"w-40",children:e.jsx(Te,{placeholder:"Urutkan"})}),e.jsxs(Ce,{children:[e.jsx(C,{value:"letter_number",children:"Nomor Surat"}),e.jsx(C,{value:"template_name",children:"Template"}),e.jsx(C,{value:"tanggal",children:"Tanggal"}),e.jsx(C,{value:"status",children:"Status"})]})]}),e.jsx(m,{variant:"outline",onClick:()=>da(ie==="asc"?"desc":"asc"),children:ie==="asc"?"↑":"↓"})]})]})]}),p.length>0&&e.jsx("div",{className:"mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-blue-600",children:p.length})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-blue-900",children:[p.length," surat dipilih"]}),e.jsx("p",{className:"text-sm text-blue-700",children:"Siap untuk dihapus"})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>{B([]),Q(!1)},className:"border-green-300 text-green-700 hover:bg-green-50",children:"Batal Pilih"}),e.jsxs(m,{variant:"destructive",size:"sm",onClick:Je,className:"bg-red-600 hover:bg-red-700 shadow-sm",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Hapus ",p.length," Surat"]})]})]})}),p.length>0&&e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(m,{size:"lg",onClick:Je,className:"bg-red-600 hover:bg-red-700 shadow-lg rounded-full w-16 h-16",children:e.jsx(U,{className:"w-6 h-6"})}),e.jsxs("div",{className:"bg-white rounded-full px-3 py-1 shadow-lg text-sm font-medium text-gray-700",children:[p.length," surat"]})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-1",children:e.jsxs("nav",{className:"flex space-x-1",children:[e.jsxs("button",{onClick:()=>re("all"),className:`flex-1 flex items-center justify-center py-3 px-4 rounded-md font-medium text-sm transition-all duration-200 ${y==="all"?"bg-green-50 text-green-700 border border-green-200 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(K,{className:"w-4 h-4 mr-2"}),"Semua Surat",e.jsx("span",{className:"ml-2 bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs",children:M.length})]}),e.jsxs("button",{onClick:()=>re("with-employee"),className:`flex-1 flex items-center justify-center py-3 px-4 rounded-md font-medium text-sm transition-all duration-200 ${y==="with-employee"?"bg-green-50 text-green-700 border border-green-200 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Surat dengan Pegawai",e.jsx("span",{className:"ml-2 bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs",children:M.filter(a=>![2,9].includes(a.template_id)).length})]}),e.jsxs("button",{onClick:()=>re("without-employee"),className:`flex-1 flex items-center justify-center py-3 px-4 rounded-md font-medium text-sm transition-all duration-200 ${y==="without-employee"?"bg-orange-50 text-orange-700 border border-orange-200 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Oa,{className:"w-4 h-4 mr-2"}),"Analisis & Pernyataan",e.jsx("span",{className:"ml-2 bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs",children:M.filter(a=>[2,9].includes(a.template_id)).length})]})]})}),e.jsxs("div",{className:"mt-3 text-sm text-gray-600",children:[y==="all"&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(we,{className:"w-4 h-4 mr-2 text-green-500"}),"Menampilkan semua surat yang telah dibuat dalam sistem"]}),y==="with-employee"&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(we,{className:"w-4 h-4 mr-2 text-green-500"}),"Surat yang memerlukan data pegawai tertentu (Template 1, 3-8)"]}),y==="without-employee"&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(we,{className:"w-4 h-4 mr-2 text-orange-500"}),"Surat analisis jabatan dan pernyataan (Template 2 & 9)"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(G,{children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Surat"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:va})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(K,{className:"w-6 h-6 text-blue-600"})})]})})}),e.jsx(G,{children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Generated"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:wa("generated")})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(Ka,{className:"w-6 h-6 text-green-600"})})]})})}),e.jsx(G,{children:e.jsx(H,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Surat Terbaru"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:_?`${_.letter_number} - ${ya()}`:"Tidak ada data"})]}),e.jsx("div",{className:"w-12 h-12 bg-teal-100 rounded-lg flex items-center justify-center",children:e.jsx(Qe,{className:"w-6 h-6 text-teal-600"})})]})})})]}),b.length===0?e.jsx(G,{children:e.jsx(H,{className:"p-0",children:e.jsx(Ma,{})})}):e.jsxs(G,{children:[e.jsx(Va,{children:e.jsxs(Ja,{className:"flex items-center gap-2",children:[e.jsx(ea,{className:"w-5 h-5"}),y==="all"&&`Surat Berdasarkan Kantor (${Object.keys(ae).length} Kantor)`,y==="with-employee"&&`Surat dengan Pegawai (${Object.keys(ae).length} Kantor)`,y==="without-employee"&&`Surat Analisis & Pernyataan (${Object.keys(ae).length} Kantor)`]})}),e.jsx(H,{children:te.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ye,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Tidak Ada Hasil"}),e.jsx("p",{className:"text-gray-600",children:"Coba ubah kata kunci pencarian Anda"})]}):e.jsx(it,{type:"multiple",className:"space-y-2",children:te.map(([a,s],t)=>{const i=xa[a]||{currentPage:1,pageSize:10},o=Math.ceil(s.length/i.pageSize),g=s.slice((i.currentPage-1)*i.pageSize,i.currentPage*i.pageSize);return e.jsxs(rt,{value:`office-${t}`,className:"border rounded-lg",children:[e.jsx(ct,{className:"px-6 py-4 hover:bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(ea,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:a}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.length," surat"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(ye,{variant:"secondary",children:s.length})})]})}),e.jsxs(dt,{className:"px-6 pb-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-2 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:`pageSize-${t}`,className:"text-sm",children:"Tampilkan"}),e.jsx("select",{id:`pageSize-${t}`,value:i.pageSize,onChange:n=>Ea(a,Number(n.target.value)),className:"border rounded px-2 py-1 text-sm",children:[10,20,50,100].map(n=>e.jsx("option",{value:n,children:n},n))}),e.jsx("span",{className:"text-sm",children:"data per halaman"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Menampilkan ",s.length===0?0:(i.currentPage-1)*i.pageSize+1,"–",Math.min(i.currentPage*i.pageSize,s.length)," dari ",s.length," surat"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Wa,{children:[e.jsx(Za,{className:"bg-gray-50",children:e.jsxs(na,{children:[e.jsx(A,{className:"w-12",children:e.jsx("div",{className:"flex items-center gap-2",children:(()=>{const j=te.flatMap(([u,D])=>D).filter(u=>(l==null?void 0:l.role)==="admin"||u.created_by===(l==null?void 0:l.id)).length;return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"checkbox",checked:z,onChange:u=>Ve(u.target.checked),disabled:j===0,className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50"}),p.length>0&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:p.length})]})})()})}),e.jsx(A,{children:"No."}),e.jsx(A,{children:"Nomor Surat"}),e.jsx(A,{children:"Template"}),e.jsx(A,{children:"Pegawai"}),e.jsx(A,{children:"Tanggal"}),e.jsx(A,{children:"Status"}),e.jsx(A,{children:"Aksi"})]})}),e.jsx(qa,{children:g.map((n,j)=>{let u=n.form_data;if(typeof u=="string")try{u=JSON.parse(u)}catch{u={}}const D=(l==null?void 0:l.role)==="admin"||n.created_by===(l==null?void 0:l.id),se=p.includes(n.id);return e.jsxs(na,{className:se?"bg-blue-50 border-blue-200":"",children:[e.jsx(T,{children:e.jsx("input",{type:"checkbox",checked:se,onChange:E=>Aa(n.id,E.target.checked),disabled:!D,className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50"})}),e.jsx(T,{children:(i.currentPage-1)*i.pageSize+j+1}),e.jsx(T,{className:"font-mono text-sm",children:n.letter_number}),e.jsx(T,{children:n.template_name}),e.jsx(T,{children:n.template_id===9?e.jsx("span",{className:"text-gray-500",children:"Tanpa Pegawai"}):e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:u.namapegawai}),e.jsx("div",{className:"text-sm text-gray-500",children:n.recipient_employee_nip})]})}),e.jsx(T,{children:u.tanggal||"-"}),e.jsx(T,{children:ka(n.status)}),e.jsx(T,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{variant:"outline",size:"sm",onClick:()=>{ma(n),De(!0)},children:e.jsx(Qe,{className:"w-4 h-4"})}),(l==null?void 0:l.role)!=="user"&&((l==null?void 0:l.role)==="admin"||n.created_by===(l==null?void 0:l.id))&&n.template_id!==2&&n.template_id!==9&&e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>He(n),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(aa,{className:"w-4 h-4 mr-2"}),"Edit Pejabat & Pegawai"]}),(l==null?void 0:l.role)!=="user"&&((l==null?void 0:l.role)==="admin"||n.created_by===(l==null?void 0:l.id))&&(n.template_id===2||n.template_id===9)&&e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>He(n),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(aa,{className:"w-4 h-4 mr-2"}),"Edit Pejabat"]}),(l==null?void 0:l.role)==="admin"&&((l==null?void 0:l.role)==="admin"||n.created_by===(l==null?void 0:l.id))&&e.jsx(m,{variant:"outline",size:"sm",onClick:()=>_a(n),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(U,{className:"w-4 h-4"})})]})})]},n.id)})})]})}),o>1&&e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[e.jsx(m,{size:"sm",variant:"outline",onClick:()=>je(a,Math.max(1,i.currentPage-1)),disabled:i.currentPage===1,children:"Prev"}),Array.from({length:o},(n,j)=>j+1).map(n=>e.jsx(m,{size:"sm",variant:n===i.currentPage?"default":"outline",onClick:()=>je(a,n),children:n},n)),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>je(a,Math.min(o,i.currentPage+1)),disabled:i.currentPage===o,children:"Next"})]})]})]},t)})})})]}),e.jsx(ke,{open:oa,onOpenChange:De,children:e.jsxs(Se,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(_e,{children:"Preview Surat"}),W&&e.jsx(m,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>window.open(Ga(`/letters/${W.id}/preview`),"_blank"),children:"Open in New Tab"})]}),W&&e.jsx("div",{className:"mt-4",children:Sa(W)})]})}),ga&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full flex flex-col items-center animate-fade-in",children:[e.jsx(Ua,{className:"w-16 h-16 text-yellow-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Sesi Berakhir"}),e.jsx("p",{className:"text-gray-600 mb-6 text-center",children:"Sesi Anda telah habis. Silakan login kembali untuk melanjutkan."}),e.jsx("button",{className:"w-full py-3 rounded-lg bg-green-600 hover:bg-green-700 text-white text-lg font-semibold shadow transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-400",onClick:()=>{localStorage.removeItem("token"),Ke(!1),ua("/login",{replace:!0})},children:"Login Ulang"})]})}),pa&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full flex flex-col items-center animate-fade-in",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(U,{className:"w-8 h-8 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Hapus Surat"}),e.jsxs("p",{className:"text-gray-600 mb-6 text-center",children:["Apakah Anda yakin ingin menghapus surat ",e.jsx("strong",{children:$==null?void 0:$.letter_number}),"? Tindakan ini tidak dapat dibatalkan."]}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx(m,{variant:"outline",onClick:()=>{oe(!1),me(null)},disabled:xe,className:"flex-1",children:"Batal"}),e.jsx(m,{onClick:Ca,disabled:xe,className:"flex-1 bg-red-600 hover:bg-red-700",children:xe?"Menghapus...":"Hapus"})]})]})}),ja&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full flex flex-col items-center animate-fade-in",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(U,{className:"w-8 h-8 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Hapus Surat"}),e.jsxs("p",{className:"text-gray-600 mb-6 text-center",children:["Apakah Anda yakin ingin menghapus ",p.length," surat yang dipilih? Tindakan ini tidak dapat dibatalkan."]}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx(m,{variant:"outline",onClick:()=>{he(!1),B([]),Q(!1)},disabled:ue,className:"flex-1",children:"Batal"}),e.jsx(m,{onClick:Ta,disabled:ue,className:"flex-1 bg-red-600 hover:bg-red-700",children:ue?"Menghapus...":"Hapus"})]})]})}),x&&e.jsx(ke,{open:!!x,onOpenChange:a=>{a||q(null)},children:e.jsxs(Se,{className:"max-w-2xl",children:[e.jsx(_e,{children:x.template_id===2||x.template_id===9?"Edit Pejabat":"Edit Pejabat & Pegawai"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx(ia,{label:"Cari Pejabat",placeholder:"Masukkan nama atau NIP pejabat...",onSelect:X,selectedPegawai:h})}),x.template_id!==2&&x.template_id!==9&&e.jsx("div",{children:e.jsx(ia,{label:"Cari Pegawai",placeholder:"Masukkan nama atau NIP pegawai...",onSelect:Y,selectedPegawai:d})})]}),e.jsxs("div",{className:"space-y-4",children:[h&&e.jsxs("div",{className:"border rounded-lg p-4 bg-blue-50",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 flex items-center",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Preview Pejabat"]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>X(null),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-100",children:e.jsx(ta,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Nama:"})," ",h.nama]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"NIP:"})," ",h.nip]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Pangkat/Gol:"})," ",h.pangkat_gol]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Jabatan:"})," ",h.jabatan]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Unit Kerja:"})," ",h.unit_kerja]})]})]}),d&&x.template_id!==2&&x.template_id!==9&&e.jsxs("div",{className:"border rounded-lg p-4 bg-green-50",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("h4",{className:"font-semibold text-green-900 flex items-center",children:[e.jsx(R,{className:"w-4 h-4 mr-2"}),"Preview Pegawai"]}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>Y(null),className:"text-green-600 hover:text-green-700 hover:bg-green-100",children:e.jsx(ta,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Nama:"})," ",d.nama]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"NIP:"})," ",d.nip]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Pangkat/Gol:"})," ",d.pangkat_gol]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Jabatan:"})," ",d.jabatan]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Unit Kerja:"})," ",d.unit_kerja]}),d.tempat_tugas&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Tempat Tugas:"})," ",d.tempat_tugas]})]})]}),!h&&(x.template_id===2||x.template_id===9)&&e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 text-center text-gray-500",children:[e.jsx(R,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"Pilih pejabat untuk melihat preview"})]}),!h&&!d&&x.template_id!==2&&x.template_id!==9&&e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 text-center text-gray-500",children:[e.jsx(R,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"Pilih pejabat dan pegawai untuk melihat preview"})]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-4",children:[e.jsx(m,{variant:"outline",onClick:()=>q(null),disabled:de,children:"Batal"}),e.jsx(m,{onClick:Pa,disabled:de||!h||x.template_id!==2&&x.template_id!==9&&!d,className:"bg-green-600 hover:bg-green-700 text-white",children:de?"Menyimpan...":"Simpan"})]})]})}),e.jsx(ke,{open:fa,onOpenChange:ee,children:e.jsxs(Se,{className:"max-w-2xl",children:[e.jsx(_e,{children:"Export Data ke Excel"}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ra,{htmlFor:"template-filter",children:"Filter by Jenis Surat/Template"}),e.jsxs(Pe,{value:F,onValueChange:ze,children:[e.jsx(Ae,{id:"template-filter",children:e.jsx(Te,{placeholder:"Pilih template"})}),e.jsxs(Ce,{children:[e.jsx(C,{value:"all",children:"Semua Template"}),Na.map(a=>e.jsx(C,{value:a,children:a},a))]})]})]}),(l==null?void 0:l.role)==="admin"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(ra,{htmlFor:"office-filter",children:"Filter by Kabupaten/Kota"}),e.jsxs(Pe,{value:I,onValueChange:Fe,children:[e.jsx(Ae,{id:"office-filter",children:e.jsx(Te,{placeholder:"Pilih kabupaten/kota"})}),e.jsxs(Ce,{children:[e.jsx(C,{value:"all",children:"Semua Kabupaten/Kota"}),Ie.map(a=>e.jsx(C,{value:a.id,children:a.kabkota||a.namakantor||a.name||"Kantor Tidak Diketahui"},a.id))]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(m,{variant:"outline",onClick:()=>{ee(!1),ze("all"),Fe("all")},disabled:ge,children:"Batal"}),e.jsx(m,{onClick:Ba,disabled:ge,className:"bg-green-600 hover:bg-green-700",children:ge?e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"w-4 h-4 mr-2 animate-spin"}),"Mengekspor..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"w-4 h-4 mr-2"}),"Export"]})})]})]})]})})]})};export{St as default};
//# sourceMappingURL=Letters-BufCDO-K.js.map
