import{j as a,a4 as _,ah as B,a6 as q,au as z,a0 as H,ao as J,aE as Q}from"./ui-vendor-Cjkg25QM.js";import{r as t}from"./react-vendor-BNG1zHOu.js";import{d as X,s as Z,y as U,G as ee,w as I,b as P}from"./index-C-Q-VUjU.js";function se(d,F={}){const{autoSave:w=!1,autoSaveInterval:k=3e4,showToastOnSave:x=!0,showToastOnError:p=!0,showToastOnValidation:f=!1,debounceValidation:b=300}=F,[r,i]=t.useState({isSubmitting:!1,isValidating:!1,isDirty:!1,isValid:!1,errors:{},warnings:{},success:{},hasUnsavedChanges:!1});X();const o=t.useRef(),v=t.useRef(),N=t.useRef(d);t.useEffect(()=>{N.current=d},[d]),t.useEffect(()=>(w&&r.isDirty&&!r.isSubmitting&&(o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{D()},k)),()=>{o.current&&clearTimeout(o.current)}),[w,r.isDirty,r.isSubmitting,k]);const A=t.useCallback(()=>{i(e=>({...e,isSubmitting:!0,isValidating:!0}))},[]),R=t.useCallback((e,s)=>{i(c=>({...c,isSubmitting:!1,isValidating:!1,hasUnsavedChanges:!e})),e?(S(),x&&s&&Z("SAVE_SUCCESS",s)):p&&s&&U("SAVE_FAILED",s)},[x,p]),h=t.useCallback(e=>{i(s=>({...s,isValidating:e}))},[]),C=t.useCallback(e=>{i(s=>({...s,isDirty:e,hasUnsavedChanges:e}))},[]),j=t.useCallback(e=>{i(s=>({...s,isValid:e}))},[]),y=t.useCallback(e=>{var s;if(i(c=>({...c,errors:e})),f&&Object.keys(e).length>0){const c=(s=Object.values(e)[0])==null?void 0:s[0];c&&U("VALIDATION_ERROR",c)}},[f]),T=t.useCallback(e=>{i(s=>({...s,warnings:e}))},[]),V=t.useCallback(e=>{i(s=>({...s,success:e}))},[]),O=t.useCallback(()=>{i(e=>({...e,errors:{},warnings:{},success:{}}))},[]),S=t.useCallback(()=>{i(e=>({...e,isDirty:!1,hasUnsavedChanges:!1,lastSaved:new Date,success:{...e.success,_general:["Data berhasil disimpan"]}}))},[]),n=t.useCallback((e,s)=>{const c=Array.isArray(s)?s:[s];i(l=>({...l,errors:{...l.errors,[e]:c}}))},[]),m=t.useCallback((e,s)=>{const c=Array.isArray(s)?s:[s];i(l=>({...l,warnings:{...l.warnings,[e]:c}}))},[]),g=t.useCallback((e,s)=>{const c=Array.isArray(s)?s:[s];i(l=>({...l,success:{...l.success,[e]:c}}))},[]),u=t.useCallback(e=>{i(s=>({...s,errors:{...s.errors,[e]:[]},warnings:{...s.warnings,[e]:[]},success:{...s.success,[e]:[]}}))},[]),E=t.useCallback(async(e,s,c)=>(v.current&&clearTimeout(v.current),new Promise(l=>{v.current=setTimeout(async()=>{try{c&&(await c.parseAsync(s),u(e),g(e,"Data valid")),l(!0)}catch(M){if(M.errors&&M.errors.length>0){const K=M.errors[0].message;n(e,K),l(!1)}else n(e,"Data tidak valid"),l(!1)}},b)})),[b,u,n,g]),D=t.useCallback(async()=>{if(!(r.isSubmitting||!r.isDirty))try{h(!0),S(),x&&ee("Data otomatis tersimpan")}catch{U("SAVE_FAILED","Gagal auto-save")}finally{h(!1)}},[r.isSubmitting,r.isDirty,S,x,h]),$=t.useCallback(e=>r.errors[e]&&r.errors[e].length>0,[r.errors]),W=t.useCallback(e=>r.warnings[e]&&r.warnings[e].length>0,[r.success]),L=t.useCallback(e=>r.success[e]&&r.success[e].length>0,[r.success]),Y=t.useCallback(e=>{var s,c,l;return{error:(s=r.errors[e])==null?void 0:s[0],warning:(c=r.warnings[e])==null?void 0:c[0],success:(l=r.success[e])==null?void 0:l[0],hasError:$(e),hasWarning:W(e),hasSuccess:L(e)}},[r,$,W,L]);return{feedback:r,startSubmission:A,endSubmission:R,setValidating:h,setDirty:C,setValid:j,setErrors:y,setWarnings:T,setSuccess:V,clearFeedback:O,markSaved:S,setFieldError:n,setFieldWarning:m,setFieldSuccess:g,clearFieldFeedback:u,validateField:E,triggerAutoSave:D,hasFieldError:$,hasFieldWarning:W,hasFieldSuccess:L,getFieldFeedback:Y}}const G=t.createContext(null);function ne({children:d,initialData:F,autoSave:w=!1,autoSaveInterval:k=3e4,showToastOnSave:x=!0,showToastOnError:p=!0,showToastOnValidation:f=!1,debounceValidation:b=300}){const r=se(F,{autoSave:w,autoSaveInterval:k,showToastOnSave:x,showToastOnError:p,showToastOnValidation:f,debounceValidation:b});return a.jsx(G.Provider,{value:{formFeedback:r},children:d})}function ie(){const d=t.useContext(G);if(!d)throw new Error("useFormFeedbackContext must be used within a FormFeedbackProvider");return d.formFeedback}const ce=({feedback:d,showLastSaved:F=!0,showUnsavedChanges:w=!0,showValidationStatus:k=!0,className:x,compact:p=!1})=>{const{isSubmitting:f,isValidating:b,isDirty:r,isValid:i,hasUnsavedChanges:o,lastSaved:v,errors:N,warnings:A,success:R}=d,h=Object.values(N).some(n=>n.length>0),C=Object.values(A).some(n=>n.length>0);Object.values(R).some(n=>n.length>0);const j=Object.values(N).reduce((n,m)=>n+m.length,0),y=Object.values(A).reduce((n,m)=>n+m.length,0),T=()=>f||b?"text-blue-600":h?"text-red-600":C?"text-yellow-600":i&&!o?"text-green-600":r||o?"text-orange-600":"text-gray-600",V=()=>f?a.jsx(q,{className:"h-4 w-4 animate-spin text-green-600"}):b?a.jsx(B,{className:"h-4 w-4 animate-pulse"}):h?a.jsx(z,{className:"h-4 w-4"}):C?a.jsx(_,{className:"h-4 w-4"}):i&&!o?a.jsx(H,{className:"h-4 w-4"}):r||o?a.jsx(J,{className:"h-4 w-4"}):a.jsx(Q,{className:"h-4 w-4"}),O=()=>f?"Menyimpan...":b?"Memvalidasi...":h?`Ada ${j} kesalahan`:C?`Ada ${y} peringatan`:i&&!o?"Form valid":r||o?"Ada perubahan belum disimpan":"Form siap",S=n=>{const g=new Date().getTime()-n.getTime(),u=Math.floor(g/1e3),E=Math.floor(u/60),D=Math.floor(E/60);return u<60?`${u} detik yang lalu`:E<60?`${E} menit yang lalu`:D<24?`${D} jam yang lalu`:n.toLocaleDateString("id-ID")};return p?a.jsxs("div",{className:I("flex items-center gap-2",x),children:[a.jsxs("div",{className:I("flex items-center gap-1",T()),children:[V(),a.jsx("span",{className:"text-sm font-medium",children:O()})]}),o&&a.jsx(P,{variant:"outline",className:"text-orange-600 border-orange-200",children:"Belum disimpan"}),j>0&&a.jsxs(P,{variant:"destructive",className:"text-xs",children:[j," error"]}),y>0&&a.jsxs(P,{variant:"secondary",className:"text-yellow-600 bg-yellow-100 border-yellow-200 text-xs",children:[y," warning"]})]}):a.jsxs("div",{className:I("space-y-3",x),children:[a.jsxs("div",{className:I("flex items-center gap-2",T()),children:[V(),a.jsx("span",{className:"text-sm font-medium",children:O()})]}),a.jsxs("div",{className:"space-y-2 text-xs text-gray-600",children:[k&&a.jsxs("div",{className:"flex items-center gap-4",children:[a.jsxs("span",{children:["Valid: ",i?"Ya":"Tidak"]}),a.jsxs("span",{children:["Dirty: ",r?"Ya":"Tidak"]}),j>0&&a.jsxs("span",{className:"text-red-600",children:["Errors: ",j]}),y>0&&a.jsxs("span",{className:"text-yellow-600",children:["Warnings: ",y]})]}),w&&o&&a.jsxs("div",{className:"flex items-center gap-1 text-orange-600",children:[a.jsx(_,{className:"h-3 w-3"}),a.jsx("span",{children:"Ada perubahan yang belum disimpan"})]}),F&&v&&a.jsxs("div",{className:"flex items-center gap-1 text-gray-500",children:[a.jsx(B,{className:"h-3 w-3"}),a.jsxs("span",{children:["Terakhir disimpan: ",S(v)]})]})]}),h&&a.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-md p-2",children:[a.jsx("div",{className:"text-sm font-medium text-red-800 mb-1",children:"Kesalahan:"}),a.jsx("ul",{className:"text-xs text-red-700 space-y-1",children:Object.entries(N).map(([n,m])=>m.map((g,u)=>a.jsxs("li",{children:[a.jsxs("span",{className:"font-medium",children:[n,":"]})," ",g]},`${n}-${u}`)))})]}),C&&a.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-2",children:[a.jsx("div",{className:"text-sm font-medium text-yellow-800 mb-1",children:"Peringatan:"}),a.jsx("ul",{className:"text-xs text-yellow-700 space-y-1",children:Object.entries(A).map(([n,m])=>m.map((g,u)=>a.jsxs("li",{children:[a.jsxs("span",{className:"font-medium",children:[n,":"]})," ",g]},`${n}-${u}`)))})]})]})};export{ne as F,ce as a,ie as u};
//# sourceMappingURL=form-status-indicator-Bv8gAXtU.js.map
