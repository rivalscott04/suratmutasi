import{j as a,aw as Ba,a2 as ha,a3 as O,F as Q,E as Ra,an as Ea,as as Fa,U as _a,aD as ba,ak as Ma,ab as xa,aa as Ua,b0 as Ja,al as Ca,aL as $a}from"./ui-vendor-DipkbOWo.js";import{r as o,d as Ia,e as Wa}from"./react-vendor-DheTkQGW.js";import{C as na,c as ta,a as ja,b as ka}from"./card-9SLqvVW8.js";import{u as fa,d as La,B as R,b as S,a as z,c as Pa,y as Ha,z as za,P as Oa}from"./index-CVVVLDtj.js";import{S as qa,a as Ga,b as Va,c as Xa,d as Qa}from"./select-KOimkH0f.js";import{u as Sa,S as Ya}from"./protected-button-DEiQgEFk.js";import{P as Za}from"./PageHeader-Du6QMQyO.js";import{A as ra,a as ia,b as la,c as da,d as oa,e as ua,f as ca}from"./alert-dialog-Df7nom5M.js";const ya=({progress:c,isUploading:u,className:_=""})=>{const r=Math.min(Math.max(c,0),100),m=Math.round(r*10)/10,w=()=>u?m===0||m<20?"Preparing upload...":m<90?"Uploading file...":m<100?"Processing...":"Complete!":"",p=()=>m<20?"text-blue-600":m<90?"text-green-600":m<100?"text-yellow-600":"text-green-600",K=()=>m<20?"bg-blue-600":m<90?"bg-green-600":m<100?"bg-yellow-600":"bg-green-600";return u?a.jsxs("div",{className:`space-y-2 ${_}`,children:[a.jsxs("div",{className:"flex items-center justify-between text-xs",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"animate-spin h-3 w-3 border border-green-600 border-t-transparent rounded-full"}),a.jsx("span",{className:`font-medium ${p()}`,children:w()})]}),a.jsxs("span",{className:`font-semibold ${p()}`,children:[m,"%"]})]}),a.jsx("div",{className:"w-full",children:a.jsx("div",{className:"relative h-1.5 w-full overflow-hidden rounded-full bg-gray-200",children:a.jsx("div",{className:`h-full transition-all duration-300 ${K()}`,style:{width:`${m}%`}})})})]}):null},X=c=>String(c).toLowerCase().replace(/[^a-z0-9_-]+/gi,"_").replace(/^_+|_+$/g,""),ae=({pengajuanId:c,jenisJabatanId:u,onFilesUploaded:_,onProgressChange:r,pengajuanStatus:m,pengajuanData:w})=>{const{token:p,user:K}=fa(),{toast:Y}=La();Sa();const[x,$]=o.useState([]),[N,T]=o.useState([]);o.useState([]),o.useState("");const[D,E]=o.useState({}),[q,A]=o.useState({}),[B,I]=o.useState(!0),[y,j]=o.useState(null),[F,b]=o.useState(null),[ma,v]=o.useState(!1),[Z,W]=o.useState(!1),[aa,G]=o.useState(""),[ea,V]=o.useState("Error");o.useState(!1);const M=async()=>{try{I(!0),j(null);let e;if(isNaN(Number(u)))try{const n=await z("/api/job-type-configurations",p);if(n!=null&&n.success&&Array.isArray(n.data)){const t=n.data.find(l=>l.jenis_jabatan===u);if(t)e=t.id;else{j("Jenis jabatan tidak ditemukan");return}}else{j("Gagal mengambil data jenis jabatan");return}}catch{j("Gagal mencari jenis jabatan");return}else e=parseInt(String(u));const s=await z(`/api/admin-wilayah-file-config/job-type/${e}`,p);if(console.log("ðŸ” API Response:",s),console.log("ðŸ” Job Type ID:",e),console.log("ðŸ” Jenis Jabatan ID:",u),s.success){if(console.log("âœ… Setting required files:",s.data),$(s.data),r){const n=N.filter(t=>s.data.some(l=>l.file_type===t.file_type)).length;r(n,s.data.length||0)}}else j("Failed to fetch file configurations")}catch(e){console.error("Error fetching file configs:",e),j("Error connecting to server")}finally{I(!1)}},L=async()=>{var e;try{const s=await z(`/api/admin-wilayah/pengajuan/${c}`,p);if(s!=null&&s.success){const t=(s.uploadedAdminWilayahFiles||((e=s.data)==null?void 0:e.uploadedAdminWilayahFiles)||[]).map(l=>({id:l.id,pengajuan_id:c,file_type:l.file_type,file_name:l.file_name,file_path:l.file_path,file_size:l.file_size,verification_status:l.verification_status||"pending",created_at:l.created_at,updated_at:l.updated_at}));T(t)}else T([])}catch(s){console.error("Error fetching uploaded files:",s),T([])}};o.useEffect(()=>{u&&(M(),L())},[u,p]),o.useEffect(()=>{if(r){const e=x.length,s=N.filter(n=>x.some(t=>t.file_type===n.file_type)).length;r(s,e)}},[x,N]);const U=async(e,s)=>{console.log("ðŸš€ START UPLOAD - fileType:",e,"fileName:",s.name),E(n=>({...n,[e]:!0})),A(n=>({...n,[e]:0}));try{if(!ga()){E(d=>({...d,[e]:!1})),A(d=>({...d,[e]:0}));return}console.log("ðŸ” Uploading file:",{fileType:e,fileName:s.name,pengajuanId:c,jenisJabatanId:u,requiredFiles:x.map(d=>({file_type:d.file_type,display_name:d.display_name}))});const n=new FormData;n.append("file",s),n.append("pengajuan_id",c),n.append("file_type",e),n.append("file_category","admin_wilayah"),n.append("uploaded_by_role","admin_wilayah"),n.append("uploaded_by_name",(K==null?void 0:K.full_name)||"Admin Wilayah"),n.append("uploaded_by_office","Kanwil Provinsi"),console.log("ðŸ“¦ FormData created:",{file:s.name,pengajuan_id:c,file_type:e,file_category:"admin_wilayah"});for(let[d,P]of n.entries())console.log("ðŸ“‹ FormData entry:",d,P);const t=setInterval(()=>{A(d=>{const P=d[e]||0;return P<90?{...d,[e]:P+Math.random()*20}:d})},200),l=await Pa(`/api/admin-wilayah/pengajuan/${c}/upload`,n,p);if(clearInterval(t),A(d=>({...d,[e]:100})),l.success){const d={id:l.data.id,pengajuan_id:c,file_type:e,file_name:s.name,file_path:l.data.file_path,file_size:s.size,verification_status:"pending",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},P=[...N,d];if(T(P),_(P),r){const sa=x.length,pa=P.filter(Ka=>x.some(Aa=>Aa.file_type===Ka.file_type)).length;r(pa,sa)}Y({title:"Success",description:`Upload berhasil: ${s.name}`,variant:"default",duration:3e3})}else{const d=l.message||"Terjadi kesalahan saat mengupload file. Silakan coba lagi.";H("Upload Gagal",d)}}catch(n){console.error("Error uploading file:",n),H("Upload Gagal","Terjadi kesalahan saat mengupload file. Periksa koneksi internet Anda dan coba lagi.")}finally{E(n=>({...n,[e]:!1})),A(n=>({...n,[e]:0}))}},i=e=>{if(e===0)return"0 Bytes";const s=1024,n=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,t)).toFixed(2))+" "+n[t]},h=e=>N.find(n=>n.file_type===e)?"uploaded":"pending",g=e=>N.find(s=>s.file_type===e),k=(e,s)=>{var t;return((t={Guru:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Madrasah":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Wakil Kepala Madrasah":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala TU":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Seksi":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Sub Bagian":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Urusan":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},Staff:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},Pelaksana:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"}}[e])==null?void 0:t[s])||null},f=e=>{const{file_type:s,display_name:n}=e;if(s==="surat_rekomendasi_kanwil")return k(u,s)||"Surat Rekomendasi dari Instansi Pembina - Varian 6.1-6.9";const t=k(u,s);return t||n},J=async e=>{try{const s=await fetch(`/api/pengajuan/files/${e.id}`,{headers:{Authorization:`Bearer ${p}`}});if(!s.ok)throw new Error("Gagal mengambil file");const n=await s.blob(),t=URL.createObjectURL(n);window.open(t,"_blank"),setTimeout(()=>URL.revokeObjectURL(t),5e3)}catch{Ha("OPERATION_FAILED","Gagal membuka preview file")}},C=async e=>{try{const s=await fetch(`/api/pengajuan/files/${e.id}`,{headers:{Authorization:`Bearer ${p}`}});if(!s.ok)throw new Error("Gagal mengambil file");const n=await s.blob(),t=URL.createObjectURL(n),l=document.createElement("a");l.href=t,l.download=e.file_name||"file.pdf",document.body.appendChild(l),l.click(),l.remove(),setTimeout(()=>URL.revokeObjectURL(t),5e3)}catch{za("Gagal mengunduh file")}},wa=e=>{const s=document.getElementById(`replace-${X(e)}`);s&&s.click()},ga=()=>{if(!(w!=null&&w.jabatan_name)||!u)return!0;const e=String(w.jabatan_name).toLowerCase(),s=String(u).toLowerCase();return e!==s?(H("Jabatan Tidak Sesuai",`Jenis jabatan yang Anda pilih tidak sama dengan yang diajukan oleh operator.

â€¢ Diajukan operator: ${w.jabatan_name}
â€¢ Dipilih admin wilayah: ${u}

Silakan pilih jenis jabatan yang sesuai terlebih dahulu, lalu ulangi upload.`),!1):!0},H=(e,s)=>{V(e),G(s),W(!0)},Na=(e,s)=>{s.preventDefault(),s.stopPropagation(),b(e),v(!0)},va=(e,s)=>{s.preventDefault(),s.stopPropagation(),s.currentTarget.contains(s.relatedTarget)||(b(null),v(!1))},Ta=e=>{e.preventDefault(),e.stopPropagation()},Da=(e,s)=>{var t;if(s.preventDefault(),s.stopPropagation(),!ga()){b(null),v(!1);return}const n=s.dataTransfer.files;if(n&&n.length>0){const l=n[0],d=[".pdf",".doc",".docx"],P="."+((t=l.name.split(".").pop())==null?void 0:t.toLowerCase());if(!d.includes(P)){H("Format File Tidak Didukung","Hanya file PDF, DOC, dan DOCX yang diizinkan untuk diupload."),b(null),v(!1);return}const sa=e==="skp_2_tahun_terakhir"?1.6*1024*1024:500*1024;if(l.size>sa){H("Ukuran File Terlalu Besar",`Ukuran file maksimal ${e==="skp_2_tahun_terakhir"?"1.6MB":"500KB"}. Silakan kompres file atau pilih file yang lebih kecil.`),b(null),v(!1);return}U(e,l)}b(null),v(!1)};return B?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3"}),a.jsx("div",{className:"space-y-3",children:[...Array(5)].map((e,s)=>a.jsx("div",{className:"h-20 bg-gray-200 rounded"},s))})]})}):y?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"text-center py-8",children:[a.jsx(Ba,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Files"}),a.jsx("p",{className:"text-gray-600 mb-4",children:y}),a.jsxs(R,{onClick:M,className:"flex items-center gap-2",children:[a.jsx(ha,{className:"h-4 w-4"}),"Retry"]})]})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Upload File Admin Wilayah"}),a.jsxs(R,{onClick:()=>{M(),L()},variant:"outline",size:"sm",children:[a.jsx(ha,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Dokumen Wajib Admin Wilayah"}),a.jsx("div",{className:"text-sm text-gray-600",children:`${x.filter(s=>N.some(n=>n.file_type===s.file_type)).length}/${x.length} berkas sudah diupload`})]}),a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:x.map(e=>{console.log("ðŸ”§ Rendering fileConfig:",e);const s=h(e.file_type),n=g(e.file_type);return a.jsx(na,{className:"border border-gray-200",children:a.jsx(ta,{className:"p-3",children:a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h4",{className:"font-medium text-gray-900 text-sm leading-tight",title:f(e),children:f(e)}),e.is_required&&a.jsx(S,{variant:"destructive",className:"text-[10px] py-0 px-1.5",children:"Wajib"})]}),s==="uploaded"?a.jsxs(S,{className:"bg-green-600 text-white flex items-center gap-1 text-xs",children:[a.jsx(O,{className:"h-3 w-3"}),"Uploaded"]}):a.jsxs(S,{variant:"secondary",className:"flex items-center gap-1 text-xs",children:[a.jsx(Q,{className:"h-3 w-3"}),"Pending"]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("p",{className:"text-xs text-gray-500",children:["PDF (maks. ",e.file_type==="skp_2_tahun_terakhir"?"1.6MB":"500KB",")"]}),a.jsx(ya,{progress:q[e.file_type]||0,isUploading:D[e.file_type],className:"mt-2"}),s==="uploaded"&&n&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-1 text-green-600 text-xs",children:[a.jsx(O,{className:"h-3 w-3"}),a.jsx("span",{className:"truncate",children:n.file_name}),a.jsxs("span",{className:"text-gray-500",children:["(",i(n.file_size),")"]})]}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx(R,{size:"sm",variant:"outline",onClick:()=>J(n),className:"h-6 px-2 text-xs",children:a.jsx(Ra,{className:"h-3 w-3"})}),a.jsx(R,{size:"sm",variant:"outline",onClick:()=>C(n),className:"h-6 px-2 text-xs",children:a.jsx(Ea,{className:"h-3 w-3"})}),a.jsx(R,{size:"sm",variant:"outline",onClick:()=>wa(e.file_type),className:"h-6 px-2 text-xs",children:a.jsx(Fa,{className:"h-3 w-3"})}),a.jsx("input",{id:`replace-${X(e.file_type)}`,type:"file",className:"hidden",accept:".pdf,.doc,.docx",onChange:t=>{var d;const l=(d=t.target.files)==null?void 0:d[0];l&&(U(e.file_type,l),t.target.value="")}})]})]}),s!=="uploaded"&&a.jsxs("div",{className:`relative border-2 border-dashed rounded-lg p-6 transition-all duration-200 cursor-pointer w-full h-32 ${F===e.file_type?"border-green-500 bg-green-50":"border-gray-300 hover:border-green-400 hover:bg-gray-50"} ${D[e.file_type]?"pointer-events-none opacity-50":""}`,onDragEnter:t=>Na(e.file_type,t),onDragLeave:t=>va(e.file_type,t),onDragOver:Ta,onDrop:t=>Da(e.file_type,t),onClick:()=>{const t=document.getElementById(`file-${X(e.file_type)}`);t&&!t.disabled&&!D[e.file_type]&&t.click()},children:[a.jsx("div",{className:"flex flex-col items-center justify-center h-full text-center",children:D[e.file_type]?a.jsx("div",{className:"w-full max-w-xs",children:a.jsx(ya,{progress:q[e.file_type]||0,isUploading:D[e.file_type]})}):F===e.file_type?a.jsxs(a.Fragment,{children:[a.jsx(_a,{className:"h-8 w-8 text-green-500 mb-2"}),a.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Lepaskan file di sini"})]}):a.jsxs(a.Fragment,{children:[a.jsx(_a,{className:"h-6 w-6 text-gray-400 mb-2"}),a.jsx("p",{className:"text-xs text-gray-600 leading-tight",children:"Drag & drop file di sini atau klik untuk memilih"})]})}),a.jsx("input",{type:"file",accept:".pdf,.doc,.docx",onChange:t=>{var d;console.log("ðŸ“ File input changed:",t.target.files);const l=(d=t.target.files)==null?void 0:d[0];l?(console.log("ðŸ“„ File selected:",l.name,"fileConfig.file_type:",e.file_type),U(e.file_type,l),t.target.value=""):console.log("âŒ No file selected")},className:"hidden",id:`file-${X(e.file_type)}`})]})]})]})})},e.id)})})]}),a.jsx(ra,{open:Z,onOpenChange:W,children:a.jsxs(ia,{className:"max-w-md",children:[a.jsxs(la,{children:[a.jsxs(da,{className:"flex items-center gap-2 text-red-600 text-lg",children:[a.jsx(ba,{className:"h-5 w-5"}),ea]}),a.jsx(oa,{className:"text-gray-700 whitespace-pre-line leading-relaxed",children:aa})]}),a.jsx(ua,{children:a.jsx(ca,{onClick:()=>W(!1),className:"bg-red-600 hover:bg-red-700",children:"Tutup"})})]})})]})},ee=({uploaded:c,total:u,isComplete:_,className:r=""})=>{const m=u>0?Math.round(c/u*100):0;return a.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 ${r}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Progress Upload Dokumen"}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:[c," dari ",u," dokumen"]}),a.jsxs("div",{className:"text-lg font-bold text-green-600",children:[m,"%"]})]})]}),a.jsx("div",{className:"mb-4",children:a.jsx(Oa,{value:m,className:"h-3 bg-gray-200"})}),a.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[a.jsx(O,{className:"h-4 w-4"}),a.jsxs("span",{children:[c," Terupload"]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[a.jsx(Ma,{className:"h-4 w-4"}),a.jsxs("span",{children:[u-c," Belum"]})]}),_&&a.jsxs("div",{className:"flex items-center gap-2 text-green-600 font-medium",children:[a.jsx(O,{className:"h-4 w-4"}),a.jsx("span",{children:"Upload Selesai"})]})]})]})},ue=()=>{var V,M,L,U;const{pengajuanId:c}=Ia(),u=Wa(),{token:_}=fa(),[r,m]=o.useState(null),[w,p]=o.useState(!0);o.useState(!1);const{submitForm:K,isSubmitting:Y}=Sa(),[x,$]=o.useState(!1),[N,T]=o.useState(!1),[D,E]=o.useState(""),[q,A]=o.useState([]),[B,I]=o.useState(""),[y,j]=o.useState({required:0,total:0,isComplete:!1}),F=(r==null?void 0:r.status)==="admin_wilayah_rejected"&&!!(r!=null&&r.final_rejected_at),b=async()=>{var i,h;if(!(!_||!c)){p(!0);try{const g=await z(`/api/admin-wilayah/pengajuan/${c}`,_);if(g&&g.success!==!1){m(g.pengajuan||((i=g.data)==null?void 0:i.pengajuan)||g);const k=g.uploadProgress||((h=g.data)==null?void 0:h.uploadProgress);if(k){const f=Number(k.required??0),J=Number(k.total??0),C=typeof k.isComplete=="boolean"?k.isComplete:f>=J;j({required:f,total:J,isComplete:C})}else j({required:0,total:0,isComplete:!1})}else m(null),j({required:0,total:0,isComplete:!1})}catch(g){console.error("Failed to fetch pengajuan detail",g),m(null)}finally{p(!1)}}},ma=async()=>{try{const i=await z("/api/admin-wilayah-file-config",_);if(i!=null&&i.success&&Array.isArray(i.data)){const h=new Map;i.data.forEach(k=>{var C;const f=k.jenis_jabatan_id,J=((C=k.jenis_jabatan)==null?void 0:C.jenis_jabatan)||`Jabatan ${f}`;f&&!h.has(f)&&h.set(f,J)});const g=Array.from(h.values());A(g),g.length>0&&!B&&I(g[0])}}catch(i){console.error("Failed to fetch job types:",i)}};o.useEffect(()=>{b(),ma()},[c,_]);const v=i=>new Date(i).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),Z=(i,h)=>{switch(i){case"approved":return a.jsx(S,{className:"bg-green-600 text-white",children:"Disetujui Kab/Kota"});case"admin_wilayah_approved":return a.jsx(S,{className:"bg-green-700 text-white",children:"Disetujui Admin Wilayah"});case"admin_wilayah_rejected":return a.jsx(S,{className:"bg-red-600 text-white",children:"Ditolak Admin Wilayah"});case"admin_wilayah_submitted":return a.jsx(S,{className:"bg-blue-600 text-white",children:"Diajukan Admin Wilayah"});case"submitted":return a.jsx(S,{className:"bg-blue-600 text-white",children:"Dikirim ke Superadmin"});default:return a.jsx(S,{className:"bg-gray-600 text-white",children:i})}},W=async()=>{!_||!c||K(async()=>{try{const i=await Pa(`/api/admin-wilayah/pengajuan/${c}/submit-to-superadmin`,{},_);(i==null?void 0:i.success)!==!1&&(E("Pengajuan berhasil diajukan ke Superadmin"),$(!0),i.pengajuan&&m(i.pengajuan)),await b()}catch(i){console.error("Error submitting to superadmin:",i),E((i==null?void 0:i.message)||"Terjadi kesalahan saat mengajukan ke Superadmin"),T(!0)}},()=>{},i=>{console.error("Error submitting to superadmin:",i)})};if(w)return a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsx("div",{className:"max-w-6xl mx-auto",children:a.jsxs("div",{className:"animate-pulse space-y-6",children:[a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),a.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})})});if(!r)return a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsx("div",{className:"max-w-6xl mx-auto",children:a.jsxs("div",{className:"text-center py-12",children:[a.jsx(Q,{className:"h-16 w-16 mx-auto text-gray-300 mb-4"}),a.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Pengajuan Tidak Ditemukan"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Pengajuan yang Anda cari tidak ditemukan atau tidak memiliki akses."}),a.jsxs(R,{onClick:()=>u("/admin-wilayah/dashboard"),className:"bg-green-600 hover:bg-green-700 text-white",children:[a.jsx(xa,{className:"h-4 w-4 mr-2"}),"Kembali ke Dashboard"]})]})})});const aa=r.status==="admin_wilayah_approved"||r.status==="admin_wilayah_submitted"||r.status==="admin_wilayah_rejected"||F,G=r.status==="admin_wilayah_submitted"||!y.isComplete,ea=r.status==="admin_wilayah_submitted"?"Sudah Diajukan":F||r.status==="admin_wilayah_rejected"?"Ajukan Lagi ke Superadmin":"Ajukan ke Superadmin";return a.jsxs("div",{className:"min-h-screen bg-background p-6",children:[a.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[a.jsx(Za,{title:"Upload File Admin Wilayah",subtitle:"Upload file tambahan untuk pengajuan mutasi pegawai",actions:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(S,{className:"bg-green-100 text-green-800",children:"Admin Wilayah"}),Z(r.status),a.jsxs(R,{variant:"outline",onClick:()=>u("/admin-wilayah/dashboard"),className:"border-green-200 text-green-700 hover:bg-green-50",children:[a.jsx(xa,{className:"h-4 w-4 mr-2"}),"Kembali"]})]})}),a.jsxs(na,{className:"border-green-200 bg-green-50",children:[a.jsx(ja,{children:a.jsxs(ka,{className:"text-green-800 flex items-center gap-2",children:[a.jsx(Q,{className:"h-5 w-5"}),"Informasi Pengajuan"]})}),a.jsx(ta,{children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Ua,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:((V=r.pegawai)==null?void 0:V.nama)||"-"}),a.jsxs("p",{className:"text-sm text-gray-600",children:["NIP: ",((M=r.pegawai)==null?void 0:M.nip)||"-"]})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Ja,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:((L=r.office)==null?void 0:L.kabkota)||"-"}),a.jsx("p",{className:"text-sm text-gray-600",children:((U=r.office)==null?void 0:U.name)||"-"})]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Q,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Jenis Jabatan"}),a.jsx("p",{className:"text-sm text-gray-600",children:r.jenis_jabatan})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Ca,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Tanggal Pengajuan"}),a.jsx("p",{className:"text-sm text-gray-600",children:v(r.created_at)})]})]})]})]})})]}),a.jsxs(na,{children:[a.jsx(ja,{children:a.jsx(ka,{className:"text-green-800",children:"Upload File Admin Wilayah"})}),a.jsxs(ta,{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Jenis Berkas Admin Wilayah"}),a.jsxs(qa,{value:B,onValueChange:I,children:[a.jsx(Ga,{className:"w-full max-w-md",children:a.jsx(Va,{placeholder:"Pilih jenis berkas..."})}),a.jsx(Xa,{children:q.map(i=>a.jsx(Qa,{value:i,children:i},i))})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Pilih jenis berkas yang sudah dikonfigurasi oleh superadmin"})]}),B&&y.total>0&&a.jsx(ee,{uploaded:y.required,total:y.total,isComplete:y.isComplete,className:"mb-6"}),(F||r.status==="admin_wilayah_rejected")&&a.jsxs("div",{className:"mb-4 rounded-lg border border-red-200 bg-red-50 p-4 text-sm text-red-800",children:[a.jsx("p",{className:"font-semibold mb-1",children:"Dokumen Admin Wilayah Ditolak"}),a.jsx("p",{children:r.final_rejection_reason||r.rejection_reason||"Perbaiki dokumen admin wilayah yang ditolak sebelum mengirim ulang ke Superadmin."}),(r.final_rejected_at||r.rejected_at)&&a.jsxs("p",{className:"text-xs text-red-600 mt-2",children:["Ditolak pada: ",v(r.final_rejected_at||r.rejected_at)]})]}),B&&a.jsx(ae,{pengajuanId:r.id,jenisJabatanId:B,onFilesUploaded:()=>b(),onProgressChange:(i,h)=>j({required:i,total:h,isComplete:i>=h&&h>0}),pengajuanStatus:r.status,pengajuanData:r})]})]}),a.jsx("div",{className:"flex items-center justify-end gap-3",children:aa&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{className:"text-sm text-gray-600 mr-2",children:[y.required,"/",y.total," berkas wajib"]}),a.jsxs(Ya,{onClick:G?()=>{}:W,className:`bg-green-600 hover:bg-green-700 text-white ${G?"opacity-50 cursor-not-allowed":""}`,isProcessing:Y,processingText:"Mengirim...",onError:()=>{},onSuccess:()=>{},children:[a.jsx($a,{className:"h-4 w-4 mr-2"}),ea]})]})})]}),a.jsx(ra,{open:x,onOpenChange:$,children:a.jsxs(ia,{children:[a.jsxs(la,{children:[a.jsxs(da,{className:"flex items-center gap-2 text-green-600 text-lg",children:[a.jsx(O,{className:"h-5 w-5"}),"Berhasil!"]}),a.jsx(oa,{className:"text-gray-700",children:D})]}),a.jsx(ua,{children:a.jsx(ca,{onClick:()=>$(!1),className:"bg-green-600 hover:bg-green-700",children:"OK"})})]})}),a.jsx(ra,{open:N,onOpenChange:T,children:a.jsxs(ia,{children:[a.jsxs(la,{children:[a.jsxs(da,{className:"flex items-center gap-2 text-red-600 text-lg",children:[a.jsx(ba,{className:"h-5 w-5"}),"Gagal Mengajukan"]}),a.jsx(oa,{className:"text-gray-700",children:D})]}),a.jsx(ua,{children:a.jsx(ca,{onClick:()=>T(!1),className:"bg-red-600 hover:bg-red-700",children:"OK"})})]})})]})};export{ue as default};
//# sourceMappingURL=AdminWilayahUploadPage-44KRId0l.js.map
