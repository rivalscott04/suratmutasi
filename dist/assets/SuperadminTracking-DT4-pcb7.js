import{j as e,F as H,a3 as K,ak as C,aw as T,a8 as ce,E as de,b2 as me,aa as xe,al as oe,T as he}from"./ui-vendor-B7g5fNgE.js";import{r as l}from"./react-vendor-BNG1zHOu.js";import{u as je,d as ue,a as ge,I as pe,b as v,B as P,D as Ne,e as fe,f as be,g as ve}from"./index-f4rt3-t3.js";import{C as m,c as x}from"./card-CAiCEFmw.js";import{T as we,a as ye,b as F,c as r,d as Se,e as c}from"./table-UA79Q_WQ.js";import{S as O,a as V,b as $,c as R,d as j}from"./select-paUEFtl1.js";import{P as G}from"./PageHeader-DSpfLw86.js";const Be=()=>{var L,z;const{user:w,token:U}=je(),{toast:q}=ue(),[I,Q]=l.useState([]),[W,B]=l.useState(!0),[y,X]=l.useState(""),[u,Y]=l.useState("all"),[g,p]=l.useState(1),[N,Z]=l.useState(10),[t,ee]=l.useState(null),[ae,E]=l.useState(!1),[f,se]=l.useState({tracked:0,completed:0,inProgress:0,overdue:0});l.useEffect(()=>{te()},[]);const te=async()=>{try{B(!0);const s=(w==null?void 0:w.office_id)===null?"/api/tracking/superadmin":"/api/tracking/admin",n=await ge(s,U);n.success&&(Q(n.data),le(n.data))}catch(a){console.error("Error loading tracking data:",a),q({title:"Error",description:"Gagal memuat data tracking",variant:"destructive"})}finally{B(!1)}},le=a=>{let s=0,n=0,d=0,i=0;a.forEach(h=>{if(h.tracking&&h.tracking.length>0){s++;const b=h.tracking[0];if(b.status_name.includes("Selesai"))n++;else if(d++,b.estimated_days){const D=new Date(b.created_at);D.setDate(D.getDate()+b.estimated_days),new Date>D&&i++}}}),se({tracked:s,completed:n,inProgress:d,overdue:i})},ne=a=>{ee(a),E(!0)},o=I.filter(a=>{var i,h;const s=y.toLowerCase(),n=a.pegawai_nip.toLowerCase().includes(s)||a.jenis_jabatan.toLowerCase().includes(s)||(((i=a.office)==null?void 0:i.kabkota)||"").toLowerCase().includes(s)||(((h=a.pegawai)==null?void 0:h.nama)||"").toLowerCase().includes(s),d=u==="all"||a.jenis_jabatan===u;return n&&d});l.useEffect(()=>{p(1)},[y,u]);const ie=Array.from(new Set(I.map(a=>a.jenis_jabatan))).sort(),S=Math.max(1,Math.ceil(o.length/N)),_=(g-1)*N,M=_+N,re=o.slice(_,M),J=a=>a.includes("Selesai")?e.jsx(K,{className:"h-4 w-4 text-green-600"}):a.includes("Diproses")?e.jsx(C,{className:"h-4 w-4 text-blue-600"}):a.includes("Disposisi")?e.jsx(he,{className:"h-4 w-4 text-orange-600"}):e.jsx(T,{className:"h-4 w-4 text-gray-600"}),A=(a,s=!1)=>a.includes("Selesai")?"bg-green-100 text-green-700 border-green-200":a.includes("Diproses")?`bg-blue-100 text-blue-700 border-blue-200 ${s?"border-red-400 text-red-700":""}`:a.includes("Disposisi")?"bg-orange-100 text-orange-700 border-orange-200":a.includes("Menunggu")?"bg-yellow-100 text-yellow-700 border-yellow-200":"bg-gray-100 text-gray-700 border-gray-200",k=a=>{if(!a.estimated_days)return!1;const s=new Date(a.created_at);return s.setDate(s.getDate()+a.estimated_days),new Date>s&&!a.status_name.includes("Selesai")};return W?e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx(G,{title:"Tracking Dokumen",subtitle:"Monitor progress berkas di pusat"}),e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((a,s)=>e.jsx(m,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"})]})})},s))})]}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx(G,{title:"Tracking Dokumen",subtitle:"Monitor progress berkas di pusat"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(m,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(H,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Memiliki riwayat tracking"}),e.jsx("p",{className:"text-2xl font-bold",children:f.tracked})]})]})})}),e.jsx(m,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Selesai"}),e.jsx("p",{className:"text-2xl font-bold",children:f.completed})]})]})})}),e.jsx(m,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Dalam Proses"}),e.jsx("p",{className:"text-2xl font-bold",children:f.inProgress})]})]})})}),e.jsx(m,{children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{className:"h-8 w-8 text-red-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Terlambat"}),e.jsx("p",{className:"text-2xl font-bold",children:f.overdue})]})]})})})]}),e.jsx(m,{className:"mb-6",children:e.jsx(x,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(pe,{placeholder:"Cari NIP/Nama/Jabatan/Kabupaten...",value:y,onChange:a=>X(a.target.value),className:"pl-10"})]}),e.jsx("div",{className:"w-full md:w-64",children:e.jsxs(O,{value:u,onValueChange:Y,children:[e.jsx(V,{children:e.jsx($,{placeholder:"Semua Jabatan"})}),e.jsxs(R,{children:[e.jsx(j,{value:"all",children:"Semua Jabatan"}),ie.map(a=>e.jsx(j,{value:a,children:a},a))]})]})})]})})}),e.jsx(m,{children:e.jsx(x,{className:"p-0",children:o.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(H,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Tidak ada data tracking"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(we,{children:[e.jsx(ye,{children:e.jsxs(F,{children:[e.jsx(r,{children:"NIP"}),e.jsx(r,{children:"Nama Pegawai"}),e.jsx(r,{children:"Jabatan"}),e.jsx(r,{children:"Kab/Kota"}),e.jsx(r,{children:"Status Terakhir"}),e.jsx(r,{children:"Estimasi"}),e.jsx(r,{children:"Tgl Final"}),e.jsx(r,{children:"Aksi"})]})}),e.jsx(Se,{children:re.map(a=>{var d,i;const s=a.tracking&&a.tracking.length>0?a.tracking[0]:null,n=a.final_approved_at?new Date(a.final_approved_at).toLocaleDateString("id-ID"):"Belum ditentukan";return e.jsxs(F,{children:[e.jsx(c,{className:"font-medium",children:a.pegawai_nip}),e.jsx(c,{children:((d=a.pegawai)==null?void 0:d.nama)||"â€”"}),e.jsx(c,{children:e.jsx(v,{variant:"outline",children:a.jenis_jabatan})}),e.jsx(c,{children:((i=a.office)==null?void 0:i.kabkota)||"N/A"}),e.jsx(c,{children:s?e.jsxs("div",{className:"flex items-center gap-2",children:[J(s.status_name),e.jsx(v,{title:s.status_name,className:`cursor-default hover:brightness-95 ${A(s.status_name,k(s))}`,children:s.status_name})]}):e.jsx("span",{className:"text-gray-500",children:"Belum ada"})}),e.jsx(c,{children:s!=null&&s.estimated_days?`${s.estimated_days} hari`:"-"}),e.jsx(c,{children:n}),e.jsx(c,{children:e.jsxs(P,{size:"sm",variant:"outline",className:"flex items-center gap-2",onClick:()=>ne(a),children:[e.jsx(de,{className:"h-4 w-4"})," Detail"]})})]},a.id)})})]})})})}),o.length>0&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Menampilkan ",_+1,"-",Math.min(M,o.length)," dari ",o.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mr-2",children:[e.jsx("span",{children:"Tampilkan"}),e.jsxs(O,{value:String(N),onValueChange:a=>{Z(Number(a)),p(1)},children:[e.jsx(V,{className:"h-8 w-[84px]",children:e.jsx($,{})}),e.jsxs(R,{children:[e.jsx(j,{value:"10",children:"10"}),e.jsx(j,{value:"25",children:"25"}),e.jsx(j,{value:"50",children:"50"})]})]}),e.jsx("span",{children:"per halaman"})]}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>p(a=>Math.max(1,a-1)),disabled:g===1,children:"Sebelumnya"}),e.jsxs("span",{className:"text-sm",children:["Hal ",g," / ",S]}),e.jsx(P,{variant:"outline",size:"sm",onClick:()=>p(a=>Math.min(S,a+1)),disabled:g===S,children:"Berikutnya"})]})]}),e.jsx(Ne,{open:ae,onOpenChange:E,children:e.jsxs(fe,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(be,{children:e.jsx(ve,{children:"Detail Tracking"})}),t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h3",{className:"font-semibold text-xl leading-tight",children:((L=t.pegawai)==null?void 0:L.nama)||"-"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 font-mono",children:["NIP: ",t.pegawai_nip]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Jenis Jabatan:"}),e.jsx("p",{className:"text-gray-600",children:t.jenis_jabatan})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Kabupaten/Kota:"}),e.jsx("p",{className:"text-gray-600",children:((z=t.office)==null?void 0:z.kabkota)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Dokumen:"}),e.jsx("p",{className:"text-gray-600",children:t.total_dokumen})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Final Approved:"}),e.jsx("p",{className:"text-gray-600",children:t.final_approved_at?new Date(t.final_approved_at).toLocaleDateString("id-ID"):"Belum ditentukan"})]})]})]}),t.tracking&&t.tracking.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Riwayat Tracking"}),e.jsxs("div",{className:"relative pl-6",children:[e.jsx("div",{className:"absolute left-2 top-0 bottom-0 w-px bg-gray-200"}),e.jsx("div",{className:"space-y-6",children:t.tracking.map(a=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-[7px] top-1 h-3 w-3 rounded-full bg-green-600 ring-2 ring-white"}),e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[J(a.status_name),e.jsx(v,{title:a.status_name,className:`cursor-default hover:brightness-95 ${A(a.status_name,k(a))}`,children:a.status_name}),k(a)&&e.jsxs(v,{variant:"destructive",className:"text-xs",children:[e.jsx(me,{className:"h-3 w-3 mr-1"})," Terlambat"]})]}),e.jsxs("div",{className:"text-xs text-gray-600 flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(xe,{className:"h-3 w-3"}),a.tracked_by_name]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"h-3 w-3"}),new Date(a.created_at).toLocaleString("id-ID")]}),a.estimated_days&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"h-3 w-3"}),"Estimasi: ",a.estimated_days," hari"]})]}),a.notes&&e.jsx("div",{className:"mt-2 text-sm text-gray-700",children:a.notes})]})]},a.id))})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(T,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Belum ada tracking untuk berkas ini"})]})]})]})})]})};export{Be as default};
//# sourceMappingURL=SuperadminTracking-DT4-pcb7.js.map
