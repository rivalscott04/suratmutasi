import{j as a,au as Ba,$ as ga,a0 as H,F as V,aB as Ra,al as Ea,aq as Fa,U as pa,aC as ka,ah as Ma,a8 as ha,a7 as Ua,a$ as Ja,aj as Ca,aK as $a}from"./ui-vendor-Cjkg25QM.js";import{r as u,d as Ia,e as Wa}from"./react-vendor-BNG1zHOu.js";import{C as Z,c as aa,a as _a,b as xa}from"./card-CZ1Pa9v9.js";import{u as ya,d as Ha,B as R,b as f,a as W,c as ba,y as La,z as za,P as Oa}from"./index-jkintgbN.js";import{S as qa,a as Ga,b as Va,c as Xa,d as Qa}from"./select-CAyonKqA.js";import{u as fa,S as Ya}from"./protected-button-BwOkRfjP.js";import{P as Za}from"./PageHeader-C_qdceav.js";import{A as ea,a as sa,b as na,c as ta,d as ra,e as ia,f as la}from"./alert-dialog-D0QRkee4.js";const ja=({progress:c,isUploading:o,className:_=""})=>{const l=Math.min(Math.max(c,0),100),m=Math.round(l*10)/10,P=()=>o?m===0||m<20?"Preparing upload...":m<90?"Uploading file...":m<100?"Processing...":"Complete!":"",h=()=>m<20?"text-blue-600":m<90?"text-green-600":m<100?"text-yellow-600":"text-green-600",K=()=>m<20?"bg-blue-600":m<90?"bg-green-600":m<100?"bg-yellow-600":"bg-green-600";return o?a.jsxs("div",{className:`space-y-2 ${_}`,children:[a.jsxs("div",{className:"flex items-center justify-between text-xs",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"animate-spin h-3 w-3 border border-green-600 border-t-transparent rounded-full"}),a.jsx("span",{className:`font-medium ${h()}`,children:P()})]}),a.jsxs("span",{className:`font-semibold ${h()}`,children:[m,"%"]})]}),a.jsx("div",{className:"w-full",children:a.jsx("div",{className:"relative h-1.5 w-full overflow-hidden rounded-full bg-gray-200",children:a.jsx("div",{className:`h-full transition-all duration-300 ${K()}`,style:{width:`${m}%`}})})})]}):null},G=c=>String(c).toLowerCase().replace(/[^a-z0-9_-]+/gi,"_").replace(/^_+|_+$/g,""),ae=({pengajuanId:c,jenisJabatanId:o,onFilesUploaded:_,onProgressChange:l,pengajuanStatus:m,pengajuanData:P})=>{const{token:h,user:K}=ya(),{toast:X}=Ha();fa();const[j,C]=u.useState([]),[S,N]=u.useState([]);u.useState([]),u.useState("");const[v,E]=u.useState({}),[L,A]=u.useState({}),[B,$]=u.useState(!0),[y,k]=u.useState(null),[F,T]=u.useState(null),[da,D]=u.useState(!1),[Q,M]=u.useState(!1),[z,O]=u.useState(""),[q,r]=u.useState("Error");u.useState(!1);const p=async()=>{try{$(!0),k(null);let e;if(isNaN(Number(o)))try{const n=await W("/api/job-type-configurations",h);if(n!=null&&n.success&&Array.isArray(n.data)){const t=n.data.find(i=>i.jenis_jabatan===o);if(t)e=t.id;else{k("Jenis jabatan tidak ditemukan");return}}else{k("Gagal mengambil data jenis jabatan");return}}catch{k("Gagal mencari jenis jabatan");return}else e=parseInt(String(o));const s=await W(`/api/admin-wilayah-file-config/job-type/${e}`,h);if(console.log("ðŸ” API Response:",s),console.log("ðŸ” Job Type ID:",e),console.log("ðŸ” Jenis Jabatan ID:",o),s.success){if(console.log("âœ… Setting required files:",s.data),C(s.data),l){const n=S.filter(t=>s.data.some(i=>i.file_type===t.file_type)).length;l(n,s.data.length||0)}}else k("Failed to fetch file configurations")}catch(e){console.error("Error fetching file configs:",e),k("Error connecting to server")}finally{$(!1)}},g=async()=>{var e;try{const s=await W(`/api/admin-wilayah/pengajuan/${c}`,h);if(s!=null&&s.success){const t=(s.uploadedAdminWilayahFiles||((e=s.data)==null?void 0:e.uploadedAdminWilayahFiles)||[]).map(i=>({id:i.id,pengajuan_id:c,file_type:i.file_type,file_name:i.file_name,file_path:i.file_path,file_size:i.file_size,verification_status:i.verification_status||"pending",created_at:i.created_at,updated_at:i.updated_at}));N(t)}else N([])}catch(s){console.error("Error fetching uploaded files:",s),N([])}};u.useEffect(()=>{o&&(p(),g())},[o,h]),u.useEffect(()=>{if(l){const e=j.length,s=S.filter(n=>j.some(t=>t.file_type===n.file_type)).length;l(s,e)}},[j,S]);const x=async(e,s)=>{console.log("ðŸš€ START UPLOAD - fileType:",e,"fileName:",s.name),E(n=>({...n,[e]:!0})),A(n=>({...n,[e]:0}));try{if(!ca()){E(d=>({...d,[e]:!1})),A(d=>({...d,[e]:0}));return}console.log("ðŸ” Uploading file:",{fileType:e,fileName:s.name,pengajuanId:c,jenisJabatanId:o,requiredFiles:j.map(d=>({file_type:d.file_type,display_name:d.display_name}))});const n=new FormData;n.append("file",s),n.append("pengajuan_id",c),n.append("file_type",e),n.append("file_category","admin_wilayah"),n.append("uploaded_by_role","admin_wilayah"),n.append("uploaded_by_name",(K==null?void 0:K.full_name)||"Admin Wilayah"),n.append("uploaded_by_office","Kanwil Provinsi"),console.log("ðŸ“¦ FormData created:",{file:s.name,pengajuan_id:c,file_type:e,file_category:"admin_wilayah"});for(let[d,b]of n.entries())console.log("ðŸ“‹ FormData entry:",d,b);const t=setInterval(()=>{A(d=>{const b=d[e]||0;return b<90?{...d,[e]:b+Math.random()*20}:d})},200),i=await ba(`/api/admin-wilayah/pengajuan/${c}/upload`,n,h);if(clearInterval(t),A(d=>({...d,[e]:100})),i.success){const d={id:i.data.id,pengajuan_id:c,file_type:e,file_name:s.name,file_path:i.data.file_path,file_size:s.size,verification_status:"pending",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},b=[...S,d];if(N(b),_(b),l){const Y=j.length,ma=b.filter(Ka=>j.some(Aa=>Aa.file_type===Ka.file_type)).length;l(ma,Y)}X({title:"Success",description:`Upload berhasil: ${s.name}`,variant:"default",duration:3e3})}else{const d=i.message||"Terjadi kesalahan saat mengupload file. Silakan coba lagi.";I("Upload Gagal",d)}}catch(n){console.error("Error uploading file:",n),I("Upload Gagal","Terjadi kesalahan saat mengupload file. Periksa koneksi internet Anda dan coba lagi.")}finally{E(n=>({...n,[e]:!1})),A(n=>({...n,[e]:0}))}},w=e=>{if(e===0)return"0 Bytes";const s=1024,n=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,t)).toFixed(2))+" "+n[t]},U=e=>S.find(n=>n.file_type===e)?"uploaded":"pending",J=e=>S.find(s=>s.file_type===e),ua=(e,s)=>{var t;return((t={Guru:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Madrasah":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Wakil Kepala Madrasah":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala TU":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Seksi":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Sub Bagian":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Urusan":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},Staff:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},Pelaksana:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"}}[e])==null?void 0:t[s])||null},oa=e=>{const{file_type:s,display_name:n}=e;if(s==="surat_rekomendasi_kanwil")return ua(o,s)||"Surat Rekomendasi dari Instansi Pembina - Varian 6.1-6.9";const t=ua(o,s);return t||n},Pa=async e=>{try{const s=await fetch(`/api/pengajuan/files/${e.id}`,{headers:{Authorization:`Bearer ${h}`}});if(!s.ok)throw new Error("Gagal mengambil file");const n=await s.blob(),t=URL.createObjectURL(n);window.open(t,"_blank"),setTimeout(()=>URL.revokeObjectURL(t),5e3)}catch{La("OPERATION_FAILED","Gagal membuka preview file")}},Sa=async e=>{try{const s=await fetch(`/api/pengajuan/files/${e.id}`,{headers:{Authorization:`Bearer ${h}`}});if(!s.ok)throw new Error("Gagal mengambil file");const n=await s.blob(),t=URL.createObjectURL(n),i=document.createElement("a");i.href=t,i.download=e.file_name||"file.pdf",document.body.appendChild(i),i.click(),i.remove(),setTimeout(()=>URL.revokeObjectURL(t),5e3)}catch{za("Gagal mengunduh file")}},wa=e=>{const s=document.getElementById(`replace-${G(e)}`);s&&s.click()},ca=()=>{if(!(P!=null&&P.jabatan_name)||!o)return!0;const e=String(P.jabatan_name).toLowerCase(),s=String(o).toLowerCase();return e!==s?(I("Jabatan Tidak Sesuai",`Jenis jabatan yang Anda pilih tidak sama dengan yang diajukan oleh operator.

â€¢ Diajukan operator: ${P.jabatan_name}
â€¢ Dipilih admin wilayah: ${o}

Silakan pilih jenis jabatan yang sesuai terlebih dahulu, lalu ulangi upload.`),!1):!0},I=(e,s)=>{r(e),O(s),M(!0)},Na=(e,s)=>{s.preventDefault(),s.stopPropagation(),T(e),D(!0)},va=(e,s)=>{s.preventDefault(),s.stopPropagation(),s.currentTarget.contains(s.relatedTarget)||(T(null),D(!1))},Ta=e=>{e.preventDefault(),e.stopPropagation()},Da=(e,s)=>{var t;if(s.preventDefault(),s.stopPropagation(),!ca()){T(null),D(!1);return}const n=s.dataTransfer.files;if(n&&n.length>0){const i=n[0],d=[".pdf",".doc",".docx"],b="."+((t=i.name.split(".").pop())==null?void 0:t.toLowerCase());if(!d.includes(b)){I("Format File Tidak Didukung","Hanya file PDF, DOC, dan DOCX yang diizinkan untuk diupload."),T(null),D(!1);return}const Y=e==="skp_2_tahun_terakhir"?1.6*1024*1024:500*1024;if(i.size>Y){I("Ukuran File Terlalu Besar",`Ukuran file maksimal ${e==="skp_2_tahun_terakhir"?"1.6MB":"500KB"}. Silakan kompres file atau pilih file yang lebih kecil.`),T(null),D(!1);return}x(e,i)}T(null),D(!1)};return B?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3"}),a.jsx("div",{className:"space-y-3",children:[...Array(5)].map((e,s)=>a.jsx("div",{className:"h-20 bg-gray-200 rounded"},s))})]})}):y?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"text-center py-8",children:[a.jsx(Ba,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Files"}),a.jsx("p",{className:"text-gray-600 mb-4",children:y}),a.jsxs(R,{onClick:p,className:"flex items-center gap-2",children:[a.jsx(ga,{className:"h-4 w-4"}),"Retry"]})]})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Upload File Admin Wilayah"}),a.jsxs(R,{onClick:()=>{p(),g()},variant:"outline",size:"sm",children:[a.jsx(ga,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Dokumen Wajib Admin Wilayah"}),a.jsx("div",{className:"text-sm text-gray-600",children:`${j.filter(s=>S.some(n=>n.file_type===s.file_type)).length}/${j.length} berkas sudah diupload`})]}),a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:j.map(e=>{console.log("ðŸ”§ Rendering fileConfig:",e);const s=U(e.file_type),n=J(e.file_type);return a.jsx(Z,{className:"border border-gray-200",children:a.jsx(aa,{className:"p-3",children:a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h4",{className:"font-medium text-gray-900 text-sm leading-tight",title:oa(e),children:oa(e)}),e.is_required&&a.jsx(f,{variant:"destructive",className:"text-[10px] py-0 px-1.5",children:"Wajib"})]}),s==="uploaded"?a.jsxs(f,{className:"bg-green-600 text-white flex items-center gap-1 text-xs",children:[a.jsx(H,{className:"h-3 w-3"}),"Uploaded"]}):a.jsxs(f,{variant:"secondary",className:"flex items-center gap-1 text-xs",children:[a.jsx(V,{className:"h-3 w-3"}),"Pending"]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("p",{className:"text-xs text-gray-500",children:["PDF (maks. ",e.file_type==="skp_2_tahun_terakhir"?"1.6MB":"500KB",")"]}),a.jsx(ja,{progress:L[e.file_type]||0,isUploading:v[e.file_type],className:"mt-2"}),s==="uploaded"&&n&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-1 text-green-600 text-xs",children:[a.jsx(H,{className:"h-3 w-3"}),a.jsx("span",{className:"truncate",children:n.file_name}),a.jsxs("span",{className:"text-gray-500",children:["(",w(n.file_size),")"]})]}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx(R,{size:"sm",variant:"outline",onClick:()=>Pa(n),className:"h-6 px-2 text-xs",children:a.jsx(Ra,{className:"h-3 w-3"})}),a.jsx(R,{size:"sm",variant:"outline",onClick:()=>Sa(n),className:"h-6 px-2 text-xs",children:a.jsx(Ea,{className:"h-3 w-3"})}),a.jsx(R,{size:"sm",variant:"outline",onClick:()=>wa(e.file_type),className:"h-6 px-2 text-xs",children:a.jsx(Fa,{className:"h-3 w-3"})}),a.jsx("input",{id:`replace-${G(e.file_type)}`,type:"file",className:"hidden",accept:".pdf,.doc,.docx",onChange:t=>{var d;const i=(d=t.target.files)==null?void 0:d[0];i&&(x(e.file_type,i),t.target.value="")}})]})]}),s!=="uploaded"&&a.jsxs("div",{className:`relative border-2 border-dashed rounded-lg p-6 transition-all duration-200 cursor-pointer w-full h-32 ${F===e.file_type?"border-green-500 bg-green-50":"border-gray-300 hover:border-green-400 hover:bg-gray-50"} ${v[e.file_type]?"pointer-events-none opacity-50":""}`,onDragEnter:t=>Na(e.file_type,t),onDragLeave:t=>va(e.file_type,t),onDragOver:Ta,onDrop:t=>Da(e.file_type,t),onClick:()=>{const t=document.getElementById(`file-${G(e.file_type)}`);t&&!t.disabled&&!v[e.file_type]&&t.click()},children:[a.jsx("div",{className:"flex flex-col items-center justify-center h-full text-center",children:v[e.file_type]?a.jsx("div",{className:"w-full max-w-xs",children:a.jsx(ja,{progress:L[e.file_type]||0,isUploading:v[e.file_type]})}):F===e.file_type?a.jsxs(a.Fragment,{children:[a.jsx(pa,{className:"h-8 w-8 text-green-500 mb-2"}),a.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Lepaskan file di sini"})]}):a.jsxs(a.Fragment,{children:[a.jsx(pa,{className:"h-6 w-6 text-gray-400 mb-2"}),a.jsx("p",{className:"text-xs text-gray-600 leading-tight",children:"Drag & drop file di sini atau klik untuk memilih"})]})}),a.jsx("input",{type:"file",accept:".pdf,.doc,.docx",onChange:t=>{var d;console.log("ðŸ“ File input changed:",t.target.files);const i=(d=t.target.files)==null?void 0:d[0];i?(console.log("ðŸ“„ File selected:",i.name,"fileConfig.file_type:",e.file_type),x(e.file_type,i),t.target.value=""):console.log("âŒ No file selected")},className:"hidden",id:`file-${G(e.file_type)}`})]})]})]})})},e.id)})})]}),a.jsx(ea,{open:Q,onOpenChange:M,children:a.jsxs(sa,{className:"max-w-md",children:[a.jsxs(na,{children:[a.jsxs(ta,{className:"flex items-center gap-2 text-red-600 text-lg",children:[a.jsx(ka,{className:"h-5 w-5"}),q]}),a.jsx(ra,{className:"text-gray-700 whitespace-pre-line leading-relaxed",children:z})]}),a.jsx(ia,{children:a.jsx(la,{onClick:()=>M(!1),className:"bg-red-600 hover:bg-red-700",children:"Tutup"})})]})})]})},ee=({uploaded:c,total:o,isComplete:_,className:l=""})=>{const m=o>0?Math.round(c/o*100):0;return a.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 ${l}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Progress Upload Dokumen"}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:[c," dari ",o," dokumen"]}),a.jsxs("div",{className:"text-lg font-bold text-green-600",children:[m,"%"]})]})]}),a.jsx("div",{className:"mb-4",children:a.jsx(Oa,{value:m,className:"h-3 bg-gray-200"})}),a.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[a.jsx(H,{className:"h-4 w-4"}),a.jsxs("span",{children:[c," Terupload"]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[a.jsx(Ma,{className:"h-4 w-4"}),a.jsxs("span",{children:[o-c," Belum"]})]}),_&&a.jsxs("div",{className:"flex items-center gap-2 text-green-600 font-medium",children:[a.jsx(H,{className:"h-4 w-4"}),a.jsx("span",{children:"Upload Selesai"})]})]})]})},oe=()=>{var M,z,O,q;const{pengajuanId:c}=Ia(),o=Wa(),{token:_}=ya(),[l,m]=u.useState(null),[P,h]=u.useState(!0);u.useState(!1);const{submitForm:K,isSubmitting:X}=fa(),[j,C]=u.useState(!1),[S,N]=u.useState(!1),[v,E]=u.useState(""),[L,A]=u.useState([]),[B,$]=u.useState(""),[y,k]=u.useState({required:0,total:0,isComplete:!1}),F=async()=>{var r,p;if(!(!_||!c)){h(!0);try{const g=await W(`/api/admin-wilayah/pengajuan/${c}`,_);if(g&&g.success!==!1){m(g.pengajuan||((r=g.data)==null?void 0:r.pengajuan)||g);const x=g.uploadProgress||((p=g.data)==null?void 0:p.uploadProgress);if(x){const w=Number(x.required??0),U=Number(x.total??0),J=typeof x.isComplete=="boolean"?x.isComplete:w>=U;k({required:w,total:U,isComplete:J})}else k({required:0,total:0,isComplete:!1})}else m(null),k({required:0,total:0,isComplete:!1})}catch(g){console.error("Failed to fetch pengajuan detail",g),m(null)}finally{h(!1)}}},T=async()=>{try{const r=await W("/api/admin-wilayah-file-config",_);if(r!=null&&r.success&&Array.isArray(r.data)){const p=new Map;r.data.forEach(x=>{var J;const w=x.jenis_jabatan_id,U=((J=x.jenis_jabatan)==null?void 0:J.jenis_jabatan)||`Jabatan ${w}`;w&&!p.has(w)&&p.set(w,U)});const g=Array.from(p.values());A(g),g.length>0&&!B&&$(g[0])}}catch(r){console.error("Failed to fetch job types:",r)}};u.useEffect(()=>{F(),T()},[c,_]);const da=r=>new Date(r).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),D=(r,p)=>{switch(r){case"approved":return a.jsx(f,{className:"bg-green-600 text-white",children:"Disetujui Kab/Kota"});case"admin_wilayah_approved":return a.jsx(f,{className:"bg-green-700 text-white",children:"Disetujui Admin Wilayah"});case"admin_wilayah_rejected":return a.jsx(f,{className:"bg-red-600 text-white",children:"Ditolak Admin Wilayah"});case"admin_wilayah_submitted":return a.jsx(f,{className:"bg-blue-600 text-white",children:"Diajukan Admin Wilayah"});case"submitted":return a.jsx(f,{className:"bg-blue-600 text-white",children:"Dikirim ke Superadmin"});default:return a.jsx(f,{className:"bg-gray-600 text-white",children:r})}},Q=async()=>{!_||!c||K(async()=>{try{const r=await ba(`/api/admin-wilayah/pengajuan/${c}/submit-to-superadmin`,{},_);(r==null?void 0:r.success)!==!1&&(E("Pengajuan berhasil diajukan ke Superadmin"),C(!0),r.pengajuan&&m(r.pengajuan)),await F()}catch(r){console.error("Error submitting to superadmin:",r),E((r==null?void 0:r.message)||"Terjadi kesalahan saat mengajukan ke Superadmin"),N(!0)}},()=>{},r=>{console.error("Error submitting to superadmin:",r)})};return P?a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsx("div",{className:"max-w-6xl mx-auto",children:a.jsxs("div",{className:"animate-pulse space-y-6",children:[a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),a.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})})}):l?a.jsxs("div",{className:"min-h-screen bg-background p-6",children:[a.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[a.jsx(Za,{title:"Upload File Admin Wilayah",subtitle:"Upload file tambahan untuk pengajuan mutasi pegawai",actions:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(f,{className:"bg-green-100 text-green-800",children:"Admin Wilayah"}),D(l.status),a.jsxs(R,{variant:"outline",onClick:()=>o("/admin-wilayah/dashboard"),className:"border-green-200 text-green-700 hover:bg-green-50",children:[a.jsx(ha,{className:"h-4 w-4 mr-2"}),"Kembali"]})]})}),a.jsxs(Z,{className:"border-green-200 bg-green-50",children:[a.jsx(_a,{children:a.jsxs(xa,{className:"text-green-800 flex items-center gap-2",children:[a.jsx(V,{className:"h-5 w-5"}),"Informasi Pengajuan"]})}),a.jsx(aa,{children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Ua,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:((M=l.pegawai)==null?void 0:M.nama)||"-"}),a.jsxs("p",{className:"text-sm text-gray-600",children:["NIP: ",((z=l.pegawai)==null?void 0:z.nip)||"-"]})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Ja,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:((O=l.office)==null?void 0:O.kabkota)||"-"}),a.jsx("p",{className:"text-sm text-gray-600",children:((q=l.office)==null?void 0:q.name)||"-"})]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(V,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Jenis Jabatan"}),a.jsx("p",{className:"text-sm text-gray-600",children:l.jenis_jabatan})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Ca,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Tanggal Pengajuan"}),a.jsx("p",{className:"text-sm text-gray-600",children:da(l.created_at)})]})]})]})]})})]}),a.jsxs(Z,{children:[a.jsx(_a,{children:a.jsx(xa,{className:"text-green-800",children:"Upload File Admin Wilayah"})}),a.jsxs(aa,{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Jenis Berkas Admin Wilayah"}),a.jsxs(qa,{value:B,onValueChange:$,children:[a.jsx(Ga,{className:"w-full max-w-md",children:a.jsx(Va,{placeholder:"Pilih jenis berkas..."})}),a.jsx(Xa,{children:L.map(r=>a.jsx(Qa,{value:r,children:r},r))})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Pilih jenis berkas yang sudah dikonfigurasi oleh superadmin"})]}),B&&y.total>0&&a.jsx(ee,{uploaded:y.required,total:y.total,isComplete:y.isComplete,className:"mb-6"}),B&&a.jsx(ae,{pengajuanId:l.id,jenisJabatanId:B,onFilesUploaded:()=>F(),onProgressChange:(r,p)=>k({required:r,total:p,isComplete:r>=p&&p>0}),pengajuanStatus:l.status,pengajuanData:l})]})]}),a.jsx("div",{className:"flex items-center justify-end gap-3",children:(l.status==="admin_wilayah_approved"||l.status==="admin_wilayah_submitted")&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{className:"text-sm text-gray-600 mr-2",children:[y.required,"/",y.total," berkas wajib"]}),a.jsxs(Ya,{onClick:l.status==="admin_wilayah_submitted"?()=>{}:Q,className:`bg-green-600 hover:bg-green-700 text-white ${l.status==="admin_wilayah_submitted"||!y.isComplete?"opacity-50 cursor-not-allowed":""}`,isProcessing:X,processingText:"Mengirim...",onError:()=>{},onSuccess:()=>{},children:[a.jsx($a,{className:"h-4 w-4 mr-2"}),l.status==="admin_wilayah_submitted"?"Sudah Diajukan":"Ajukan ke Superadmin"]})]})})]}),a.jsx(ea,{open:j,onOpenChange:C,children:a.jsxs(sa,{children:[a.jsxs(na,{children:[a.jsxs(ta,{className:"flex items-center gap-2 text-green-600 text-lg",children:[a.jsx(H,{className:"h-5 w-5"}),"Berhasil!"]}),a.jsx(ra,{className:"text-gray-700",children:v})]}),a.jsx(ia,{children:a.jsx(la,{onClick:()=>C(!1),className:"bg-green-600 hover:bg-green-700",children:"OK"})})]})}),a.jsx(ea,{open:S,onOpenChange:N,children:a.jsxs(sa,{children:[a.jsxs(na,{children:[a.jsxs(ta,{className:"flex items-center gap-2 text-red-600 text-lg",children:[a.jsx(ka,{className:"h-5 w-5"}),"Gagal Mengajukan"]}),a.jsx(ra,{className:"text-gray-700",children:v})]}),a.jsx(ia,{children:a.jsx(la,{onClick:()=>N(!1),className:"bg-red-600 hover:bg-red-700",children:"OK"})})]})})]}):a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsx("div",{className:"max-w-6xl mx-auto",children:a.jsxs("div",{className:"text-center py-12",children:[a.jsx(V,{className:"h-16 w-16 mx-auto text-gray-300 mb-4"}),a.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Pengajuan Tidak Ditemukan"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Pengajuan yang Anda cari tidak ditemukan atau tidak memiliki akses."}),a.jsxs(R,{onClick:()=>o("/admin-wilayah/dashboard"),className:"bg-green-600 hover:bg-green-700 text-white",children:[a.jsx(ha,{className:"h-4 w-4 mr-2"}),"Kembali ke Dashboard"]})]})})})};export{oe as default};
//# sourceMappingURL=AdminWilayahUploadPage-Cc5XDJC_.js.map
