import{j as e,F as K,a3 as F,ak as C,aw as P,a8 as de,E as me,b2 as xe,aa as oe,al as he,T as ge}from"./ui-vendor-B7g5fNgE.js";import{r as i}from"./react-vendor-BNG1zHOu.js";import{u as je,d as ue,a as pe,I as fe,b as y,B as I,D as Ne,e as be,f as ve,g as we}from"./index-StOLTLM1.js";import{C as h,c as g}from"./card-B5fo6Aht.js";import{T as ye,a as ke,b as O,c as m,d as _e,e as x}from"./table-CH4OMqJ6.js";import{S as V,a as $,b as R,c as G,d as p}from"./select-5OxMzyhX.js";import{P as U}from"./PageHeader-BznzlUYq.js";const Be=()=>{var H,z;const{user:c,token:q}=je(),{toast:Q}=ue(),[L,W]=i.useState([]),[X,M]=i.useState(!0),[k,Y]=i.useState(""),[f,Z]=i.useState("all"),[N,b]=i.useState(1),[v,ee]=i.useState(10),[l,ae]=i.useState(null),[se,B]=i.useState(!1),[w,te]=i.useState({tracked:0,completed:0,inProgress:0,overdue:0});i.useEffect(()=>{ne()},[]);const ne=async()=>{try{M(!0);const s=(c==null?void 0:c.office_id)===null?"/api/tracking/superadmin":"/api/tracking/admin",t=await pe(s,q);t.success&&(W(t.data),ie(t.data))}catch(a){console.error("Error loading tracking data:",a),Q({title:"Error",description:"Gagal memuat data tracking",variant:"destructive"})}finally{M(!1)}},ie=a=>{let s=0,t=0,r=0,n=0;a.forEach(d=>{if(d.tracking&&d.tracking.length>0){s++;const o=d.tracking[0];if(o.status_name.includes("Selesai"))t++;else if(r++,o.estimated_days){const u=new Date(o.created_at);u.setDate(u.getDate()+o.estimated_days),new Date>u&&n++}}}),te({tracked:s,completed:t,inProgress:r,overdue:n})},le=a=>{ae(a),B(!0)},_=L.filter(a=>{var n,d;const s=k.toLowerCase(),t=a.pegawai_nip.toLowerCase().includes(s)||a.jenis_jabatan.toLowerCase().includes(s)||(((n=a.office)==null?void 0:n.kabkota)||"").toLowerCase().includes(s)||(((d=a.pegawai)==null?void 0:d.nama)||"").toLowerCase().includes(s),r=f==="all"||a.jenis_jabatan===f;return t&&r}),j=i.useMemo(()=>(c==null?void 0:c.office_id)===null?[..._].sort((s,t)=>{var d,o;const r=s.tracking&&s.tracking.length>0,n=t.tracking&&t.tracking.length>0;if(r&&!n)return-1;if(!r&&n)return 1;if(r&&n){const u=(d=s.tracking[0])!=null&&d.created_at?new Date(s.tracking[0].created_at).getTime():0;return((o=t.tracking[0])!=null&&o.created_at?new Date(t.tracking[0].created_at).getTime():0)-u}return 0}):_,[_,c==null?void 0:c.office_id]);i.useEffect(()=>{b(1)},[k,f]);const re=Array.from(new Set(L.map(a=>a.jenis_jabatan))).sort(),S=Math.max(1,Math.ceil(j.length/v)),D=(N-1)*v,E=D+v,ce=j.slice(D,E),J=a=>a.includes("Selesai")?e.jsx(F,{className:"h-4 w-4 text-green-600"}):a.includes("Diproses")?e.jsx(C,{className:"h-4 w-4 text-blue-600"}):a.includes("Disposisi")?e.jsx(ge,{className:"h-4 w-4 text-orange-600"}):e.jsx(P,{className:"h-4 w-4 text-gray-600"}),A=(a,s=!1)=>a.includes("Selesai")?"bg-green-100 text-green-700 border-green-200":a.includes("Diproses")?`bg-blue-100 text-blue-700 border-blue-200 ${s?"border-red-400 text-red-700":""}`:a.includes("Disposisi")?"bg-orange-100 text-orange-700 border-orange-200":a.includes("Menunggu")?"bg-yellow-100 text-yellow-700 border-yellow-200":"bg-gray-100 text-gray-700 border-gray-200",T=a=>{if(!a.estimated_days)return!1;const s=new Date(a.created_at);return s.setDate(s.getDate()+a.estimated_days),new Date>s&&!a.status_name.includes("Selesai")};return X?e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx(U,{title:"Tracking Dokumen",subtitle:"Monitor progress berkas di pusat"}),e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((a,s)=>e.jsx(h,{children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"})]})})},s))})]}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx(U,{title:"Tracking Dokumen",subtitle:"Monitor progress berkas di pusat"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(h,{children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(K,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Memiliki riwayat tracking"}),e.jsx("p",{className:"text-2xl font-bold",children:w.tracked})]})]})})}),e.jsx(h,{children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(F,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Selesai"}),e.jsx("p",{className:"text-2xl font-bold",children:w.completed})]})]})})}),e.jsx(h,{children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(C,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Dalam Proses"}),e.jsx("p",{className:"text-2xl font-bold",children:w.inProgress})]})]})})}),e.jsx(h,{children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(P,{className:"h-8 w-8 text-red-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Terlambat"}),e.jsx("p",{className:"text-2xl font-bold",children:w.overdue})]})]})})})]}),e.jsx(h,{className:"mb-6",children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-center md:gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(de,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(fe,{placeholder:"Cari NIP/Nama/Jabatan/Kabupaten...",value:k,onChange:a=>Y(a.target.value),className:"pl-10"})]}),e.jsx("div",{className:"w-full md:w-64",children:e.jsxs(V,{value:f,onValueChange:Z,children:[e.jsx($,{children:e.jsx(R,{placeholder:"Semua Jabatan"})}),e.jsxs(G,{children:[e.jsx(p,{value:"all",children:"Semua Jabatan"}),re.map(a=>e.jsx(p,{value:a,children:a},a))]})]})})]})})}),e.jsx(h,{children:e.jsx(g,{className:"p-0",children:j.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(K,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Tidak ada data tracking"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ye,{children:[e.jsx(ke,{children:e.jsxs(O,{children:[e.jsx(m,{children:"NIP"}),e.jsx(m,{children:"Nama Pegawai"}),e.jsx(m,{children:"Jabatan"}),e.jsx(m,{children:"Kab/Kota"}),e.jsx(m,{children:"Status Terakhir"}),e.jsx(m,{children:"Estimasi"}),e.jsx(m,{children:"Tgl Final"}),e.jsx(m,{children:"Aksi"})]})}),e.jsx(_e,{children:ce.map(a=>{var r,n;const s=a.tracking&&a.tracking.length>0?a.tracking[0]:null,t=a.final_approved_at?new Date(a.final_approved_at).toLocaleDateString("id-ID"):"Belum ditentukan";return e.jsxs(O,{children:[e.jsx(x,{className:"font-medium",children:a.pegawai_nip}),e.jsx(x,{children:((r=a.pegawai)==null?void 0:r.nama)||"â€”"}),e.jsx(x,{children:e.jsx(y,{variant:"outline",children:a.jenis_jabatan})}),e.jsx(x,{children:((n=a.office)==null?void 0:n.kabkota)||"N/A"}),e.jsx(x,{children:s?e.jsxs("div",{className:"flex items-center gap-2",children:[J(s.status_name),e.jsx(y,{title:s.status_name,className:`cursor-default hover:brightness-95 ${A(s.status_name,T(s))}`,children:s.status_name})]}):e.jsx("span",{className:"text-gray-500",children:"Belum ada"})}),e.jsx(x,{children:s!=null&&s.estimated_days?`${s.estimated_days} hari`:"-"}),e.jsx(x,{children:t}),e.jsx(x,{children:e.jsxs(I,{size:"sm",variant:"outline",className:"flex items-center gap-2",onClick:()=>le(a),children:[e.jsx(me,{className:"h-4 w-4"})," Detail"]})})]},a.id)})})]})})})}),j.length>0&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Menampilkan ",D+1,"-",Math.min(E,j.length)," dari ",j.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600 mr-2",children:[e.jsx("span",{children:"Tampilkan"}),e.jsxs(V,{value:String(v),onValueChange:a=>{ee(Number(a)),b(1)},children:[e.jsx($,{className:"h-8 w-[84px]",children:e.jsx(R,{})}),e.jsxs(G,{children:[e.jsx(p,{value:"10",children:"10"}),e.jsx(p,{value:"25",children:"25"}),e.jsx(p,{value:"50",children:"50"})]})]}),e.jsx("span",{children:"per halaman"})]}),e.jsx(I,{variant:"outline",size:"sm",onClick:()=>b(a=>Math.max(1,a-1)),disabled:N===1,children:"Sebelumnya"}),e.jsxs("span",{className:"text-sm",children:["Hal ",N," / ",S]}),e.jsx(I,{variant:"outline",size:"sm",onClick:()=>b(a=>Math.min(S,a+1)),disabled:N===S,children:"Berikutnya"})]})]}),e.jsx(Ne,{open:se,onOpenChange:B,children:e.jsxs(be,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(ve,{children:e.jsx(we,{children:"Detail Tracking"})}),l&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("h3",{className:"font-semibold text-xl leading-tight",children:((H=l.pegawai)==null?void 0:H.nama)||"-"}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 font-mono",children:["NIP: ",l.pegawai_nip]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Jenis Jabatan:"}),e.jsx("p",{className:"text-gray-600",children:l.jenis_jabatan})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Kabupaten/Kota:"}),e.jsx("p",{className:"text-gray-600",children:((z=l.office)==null?void 0:z.kabkota)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Dokumen:"}),e.jsx("p",{className:"text-gray-600",children:l.total_dokumen})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Final Approved:"}),e.jsx("p",{className:"text-gray-600",children:l.final_approved_at?new Date(l.final_approved_at).toLocaleDateString("id-ID"):"Belum ditentukan"})]})]})]}),l.tracking&&l.tracking.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Riwayat Tracking"}),e.jsxs("div",{className:"relative pl-6",children:[e.jsx("div",{className:"absolute left-2 top-0 bottom-0 w-px bg-gray-200"}),e.jsx("div",{className:"space-y-6",children:l.tracking.map(a=>e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute -left-[7px] top-1 h-3 w-3 rounded-full bg-green-600 ring-2 ring-white"}),e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[J(a.status_name),e.jsx(y,{title:a.status_name,className:`cursor-default hover:brightness-95 ${A(a.status_name,T(a))}`,children:a.status_name}),T(a)&&e.jsxs(y,{variant:"destructive",className:"text-xs",children:[e.jsx(xe,{className:"h-3 w-3 mr-1"})," Terlambat"]})]}),e.jsxs("div",{className:"text-xs text-gray-600 flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(oe,{className:"h-3 w-3"}),a.tracked_by_name]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(he,{className:"h-3 w-3"}),new Date(a.created_at).toLocaleString("id-ID")]}),a.estimated_days&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(C,{className:"h-3 w-3"}),"Estimasi: ",a.estimated_days," hari"]})]}),a.notes&&e.jsx("div",{className:"mt-2 text-sm text-gray-700",children:a.notes})]})]},a.id))})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Belum ada tracking untuk berkas ini"})]})]})]})})]})};export{Be as default};
//# sourceMappingURL=SuperadminTracking-D-DlawGo.js.map
