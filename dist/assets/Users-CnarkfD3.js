import{j as e,_ as ye,ao as Ce,a2 as ke,a3 as D,ap as De,aq as Se,aA as q,aB as K,w as S,aI as _,ae as J}from"./ui-vendor-CkT_OuiB.js";import{r}from"./react-vendor-BNG1zHOu.js";import{u as _e,a as Ae,t as x,B as t,I as d,b as Pe,D as Q,e as X,f as Y,g as Z,h as ee,i as se,j as Ue,c as Te,l as Le}from"./index-DNdmRr78.js";import{L as o}from"./label-DudCoqkq.js";import{S as ae,a as le,b as re,c as te,d as c}from"./select-DoHFmTMJ.js";import{T as Me,a as Ee,b as E,c as g,d as Be,e as u}from"./table-B49hRDnr.js";import{A as Fe,a as ze,b as Ie,c as Ge,d as Oe,e as Re,g as He,f as We}from"./alert-dialog-Mxkvv3FL.js";import{C as ie,c as ne,a as Ve,b as $e,d as qe}from"./card-BUmGgd2s.js";const as=()=>{const{user:A,token:h}=_e(),[oe,de]=r.useState([]),[ce,B]=r.useState(!0),[w,he]=r.useState(""),[me,b]=r.useState(!1),[xe,v]=r.useState(!1),[ue,P]=r.useState(!1),[m,U]=r.useState(null),[a,i]=r.useState({email:"",full_name:"",password:"",role:"user",office_id:""}),[p,F]=r.useState(!1),[j,N]=r.useState(!1),[pe,z]=r.useState(!1),[je,T]=r.useState(null),[I,L]=r.useState(""),[f,y]=r.useState(!1),fe=()=>{const n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let l="";const k="abcdefghijklmnopqrstuvwxyz",H="ABCDEFGHIJKLMNOPQRSTUVWXYZ",W="0123456789",V="!@#$%^&*";l+=k[Math.floor(Math.random()*k.length)],l+=H[Math.floor(Math.random()*H.length)],l+=W[Math.floor(Math.random()*W.length)],l+=V[Math.floor(Math.random()*V.length)];for(let $=4;$<12;$++)l+=n[Math.floor(Math.random()*n.length)];return l.split("").sort(()=>Math.random()-.5).join("")},C=async s=>{try{await navigator.clipboard.writeText(s),y(!0),x({title:"Password disalin",description:"Password telah disalin ke clipboard"}),setTimeout(()=>y(!1),2e3)}catch{try{const l=document.createElement("textarea");l.value=s,l.style.position="fixed",l.style.opacity="0",l.style.left="-999999px",l.style.top="-999999px",document.body.appendChild(l),l.focus(),l.select();const k=document.execCommand("copy");if(document.body.removeChild(l),k)y(!0),x({title:"Password disalin",description:"Password telah disalin ke clipboard"}),setTimeout(()=>y(!1),2e3);else throw new Error("execCommand failed")}catch{x({title:"Gagal menyalin",description:"Tidak dapat menyalin password ke clipboard",variant:"destructive"})}}},G=()=>{const s=fe();i({...a,password:s}),x({title:"Password di-generate",description:"Password secure telah di-generate"})};if((A==null?void 0:A.role)!=="admin")return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(ie,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-600 mb-2",children:"Akses Ditolak"}),e.jsx("p",{className:"text-gray-600",children:"Anda tidak memiliki akses ke halaman ini."})]})})})});r.useEffect(()=>{M()},[]);const M=async()=>{if(h){B(!0);try{const s=await Ae("/api/users",h);de(s.users||[])}catch(s){console.error("Failed to fetch users:",s),x({title:"Error",description:"Gagal mengambil data user",variant:"destructive"})}finally{B(!1)}}},ge=()=>{i({email:"",full_name:"",password:"",role:"user",office_id:""}),b(!0)},we=s=>{U(s),i({email:s.email,full_name:s.full_name,password:"",role:s.role,office_id:s.office_id||""}),v(!0)},be=s=>{U(s),P(!0)},O=async(s=!1)=>{if(h){N(!0);try{if(s&&m){const n={...a};n.password||delete n.password,await Ue(`/api/users/${m.id}`,n,h),T(!0),L("User berhasil diperbarui.")}else await Te("/api/users",a,h),T(!0),L("User berhasil ditambahkan.");M(),b(!1),v(!1),i({email:"",full_name:"",password:"",role:"user",office_id:""})}catch(n){T(!1),L((n==null?void 0:n.message)||"Gagal menyimpan user.")}finally{N(!1),b(!1),v(!1),z(!0)}}},ve=async()=>{if(!(!h||!m)){N(!0);try{await Le(`/api/users/${m.id}`,h),x({title:"Sukses",description:"User berhasil dihapus"}),M(),P(!1),U(null)}catch(s){console.error("Failed to delete user:",s),x({title:"Error",description:"Gagal menghapus user",variant:"destructive"})}finally{N(!1)}}},R=oe.filter(s=>s.full_name.toLowerCase().includes(w.toLowerCase())||s.email.toLowerCase().includes(w.toLowerCase())||s.role.toLowerCase().includes(w.toLowerCase())),Ne=s=>{switch(s){case"admin":return"bg-red-100 text-red-800";case"operator":return"bg-blue-100 text-blue-800";case"user":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[pe&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/20 backdrop-blur-sm animate-in fade-in-0 duration-200",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full flex flex-col items-center animate-in zoom-in-95 duration-200",children:[je?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-10 h-10 text-green-600",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Berhasil"}),e.jsx("p",{className:"text-gray-600 mb-6 text-center",children:I})]}):e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-10 h-10 text-red-600",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Gagal"}),e.jsx("p",{className:"text-gray-600 mb-6 text-center",children:I})]}),e.jsx("button",{className:"w-full py-3 rounded-lg bg-green-600 hover:bg-green-700 text-white text-lg font-semibold shadow transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-400",onClick:()=>z(!1),children:"Tutup"})]})}),e.jsxs(ie,{children:[e.jsx(Ve,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs($e,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Management User"]}),e.jsx(qe,{children:"Kelola user dan akses sistem"})]}),e.jsxs(t,{onClick:ge,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Tambah User"]})]})}),e.jsxs(ne,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(d,{placeholder:"Cari user...",value:w,onChange:s=>he(s.target.value),className:"pl-10"})]})}),ce?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(D,{className:"w-6 h-6 animate-spin mr-2 text-green-600"}),e.jsx("span",{children:"Loading users..."})]}):e.jsx("div",{className:"border rounded-lg",children:e.jsxs(Me,{children:[e.jsx(Ee,{children:e.jsxs(E,{children:[e.jsx(g,{children:"Nama"}),e.jsx(g,{children:"Email"}),e.jsx(g,{children:"Role"}),e.jsx(g,{children:"Office ID"}),e.jsx(g,{children:"Created At"}),e.jsx(g,{className:"text-right",children:"Aksi"})]})}),e.jsx(Be,{children:R.length===0?e.jsx(E,{children:e.jsx(u,{colSpan:6,className:"text-center py-8 text-gray-500",children:w?"Tidak ada user yang ditemukan":"Belum ada user"})}):R.map(s=>e.jsxs(E,{children:[e.jsx(u,{className:"font-medium",children:s.full_name}),e.jsx(u,{children:s.email}),e.jsx(u,{children:e.jsx(Pe,{className:Ne(s.role),children:s.role})}),e.jsx(u,{children:s.office_id||"-"}),e.jsx(u,{children:s.created_at?new Date(s.created_at).toLocaleDateString("id-ID"):"-"}),e.jsx(u,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(t,{variant:"outline",size:"sm",onClick:()=>we(s),children:e.jsx(De,{className:"w-4 h-4"})}),e.jsx(t,{variant:"outline",size:"sm",onClick:()=>be(s),className:"text-red-600 hover:text-red-700",children:e.jsx(Se,{className:"w-4 h-4"})})]})})]},s.id))})]})})]})]}),e.jsx(Q,{open:me,onOpenChange:b,children:e.jsxs(X,{className:"sm:max-w-md",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Tambah User Baru"}),e.jsx(ee,{children:"Masukkan informasi user yang akan ditambahkan ke sistem."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"email",children:"Email"}),e.jsx(d,{id:"email",type:"email",value:a.email,onChange:s=>i({...a,email:s.target.value}),placeholder:"user@example.com"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"full_name",children:"Nama Lengkap"}),e.jsx(d,{id:"full_name",value:a.full_name,onChange:s=>i({...a,full_name:s.target.value}),placeholder:"Nama lengkap user"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(d,{id:"password",type:p?"text":"password",value:a.password,onChange:s=>i({...a,password:s.target.value}),placeholder:"Password"}),e.jsxs("div",{className:"absolute right-0 top-0 h-full flex items-center gap-1 pr-2",children:[e.jsx(t,{type:"button",variant:"ghost",size:"sm",className:"h-full px-2 hover:bg-transparent",onClick:()=>F(!p),children:p?e.jsx(q,{className:"h-4 w-4"}):e.jsx(K,{className:"h-4 w-4"})}),a.password&&e.jsx(t,{type:"button",variant:"ghost",size:"sm",className:"h-full px-2 hover:bg-transparent",onClick:()=>C(a.password),children:f?e.jsx(S,{className:"h-4 w-4 text-green-600"}):e.jsx(_,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t,{type:"button",variant:"outline",size:"sm",onClick:G,className:"flex items-center gap-2 border-green-600 text-green-600 hover:bg-green-50",children:[e.jsx(J,{className:"h-4 w-4"}),"Generate Password"]}),a.password&&e.jsxs(t,{type:"button",variant:"outline",size:"sm",onClick:()=>C(a.password),className:"flex items-center gap-2 border-blue-600 text-blue-600 hover:bg-blue-50",children:[f?e.jsx(S,{className:"h-4 w-4"}):e.jsx(_,{className:"h-4 w-4"}),f?"Disalin!":"Copy Password"]})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"role",children:"Role"}),e.jsxs(ae,{value:a.role,onValueChange:s=>i({...a,role:s}),children:[e.jsx(le,{children:e.jsx(re,{placeholder:"Pilih role"})}),e.jsxs(te,{children:[e.jsx(c,{value:"user",children:"User"}),e.jsx(c,{value:"operator",children:"Operator"}),e.jsx(c,{value:"admin",children:"Admin"}),e.jsx(c,{value:"admin_wilayah",children:"Admin Wilayah"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"office_id",children:"Office ID"}),e.jsx(d,{id:"office_id",value:a.office_id,onChange:s=>i({...a,office_id:s.target.value}),placeholder:"ID kantor (opsional)"})]})]}),e.jsxs(se,{children:[e.jsx(t,{variant:"outline",onClick:()=>b(!1),children:"Batal"}),e.jsxs(t,{onClick:()=>O(!1),disabled:j||!a.email||!a.full_name||!a.password,className:"bg-green-600 hover:bg-green-700",children:[j?e.jsx(D,{className:"w-4 h-4 animate-spin mr-2 text-white"}):null,"Tambah User"]})]})]})}),e.jsx(Q,{open:xe,onOpenChange:v,children:e.jsxs(X,{className:"sm:max-w-md",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Edit User"}),e.jsx(ee,{children:"Perbarui informasi user."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"edit-email",children:"Email"}),e.jsx(d,{id:"edit-email",type:"email",value:a.email,onChange:s=>i({...a,email:s.target.value}),placeholder:"user@example.com"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"edit-full_name",children:"Nama Lengkap"}),e.jsx(d,{id:"edit-full_name",value:a.full_name,onChange:s=>i({...a,full_name:s.target.value}),placeholder:"Nama lengkap user"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"edit-password",children:"Password Baru (opsional)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(d,{id:"edit-password",type:p?"text":"password",value:a.password,onChange:s=>i({...a,password:s.target.value}),placeholder:"Kosongkan jika tidak ingin mengubah password"}),e.jsxs("div",{className:"absolute right-0 top-0 h-full flex items-center gap-1 pr-2",children:[e.jsx(t,{type:"button",variant:"ghost",size:"sm",className:"h-full px-2 hover:bg-transparent",onClick:()=>F(!p),children:p?e.jsx(q,{className:"h-4 w-4"}):e.jsx(K,{className:"h-4 w-4"})}),a.password&&e.jsx(t,{type:"button",variant:"ghost",size:"sm",className:"h-full px-2 hover:bg-transparent",onClick:()=>C(a.password),children:f?e.jsx(S,{className:"h-4 w-4 text-green-600"}):e.jsx(_,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(t,{type:"button",variant:"outline",size:"sm",onClick:G,className:"flex items-center gap-2 border-green-600 text-green-600 hover:bg-green-50",children:[e.jsx(J,{className:"h-4 w-4"}),"Generate Password"]}),a.password&&e.jsxs(t,{type:"button",variant:"outline",size:"sm",onClick:()=>C(a.password),className:"flex items-center gap-2 border-blue-600 text-blue-600 hover:bg-blue-50",children:[f?e.jsx(S,{className:"h-4 w-4"}):e.jsx(_,{className:"h-4 w-4"}),f?"Disalin!":"Copy Password"]})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"edit-role",children:"Role"}),e.jsxs(ae,{value:a.role,onValueChange:s=>i({...a,role:s}),children:[e.jsx(le,{children:e.jsx(re,{placeholder:"Pilih role"})}),e.jsxs(te,{children:[e.jsx(c,{value:"user",children:"User"}),e.jsx(c,{value:"operator",children:"Operator"}),e.jsx(c,{value:"admin",children:"Admin"}),e.jsx(c,{value:"admin_wilayah",children:"Admin Wilayah"})]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"edit-office_id",children:"Office ID"}),e.jsx(d,{id:"edit-office_id",value:a.office_id,onChange:s=>i({...a,office_id:s.target.value}),placeholder:"ID kantor (opsional)"})]})]}),e.jsxs(se,{children:[e.jsx(t,{variant:"outline",onClick:()=>v(!1),children:"Batal"}),e.jsxs(t,{onClick:()=>O(!0),disabled:j||!a.email||!a.full_name,className:"bg-green-600 hover:bg-green-700 text-white",children:[j?e.jsx(D,{className:"w-4 h-4 animate-spin mr-2 text-white"}):null,"Update User"]})]})]})}),e.jsx(Fe,{open:ue,onOpenChange:P,children:e.jsxs(ze,{children:[e.jsxs(Ie,{children:[e.jsx(Ge,{children:"Hapus User"}),e.jsxs(Oe,{children:['Apakah Anda yakin ingin menghapus user "',m==null?void 0:m.full_name,'"? Tindakan ini tidak dapat dibatalkan.']})]}),e.jsxs(Re,{children:[e.jsx(He,{children:"Batal"}),e.jsxs(We,{onClick:ve,disabled:j,className:"bg-red-600 hover:bg-red-700",children:[j?e.jsx(D,{className:"w-4 h-4 animate-spin mr-2 text-white"}):null,"Hapus"]})]})]})})]})};export{as as default};
//# sourceMappingURL=Users-CnarkfD3.js.map
