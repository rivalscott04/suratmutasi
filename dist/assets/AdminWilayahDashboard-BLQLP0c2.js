import{j as e,au as J,aF as T,aX as M,K as V,ad as W,_ as G,a0 as y,af as H,ac as O}from"./ui-vendor-BCnv6AUJ.js";import{r as d,L as u}from"./react-vendor-C8WR5ETM.js";import{C as c,a as x,b as m,c as h}from"./card-DH8B7gbc.js";import{u as Q,B as n,b,a as R,k as X}from"./index-CjXV7PZi.js";import{P as z}from"./progress-B3r95fqc.js";const te=()=>{const{token:o}=Q(),[g,v]=d.useState("process"),[l,K]=d.useState({totalPengajuan:0,pendingUpload:0,completedUpload:0,totalFiles:0,verifiedFiles:0,rejectedFiles:0}),[w,$]=d.useState([]),[E,_]=d.useState(!0),[F,f]=d.useState(null),[P,q]=d.useState([]),[k,A]=d.useState(null),[C,U]=d.useState([]),N=async()=>{var s,a,r;try{_(!0),f(null);const t=await R("/api/admin-wilayah/dashboard",o),i=((s=t==null?void 0:t.data)==null?void 0:s.stats)||(t==null?void 0:t.stats),j=((a=t==null?void 0:t.data)==null?void 0:a.recentUploads)||(t==null?void 0:t.recentUploads)||[],p=((r=t==null?void 0:t.data)==null?void 0:r.pengajuan)||(t==null?void 0:t.pengajuan)||[];i?(K({totalPengajuan:Number(i.total_pengajuan||i.totalPengajuan||0),pendingUpload:Number(i.pending_upload||i.pendingUpload||0),completedUpload:Number(i.completed_upload||i.completedUpload||0),totalFiles:Number(i.total_files||i.totalFiles||0),verifiedFiles:Number(i.verified_files||i.verifiedFiles||0),rejectedFiles:Number(i.rejected_files||i.rejectedFiles||0)}),$(Array.isArray(j)?j:[]),q(Array.isArray(p)?p:[])):f("Failed to fetch dashboard data")}catch(t){console.error("Error fetching dashboard data:",t),f("Error connecting to server")}finally{_(!1)}},B=async()=>{var s;try{const a=await R("/api/admin-wilayah/history",o),r=((s=a==null?void 0:a.data)==null?void 0:s.pengajuan)||(a==null?void 0:a.pengajuan)||[];U(Array.isArray(r)?r:[])}catch{U([])}},I=async s=>{if(o){A(s);try{const a=await X(`/api/admin-wilayah/pengajuan/${s}/submit-to-superadmin`,{},o);(a==null?void 0:a.success)!==!1&&await N()}finally{A(null)}}};d.useEffect(()=>{N(),B()},[o]);const L=()=>l.totalFiles===0?0:l.verifiedFiles/l.totalFiles*100,S=s=>new Date(s).toLocaleDateString("id-ID",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return E?e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[...Array(4)].map((s,a)=>e.jsx("div",{className:"h-32 bg-gray-200 rounded"},a))})]})})}):F?e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsx("div",{className:"max-w-6xl mx-auto",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(J,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Error Loading Dashboard"}),e.jsx("p",{className:"text-gray-600 mb-4",children:F}),e.jsxs(n,{onClick:N,className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(T,{className:"h-4 w-4"}),"Retry"]})]})})}):e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Dashboard Admin Wilayah"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"Monitoring aktivitas upload file dan progress pengajuan"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{onClick:N,variant:"outline",size:"sm",className:"border-green-200 text-green-700 hover:bg-green-50",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Refresh"]}),e.jsx(M,{className:"h-6 w-6 text-green-600"}),e.jsx(b,{className:"bg-green-100 text-green-800",children:"Admin Wilayah"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{variant:g==="process"?"default":"outline",size:"sm",onClick:()=>v("process"),children:"Dalam Proses"}),e.jsx(n,{variant:g==="archive"?"default":"outline",size:"sm",onClick:()=>v("archive"),children:"Arsip"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(c,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Total Pengajuan"}),e.jsx(V,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l.totalPengajuan}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Pengajuan yang sudah approved"})]})]}),e.jsxs(c,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Pending Upload"}),e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:l.pendingUpload}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Menunggu upload file admin wilayah"})]})]}),e.jsxs(c,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Completed Upload"}),e.jsx(G,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:l.completedUpload}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"File admin wilayah sudah lengkap"})]})]}),e.jsxs(c,{children:[e.jsxs(x,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Total Files"}),e.jsx(y,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(h,{children:[e.jsx("div",{className:"text-2xl font-bold",children:l.totalFiles}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"File yang sudah diupload"})]})]})]}),e.jsxs(c,{children:[e.jsx(x,{children:e.jsx(m,{children:"Progress Overview"})}),e.jsx(h,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"File Verification Progress"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[l.verifiedFiles," of ",l.totalFiles," files verified"]})]}),e.jsx(z,{value:L(),className:"h-2"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Pending: ",l.totalFiles-l.verifiedFiles-l.rejectedFiles]}),e.jsxs("span",{children:["Verified: ",l.verifiedFiles]}),e.jsxs("span",{children:["Rejected: ",l.rejectedFiles]})]})]})})]}),g==="process"&&e.jsxs(c,{children:[e.jsx(x,{children:e.jsx(m,{children:"Pengajuan dari Kab/Kota (Approved)"})}),e.jsx(h,{children:P.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Tidak ada data"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-2 pr-4",children:"Pegawai"}),e.jsx("th",{className:"py-2 pr-4",children:"NIP"}),e.jsx("th",{className:"py-2 pr-4",children:"Jenis Jabatan"}),e.jsx("th",{className:"py-2 pr-4",children:"Berkas Kab/Kota"}),e.jsx("th",{className:"py-2 pr-4",children:"Progress Kanwil"}),e.jsx("th",{className:"py-2 pr-4",children:"Aksi"})]})}),e.jsx("tbody",{children:P.map(s=>{var j,p,D;const a=s.pegawai||{},r=s.progress_admin_wilayah||{required:0,approved:0},t=`${r.approved}/${r.required}`,i=s.status==="admin_wilayah_approved"&&(((j=s.progress_admin_wilayah)==null?void 0:j.required)||0)>0&&(((p=s.progress_admin_wilayah)==null?void 0:p.approved)||0)>=(((D=s.progress_admin_wilayah)==null?void 0:D.required)||0);return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 pr-4",children:a.nama||"-"}),e.jsx("td",{className:"py-2 pr-4",children:a.nip||"-"}),e.jsx("td",{className:"py-2 pr-4",children:s.jenis_jabatan}),e.jsx("td",{className:"py-2 pr-4",children:s.kabupaten_files_count}),e.jsx("td",{className:"py-2 pr-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t}),e.jsx(z,{value:r.required?r.approved/r.required*100:0,className:"h-2 w-32"})]})}),e.jsx("td",{className:"py-2 pr-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{asChild:!0,variant:"outline",size:"sm",className:"border-green-200 text-green-700 hover:bg-green-50",children:e.jsx(u,{to:`/pengajuan/${s.id}`,children:"Detail"})}),e.jsx(n,{asChild:!0,size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",children:e.jsx(u,{to:`/admin-wilayah/upload/${s.id}`,children:"Upload Kanwil"})}),e.jsx(n,{size:"sm",disabled:!i||k===s.id,onClick:()=>I(s.id),className:`text-white ${i?"bg-blue-600 hover:bg-blue-700":"bg-blue-300 cursor-not-allowed"}`,children:k===s.id?"Mengajukan...":"Ajukan ke Superadmin"})]})})]},s.id)})})]})})})]}),g==="archive"&&e.jsxs(c,{children:[e.jsx(x,{children:e.jsx(m,{children:"Arsip (Keputusan Superadmin)"})}),e.jsx(h,{children:C.length===0?e.jsx("div",{className:"text-center text-gray-500 py-8",children:"Belum ada arsip"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left border-b",children:[e.jsx("th",{className:"py-2 pr-4",children:"Pegawai"}),e.jsx("th",{className:"py-2 pr-4",children:"NIP"}),e.jsx("th",{className:"py-2 pr-4",children:"Jenis Jabatan"}),e.jsx("th",{className:"py-2 pr-4",children:"Status"}),e.jsx("th",{className:"py-2 pr-4",children:"Tanggal"}),e.jsx("th",{className:"py-2 pr-4",children:"Aksi"})]})}),e.jsx("tbody",{children:C.map(s=>{var a,r;return e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 pr-4",children:((a=s.pegawai)==null?void 0:a.nama)||"-"}),e.jsx("td",{className:"py-2 pr-4",children:((r=s.pegawai)==null?void 0:r.nip)||"-"}),e.jsx("td",{className:"py-2 pr-4",children:s.jenis_jabatan}),e.jsx("td",{className:"py-2 pr-4",children:e.jsx(b,{className:s.status==="approved"?"bg-green-600 text-white":"bg-red-600 text-white",children:s.status==="approved"?"Disetujui":"Ditolak"})}),e.jsx("td",{className:"py-2 pr-4",children:S(s.updated_at)}),e.jsx("td",{className:"py-2 pr-4",children:e.jsx(n,{asChild:!0,variant:"outline",size:"sm",children:e.jsx(u,{to:`/pengajuan/${s.id}`,children:"Detail"})})})]},s.id)})})]})})})]}),e.jsxs(c,{children:[e.jsx(x,{children:e.jsx(m,{children:"Recent Uploads"})}),e.jsx(h,{children:e.jsx("div",{className:"space-y-4",children:w.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(y,{className:"h-12 w-12 mx-auto mb-4 text-gray-300"}),e.jsx("p",{children:"Belum ada file yang diupload"})]}):w.map(s=>e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.pengajuan.pegawai.nama}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.pengajuan.jenis_jabatan," • ",s.file_type]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{variant:s.status==="approved"?"default":"secondary",children:s.status}),e.jsx(n,{size:"sm",variant:"outline",asChild:!0,children:e.jsx(u,{to:`/admin-wilayah/upload/${s.pengajuan.id}`,children:e.jsx(H,{className:"h-4 w-4"})})})]})]}),e.jsxs("div",{className:"mt-2 text-xs text-gray-400",children:["Uploaded by: ",e.jsx("strong",{children:s.uploaded_by_name}),"(",s.uploaded_by_office,") - ",S(s.uploaded_at)]})]},s.id))})})]}),e.jsxs(c,{children:[e.jsx(x,{children:e.jsx(m,{children:"Quick Actions"})}),e.jsx(h,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(n,{asChild:!0,className:"flex-1",children:e.jsxs(u,{to:"/admin-wilayah/pengajuan",children:[e.jsx(y,{className:"h-4 w-4 mr-2"}),"View All Pengajuan"]})}),e.jsxs(n,{variant:"outline",className:"flex-1",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Generate Report"]})]})})]})]})})};export{te as default};
//# sourceMappingURL=AdminWilayahDashboard-BLQLP0c2.js.map
