{"version":3,"file":"LetterPrintPreview-8sY6oo7U.js","sources":["../../src/pages/LetterPrintPreview.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useParams, useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '@/contexts/AuthContext';\r\nimport { Template1 } from '@/components/templates/Template1';\r\nimport { Template2 } from '@/components/templates/Template2';\r\nimport { Template3 } from '@/components/templates/Template3';\r\nimport { Template4 } from '@/components/templates/Template4';\r\nimport { Template5 } from '@/components/templates/Template5';\r\nimport { Template6 } from '@/components/templates/Template6';\r\nimport { Template7 } from '@/components/templates/Template7';\r\nimport { Template8 } from '@/components/templates/Template8';\r\nimport { Template9 } from '@/components/templates/Template9';\r\nimport { apiGet } from '@/lib/api';\r\n\r\nconst LetterPrintPreview: React.FC = () => {\r\n  const { id } = useParams<{ id: string }>();\r\n  const navigate = useNavigate();\r\n  const { token, isAuthenticated, loading: authLoading } = useAuth();\r\n  const [letter, setLetter] = useState<any>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!authLoading && !isAuthenticated) {\r\n      navigate('/');\r\n      return;\r\n    }\r\n  }, [authLoading, isAuthenticated, navigate]);\r\n\r\n  useEffect(() => {\r\n    if (!authLoading && isAuthenticated && token && id) {\r\n      const fetchLetter = async () => {\r\n        setLoading(true);\r\n        try {\r\n          const res = await apiGet(`/api/letters/${id}`, token);\r\n          setLetter(res.letter || res);\r\n        } catch (err: any) {\r\n          console.error('Error fetching letter:', err);\r\n          setError('Gagal mengambil data surat');\r\n        } finally {\r\n          setLoading(false);\r\n        }\r\n      };\r\n      fetchLetter();\r\n    }\r\n  }, [id, token, isAuthenticated, authLoading]);\r\n\r\n  const renderPreviewByTemplate = (letter: any) => {\r\n    let data = letter.form_data;\r\n    if (typeof data === 'string') {\r\n      try { data = JSON.parse(data); } catch { data = {}; }\r\n    }\r\n    // Gabungkan data dengan office, kode_kabko, letter_number, dan field root letter\r\n    data = {\r\n      ...data,\r\n      office: letter.office,\r\n      kode_kabko: letter.office?.kode_kabko || data.kode_kabko,\r\n      letter_number: letter.letter_number,\r\n      ...letter,\r\n    };\r\n    // Fallback: jika data.nosrt kosong, ambil dari letter_number\r\n    if (!data.nosrt && letter.letter_number) {\r\n      const match = letter.letter_number.match(/^B-([^/]+)/);\r\n      if (match) data.nosrt = match[1];\r\n    }\r\n    if (!data) return <div>Data surat tidak ditemukan</div>;\r\n    const id = String(letter.template_id);\r\n    if (id === '1') return <Template1 data={data} />;\r\n    if (id === '2') return <Template2 data={data} />;\r\n    if (id === '3') return <Template3 data={data} />;\r\n    if (id === '4') return <Template4 data={data} />;\r\n    if (id === '5') return <Template5 data={data} />;\r\n    if (id === '6') return <Template6 data={data} />;\r\n    if (id === '7') return <Template7 data={data} />;\r\n    if (id === '8') return <Template8 data={data} />;\r\n    if (id === '9') return <Template9 data={data} />;\r\n    return <div>Template tidak dikenali</div>;\r\n  };\r\n\r\n  if (authLoading || loading) return <div>Loading...</div>;\r\n  if (error) return <div className=\"text-error\">{error}</div>;\r\n  if (!letter) return <div>Surat tidak ditemukan</div>;\r\n\r\n  return (\r\n    <div style={{ fontFamily: 'Arial, sans-serif', background: '#f8fafc', minHeight: '100vh', padding: 24 }}>\r\n      <style>{`\r\n        @media print {\r\n          .print-paper {\r\n            background: #fff !important;\r\n            box-shadow: none !important;\r\n            border-radius: 0 !important;\r\n            margin: 0 !important;\r\n            padding: 0 !important;\r\n            max-width: 100% !important;\r\n            width: 100% !important;\r\n          }\r\n          body { background: #fff !important; }\r\n        }\r\n      `}</style>\r\n      <div className=\"flex justify-end mb-4 print:hidden\">\r\n        <button\r\n          onClick={() => window.print()}\r\n          className=\"bg-teal-700 hover:bg-teal-800 text-white px-4 py-2 rounded shadow\"\r\n        >\r\n          Print\r\n        </button>\r\n      </div>\r\n      <div className=\"flex justify-center\">\r\n        <div className=\"print-paper w-full max-w-[700px] bg-white rounded shadow p-4 md:p-8\">\r\n          {renderPreviewByTemplate(letter)}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LetterPrintPreview; "],"names":["LetterPrintPreview","id","useParams","navigate","useNavigate","token","isAuthenticated","authLoading","useAuth","letter","setLetter","useState","loading","setLoading","error","setError","useEffect","res","apiGet","err","renderPreviewByTemplate","data","match","jsx","Template1","Template2","Template3","Template4","Template5","Template6","Template7","Template8","Template9","jsxs"],"mappings":"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"}