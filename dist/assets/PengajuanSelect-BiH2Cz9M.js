import{j as e,x as H,A as R,B,K as le,a6 as ce,G as de,aC as A,al as me,aD as oe,d as xe,aE as he}from"./ui-vendor-e65TVV2G.js";import{r as n,d as je}from"./react-vendor-C8WR5ETM.js";import{C as K,a as $,b as O,c as Q}from"./card-Cn5ZAoHG.js";import{u as V,a as W,D as ue,e as ge,f as be,g as pe,I as X,b as P,B as m,k as fe}from"./index-DMfYXVru.js";import{C as U}from"./checkbox-BIoALTUh.js";import{T as Ne,a as ye,b as I,c as u,d as ve,e as j}from"./table-Dy0pubuB.js";import"./data-vendor-DtxkLsA5.js";const ke=({open:o,onOpenChange:N,onJabatanSelected:y})=>{const{token:v}=V(),[S,T]=n.useState([]),[x,h]=n.useState(!0),[l,p]=n.useState(""),[r,g]=n.useState(null);n.useEffect(()=>{o&&b()},[o]);const b=async()=>{try{h(!0);const s=await W("/api/job-type-configurations?active_only=true",v);s.success&&T(s.data)}catch(s){console.error("Error fetching job types:",s)}finally{h(!1)}},c=S.filter(s=>s.jenis_jabatan.toLowerCase().includes(l.toLowerCase())),k=s=>{g(s)},w=()=>{r&&(y(r),N(!1),g(null),p(""))},d=()=>{N(!1),g(null),p("")};return e.jsx(ue,{open:o,onOpenChange:N,children:e.jsxs(ge,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(be,{children:[e.jsxs(pe,{className:"flex items-center gap-2 text-xl",children:[e.jsx(H,{className:"h-5 w-5 text-green-600"}),"Pilih Jabatan untuk Pengajuan"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-2",children:"Pilih jenis jabatan yang akan diajukan. Setiap jabatan memiliki persyaratan dokumen yang berbeda."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(X,{placeholder:"Cari jabatan...",value:l,onChange:s=>p(s.target.value),className:"pl-10"})]}),x?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(B,{className:"h-8 w-8 animate-spin mr-2"}),e.jsx("span",{children:"Memuat data jabatan..."})]}):c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(le,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:l?"Tidak ada jabatan yang sesuai dengan pencarian":"Tidak ada jabatan yang tersedia"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:c.map(s=>e.jsxs(K,{className:`cursor-pointer transition-all duration-200 hover:shadow-md ${(r==null?void 0:r.id)===s.id?"ring-2 ring-green-500 bg-green-50 border-green-200":"hover:border-green-300"}`,onClick:()=>k(s),children:[e.jsx($,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(O,{className:"text-lg font-semibold text-gray-800",children:s.jenis_jabatan}),e.jsx(P,{variant:"secondary",className:"bg-green-100 text-green-800 border-green-200",children:"Aktif"})]})}),e.jsxs(Q,{className:"pt-0",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Dokumen:"}),e.jsx("span",{className:"font-semibold text-green-600",children:s.max_dokumen})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Min Dokumen:"}),e.jsx("span",{className:"text-sm text-gray-500",children:s.min_dokumen})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Jenis File:"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[s.required_files.length," jenis"]})]})]}),(r==null?void 0:r.id)===s.id&&e.jsx("div",{className:"mt-3 pt-3 border-t border-green-200",children:e.jsxs("div",{className:"flex items-center text-green-600 text-sm font-medium",children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Dipilih"]})})]})]},s.id))}),r&&e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-green-800 mb-2",children:"Jabatan yang Dipilih:"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-green-700",children:r.jenis_jabatan}),e.jsxs("p",{className:"text-sm text-green-600",children:[r.required_files.length," jenis dokumen diperlukan"]})]}),e.jsxs(P,{className:"bg-green-600 text-white",children:[r.max_dokumen," dokumen"]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(m,{variant:"outline",onClick:d,className:"border-gray-300 text-gray-700 hover:bg-gray-50",children:"Batal"}),e.jsx(m,{onClick:w,disabled:!r,className:"bg-green-600 hover:bg-green-700 text-white",children:"Pilih Jabatan"})]})]})]})})},Le=()=>{const o=je(),{user:N,token:y,isAuthenticated:v}=V(),[S,T]=n.useState({}),[x,h]=n.useState(null),[l,p]=n.useState(""),[r,g]=n.useState(!0),[b,c]=n.useState(null),[k,w]=n.useState(!1),[d,s]=n.useState(1),[_]=n.useState(5),[Y,J]=n.useState(!1),[i,Z]=n.useState(null);n.useEffect(()=>{if(!v){o("/");return}},[v,o]);const ee=a=>{Z(a),ae(a.id)},ae=async a=>{try{g(!0),c(null);const t=await W("/api/pengajuan/pegawai-grouped",y);if(t.success){const M={};Object.entries(t.data).forEach(([re,ie])=>{const z=ie.filter(we=>!0);z.length>0&&(M[re]=z)}),T(M),Object.keys(M).length===0&&c("Tidak ada pegawai yang tersedia untuk jabatan ini")}else c(t.message||"Gagal mengambil data pegawai")}catch(t){console.error("Error fetching pegawai by jabatan:",t),c("Terjadi kesalahan saat mengambil data pegawai")}finally{g(!1)}},se=async()=>{if(!(!x||!i))try{w(!0);const a=await fe("/api/pengajuan",{pegawai_nip:x,jabatan_id:i.id,jenis_jabatan:i.jenis_jabatan},y);a.success?o(`/pengajuan/${a.data.id}/upload`,{state:{jabatan:i,requiredFiles:i.required_files}}):c(a.message||"Gagal membuat pengajuan")}catch(a){console.error("Error creating pengajuan:",a),c("Terjadi kesalahan saat membuat pengajuan")}finally{w(!1)}},F=()=>{const a=[];return Object.values(S).forEach(t=>{a.push(...t)}),l?a.filter(t=>t.nama.toLowerCase().includes(l.toLowerCase())||t.jabatan.toLowerCase().includes(l.toLowerCase())||t.unit_kerja.toLowerCase().includes(l.toLowerCase())||t.nip.includes(l)):a},te=a=>{if(a){const t=F();t.length>0&&h(t[0].nip)}else h(null)},f=F(),D=f.length,C=Math.ceil(D/_),L=(d-1)*_,G=L+_,q=f.slice(L,G),E=a=>{s(a),h(null)},ne=a=>{p(a),s(1),h(null)};return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs(m,{variant:"outline",onClick:()=>o("/pengajuan"),className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Kembali ke Data Pengajuan"]})}),e.jsxs(K,{children:[e.jsxs($,{children:[e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Pilih Pegawai untuk Pengajuan"]}),e.jsx("div",{className:"text-sm text-gray-600",children:i?`Pilih pegawai untuk pengajuan jabatan: ${i.jenis_jabatan}`:"Pilih jabatan terlebih dahulu, kemudian pilih pegawai yang akan diajukan"})]}),e.jsxs(Q,{children:[b&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600",children:b})}),!i&&e.jsxs("div",{className:"mb-6 p-6 bg-green-50 border border-green-200 rounded-lg text-center",children:[e.jsx(A,{className:"h-12 w-12 text-green-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-green-800 mb-2",children:"Pilih Jabatan Terlebih Dahulu"}),e.jsx("p",{className:"text-green-600 mb-4",children:"Untuk memulai pengajuan, Anda perlu memilih jenis jabatan yang akan diajukan."}),e.jsxs(m,{onClick:()=>J(!0),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Pilih Jabatan"]})]}),i&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-green-800",children:["Jabatan: ",i.jenis_jabatan]}),e.jsxs("p",{className:"text-sm text-green-600",children:[i.required_files.length," jenis dokumen diperlukan"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(P,{className:"bg-green-600 text-white",children:[i.max_dokumen," dokumen"]}),e.jsx(m,{variant:"outline",size:"sm",onClick:()=>J(!0),className:"border-green-600 text-green-600 hover:bg-green-50",children:"Ubah Jabatan"})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(X,{placeholder:"Cari pegawai berdasarkan nama, jabatan, unit kerja, atau NIP...",value:l,onChange:a=>ne(a.target.value),className:"pl-10"})]}),f.length>0&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Menampilkan ",f.length," pegawai (halaman ",d," dari ",C,")"]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:i?r?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(B,{className:"h-8 w-8 animate-spin mr-2"}),e.jsx("span",{children:"Memuat data pegawai..."})]}):b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(me,{className:"h-12 w-12 text-red-400 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 mb-2",children:b}),e.jsx("p",{className:"text-sm text-gray-500",children:"Pastikan sudah ada surat yang dibuat untuk pegawai di menu Template Generator"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(Ne,{children:[e.jsx(ye,{children:e.jsxs(I,{children:[e.jsx(u,{className:"w-12",children:e.jsx(U,{checked:x!==null,onCheckedChange:te})}),e.jsx(u,{children:"NIP"}),e.jsx(u,{children:"Nama"}),e.jsx(u,{children:"Jabatan"}),e.jsx(u,{children:"Unit Kerja"}),e.jsx(u,{children:"Induk Unit"}),e.jsx(u,{className:"text-center",children:"Total Surat"})]})}),e.jsx(ve,{children:q.length===0?e.jsx(I,{children:e.jsx(j,{colSpan:7,className:"text-center py-8 text-gray-500",children:l?"Tidak ada pegawai yang sesuai dengan pencarian":e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"Tidak ada pegawai yang tersedia"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Pastikan sudah ada surat yang dibuat untuk pegawai di menu Template Generator"})]})})}):q.map(a=>e.jsxs(I,{className:"hover:bg-gray-50",children:[e.jsx(j,{children:e.jsx(U,{checked:x===a.nip,onCheckedChange:t=>{h(t?a.nip:null)}})}),e.jsx(j,{className:"font-mono text-sm",children:a.nip}),e.jsx(j,{className:"font-medium",children:a.nama}),e.jsx(j,{children:a.jabatan}),e.jsx(j,{children:a.unit_kerja}),e.jsx(j,{children:a.induk_unit}),e.jsx(j,{className:"text-center",children:e.jsxs(P,{variant:"secondary",children:[a.total_surat," surat"]})})]},a.nip))})]}),C>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Menampilkan ",L+1," sampai ",Math.min(G,D)," dari ",D," pegawai"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>E(d-1),disabled:d===1,children:[e.jsx(oe,{className:"h-4 w-4"}),"Sebelumnya"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:C},(a,t)=>t+1).map(a=>e.jsx(m,{variant:d===a?"default":"outline",size:"sm",onClick:()=>E(a),className:"w-8 h-8 p-0",children:a},a))}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>E(d+1),disabled:d===C,children:["Selanjutnya",e.jsx(xe,{className:"h-4 w-4"})]})]})]})]}):e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Pilih jabatan terlebih dahulu untuk melihat daftar pegawai"})]})})}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(m,{onClick:se,disabled:!x||!i||k,size:"lg",className:"bg-green-600 hover:bg-green-700 text-white",children:k?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"h-4 w-4 mr-2 animate-spin"}),"Membuat Pengajuan..."]}):e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"Proses Pengajuan"]})})}),!x&&i&&f.length>0&&e.jsx("p",{className:"text-sm text-gray-500 mt-2 text-center",children:"Pilih satu pegawai untuk melanjutkan proses pengajuan"})]})]}),e.jsx(ke,{open:Y,onOpenChange:J,onJabatanSelected:ee})]})};export{Le as default};
//# sourceMappingURL=PengajuanSelect-BiH2Cz9M.js.map
