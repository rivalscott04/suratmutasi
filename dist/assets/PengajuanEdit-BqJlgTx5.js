import{j as e,a3 as _,at as X,a5 as Q,a6 as V,aB as W,ak as Z,aC as ee,U as ae,an as se}from"./ui-vendor-CkT_OuiB.js";import{d as ne,e as te,u as ie,r}from"./react-vendor-BNG1zHOu.js";import{C as h,c as g,a as C,b as B}from"./card-BJqCBAvQ.js";import{u as re,a as le,B as m,b as F,I as ce,j as de}from"./index-DgJIsNQf.js";import{L as T}from"./label-C1m6lE5X.js";import{A as K,a as U,b as E,c as M,d as me,e as oe,g as ue,f as pe}from"./alert-dialog-BwAhv_K8.js";const ke=()=>{const{pengajuanId:l}=ne(),o=te();ie();const{user:he,token:x,isAuthenticated:k}=re(),[u,L]=r.useState(null),[$,y]=r.useState(!0),[N,c]=r.useState(null),[d,v]=r.useState(!1),[z,j]=r.useState(!1),[f,S]=r.useState([]),[i,I]=r.useState(null),[R,w]=r.useState(!1);r.useEffect(()=>{if(!k){o("/");return}l&&G()},[k,o,l]);const G=async()=>{try{y(!0);const a=await le(`/api/pengajuan/${l}`,x);a.success?(L(a.data.pengajuan),J(a.data.pengajuan)):c(a.message||"Gagal mengambil data pengajuan")}catch(a){console.error("Error fetching pengajuan data:",a),c("Terjadi kesalahan saat mengambil data pengajuan")}finally{y(!1)}},J=a=>{const s=a.files.filter(t=>t.verification_status==="rejected").map(t=>({file_type:t.file_type,file:null,display_name:P(t.file_type),is_required:!0}));S(s)},P=a=>({surat_pengantar:"Surat Pengantar",surat_permohonan_dari_yang_bersangkutan:"Surat Permohonan Dari Yang Bersangkutan",surat_keputusan_cpns:"Surat Keputusan CPNS",surat_keputusan_pns:"Surat Keputusan PNS",surat_keputusan_kenaikan_pangkat_terakhir:"Surat Keputusan Kenaikan Pangkat Terakhir",surat_keputusan_jabatan_terakhir:"Surat Keputusan Jabatan Terakhir",skp_2_tahun_terakhir:"SKP 2 Tahun Terakhir",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan Yang Diterbitkan Inspektorat Jenderal Kementerian Agama",surat_keterangan_anjab_abk_instansi_asal:"Surat Keterangan Anjab dan ABK terhadap jabatan PNS dari instansi asal",surat_keterangan_anjab_abk_instansi_penerima:"Surat Keterangan Anjab dan ABK terhadap jabatan PNS dari instansi penerima",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan Tidak Pernah Dijatuhi Hukuman Disiplin Tingkat Sedang atau Berat Dalam 1 (satu) Tahun Terakhir Dari PPK",surat_persetujuan_mutasi_asal:"Surat Persetujuan Mutasi dari ASAL dengan menyebutkan jabatan yang akan diduduki",surat_lolos_butuh_ppk:"Surat Lolos Butuh dari Pejabat Pembina Kepegawaian instansi yang dituju",peta_jabatan:"Peta Jabatan",hasil_uji_kompetensi:"Hasil Uji Kompetensi",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",anjab_abk_instansi_asal:"Anjab/Abk Instansi Asal",anjab_abk_instansi_penerima:"Anjab/Abk Instansi Penerima",surat_keterangan_tidak_tugas_belajar:"Surat Keterangan Tidak Sedang Tugas Belajar",sptjm_pimpinan_satker_asal:"SPTJM Pimpinan Satker dari Asal",sptjm_pimpinan_satker_penerima:"SPTJM Pimpinan Satker dari Penerima",surat_rekomendasi_instansi_pembina:"Surat Rekomendasi Instansi Pembina"})[a]||a.replace(/_/g," ").toUpperCase(),H=(a,n)=>{S(s=>s.map(t=>t.file_type===a?{...t,file:n}:t))},O=async()=>{try{v(!0);const a=new FormData;f.forEach(s=>{s.file&&(a.append("files",s.file),a.append("file_types",s.file_type))});const n=await de(`/api/pengajuan/${l}/update-files`,a,x);n.success?o(`/pengajuan/${l}`):c(n.message||"Gagal memperbarui dokumen")}catch(a){console.error("Error updating files:",a),c("Terjadi kesalahan saat memperbarui dokumen")}finally{v(!1),j(!1)}},Y=async a=>{try{const n=await fetch(`/api/pengajuan/files/${a.id}`,{headers:{Authorization:`Bearer ${x}`}});if(!n.ok)throw new Error("Gagal mengambil file");const s=await n.blob(),t=URL.createObjectURL(s);I({...a,blobUrl:t}),w(!0)}catch(n){console.error("Error previewing file:",n),c("Gagal preview file. Silakan coba lagi.")}},q=a=>{window.open(`/api/pengajuan/files/${a.id}`,"_blank")},A=a=>{const s=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(a)/Math.log(1024));return parseFloat((a/Math.pow(1024,t)).toFixed(2))+" "+s[t]};if($)return e.jsx("div",{className:"container mx-auto p-6",children:e.jsx(h,{children:e.jsxs(g,{className:"flex items-center justify-center py-12",children:[e.jsx(_,{className:"h-8 w-8 animate-spin mr-2 text-green-600"}),e.jsx("span",{children:"Memuat data pengajuan..."})]})})});if(!u)return e.jsx("div",{className:"container mx-auto p-6",children:e.jsx(h,{children:e.jsxs(g,{className:"flex items-center justify-center py-12",children:[e.jsx(X,{className:"h-8 w-8 text-red-500 mr-2"}),e.jsx("span",{className:"text-red-600",children:"Pengajuan tidak ditemukan"})]})})});const p=u.files.filter(a=>a.verification_status==="rejected"),b=u.files.filter(a=>a.verification_status==="approved");return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(m,{variant:"outline",onClick:()=>o(`/pengajuan/${l}`),className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Kembali ke Detail Pengajuan"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Perbaiki Dokumen Pengajuan"}),e.jsxs("p",{className:"text-gray-600",children:["ID: ",u.id]})]})]})}),N&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600",children:N})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(h,{children:[e.jsx(C,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-green-600"}),"Dokumen yang Sudah Sesuai",e.jsx(F,{variant:"outline",className:"ml-2",children:b.length})]})}),e.jsx(g,{children:b.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Tidak ada dokumen yang sudah sesuai"}):e.jsx("div",{className:"space-y-3",children:b.map(a=>e.jsx("div",{className:"p-4 border border-green-200 rounded-lg bg-green-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-green-800",children:P(a.file_type)}),e.jsx("p",{className:"text-sm text-green-600",children:a.file_name}),e.jsx("p",{className:"text-xs text-green-500",children:A(a.file_size)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{size:"sm",variant:"outline",onClick:()=>Y(a),className:"text-green-600 border-green-300 hover:bg-green-100",children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>q(a),className:"text-green-600 border-green-300 hover:bg-green-100",children:e.jsx(Z,{className:"h-4 w-4"})})]})]})},a.id))})})]}),e.jsxs(h,{children:[e.jsx(C,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-red-600"}),"Dokumen yang Perlu Diperbaiki",e.jsx(F,{variant:"outline",className:"ml-2",children:p.length})]})}),e.jsx(g,{children:p.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Tidak ada dokumen yang perlu diperbaiki"}):e.jsx("div",{className:"space-y-4",children:f.map(a=>{const n=p.find(s=>s.file_type===a.file_type);return e.jsx("div",{className:"p-4 border border-red-200 rounded-lg bg-red-50",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(T,{className:"text-sm font-medium text-red-800",children:a.display_name}),n&&e.jsxs("div",{className:"mt-2 p-3 bg-white rounded border",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Dokumen saat ini: ",n.file_name]}),e.jsx("p",{className:"text-xs text-gray-500",children:A(n.file_size)}),n.verification_notes&&e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Catatan: ",n.verification_notes]})]})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:`file-${a.file_type}`,className:"text-sm font-medium text-red-800",children:"Upload Dokumen Baru"}),e.jsxs("div",{className:"mt-1 flex items-center gap-3",children:[e.jsxs(m,{type:"button",variant:"outline",onClick:()=>{var s;return(s=document.getElementById(`file-${a.file_type}`))==null?void 0:s.click()},className:"bg-white text-gray-700 border-gray-300 hover:bg-gray-50",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Pilih File"]}),e.jsx("span",{className:"text-sm text-gray-600",children:a.file?a.file.name:"Belum ada file dipilih"})]}),e.jsx(ce,{id:`file-${a.file_type}`,type:"file",accept:".pdf,.doc,.docx",onChange:s=>{var D;const t=(D=s.target.files)==null?void 0:D[0];t&&(H(a.file_type,t),s.target.value="")},className:"hidden"})]})]})},a.file_type)})})})]})]}),p.length>0&&e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(m,{onClick:()=>j(!0),disabled:d||f.every(a=>!a.file),className:"bg-green-600 hover:bg-green-700 text-white",size:"lg",children:d?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-4 w-4 mr-2 animate-spin text-green-600"}),"Menyimpan..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Simpan Perubahan"]})})}),e.jsx(K,{open:z,onOpenChange:j,children:e.jsxs(U,{children:[e.jsxs(E,{children:[e.jsx(M,{children:"Simpan Perubahan"}),e.jsx(me,{children:"Apakah Anda yakin ingin menyimpan perubahan dokumen? Dokumen yang sudah sesuai tidak akan berubah."})]}),e.jsxs(oe,{children:[e.jsx(ue,{disabled:d,children:"Batal"}),e.jsx(pe,{onClick:O,disabled:d,className:"bg-green-600 hover:bg-green-700 text-white",children:d?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-4 w-4 mr-2 animate-spin text-green-600"}),"Menyimpan..."]}):"Simpan"})]})]})}),e.jsx(K,{open:R,onOpenChange:a=>{w(a),!a&&(i!=null&&i.blobUrl)&&URL.revokeObjectURL(i.blobUrl)},children:e.jsxs(U,{className:"max-w-4xl",children:[e.jsx(E,{children:e.jsxs(M,{children:["Preview File: ",i==null?void 0:i.file_name]})}),e.jsx("div",{className:"mt-4",children:i&&e.jsxs("div",{className:"border rounded-lg overflow-hidden bg-white",children:[e.jsx("div",{className:"bg-green-600 text-white px-4 py-2 flex items-center justify-between",children:e.jsx("span",{className:"font-medium",children:i.file_name})}),e.jsx("iframe",{src:i.blobUrl||`/api/pengajuan/files/${i.id}`,className:"w-full h-96 border-0",title:"File Preview"})]})})]})})]})};export{ke as default};
//# sourceMappingURL=PengajuanEdit-BqJlgTx5.js.map
