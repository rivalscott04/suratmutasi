import{j as e,F as $,ar as Re,a8 as ja,aM as re,aN as Me,E as Be,S as Ie,a3 as U,aD as L,at as Ee,aK as oe,p as de,a9 as ce,as as Ke,ak as Je}from"./ui-vendor-DipkbOWo.js";import{e as pa,h as ba,r as o,c as fa}from"./react-vendor-DheTkQGW.js";import{C as va,a as ya,b as wa,c as Na}from"./card-DMC2b7AF.js";import{u as ka,d as Sa,a as ze,B as h,I as Da,b as Q,p as Le,q as Oe,r as He,v as x,D as _a,e as Ca,f as Pa,g as Fa,l as Aa,j as Ta}from"./index-BTaIBrBE.js";import{S as he,a as me,b as ue,c as ge,d as R}from"./select-CQ_f5ayV.js";import{T as xe,a as je,b as M,c as d,d as pe,e as m}from"./table--jIlP5Nc.js";import{A as $a,a as Ua,b as Ra,c as Ma}from"./accordion-Wtz6ypXi.js";import{A as Ba,a as Ia,b as Ea,c as Ka,d as Ja,e as za,g as La,f as Oa}from"./alert-dialog-BcGDVkPt.js";import{L as be}from"./label-CW5_Kf2p.js";import{T as Ha}from"./textarea-DqcpLLz4.js";const ss=()=>{const S=pa(),[Ge,fe]=ba(),{user:n,token:O,isAuthenticated:A}=ka(),{toast:Z}=Sa(),[b,Ve]=o.useState([]),[We,ve]=o.useState(!0),[ye,H]=o.useState(null),B=(a,t)=>{const s=Ge.get(a);if(s!==null)return s;const l=sessionStorage.getItem(`pengajuan_filter_${a}`);return l||t},[p,qe]=o.useState(()=>B("search","")),[j,we]=o.useState(()=>B("status","all")),[v,Ye]=o.useState(()=>B("created_by","all")),[y,Xe]=o.useState(()=>B("jenis_jabatan","all")),[i,u]=o.useState(()=>{const a=B("page","1");return parseInt(a,10)||1}),[D,Qe]=o.useState(1),[w,Ze]=o.useState(0),[ea,G]=o.useState(!1),[Ne,ee]=o.useState(null),[ae,ke]=o.useState(!1),[aa,I]=o.useState(!1),[_,V]=o.useState(null),[E,K]=o.useState(""),[Se,J]=o.useState(""),[De,_e]=o.useState(!1),[z,sa]=o.useState({users:[],statuses:[],jenisJabatan:[]}),[W,Ce]=o.useState({}),C=50,c=(n==null?void 0:n.role)==="admin",N=(n==null?void 0:n.role)==="user",Pe=(n==null?void 0:n.role)==="bimas",Fe=(n==null?void 0:n.role)==="kanwil",Ae=N||Pe,se=c||N||Pe,q=fa.useMemo(()=>{if(!se)return{};if(Object.keys(W).length>0)return console.log("ðŸ” Using server grouping:",W),W;if(!b||b.length===0)return{};console.log("ðŸ” Using client grouping, pengajuanList length:",b.length);const a=b.reduce((t,s)=>{var r;const l=s.office&&(s.office.kabkota||s.office.name)||s.pegawai&&s.pegawai.induk_unit||((r=s.pegawai)==null?void 0:r.unit_kerja)||"Lainnya";return t[l]||(t[l]=[]),t[l].push(s),t},{});return console.log("ðŸ” Client grouped result:",a),a},[se,W,b]);o.useEffect(()=>{if(!A)return;const a=new URLSearchParams;p&&a.set("search",p),j!=="all"&&a.set("status",j),v!=="all"&&a.set("created_by",v),y!=="all"&&a.set("jenis_jabatan",y),i>1&&a.set("page",i.toString()),fe(a,{replace:!0}),sessionStorage.setItem("pengajuan_filter_search",p),sessionStorage.setItem("pengajuan_filter_status",j),sessionStorage.setItem("pengajuan_filter_created_by",v),sessionStorage.setItem("pengajuan_filter_jenis_jabatan",y),sessionStorage.setItem("pengajuan_filter_page",i.toString())},[A,p,j,v,y,i,fe]),o.useEffect(()=>{if(!A){S("/");return}N&&j!=="final_approved"&&we("final_approved"),te()},[A,S,i,j,v,y,N,p]),o.useEffect(()=>{A&&ta()},[A]);const te=async()=>{var a,t,s;try{ve(!0);const l=new URLSearchParams({page:i.toString(),limit:C.toString(),...j!=="all"&&{status:j},...y!=="all"&&{jenis_jabatan:y},...p&&{search:p},...c&&v!=="all"&&{created_by:v},...Fe&&(n==null?void 0:n.id)&&{created_by:n.id}}),r=await ze(`/api/pengajuan?${l}`,O);if(r.success){if(Ve(r.data),c){const k=r.grouped_by_kabkota;console.log("ðŸ” Frontend received grouped data:",k),console.log("ðŸ” Frontend received data length:",(a=r.data)==null?void 0:a.length),Ce(k||{})}const f=((t=r.pagination)==null?void 0:t.totalPages)||1,P=((s=r.pagination)==null?void 0:s.total)||0;Qe(f),Ze(P)}else H(r.message||"Gagal mengambil data pengajuan")}catch(l){console.error("Error fetching pengajuan data:",l),H("Terjadi kesalahan saat mengambil data pengajuan")}finally{ve(!1)}},ta=async()=>{try{console.log("ðŸ” Fetching filter options...");const a=await ze("/api/pengajuan/filter-options",O);console.log("ðŸ” Filter options response:",a),a.success?(sa(a.data),console.log("ðŸ” Filter options set:",a.data)):console.error("ðŸ” Filter options failed:",a.message)}catch(a){console.error("Error fetching filter options:",a)}},na=a=>{qe(a),u(1)},la=a=>{N||(we(a),u(1))},ia=a=>{Ye(a),u(1)},ra=a=>{Xe(a),u(1)},T=a=>{S(`/pengajuan/${a}`)},oa=async()=>{if(Ne)try{ke(!0);const a=await Aa(`/api/pengajuan/${Ne}`,O);a.success?(te(),G(!1),ee(null)):H(a.message||"Gagal menghapus pengajuan")}catch(a){console.error("Error deleting pengajuan:",a),H("Terjadi kesalahan saat menghapus pengajuan")}finally{ke(!1)}},da=async()=>{if(!(!_||!E)){_e(!0);try{const a=await Ta(`/api/pengajuan/${_.id}/update-status`,{status:E,reason:Se},O);a.success?(Z({title:"Berhasil",description:"Status pengajuan berhasil diubah"}),I(!1),V(null),K(""),J(""),te()):Z({title:"Error",description:a.message||"Gagal mengubah status",variant:"destructive"})}catch(a){console.error("Error updating status:",a),Z({title:"Error",description:"Terjadi kesalahan saat mengubah status",variant:"destructive"})}finally{_e(!1)}}},ne=(a,t)=>{const s=(P,k)=>{var Y;return P!=="submitted"||!k?!1:((Y=k.files)==null?void 0:Y.some(le=>le.file_category==="admin_wilayah"))||!1},r={draft:{label:"Draft",className:"bg-gray-100 text-gray-800 hover:bg-gray-200",icon:Je},submitted:{label:s(a,t)?"Diajukan Admin Wilayah":"Diajukan",className:s(a,t)?"bg-blue-200 text-blue-800 hover:bg-blue-300":"bg-blue-100 text-blue-800 hover:bg-blue-200",icon:$},approved:{label:"Disetujui",className:"bg-green-100 text-green-800 hover:bg-green-200",icon:U},rejected:{label:"Ditolak Admin Wilayah",className:"bg-red-100 text-red-800 hover:bg-red-200",icon:L},resubmitted:{label:"Diajukan Ulang",className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-200",icon:Je},admin_wilayah_approved:{label:"Disetujui Admin Wilayah",className:"bg-green-200 text-green-800 hover:bg-green-300",icon:U},admin_wilayah_rejected:{label:"Ditolak Superadmin",className:"bg-red-200 text-red-800 hover:bg-red-300",icon:L},admin_wilayah_submitted:{label:"Diajukan Admin Wilayah",className:"bg-blue-200 text-blue-800 hover:bg-blue-300",icon:$},kanwil_submitted:{label:"Diajukan Kanwil",className:"bg-purple-200 text-purple-800 hover:bg-purple-300",icon:$},kanwil_approved:{label:"Disetujui Kanwil",className:"bg-purple-300 text-purple-900 hover:bg-purple-400",icon:U},final_approved:{label:"Final Approved",className:"bg-green-600 text-white",icon:U},final_rejected:{label:"Final Rejected",className:"bg-red-600 text-white",icon:L}}[a]||{label:a,className:"bg-gray-100 text-gray-800",icon:$},f=r.icon;return e.jsxs(Q,{className:r.className,children:[e.jsx(f,{className:"h-3 w-3 mr-1"}),r.label]})},Te=a=>({guru:"Guru",eselon_iv:"Eselon IV",fungsional:"Fungsional",pelaksana:"Pelaksana"})[a]||a,$e=a=>new Date(a).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),Ue=()=>{const a=Object.keys(q).length>0?q:b.reduce((t,s)=>{var r;const l=s.office&&(s.office.kabkota||s.office.name)||s.pegawai&&s.pegawai.induk_unit||((r=s.pegawai)==null?void 0:r.unit_kerja)||"Lainnya";return t[l]||(t[l]=[]),t[l].push(s),t},{});return Object.entries(a).map(([t,s])=>({kabkota:t,total:s.length}))},ca=(a,t)=>{const s=URL.createObjectURL(a),l=document.createElement("a");l.href=s,l.download=t,document.body.appendChild(l),l.click(),l.remove(),URL.revokeObjectURL(s)},ha=()=>{const a=Ue(),t=new Date,l=`Rekap-final_approved-per-kabkota-${`${t.getFullYear()}${String(t.getMonth()+1).padStart(2,"0")}${String(t.getDate()).padStart(2,"0")}`}.xls`,r=`
      <html>
      <head><meta charset="UTF-8" /></head>
      <body>
        <table border="1">
          <thead>
            <tr><th>Kab/Kota</th><th>Jumlah Pengajuan Final Approved</th></tr>
          </thead>
          <tbody>
            ${a.map(P=>`<tr><td>${P.kabkota}</td><td>${P.total}</td></tr>`).join("")}
          </tbody>
        </table>
      </body>
      </html>`,f=new Blob([r],{type:"application/vnd.ms-excel"});ca(f,l)},ma=()=>{const a=Ue().sort((g,F)=>F.total-g.total),t=a.reduce((g,F)=>g+F.total,0),s=Math.max(1,...a.map(g=>g.total)),l=a.length,r=new Date,f=r.toLocaleString("id-ID",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),k=`Rekap-disetujui-kanwil-per-kabkota-${`${r.getFullYear()}${String(r.getMonth()+1).padStart(2,"0")}${String(r.getDate()).padStart(2,"0")}`}.pdf`,Y=(n==null?void 0:n.full_name)||(n==null?void 0:n.email)||"Admin Pusat",le=a.slice(0,5),ie=window.open("","_blank");ie&&(ie.document.write(`
      <html>
        <head>
          <meta charset="UTF-8" />
          <title>${k}</title>
          <style>
            @page { size: A4; margin: 18mm 14mm; }
            * { box-sizing: border-box; }
            body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; color: #111827; }
            .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
            .title { font-size: 18px; font-weight: 700; }
            .meta { font-size: 12px; color: #4b5563; }
            .summary { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 8px; margin: 12px 0 16px; }
            .card { border: 1px solid #e5e7eb; border-radius: 8px; padding: 10px; }
            .card h3 { font-size: 12px; color: #6b7280; margin: 0 0 4px; font-weight: 600; }
            .card .value { font-size: 20px; font-weight: 700; color: #111827; }
            table { border-collapse: collapse; width: 100%; margin-top: 4px; }
            th, td { border: 1px solid #e5e7eb; padding: 8px 10px; font-size: 12px; }
            th { background: #f9fafb; text-align: left; }
            tfoot td { font-weight: 700; background: #f3f4f6; }
            .row { display: flex; align-items: center; gap: 10px; }
            .bar { height: 8px; background: #d1fae5; border-radius: 4px; overflow: hidden; }
            .bar > span { display: block; height: 100%; background: #10b981; }
            .note { margin-top: 12px; font-size: 11px; color: #6b7280; }
            .section-title { margin-top: 16px; font-size: 14px; font-weight: 700; }
          </style>
        </head>
        <body>
          <div class="header">
            <div>
              <div class="title">Rekap Pengajuan Telah Disetujui Kanwil per Kab/Kota</div>
              <div class="meta">Dihasilkan: ${f} â€¢ Dibuat oleh: ${Y}</div>
            </div>
          </div>

          <div class="summary">
            <div class="card">
              <h3>Total Telah Disetujui Kanwil</h3>
              <div class="value">${t}</div>
            </div>
            <div class="card">
              <h3>Jumlah Kab/Kota</h3>
              <div class="value">${l}</div>
            </div>
            <div class="card">
              <h3>Top Kab/Kota</h3>
              <div style="font-size:12px; color:#111827; line-height:1.4;">
                ${le.map((g,F)=>`${F+1}. ${g.kabkota} (${g.total})`).join("<br/>")||"-"}
              </div>
            </div>
          </div>

          <div class="section-title">Tabel Rekap</div>
          <table>
            <thead>
              <tr>
                <th style="width:36px;">No</th>
                <th>Kab/Kota</th>
                <th style="width:110px;">Jumlah</th>
                <th style="width:80px;">Persen</th>
                <th>Visual</th>
              </tr>
            </thead>
            <tbody>
              ${a.map((g,F)=>{const ua=t>0?Math.round(g.total/t*1e3)/10:0,ga=Math.round(g.total/s*100),X=140,xa=Math.max(1,Math.round(ga/100*X));return`
                  <tr>
                    <td>${F+1}</td>
                    <td>${g.kabkota}</td>
                    <td style="text-align:right; font-variant-numeric: tabular-nums;">${g.total}</td>
                    <td style="text-align:right; font-variant-numeric: tabular-nums;">${ua.toFixed(1)}%</td>
                    <td>
                      <svg width="${X}" height="10" viewBox="0 0 ${X} 10" xmlns="http://www.w3.org/2000/svg">
                        <rect x="0" y="0" width="${X}" height="10" fill="#E5F6F1" stroke="#D1D5DB" />
                        <rect x="0" y="0" width="${xa}" height="10" fill="#10B981" />
                      </svg>
                    </td>
                  </tr>
                `}).join("")}
            </tbody>
            <tfoot>
              <tr>
                <td colspan="2">Total</td>
                <td style="text-align:right; font-variant-numeric: tabular-nums;">${t}</td>
                <td></td>
                <td></td>
              </tr>
            </tfoot>
          </table>

          <div class="note">Catatan: Laporan ini menampilkan pengajuan yang <strong>telah disetujui Kanwil</strong>.</div>

          <script>
            window.onload = function() { window.print(); };
          <\/script>
        </body>
      </html>
    `),ie.document.close())};return console.log("ðŸ” Debug PengajuanIndex:",{userRole:n==null?void 0:n.role,isAdmin:c,userEmail:n==null?void 0:n.email}),e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs(va,{children:[e.jsx(ya,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(wa,{className:"flex items-center gap-2",children:[e.jsx($,{className:"h-5 w-5"}),"Daftar Pengajuan Mutasi PNS"]}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:c?"Semua pengajuan mutasi PNS":N?"Semua pengajuan berstatus final_approved (read-only)":Fe?"Pengajuan mutasi PNS Anda (Kanwil)":"Pengajuan mutasi PNS Anda"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[N&&e.jsxs(e.Fragment,{children:[e.jsx(h,{onClick:ha,className:"bg-green-600 hover:bg-green-700 text-white",children:"Export Excel"}),e.jsx(h,{onClick:ma,className:"bg-blue-600 hover:bg-blue-700 text-white",children:"Export PDF"})]}),!Ae&&e.jsxs(h,{onClick:()=>S("/pengajuan/select"),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Tambah Pengajuan"]})]})]})}),e.jsxs(Na,{children:[ye&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600",children:ye})}),e.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ja,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(Da,{placeholder:"Cari berdasarkan nama pegawai, jabatan, atau jenis jabatan...",value:p,onChange:a=>na(a.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4 text-gray-400"}),e.jsxs(he,{value:j,onValueChange:la,children:[e.jsx(me,{className:"w-48",children:e.jsx(ue,{placeholder:"Filter Status"})}),e.jsxs(ge,{children:[e.jsx(R,{value:"all",children:"Semua Status"}),z.statuses.filter(a=>a.count>0).map(a=>e.jsxs(R,{value:a.value,children:[a.label," (",a.count,")"]},a.value))]})]})]}),N&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4 text-gray-400"}),e.jsxs(he,{value:y,onValueChange:ra,children:[e.jsx(me,{className:"w-48",children:e.jsx(ue,{placeholder:"Filter Jenis Jabatan"})}),e.jsxs(ge,{children:[e.jsx(R,{value:"all",children:"Semua Jenis Jabatan"}),z.jenisJabatan.filter(a=>a.count>0).map(a=>e.jsxs(R,{value:a.value,children:[a.label," (",a.count,")"]},a.value))]})]})]}),c&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4 text-gray-400"}),e.jsxs(he,{value:v,onValueChange:ia,children:[e.jsx(me,{className:"w-48",children:e.jsx(ue,{placeholder:"Filter Pembuat"})}),e.jsxs(ge,{children:[e.jsx(R,{value:"all",children:"Semua Pembuat"}),z.users.map(a=>e.jsx(R,{value:a.id,children:a.full_name||a.email||"Unknown User"},a.id))]})]})]})]})]}),se&&Object.keys(q).length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Tergabung berdasarkan kabupaten/kota"}),e.jsx($a,{type:"multiple",className:"w-full",children:Object.entries(q).map(([a,t])=>e.jsxs(Ua,{value:a,className:"border rounded-lg",children:[e.jsx(Ra,{className:"px-4 py-3 hover:no-underline",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"font-medium",children:a}),e.jsx(Q,{variant:"secondary",className:"ml-2",children:t.length})]})}),e.jsx(Ma,{className:"px-0",children:e.jsx("div",{className:"border-t",children:e.jsxs(xe,{children:[e.jsx(je,{children:e.jsxs(M,{children:[e.jsx(d,{children:"Pegawai"}),e.jsx(d,{children:"Jenis Jabatan"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Jumlah Dokumen"}),c&&e.jsx(d,{children:"Pembuat"}),e.jsx(d,{children:"Tanggal Dibuat"}),e.jsx(d,{className:"text-right",children:"Aksi"})]})}),e.jsx(pe,{children:t.map(s=>e.jsxs(M,{className:"hover:bg-gray-50",children:[e.jsx(m,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.pegawai.nama}),e.jsx("div",{className:"text-sm text-gray-500",children:s.pegawai.jabatan})]})}),e.jsx(m,{children:e.jsx(Q,{variant:"outline",children:Te(s.jenis_jabatan)})}),e.jsx(m,{children:ne(s.status,s)}),e.jsx(m,{children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-sm",children:s.files.length})})}),c&&e.jsx(m,{children:e.jsx("div",{className:"text-sm text-gray-600",children:(()=>{var r;const l=z.users.find(f=>f.id===s.created_by);return l?l.full_name||l.email||"Unknown User":(r=s.created_by)!=null&&r.includes("@")?s.created_by:"Unknown User"})()})}),e.jsx(m,{children:e.jsx("div",{className:"text-sm text-gray-600",children:$e(s.created_at)})}),e.jsx(m,{className:"text-right",children:e.jsxs(Le,{children:[e.jsx(Oe,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"sm",children:e.jsx(Me,{className:"h-4 w-4"})})}),e.jsxs(He,{align:"end",children:[e.jsxs(x,{onClick:()=>T(s.id),children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Lihat Detail"]}),c&&e.jsxs(x,{onClick:()=>{V(s),K(s.status),J(""),I(!0)},children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Ubah Status"]}),c&&s.status==="admin_wilayah_submitted"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{onClick:()=>T(s.id),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Setujui"]}),e.jsxs(x,{onClick:()=>T(s.id),children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Tolak"]})]}),c&&e.jsxs(x,{onClick:()=>{ee(s.id),G(!0)},className:"text-red-600",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Hapus"]})]})]})})]},s.id))})]})})})]},a))}),D>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border rounded-lg bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Menampilkan ",(i-1)*C+1," sampai ",Math.min(i*C,w)," dari ",w," pengajuan"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>u(i-1),disabled:i===1,children:[e.jsx(oe,{className:"h-4 w-4"}),"Sebelumnya"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:D},(a,t)=>t+1).map(a=>e.jsx(h,{variant:i===a?"default":"outline",size:"sm",onClick:()=>u(a),className:`w-8 h-8 p-0 ${i===a?"bg-green-600 hover:bg-green-700 text-white border-green-600":"bg-white hover:bg-green-50 text-gray-700 border-gray-300 hover:border-green-300"}`,children:a},a))}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>u(i+1),disabled:i===D,children:["Selanjutnya",e.jsx(de,{className:"h-4 w-4"})]})]})]})]}):e.jsx("div",{className:"border rounded-lg overflow-hidden",children:We?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(ce,{className:"h-8 w-8 animate-spin mr-2 text-green-600"}),e.jsx("span",{children:"Memuat data pengajuan..."})]}):b.length===0&&w===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx($,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 mb-2",children:p||j!=="all"?"Tidak ada pengajuan yang sesuai dengan filter":"Belum ada pengajuan"}),!p&&j==="all"&&(n==null?void 0:n.role)!=="user"&&e.jsxs(h,{onClick:()=>S("/pengajuan/select"),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(Re,{className:"h-4 w-4 mr-2"}),"Buat Pengajuan Pertama"]})]}):b.length===0&&w>0?e.jsxs(e.Fragment,{children:[e.jsxs(xe,{children:[e.jsx(je,{children:e.jsxs(M,{children:[e.jsx(d,{children:"Pegawai"}),e.jsx(d,{children:"Jenis Jabatan"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Jumlah Dokumen"}),e.jsx(d,{children:"Tanggal Dibuat"}),e.jsx(d,{children:"Aksi"})]})}),e.jsx(pe,{children:e.jsx(M,{children:e.jsx(m,{colSpan:6,className:"text-center py-8 text-gray-500",children:"Tidak ada data di halaman ini"})})})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Menampilkan ",(i-1)*C+1," sampai ",Math.min(i*C,w)," dari ",w," pengajuan"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>u(i-1),disabled:i===1,children:[e.jsx(oe,{className:"h-4 w-4"}),"Sebelumnya"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:D},(a,t)=>t+1).map(a=>e.jsx(h,{variant:i===a?"default":"outline",size:"sm",onClick:()=>u(a),className:`w-8 h-8 p-0 ${i===a?"bg-green-600 hover:bg-green-700 text-white border-green-600":"bg-white hover:bg-green-50 text-gray-700 border-gray-300 hover:border-green-300"}`,children:a},a))}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>u(i+1),disabled:i===D,children:["Selanjutnya",e.jsx(de,{className:"h-4 w-4"})]})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(xe,{children:[e.jsx(je,{children:e.jsxs(M,{children:[e.jsx(d,{children:"Pegawai"}),e.jsx(d,{children:"Jenis Jabatan"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Dokumen"}),c&&e.jsx(d,{children:"Pembuat"}),e.jsx(d,{children:"Tanggal Dibuat"}),e.jsx(d,{className:"text-right",children:"Aksi"})]})}),e.jsx(pe,{children:b.map(a=>e.jsxs(M,{className:"hover:bg-gray-50",children:[e.jsx(m,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a.pegawai.nama}),e.jsx("div",{className:"text-sm text-gray-500",children:a.pegawai.jabatan})]})}),e.jsx(m,{children:e.jsx(Q,{variant:"outline",children:Te(a.jenis_jabatan)})}),e.jsx(m,{children:ne(a.status,a)}),e.jsx(m,{children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"text-sm",children:a.files.length})})}),c&&e.jsx(m,{children:e.jsx("div",{className:"text-sm text-gray-600",children:(()=>{var s;const t=z.users.find(l=>l.id===a.created_by);return t?t.full_name||t.email||"Unknown User":(s=a.created_by)!=null&&s.includes("@")?a.created_by:"Unknown User"})()})}),e.jsx(m,{children:e.jsx("div",{className:"text-sm text-gray-600",children:$e(a.created_at)})}),e.jsx(m,{className:"text-right",children:e.jsxs(Le,{children:[e.jsx(Oe,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"sm",children:e.jsx(Me,{className:"h-4 w-4"})})}),e.jsxs(He,{align:"end",children:[e.jsxs(x,{onClick:()=>T(a.id),children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"Lihat Detail"]}),!Ae&&e.jsxs(e.Fragment,{children:[a.status==="draft"&&e.jsxs(x,{onClick:()=>S(`/pengajuan/${a.id}/upload`),children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"Upload Dokumen"]}),a.status==="rejected"&&e.jsxs(x,{onClick:()=>S(`/pengajuan/${a.id}/edit`),children:[e.jsx(Ke,{className:"h-4 w-4 mr-2"}),"Perbaiki Dokumen"]})]}),c&&e.jsxs(x,{onClick:()=>{V(a),K(a.status),J(""),I(!0)},children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Ubah Status"]}),c&&a.status==="admin_wilayah_submitted"&&e.jsxs(e.Fragment,{children:[e.jsxs(x,{onClick:()=>T(a.id),children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Setujui"]}),e.jsxs(x,{onClick:()=>T(a.id),children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Tolak"]})]}),(c||a.status==="draft"&&(n==null?void 0:n.role)!=="user")&&e.jsxs(x,{onClick:()=>{console.log("ðŸ” Debug: Klik hapus untuk pengajuan:",{id:a.id,status:a.status,isAdmin:c,userRole:n==null?void 0:n.role}),ee(a.id),G(!0)},className:"text-red-600",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Hapus"]})]})]})})]},a.id))})]}),e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Menampilkan ",(i-1)*C+1," sampai ",Math.min(i*C,w)," dari ",w," pengajuan"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>u(i-1),disabled:i===1,children:[e.jsx(oe,{className:"h-4 w-4"}),"Sebelumnya"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:D},(a,t)=>t+1).map(a=>e.jsx(h,{variant:i===a?"default":"outline",size:"sm",onClick:()=>u(a),className:`w-8 h-8 p-0 ${i===a?"bg-green-600 hover:bg-green-700 text-white border-green-600":"bg-white hover:bg-green-50 text-gray-700 border-gray-300 hover:border-green-300"}`,children:a},a))}),e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>u(i+1),disabled:i===D,children:["Selanjutnya",e.jsx(de,{className:"h-4 w-4"})]})]})]})]})})]})]}),e.jsx(_a,{open:aa,onOpenChange:I,children:e.jsxs(Ca,{className:"sm:max-w-md",children:[e.jsx(Pa,{children:e.jsx(Fa,{children:"Ubah Status Pengajuan"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(be,{htmlFor:"status",children:"Status Saat Ini"}),e.jsx("div",{className:"mt-1 p-2 bg-gray-50 rounded-md",children:_&&ne(_.status,_)})]}),e.jsxs("div",{children:[e.jsx(be,{htmlFor:"newStatus",children:"Status Baru"}),e.jsxs("select",{id:"newStatus",value:E,onChange:a=>K(a.target.value),className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:"draft",children:"Draft"}),e.jsx("option",{value:"submitted",children:"Submitted"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Ditolak Admin Wilayah"}),e.jsx("option",{value:"resubmitted",children:"Resubmitted"}),e.jsx("option",{value:"admin_wilayah_approved",children:"Admin Wilayah Approved"}),e.jsx("option",{value:"admin_wilayah_rejected",children:"Ditolak Superadmin"}),e.jsx("option",{value:"admin_wilayah_submitted",children:"Admin Wilayah Submitted"}),e.jsx("option",{value:"final_approved",children:"Final Approved"}),e.jsx("option",{value:"final_rejected",children:"Final Rejected"})]})]}),e.jsxs("div",{children:[e.jsx(be,{htmlFor:"reason",children:"Alasan Perubahan (Opsional)"}),e.jsx(Ha,{id:"reason",value:Se,onChange:a=>J(a.target.value),placeholder:"Masukkan alasan perubahan status...",className:"mt-1",rows:3})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-4",children:[e.jsx(h,{variant:"outline",onClick:()=>{I(!1),V(null),K(""),J("")},children:"Batal"}),e.jsx(h,{onClick:da,disabled:De||!E||_&&E===_.status,className:"bg-green-600 hover:bg-green-700 text-white",children:De?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-4 w-4 mr-2 animate-spin"}),"Memproses..."]}):"Ubah Status"})]})]})}),e.jsx(Ba,{open:ea,onOpenChange:G,children:e.jsxs(Ia,{children:[e.jsxs(Ea,{children:[e.jsx(Ka,{children:"Hapus Pengajuan"}),e.jsx(Ja,{children:"Apakah Anda yakin ingin menghapus pengajuan ini? Tindakan ini tidak dapat dibatalkan."})]}),e.jsxs(za,{children:[e.jsx(La,{disabled:ae,children:"Batal"}),e.jsx(Oa,{onClick:oa,disabled:ae,className:"bg-red-600 hover:bg-red-700",children:ae?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"h-4 w-4 mr-2 animate-spin text-green-600"}),"Menghapus..."]}):"Hapus"})]})]})})]})};export{ss as default};
//# sourceMappingURL=PengajuanIndex-BMiD3_vx.js.map
