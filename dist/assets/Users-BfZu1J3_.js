import{j as e,K as oe,ao as ce,V as he,W as w,ap as me,aq as xe,aC as E,aD as P}from"./ui-vendor-DiY4nm-6.js";import{r as l}from"./react-vendor-C8WR5ETM.js";import{u as ue,a as je,t as S,B as t,I as n,b as fe,D as I,e as M,f as O,g as R,h as H,i as z,j as ge,k as pe,m as ve}from"./index-BakxVqGD.js";import{L as i}from"./label-DNoQbHOo.js";import{S as G,a as W,b as V,c as K,d}from"./select-LMyPoEoA.js";import{T as we,a as be,b as _,c as j,d as Ne,e as m}from"./table-Dg1us99K.js";import{A as ke,a as ye,b as Ce,c as De,d as Se,e as _e,g as Ae,f as Ue}from"./alert-dialog-BEZq2G1v.js";import{C as $,c as q,a as Le,b as Te,d as Fe}from"./card-CAu6g27L.js";const ze=()=>{const{user:b,token:o}=ue(),[J,Q]=l.useState([]),[X,A]=l.useState(!0),[f,Y]=l.useState(""),[Z,g]=l.useState(!1),[ee,p]=l.useState(!1),[se,N]=l.useState(!1),[c,k]=l.useState(null),[a,r]=l.useState({email:"",full_name:"",password:"",role:"user",office_id:""}),[x,U]=l.useState(!1),[u,v]=l.useState(!1),[ae,L]=l.useState(!1),[le,y]=l.useState(null),[T,C]=l.useState("");if((b==null?void 0:b.role)!=="admin")return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx($,{children:e.jsx(q,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-600 mb-2",children:"Akses Ditolak"}),e.jsx("p",{className:"text-gray-600",children:"Anda tidak memiliki akses ke halaman ini."})]})})})});l.useEffect(()=>{D()},[]);const D=async()=>{if(o){A(!0);try{const s=await je("/api/users",o);Q(s.users||[])}catch(s){console.error("Failed to fetch users:",s),S({title:"Error",description:"Gagal mengambil data user",variant:"destructive"})}finally{A(!1)}}},re=()=>{r({email:"",full_name:"",password:"",role:"user",office_id:""}),g(!0)},ie=s=>{k(s),r({email:s.email,full_name:s.full_name,password:"",role:s.role,office_id:s.office_id||""}),p(!0)},te=s=>{k(s),N(!0)},F=async(s=!1)=>{if(o){v(!0);try{if(s&&c){const h={...a};h.password||delete h.password,await ge(`/api/users/${c.id}`,h,o),y(!0),C("User berhasil diperbarui.")}else await pe("/api/users",a,o),y(!0),C("User berhasil ditambahkan.");D(),g(!1),p(!1),r({email:"",full_name:"",password:"",role:"user",office_id:""})}catch(h){y(!1),C((h==null?void 0:h.message)||"Gagal menyimpan user.")}finally{v(!1),g(!1),p(!1),L(!0)}}},ne=async()=>{if(!(!o||!c)){v(!0);try{await ve(`/api/users/${c.id}`,o),S({title:"Sukses",description:"User berhasil dihapus"}),D(),N(!1),k(null)}catch(s){console.error("Failed to delete user:",s),S({title:"Error",description:"Gagal menghapus user",variant:"destructive"})}finally{v(!1)}}},B=J.filter(s=>s.full_name.toLowerCase().includes(f.toLowerCase())||s.email.toLowerCase().includes(f.toLowerCase())||s.role.toLowerCase().includes(f.toLowerCase())),de=s=>{switch(s){case"admin":return"bg-red-100 text-red-800";case"operator":return"bg-blue-100 text-blue-800";case"user":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[ae&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/20 backdrop-blur-sm animate-in fade-in-0 duration-200",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full flex flex-col items-center animate-in zoom-in-95 duration-200",children:[le?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-10 h-10 text-green-600",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Berhasil"}),e.jsx("p",{className:"text-gray-600 mb-6 text-center",children:T})]}):e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-10 h-10 text-red-600",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Gagal"}),e.jsx("p",{className:"text-gray-600 mb-6 text-center",children:T})]}),e.jsx("button",{className:"w-full py-3 rounded-lg bg-green-600 hover:bg-green-700 text-white text-lg font-semibold shadow transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-400",onClick:()=>L(!1),children:"Tutup"})]})}),e.jsxs($,{children:[e.jsx(Le,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs(Te,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"w-5 h-5"}),"Management User"]}),e.jsx(Fe,{children:"Kelola user dan akses sistem"})]}),e.jsxs(t,{onClick:re,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(ce,{className:"w-4 h-4 mr-2"}),"Tambah User"]})]})}),e.jsxs(q,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(n,{placeholder:"Cari user...",value:f,onChange:s=>Y(s.target.value),className:"pl-10"})]})}),X?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(w,{className:"w-6 h-6 animate-spin mr-2"}),e.jsx("span",{children:"Loading users..."})]}):e.jsx("div",{className:"border rounded-lg",children:e.jsxs(we,{children:[e.jsx(be,{children:e.jsxs(_,{children:[e.jsx(j,{children:"Nama"}),e.jsx(j,{children:"Email"}),e.jsx(j,{children:"Role"}),e.jsx(j,{children:"Office ID"}),e.jsx(j,{children:"Created At"}),e.jsx(j,{className:"text-right",children:"Aksi"})]})}),e.jsx(Ne,{children:B.length===0?e.jsx(_,{children:e.jsx(m,{colSpan:6,className:"text-center py-8 text-gray-500",children:f?"Tidak ada user yang ditemukan":"Belum ada user"})}):B.map(s=>e.jsxs(_,{children:[e.jsx(m,{className:"font-medium",children:s.full_name}),e.jsx(m,{children:s.email}),e.jsx(m,{children:e.jsx(fe,{className:de(s.role),children:s.role})}),e.jsx(m,{children:s.office_id||"-"}),e.jsx(m,{children:s.created_at?new Date(s.created_at).toLocaleDateString("id-ID"):"-"}),e.jsx(m,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(t,{variant:"outline",size:"sm",onClick:()=>ie(s),children:e.jsx(me,{className:"w-4 h-4"})}),e.jsx(t,{variant:"outline",size:"sm",onClick:()=>te(s),className:"text-red-600 hover:text-red-700",children:e.jsx(xe,{className:"w-4 h-4"})})]})})]},s.id))})]})})]})]}),e.jsx(I,{open:Z,onOpenChange:g,children:e.jsxs(M,{className:"sm:max-w-md",children:[e.jsxs(O,{children:[e.jsx(R,{children:"Tambah User Baru"}),e.jsx(H,{children:"Masukkan informasi user yang akan ditambahkan ke sistem."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email",children:"Email"}),e.jsx(n,{id:"email",type:"email",value:a.email,onChange:s=>r({...a,email:s.target.value}),placeholder:"user@example.com"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"full_name",children:"Nama Lengkap"}),e.jsx(n,{id:"full_name",value:a.full_name,onChange:s=>r({...a,full_name:s.target.value}),placeholder:"Nama lengkap user"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx(n,{id:"password",type:x?"text":"password",value:a.password,onChange:s=>r({...a,password:s.target.value}),placeholder:"Password"}),e.jsx(t,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>U(!x),children:x?e.jsx(E,{className:"h-4 w-4"}):e.jsx(P,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"role",children:"Role"}),e.jsxs(G,{value:a.role,onValueChange:s=>r({...a,role:s}),children:[e.jsx(W,{children:e.jsx(V,{placeholder:"Pilih role"})}),e.jsxs(K,{children:[e.jsx(d,{value:"user",children:"User"}),e.jsx(d,{value:"operator",children:"Operator"}),e.jsx(d,{value:"admin",children:"Admin"}),e.jsx(d,{value:"admin_wilayah",children:"Admin Wilayah"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"office_id",children:"Office ID"}),e.jsx(n,{id:"office_id",value:a.office_id,onChange:s=>r({...a,office_id:s.target.value}),placeholder:"ID kantor (opsional)"})]})]}),e.jsxs(z,{children:[e.jsx(t,{variant:"outline",onClick:()=>g(!1),children:"Batal"}),e.jsxs(t,{onClick:()=>F(!1),disabled:u||!a.email||!a.full_name||!a.password,className:"bg-green-600 hover:bg-green-700",children:[u?e.jsx(w,{className:"w-4 h-4 animate-spin mr-2"}):null,"Tambah User"]})]})]})}),e.jsx(I,{open:ee,onOpenChange:p,children:e.jsxs(M,{className:"sm:max-w-md",children:[e.jsxs(O,{children:[e.jsx(R,{children:"Edit User"}),e.jsx(H,{children:"Perbarui informasi user."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit-email",children:"Email"}),e.jsx(n,{id:"edit-email",type:"email",value:a.email,onChange:s=>r({...a,email:s.target.value}),placeholder:"user@example.com"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit-full_name",children:"Nama Lengkap"}),e.jsx(n,{id:"edit-full_name",value:a.full_name,onChange:s=>r({...a,full_name:s.target.value}),placeholder:"Nama lengkap user"})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit-password",children:"Password Baru (opsional)"}),e.jsxs("div",{className:"relative",children:[e.jsx(n,{id:"edit-password",type:x?"text":"password",value:a.password,onChange:s=>r({...a,password:s.target.value}),placeholder:"Kosongkan jika tidak ingin mengubah password"}),e.jsx(t,{type:"button",variant:"ghost",size:"sm",className:"absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent",onClick:()=>U(!x),children:x?e.jsx(E,{className:"h-4 w-4"}):e.jsx(P,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit-role",children:"Role"}),e.jsxs(G,{value:a.role,onValueChange:s=>r({...a,role:s}),children:[e.jsx(W,{children:e.jsx(V,{placeholder:"Pilih role"})}),e.jsxs(K,{children:[e.jsx(d,{value:"user",children:"User"}),e.jsx(d,{value:"operator",children:"Operator"}),e.jsx(d,{value:"admin",children:"Admin"}),e.jsx(d,{value:"admin_wilayah",children:"Admin Wilayah"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"edit-office_id",children:"Office ID"}),e.jsx(n,{id:"edit-office_id",value:a.office_id,onChange:s=>r({...a,office_id:s.target.value}),placeholder:"ID kantor (opsional)"})]})]}),e.jsxs(z,{children:[e.jsx(t,{variant:"outline",onClick:()=>p(!1),children:"Batal"}),e.jsxs(t,{onClick:()=>F(!0),disabled:u||!a.email||!a.full_name,className:"bg-green-600 hover:bg-green-700 text-white",children:[u?e.jsx(w,{className:"w-4 h-4 animate-spin mr-2"}):null,"Update User"]})]})]})}),e.jsx(ke,{open:se,onOpenChange:N,children:e.jsxs(ye,{children:[e.jsxs(Ce,{children:[e.jsx(De,{children:"Hapus User"}),e.jsxs(Se,{children:['Apakah Anda yakin ingin menghapus user "',c==null?void 0:c.full_name,'"? Tindakan ini tidak dapat dibatalkan.']})]}),e.jsxs(_e,{children:[e.jsx(Ae,{children:"Batal"}),e.jsxs(Ue,{onClick:ne,disabled:u,className:"bg-red-600 hover:bg-red-700",children:[u?e.jsx(w,{className:"w-4 h-4 animate-spin mr-2"}):null,"Hapus"]})]})]})})]})};export{ze as default};
//# sourceMappingURL=Users-BfZu1J3_.js.map
