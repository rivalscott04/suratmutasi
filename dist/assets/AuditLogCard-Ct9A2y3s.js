import{j as e,m as R,ak as x,a9 as V,aw as z,aa as $,aX as G}from"./ui-vendor-B7g5fNgE.js";import{r as i}from"./react-vendor-BNG1zHOu.js";import{C as u,a as j,b as g,c as h}from"./card-D92NyER7.js";import{x as y,a as H,b as N,B as v}from"./index-yKRLyRCw.js";import{S as U}from"./separator-GRgtOYbS.js";const F=R("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),L=i.forwardRef(({className:t,variant:n,...r},l)=>e.jsx("div",{ref:l,role:"alert",className:y(F({variant:n}),t),...r}));L.displayName="Alert";const K=i.forwardRef(({className:t,...n},r)=>e.jsx("h5",{ref:r,className:y("mb-1 font-medium leading-none tracking-tight",t),...n}));K.displayName="AlertTitle";const D=i.forwardRef(({className:t,...n},r)=>e.jsx("div",{ref:r,className:y("text-sm [&_p]:leading-relaxed",t),...n}));D.displayName="AlertDescription";const Y=({pengajuanId:t,token:n,isAdmin:r,showOnlyLatest:l=!1,onViewAll:_})=>{const[f,B]=i.useState([]),[s,E]=i.useState(null),[m,w]=i.useState(1),[p,A]=i.useState(!1),[C,b]=i.useState(null);i.useEffect(()=>{r&&t&&P()},[r,t,m]);const P=async()=>{try{A(!0),b(null);const c=await H(`/api/pengajuan/${t}/audit-log?page=${m}&limit=${l?1:10}`,n);c.success?(B(c.data.audit_logs),E(c.data.pagination)):b(c.message||"Gagal memuat audit log")}catch(a){console.error("Error fetching audit log:",a),b("Terjadi kesalahan saat memuat audit log")}finally{A(!1)}},T=a=>new Date(a).toLocaleDateString("id-ID",{day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"}),J=a=>{switch(a){case"jabatan_changed":return e.jsxs(N,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),"Ubah Jabatan"]});default:return e.jsx(N,{variant:"outline",children:a})}},S=a=>{if(!a)return null;try{return JSON.parse(a)}catch{return a}};return r?p?e.jsxs(u,{children:[e.jsx(j,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-5 w-5"}),"Audit Log"]})}),e.jsx(h,{className:"flex items-center justify-center py-8",children:e.jsx(V,{className:"h-6 w-6 animate-spin text-gray-400"})})]}):C?e.jsxs(u,{children:[e.jsx(j,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-5 w-5"}),"Audit Log"]})}),e.jsx(h,{children:e.jsxs(L,{variant:"destructive",children:[e.jsx(z,{className:"h-4 w-4"}),e.jsx(D,{children:C})]})})]}):f.length===0?e.jsxs(u,{children:[e.jsx(j,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-5 w-5"}),"Audit Log"]})}),e.jsx(h,{children:e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"Belum ada perubahan yang dicatat"})})]}):e.jsxs(u,{children:[e.jsx(j,{children:e.jsxs(g,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{className:"h-5 w-5"}),l?"Perubahan Terbaru":"Audit Log",!l&&e.jsxs(N,{variant:"outline",className:"ml-2",children:[(s==null?void 0:s.total_count)||f.length," perubahan"]})]}),l&&s&&s.total_count>1&&_&&e.jsx(v,{variant:"outline",size:"sm",onClick:_,children:"Lihat Semua"})]})}),e.jsxs(h,{children:[e.jsx("div",{className:"space-y-4",children:f.map((a,c)=>{var k;const d=S(a.old_value),o=S(a.new_value);return e.jsxs("div",{children:[c>0&&e.jsx(U,{className:"my-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[J(a.action),e.jsx("span",{className:"text-xs text-gray-500",children:T(a.changed_at)})]})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx($,{className:"h-4 w-4 text-gray-400"}),e.jsx("span",{className:"font-medium",children:a.changed_by_name}),e.jsxs("span",{className:"text-gray-500",children:["(",((k=a.changer)==null?void 0:k.email)||a.changed_by,")"]})]}),d&&o&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 space-y-2",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-500 font-medium",children:"Dari:"}),e.jsx("div",{className:"mt-1 text-sm bg-white border border-gray-200 rounded p-2",children:typeof d=="object"&&d.jenis_jabatan?d.jenis_jabatan:typeof d=="object"?JSON.stringify(d):d})]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-gray-500 font-medium",children:"Ke:"}),e.jsx("div",{className:"mt-1 text-sm bg-white border border-gray-200 rounded p-2",children:typeof o=="object"&&o.jenis_jabatan?o.jenis_jabatan:typeof o=="object"?JSON.stringify(o):o})]})]}),a.reason&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-800 mb-1",children:"Alasan:"}),e.jsx("p",{className:"text-sm text-gray-700",children:a.reason})]})]})]},a.id)})}),!l&&s&&s.total_pages>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6 pt-4 border-t",children:[e.jsxs("div",{className:"text-sm text-gray-500",children:["Halaman ",s.current_page," dari ",s.total_pages," ","(",s.total_count," total)"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{variant:"outline",size:"sm",onClick:()=>w(m-1),disabled:!s.has_prev||p,children:"Sebelumnya"}),e.jsx(v,{variant:"outline",size:"sm",onClick:()=>w(m+1),disabled:!s.has_next||p,children:"Selanjutnya"})]})]})]})]}):null};export{L as A,D as a,Y as b};
//# sourceMappingURL=AuditLogCard-Ct9A2y3s.js.map
