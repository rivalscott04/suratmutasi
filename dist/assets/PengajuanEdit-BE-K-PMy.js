import{j as e,B as _,al as X,G as Q,H as V,au as W,ai as Z,av as ee,N as ae,ae as se}from"./ui-vendor-e65TVV2G.js";import{g as ne,d as te,u as ie,r}from"./react-vendor-C8WR5ETM.js";import{C as p,c as g,a as C,b as B}from"./card-ozF6mIds.js";import{u as re,a as le,B as m,b as F,I as ce,j as de}from"./index-CAAH4E-w.js";import{L as T}from"./label-Dj8fNAIl.js";import{A as K,a as U,b as M,c as E,d as me,e as oe,g as ue,f as he}from"./alert-dialog-D-kdNcbF.js";import"./data-vendor-DtxkLsA5.js";const Ne=()=>{const{pengajuanId:l}=ne(),o=te();ie();const{user:pe,token:x,isAuthenticated:k}=re(),[u,L]=r.useState(null),[$,N]=r.useState(!0),[y,c]=r.useState(null),[d,v]=r.useState(!1),[z,j]=r.useState(!1),[f,S]=r.useState([]),[i,I]=r.useState(null),[G,w]=r.useState(!1);r.useEffect(()=>{if(!k){o("/");return}l&&R()},[k,o,l]);const R=async()=>{try{N(!0);const a=await le(`/api/pengajuan/${l}`,x);a.success?(L(a.data.pengajuan),H(a.data.pengajuan)):c(a.message||"Gagal mengambil data pengajuan")}catch(a){console.error("Error fetching pengajuan data:",a),c("Terjadi kesalahan saat mengambil data pengajuan")}finally{N(!1)}},H=a=>{const n=a.files.filter(t=>t.verification_status==="rejected").map(t=>({file_type:t.file_type,file:null,display_name:P(t.file_type),is_required:!0}));S(n)},P=a=>({surat_pengantar:"Surat Pengantar",surat_permohonan_dari_yang_bersangkutan:"Surat Permohonan Dari Yang Bersangkutan",surat_keputusan_cpns:"Surat Keputusan CPNS",surat_keputusan_pns:"Surat Keputusan PNS",surat_keputusan_kenaikan_pangkat_terakhir:"Surat Keputusan Kenaikan Pangkat Terakhir",surat_keputusan_jabatan_terakhir:"Surat Keputusan Jabatan Terakhir",skp_2_tahun_terakhir:"SKP 2 Tahun Terakhir",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan Yang Diterbitkan Inspektorat Jenderal Kementerian Agama",surat_keterangan_anjab_abk_instansi_asal:"Surat Keterangan Anjab dan ABK terhadap jabatan PNS dari instansi asal",surat_keterangan_anjab_abk_instansi_penerima:"Surat Keterangan Anjab dan ABK terhadap jabatan PNS dari instansi penerima",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan Tidak Pernah Dijatuhi Hukuman Disiplin Tingkat Sedang atau Berat Dalam 1 (satu) Tahun Terakhir Dari PPK",surat_persetujuan_mutasi_asal:"Surat Persetujuan Mutasi dari ASAL dengan menyebutkan jabatan yang akan diduduki",surat_lolos_butuh_ppk:"Surat Lolos Butuh dari Pejabat Pembina Kepegawaian instansi yang dituju",peta_jabatan:"Peta Jabatan",hasil_assessment:"Hasil Assessment",anjab_abk_instansi_asal:"Anjab/Abk Instansi Asal",anjab_abk_instansi_penerima:"Anjab/Abk Instansi Penerima",surat_keterangan_tidak_tugas_belajar:"Surat Keterangan Tidak Sedang Tugas Belajar",sptjm_pimpinan_satker_asal:"SPTJM Pimpinan Satker dari Asal",sptjm_pimpinan_satker_penerima:"SPTJM Pimpinan Satker dari Penerima",surat_rekomendasi_instansi_pembina:"Surat Rekomendasi Instansi Pembina"})[a]||a.replace(/_/g," ").toUpperCase(),J=(a,s)=>{S(n=>n.map(t=>t.file_type===a?{...t,file:s}:t))},O=async()=>{try{v(!0);const a=new FormData;f.forEach(n=>{n.file&&(a.append("files",n.file),a.append("file_types",n.file_type))});const s=await de(`/api/pengajuan/${l}/update-files`,a,x);s.success?o(`/pengajuan/${l}`):c(s.message||"Gagal memperbarui dokumen")}catch(a){console.error("Error updating files:",a),c("Terjadi kesalahan saat memperbarui dokumen")}finally{v(!1),j(!1)}},Y=async a=>{try{const s=await fetch(`/api/pengajuan/files/${a.id}`,{headers:{Authorization:`Bearer ${x}`}});if(!s.ok)throw new Error("Gagal mengambil file");const n=await s.blob(),t=URL.createObjectURL(n);I({...a,blobUrl:t}),w(!0)}catch(s){console.error("Error previewing file:",s),c("Gagal preview file. Silakan coba lagi.")}},q=a=>{window.open(`/api/pengajuan/files/${a.id}`,"_blank")},D=a=>{const n=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(a)/Math.log(1024));return parseFloat((a/Math.pow(1024,t)).toFixed(2))+" "+n[t]};if($)return e.jsx("div",{className:"container mx-auto p-6",children:e.jsx(p,{children:e.jsxs(g,{className:"flex items-center justify-center py-12",children:[e.jsx(_,{className:"h-8 w-8 animate-spin mr-2"}),e.jsx("span",{children:"Memuat data pengajuan..."})]})})});if(!u)return e.jsx("div",{className:"container mx-auto p-6",children:e.jsx(p,{children:e.jsxs(g,{className:"flex items-center justify-center py-12",children:[e.jsx(X,{className:"h-8 w-8 text-red-500 mr-2"}),e.jsx("span",{className:"text-red-600",children:"Pengajuan tidak ditemukan"})]})})});const h=u.files.filter(a=>a.verification_status==="rejected"),b=u.files.filter(a=>a.verification_status==="approved");return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(m,{variant:"outline",onClick:()=>o(`/pengajuan/${l}`),className:"flex items-center gap-2",children:[e.jsx(Q,{className:"h-4 w-4"}),"Kembali ke Detail Pengajuan"]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Perbaiki Dokumen Pengajuan"}),e.jsxs("p",{className:"text-gray-600",children:["ID: ",u.id]})]})]})}),y&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600",children:y})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(p,{children:[e.jsx(C,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"h-5 w-5 text-green-600"}),"Dokumen yang Sudah Sesuai",e.jsx(F,{variant:"outline",className:"ml-2",children:b.length})]})}),e.jsx(g,{children:b.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Tidak ada dokumen yang sudah sesuai"}):e.jsx("div",{className:"space-y-3",children:b.map(a=>e.jsx("div",{className:"p-4 border border-green-200 rounded-lg bg-green-50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"font-medium text-green-800",children:P(a.file_type)}),e.jsx("p",{className:"text-sm text-green-600",children:a.file_name}),e.jsx("p",{className:"text-xs text-green-500",children:D(a.file_size)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{size:"sm",variant:"outline",onClick:()=>Y(a),className:"text-green-600 border-green-300 hover:bg-green-100",children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>q(a),className:"text-green-600 border-green-300 hover:bg-green-100",children:e.jsx(Z,{className:"h-4 w-4"})})]})]})},a.id))})})]}),e.jsxs(p,{children:[e.jsx(C,{children:e.jsxs(B,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-5 w-5 text-red-600"}),"Dokumen yang Perlu Diperbaiki",e.jsx(F,{variant:"outline",className:"ml-2",children:h.length})]})}),e.jsx(g,{children:h.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"Tidak ada dokumen yang perlu diperbaiki"}):e.jsx("div",{className:"space-y-4",children:f.map(a=>{const s=h.find(n=>n.file_type===a.file_type);return e.jsx("div",{className:"p-4 border border-red-200 rounded-lg bg-red-50",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(T,{className:"text-sm font-medium text-red-800",children:a.display_name}),s&&e.jsxs("div",{className:"mt-2 p-3 bg-white rounded border",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Dokumen saat ini: ",s.file_name]}),e.jsx("p",{className:"text-xs text-gray-500",children:D(s.file_size)}),s.verification_notes&&e.jsxs("p",{className:"text-xs text-red-600 mt-1",children:["Catatan: ",s.verification_notes]})]})]}),e.jsxs("div",{children:[e.jsx(T,{htmlFor:`file-${a.file_type}`,className:"text-sm font-medium text-red-800",children:"Upload Dokumen Baru"}),e.jsxs("div",{className:"mt-1 flex items-center gap-3",children:[e.jsxs(m,{type:"button",variant:"outline",onClick:()=>{var n;return(n=document.getElementById(`file-${a.file_type}`))==null?void 0:n.click()},className:"bg-white text-gray-700 border-gray-300 hover:bg-gray-50",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Pilih File"]}),e.jsx("span",{className:"text-sm text-gray-600",children:a.file?a.file.name:"Belum ada file dipilih"})]}),e.jsx(ce,{id:`file-${a.file_type}`,type:"file",accept:".pdf,.doc,.docx",onChange:n=>{var A;const t=(A=n.target.files)==null?void 0:A[0];t&&J(a.file_type,t)},className:"hidden"})]})]})},a.file_type)})})})]})]}),h.length>0&&e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(m,{onClick:()=>j(!0),disabled:d||f.every(a=>!a.file),className:"bg-green-600 hover:bg-green-700 text-white",size:"lg",children:d?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-4 w-4 mr-2 animate-spin"}),"Menyimpan..."]}):e.jsxs(e.Fragment,{children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Simpan Perubahan"]})})}),e.jsx(K,{open:z,onOpenChange:j,children:e.jsxs(U,{children:[e.jsxs(M,{children:[e.jsx(E,{children:"Simpan Perubahan"}),e.jsx(me,{children:"Apakah Anda yakin ingin menyimpan perubahan dokumen? Dokumen yang sudah sesuai tidak akan berubah."})]}),e.jsxs(oe,{children:[e.jsx(ue,{disabled:d,children:"Batal"}),e.jsx(he,{onClick:O,disabled:d,className:"bg-green-600 hover:bg-green-700 text-white",children:d?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-4 w-4 mr-2 animate-spin"}),"Menyimpan..."]}):"Simpan"})]})]})}),e.jsx(K,{open:G,onOpenChange:a=>{w(a),!a&&(i!=null&&i.blobUrl)&&URL.revokeObjectURL(i.blobUrl)},children:e.jsxs(U,{className:"max-w-4xl",children:[e.jsx(M,{children:e.jsxs(E,{children:["Preview File: ",i==null?void 0:i.file_name]})}),e.jsx("div",{className:"mt-4",children:i&&e.jsxs("div",{className:"border rounded-lg overflow-hidden bg-white",children:[e.jsx("div",{className:"bg-green-600 text-white px-4 py-2 flex items-center justify-between",children:e.jsx("span",{className:"font-medium",children:i.file_name})}),e.jsx("iframe",{src:i.blobUrl||`/api/pengajuan/files/${i.id}`,className:"w-full h-96 border-0",title:"File Preview"})]})})]})})]})};export{Ne as default};
//# sourceMappingURL=PengajuanEdit-BE-K-PMy.js.map
