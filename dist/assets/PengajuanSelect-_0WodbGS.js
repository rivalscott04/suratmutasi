import{j as e,at as D,a5 as ce,_ as de,aI as me,a2 as oe,a3 as q,aJ as xe,o as he,aK as je}from"./ui-vendor-BBh2_8F_.js";import{e as ue,r as n}from"./react-vendor-BNG1zHOu.js";import{C as H,a as K,b as R,c as U}from"./card-DgBvMydw.js";import{D as ge,e as pe,f as be,g as fe,B as l,u as Ne,a as $,b as T,I as ye,c as ve}from"./index-h5hn0b4h.js";import{C as Q}from"./checkbox-CLdU1Hr7.js";import{T as we,a as ke,b as _,c as m,d as Ce,e as r}from"./table-CmeJ7NZq.js";const Pe=({isOpen:o,onClose:N,title:h="Terjadi Kesalahan",message:g,showRetry:y=!1,onRetry:p})=>e.jsx(ge,{open:o,onOpenChange:N,children:e.jsxs(pe,{className:"sm:max-w-md",children:[e.jsx(be,{children:e.jsxs(fe,{className:"flex items-center gap-2 text-red-600",children:[e.jsx(D,{className:"h-5 w-5"}),h]})}),e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(D,{className:"h-6 w-6 text-red-500"})}),e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"text-gray-700 leading-relaxed",children:g})})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[y&&p&&e.jsx(l,{variant:"outline",onClick:p,className:"border-gray-300",children:"Coba Lagi"}),e.jsx(l,{onClick:N,className:"bg-red-600 hover:bg-red-700 text-white",children:"Tutup"})]})]})}),Le=()=>{const o=ue(),{user:N,token:h,isAuthenticated:g}=Ne(),[y,p]=n.useState({}),[x,j]=n.useState(null),[i,V]=n.useState(""),[W,E]=n.useState(!0),[b,c]=n.useState(null),[M,J]=n.useState(!1),[X,v]=n.useState(!1),[Y,L]=n.useState(""),[d,I]=n.useState(1),[w]=n.useState(5),[A,Z]=n.useState([]),[t,G]=n.useState(null);n.useEffect(()=>{if(!g){o("/");return}ee()},[g,o]);const ee=async()=>{try{const a=await $("/api/job-type-configurations?active_only=true",h);a.success&&Z(a.data)}catch(a){console.error("Error fetching job types:",a),c("Gagal mengambil data jabatan")}},ae=a=>{G(a),se(a.id)},se=async a=>{try{E(!0),c(null);const s=await $("/api/pengajuan/pegawai-grouped",h);if(s.success){const S={};Object.entries(s.data).forEach(([le,ie])=>{const O=ie.filter(Se=>!0);O.length>0&&(S[le]=O)}),p(S),Object.keys(S).length===0&&c("Tidak ada pegawai yang tersedia untuk jabatan ini")}else c(s.message||"Gagal mengambil data pegawai")}catch(s){console.error("Error fetching pegawai by jabatan:",s),c("Terjadi kesalahan saat mengambil data pegawai")}finally{E(!1)}},te=async()=>{if(!(!x||!t))try{J(!0);const a=await ve("/api/pengajuan",{pegawai_nip:x,jabatan_id:t.id,jenis_jabatan:t.jenis_jabatan},h);a.success?o(`/pengajuan/${a.data.id}/upload`,{state:{jabatan:t,requiredFiles:t.required_files}}):(L(a.message||"Gagal membuat pengajuan"),v(!0),c(null))}catch(a){console.error("Error creating pengajuan:",a),L("Terjadi kesalahan saat membuat pengajuan"),v(!0),c(null)}finally{J(!1)}},B=()=>{const a=[];return Object.values(y).forEach(s=>{a.push(...s)}),i?a.filter(s=>s.nama.toLowerCase().includes(i.toLowerCase())||s.jabatan.toLowerCase().includes(i.toLowerCase())||s.unit_kerja.toLowerCase().includes(i.toLowerCase())||s.nip.includes(i)):a},ne=a=>{if(a){const s=B();s.length>0&&j(s[0].nip)}else j(null)},u=B(),k=u.length,f=Math.ceil(k/w),C=(d-1)*w,z=C+w,F=u.slice(C,z),P=a=>{I(a),j(null)},re=a=>{V(a),I(1),j(null)};return e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("div",{className:"flex items-center gap-4 mb-6",children:e.jsxs(l,{variant:"outline",onClick:()=>o("/pengajuan"),className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),"Kembali ke Data Pengajuan"]})}),e.jsxs(H,{children:[e.jsxs(K,{children:[e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5"}),"Pilih Pegawai untuk Pengajuan"]}),e.jsx("div",{className:"text-sm text-gray-600",children:t?`Pilih pegawai untuk pengajuan jabatan: ${t.jenis_jabatan}`:"Pilih jabatan terlebih dahulu, kemudian pilih pegawai yang akan diajukan"})]}),e.jsxs(U,{children:[b&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-600",children:b})}),!t&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"Pilih Jabatan untuk Pengajuan"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:A.map(a=>e.jsxs(H,{className:"cursor-pointer transition-all duration-200 hover:shadow-md hover:border-green-300",onClick:()=>ae(a),children:[e.jsx(K,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(R,{className:"text-lg font-semibold text-gray-800",children:a.jenis_jabatan}),e.jsx(T,{variant:"secondary",className:"bg-green-100 text-green-800 border-green-200",children:"Aktif"})]})}),e.jsx(U,{className:"pt-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Total Dokumen:"}),e.jsx("span",{className:"font-semibold text-green-600",children:a.max_dokumen})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Min Dokumen:"}),e.jsx("span",{className:"text-sm text-gray-500",children:a.min_dokumen})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Jenis File:"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[a.required_files.length," jenis"]})]})]})})]},a.id))}),A.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(me,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Tidak ada jabatan yang tersedia"})]})]}),t&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-green-800",children:["Jabatan: ",t.jenis_jabatan]}),e.jsxs("p",{className:"text-sm text-green-600",children:[t.required_files.length," jenis dokumen diperlukan"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(T,{className:"bg-green-600 text-white",children:[t.max_dokumen," dokumen"]}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>G(null),className:"border-green-600 text-green-600 hover:bg-green-50",children:"Pilih Jabatan Lain"})]})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(oe,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx(ye,{placeholder:"Cari pegawai berdasarkan nama, jabatan, unit kerja, atau NIP...",value:i,onChange:a=>re(a.target.value),className:"pl-10"})]}),u.length>0&&e.jsxs("p",{className:"text-sm text-gray-500 mt-2",children:["Menampilkan ",u.length," pegawai (halaman ",d," dari ",f,")"]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:t?W?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx(q,{className:"h-8 w-8 animate-spin mr-2 text-green-600"}),e.jsx("span",{children:"Memuat data pegawai..."})]}):b?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsxs("div",{className:"text-center",children:[e.jsx(D,{className:"h-12 w-12 text-red-400 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 mb-2",children:b}),e.jsx("p",{className:"text-sm text-gray-500",children:"Pastikan sudah ada surat yang dibuat untuk pegawai di menu Template Generator"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs(we,{children:[e.jsx(ke,{children:e.jsxs(_,{children:[e.jsx(m,{className:"w-12",children:e.jsx(Q,{checked:x!==null,onCheckedChange:ne})}),e.jsx(m,{children:"NIP"}),e.jsx(m,{children:"Nama"}),e.jsx(m,{children:"Jabatan"}),e.jsx(m,{children:"Unit Kerja"}),e.jsx(m,{children:"Induk Unit"}),e.jsx(m,{className:"text-center",children:"Total Surat"})]})}),e.jsx(Ce,{children:F.length===0?e.jsx(_,{children:e.jsx(r,{colSpan:7,className:"text-center py-8 text-gray-500",children:i?"Tidak ada pegawai yang sesuai dengan pencarian":e.jsxs("div",{children:[e.jsx("p",{className:"mb-2",children:"Tidak ada pegawai yang tersedia"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Pastikan sudah ada surat yang dibuat untuk pegawai di menu Template Generator"})]})})}):F.map(a=>e.jsxs(_,{className:"hover:bg-gray-50",children:[e.jsx(r,{children:e.jsx(Q,{checked:x===a.nip,onCheckedChange:s=>{j(s?a.nip:null)}})}),e.jsx(r,{className:"font-mono text-sm",children:a.nip}),e.jsx(r,{className:"font-medium",children:a.nama}),e.jsx(r,{children:a.jabatan}),e.jsx(r,{children:a.unit_kerja}),e.jsx(r,{children:a.induk_unit}),e.jsx(r,{className:"text-center",children:e.jsxs(T,{variant:"secondary",children:[a.total_surat," surat"]})})]},a.nip))})]}),f>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t bg-gray-50",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Menampilkan ",C+1," sampai ",Math.min(z,k)," dari ",k," pegawai"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>P(d-1),disabled:d===1,children:[e.jsx(xe,{className:"h-4 w-4"}),"Sebelumnya"]}),e.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:f},(a,s)=>s+1).map(a=>e.jsx(l,{variant:d===a?"default":"outline",size:"sm",onClick:()=>P(a),className:"w-8 h-8 p-0",children:a},a))}),e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>P(d+1),disabled:d===f,children:["Selanjutnya",e.jsx(he,{className:"h-4 w-4"})]})]})]})]}):null}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(l,{onClick:te,disabled:!x||!t||M,size:"lg",className:"bg-green-600 hover:bg-green-700 text-white",children:M?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-2 animate-spin text-green-600"}),"Membuat Pengajuan..."]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Proses Pengajuan"]})})}),!x&&t&&u.length>0&&e.jsx("p",{className:"text-sm text-gray-500 mt-2 text-center",children:"Pilih satu pegawai untuk melanjutkan proses pengajuan"})]})]}),e.jsx(Pe,{isOpen:X,onClose:()=>v(!1),title:"Gagal Membuat Pengajuan",message:Y,showRetry:!1})]})};export{Le as default};
//# sourceMappingURL=PengajuanSelect-_0WodbGS.js.map
