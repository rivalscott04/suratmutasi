import{j as a,U as aa,at as ja,ae as V,a6 as $,aB as xa,ak as ya,ap as ba,F as W,aL as ea,ag as fa,a5 as Q,a4 as Pa,a_ as Sa,ai as wa}from"./ui-vendor-CkT_OuiB.js";import{r as p,d as Na,e as va}from"./react-vendor-BNG1zHOu.js";import{C as L,c as z,a as X,b as Y}from"./card-BGKlmEdE.js";import{P as sa,u as na,d as Ta,B as S,b as w,a as M,c as ta,s as Da,y as Z,z as Aa}from"./index-KoBOkyGV.js";import{S as Ka,a as Ra,b as Ba,c as Fa,d as Ea}from"./select-D0raCU8N.js";import{u as ia,S as ra}from"./protected-button-CHeysFgU.js";import{P as Ma}from"./PageHeader-Bkply_s3.js";import{A as Ua,a as Ja,b as Ia,c as Ca,d as Wa,e as $a,g as Ha,f as qa}from"./alert-dialog-BAvOOkGl.js";const La=({isUploading:d,progress:o,fileName:_,className:l=""})=>d?a.jsxs("div",{className:`bg-blue-50 border border-blue-200 rounded-lg p-3 ${l}`,children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx("div",{className:"animate-spin",children:a.jsx(aa,{className:"h-4 w-4 text-blue-600"})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"text-sm font-medium text-blue-900",children:["Mengupload ",_]}),a.jsxs("div",{className:"text-xs text-blue-600",children:[o,"% selesai"]})]})]}),a.jsx(sa,{value:o,className:"h-2 bg-blue-100"})]}):null,E=d=>String(d).toLowerCase().replace(/[^a-z0-9_-]+/gi,"_").replace(/^_+|_+$/g,""),za=({pengajuanId:d,jenisJabatanId:o,onFilesUploaded:_,onProgressChange:l,pengajuanStatus:N})=>{const{token:b,user:A}=na(),{toast:R}=Ta(),[k,H]=p.useState([]),[x,y]=p.useState([]);p.useState([]),p.useState("");const[D,j]=p.useState({}),[K,v]=p.useState({}),[q,B]=p.useState(!1),[U,G]=p.useState(!1),{submitForm:J,isSubmitting:I}=ia(),[C,F]=p.useState(!0),[r,c]=p.useState(null),m=async()=>{try{F(!0),c(null);let e;if(isNaN(Number(o)))try{const n=await M("/api/job-type-configurations",b);if(n!=null&&n.success&&Array.isArray(n.data)){const t=n.data.find(i=>i.jenis_jabatan===o);if(t)e=t.id;else{c("Jenis jabatan tidak ditemukan");return}}else{c("Gagal mengambil data jenis jabatan");return}}catch{c("Gagal mencari jenis jabatan");return}else e=parseInt(String(o));const s=await M(`/api/admin-wilayah-file-config/job-type/${e}`,b);if(console.log("ðŸ” API Response:",s),console.log("ðŸ” Job Type ID:",e),console.log("ðŸ” Jenis Jabatan ID:",o),s.success){if(console.log("âœ… Setting required files:",s.data),H(s.data),l){const n=x.filter(t=>s.data.some(i=>i.file_type===t.file_type)).length;l(n,s.data.length||0)}}else c("Failed to fetch file configurations")}catch(e){console.error("Error fetching file configs:",e),c("Error connecting to server")}finally{F(!1)}},g=async()=>{var e;try{const s=await M(`/api/admin-wilayah/pengajuan/${d}`,b);if(s!=null&&s.success){const t=(s.uploadedAdminWilayahFiles||((e=s.data)==null?void 0:e.uploadedAdminWilayahFiles)||[]).map(i=>({id:i.id,pengajuan_id:d,file_type:i.file_type,file_name:i.file_name,file_path:i.file_path,file_size:i.file_size,verification_status:i.verification_status||"pending",created_at:i.created_at,updated_at:i.updated_at}));y(t)}else y([])}catch(s){console.error("Error fetching uploaded files:",s),y([])}};p.useEffect(()=>{o&&(m(),g())},[o,b]),p.useEffect(()=>{if(l){const e=k.length,s=x.filter(n=>k.some(t=>t.file_type===n.file_type)).length;l(s,e)}},[k,x]);const h=async(e,s)=>{console.log("ðŸš€ START UPLOAD - fileType:",e,"fileName:",s.name),j(n=>({...n,[e]:!0})),v(n=>({...n,[e]:0}));try{console.log("ðŸ” Uploading file:",{fileType:e,fileName:s.name,pengajuanId:d,jenisJabatanId:o,requiredFiles:k.map(u=>({file_type:u.file_type,display_name:u.display_name}))});const n=new FormData;n.append("file",s),n.append("pengajuan_id",d),n.append("file_type",e),n.append("file_category","admin_wilayah"),n.append("uploaded_by_role","admin_wilayah"),n.append("uploaded_by_name",(A==null?void 0:A.full_name)||"Admin Wilayah"),n.append("uploaded_by_office","Kanwil Provinsi"),console.log("ðŸ“¦ FormData created:",{file:s.name,pengajuan_id:d,file_type:e,file_category:"admin_wilayah"});for(let[u,P]of n.entries())console.log("ðŸ“‹ FormData entry:",u,P);const t=setInterval(()=>{v(u=>{const P=u[e]||0;return P<90?{...u,[e]:P+Math.random()*20}:u})},200),i=await ta(`/api/admin-wilayah/pengajuan/${d}/upload`,n,b);if(clearInterval(t),v(u=>({...u,[e]:100})),i.success){const u={id:i.data.id,pengajuan_id:d,file_type:e,file_name:s.name,file_path:i.data.file_path,file_size:s.size,verification_status:"pending",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},P=[...x,u];if(y(P),_(P),l){const ga=k.length,ha=P.filter(_a=>k.some(ka=>ka.file_type===_a.file_type)).length;l(ha,ga)}R({title:"Success",description:`Upload berhasil: ${s.name}`,variant:"default",duration:3e3})}else R({title:"Error",description:i.message||"Gagal upload file",variant:"destructive",duration:3e3})}catch(n){console.error("Error uploading file:",n),R({title:"Error",description:"Gagal upload file",variant:"destructive",duration:3e3})}finally{j(n=>({...n,[e]:!1})),v(n=>({...n,[e]:0}))}},f=async()=>{J(async()=>{Da("SUBMIT_SUCCESS","File berhasil diajukan ke Superadmin"),B(!1)},()=>{},e=>{Z("OPERATION_FAILED","Gagal mengajukan file ke Superadmin")})},T=e=>{if(e===0)return"0 Bytes";const s=1024,n=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,t)).toFixed(2))+" "+n[t]},la=e=>{const s=Date.now(),n=new Date(e).getTime(),t=Math.max(0,Math.floor((s-n)/1e3));if(t<5)return"baru saja";if(t<60)return`${t} detik lalu`;const i=Math.floor(t/60);if(i<60)return`${i} menit lalu`;const u=Math.floor(i/60);return u<24?`${u} jam lalu`:`${Math.floor(u/24)} hari lalu`},da=e=>x.find(n=>n.file_type===e)?"uploaded":"pending",ua=e=>x.find(s=>s.file_type===e),O=(e,s)=>{var t;return((t={Guru:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Madrasah":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Wakil Kepala Madrasah":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala TU":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Seksi":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Sub Bagian":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Urusan":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},Staff:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},Pelaksana:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"}}[e])==null?void 0:t[s])||null},oa=e=>{const{file_type:s,display_name:n}=e;if(s==="surat_rekomendasi_kanwil")return O(o,s)||"Surat Rekomendasi dari Instansi Pembina - Varian 6.1-6.9";const t=O(o,s);return t||n},ca=async e=>{try{const s=await fetch(`/api/pengajuan/files/${e.id}`,{headers:{Authorization:`Bearer ${b}`}});if(!s.ok)throw new Error("Gagal mengambil file");const n=await s.blob(),t=URL.createObjectURL(n);window.open(t,"_blank"),setTimeout(()=>URL.revokeObjectURL(t),5e3)}catch{Z("OPERATION_FAILED","Gagal membuka preview file")}},ma=async e=>{try{const s=await fetch(`/api/pengajuan/files/${e.id}`,{headers:{Authorization:`Bearer ${b}`}});if(!s.ok)throw new Error("Gagal mengambil file");const n=await s.blob(),t=URL.createObjectURL(n),i=document.createElement("a");i.href=t,i.download=e.file_name||"file.pdf",document.body.appendChild(i),i.click(),i.remove(),setTimeout(()=>URL.revokeObjectURL(t),5e3)}catch{Aa("Gagal mengunduh file")}},pa=e=>{const s=document.getElementById(`replace-${E(e)}`);s&&s.click()};return C?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3"}),a.jsx("div",{className:"space-y-3",children:[...Array(5)].map((e,s)=>a.jsx("div",{className:"h-20 bg-gray-200 rounded"},s))})]})}):r?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"text-center py-8",children:[a.jsx(ja,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Files"}),a.jsx("p",{className:"text-gray-600 mb-4",children:r}),a.jsxs(S,{onClick:m,className:"flex items-center gap-2",children:[a.jsx(V,{className:"h-4 w-4"}),"Retry"]})]})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Upload File Admin Wilayah"}),a.jsxs(S,{onClick:()=>{m(),g()},variant:"outline",size:"sm",children:[a.jsx(V,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Dokumen Wajib Admin Wilayah"}),a.jsx("div",{className:"text-sm text-gray-600",children:`${k.filter(s=>x.some(n=>n.file_type===s.file_type)).length}/${k.length} berkas sudah diupload`})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:k.map(e=>{console.log("ðŸ”§ Rendering fileConfig:",e);const s=da(e.file_type),n=ua(e.file_type);return a.jsx(L,{className:"border border-gray-200",children:a.jsx(z,{className:"p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[a.jsx("h4",{className:"font-medium text-gray-900",children:oa(e)}),e.is_required&&a.jsx(w,{variant:"destructive",className:"text-[10px] py-0 px-1.5",children:"Wajib"})]}),a.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Upload file PDF (maks. ",e.file_type==="skp_2_tahun_terakhir"?"1.6MB":"500KB",")"]}),D[e.file_type]&&a.jsx(La,{isUploading:D[e.file_type],progress:K[e.file_type]||0,fileName:e.display_name,className:"mt-2"}),s==="uploaded"&&n&&a.jsxs("div",{className:"mt-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[a.jsx($,{className:"h-4 w-4"}),a.jsx("span",{className:"text-sm font-medium truncate max-w-xs",children:n.file_name}),a.jsxs("span",{className:"text-sm text-gray-500",children:["(",T(n.file_size),")"]}),a.jsxs("span",{className:"text-sm text-gray-500",children:["â€¢ ",la(n.created_at)]})]}),a.jsxs("div",{className:"mt-2 flex gap-2 flex-wrap",children:[a.jsxs(S,{size:"sm",variant:"outline",onClick:()=>ca(n),className:"flex items-center gap-1",children:[a.jsx(xa,{className:"h-3 w-3"}),"Preview"]}),a.jsxs(S,{size:"sm",variant:"outline",onClick:()=>ma(n),className:"flex items-center gap-1",children:[a.jsx(ya,{className:"h-3 w-3"}),"Download"]}),a.jsxs(S,{size:"sm",variant:"outline",onClick:()=>pa(e.file_type),className:"flex items-center gap-1",children:[a.jsx(ba,{className:"h-3 w-3"}),"Ganti File"]}),a.jsx("input",{id:`replace-${E(e.file_type)}`,type:"file",className:"hidden",accept:".pdf,.doc,.docx",onChange:t=>{var u;const i=(u=t.target.files)==null?void 0:u[0];i&&(h(e.file_type,i),t.target.value="")}})]})]})]}),a.jsx("div",{className:"flex items-center gap-2",children:s==="uploaded"?a.jsxs(w,{className:"bg-green-600 text-white flex items-center gap-1",children:[a.jsx($,{className:"h-3 w-3"}),"Uploaded"]}):a.jsxs(a.Fragment,{children:[a.jsxs(w,{variant:"secondary",className:"flex items-center gap-1",children:[a.jsx(W,{className:"h-3 w-3"}),"Pending"]}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx("input",{type:"file",accept:".pdf,.doc,.docx",onChange:t=>{var u;console.log("ðŸ“ File input changed:",t.target.files);const i=(u=t.target.files)==null?void 0:u[0];i?(console.log("ðŸ“„ File selected:",i.name,"fileConfig.file_type:",e.file_type),h(e.file_type,i),t.target.value=""):console.log("âŒ No file selected")},className:"hidden",id:`file-${E(e.file_type)}`}),a.jsx("label",{htmlFor:`file-${E(e.file_type)}`,onClick:()=>{const t=document.getElementById(`file-${E(e.file_type)}`);t&&!t.disabled&&t.click()},children:a.jsxs(S,{disabled:D[e.file_type],size:"sm",className:"h-8 px-3 cursor-pointer bg-green-600 hover:bg-green-700 text-white",children:[D[e.file_type]?a.jsx("div",{className:"animate-spin h-3 w-3 border-2 border-white border-t-transparent rounded-full"}):a.jsx(aa,{className:"h-3 w-3 mr-1"}),"Pilih File"]})})]})]})})]})})},e.id)})})]}),(()=>{const e=k.every(n=>x.some(t=>t.file_type===n.file_type)),s=N==="submitted";return a.jsx("div",{className:"flex justify-end",children:e?a.jsxs(S,{onClick:()=>!s&&B(!0),className:"bg-green-600 hover:bg-green-700",disabled:U||s,children:[a.jsx(ea,{className:"h-4 w-4 mr-2"}),s?"Sudah Dikirim":"Ajukan ke Superadmin"]}):a.jsx("div",{className:"text-sm text-gray-500 text-center",children:"Tombol ajukan akan muncul setelah semua berkas wajib diupload"})})})(),a.jsx(Ua,{open:q,onOpenChange:B,children:a.jsxs(Ja,{children:[a.jsxs(Ia,{children:[a.jsx(Ca,{children:"Ajukan ke Superadmin"}),a.jsx(Wa,{children:"Apakah Anda yakin ingin mengajukan semua file yang telah diupload ke Superadmin? Tindakan ini tidak dapat dibatalkan."})]}),a.jsxs($a,{children:[a.jsx(Ha,{disabled:U,children:"Batal"}),a.jsx(qa,{asChild:!0,children:a.jsx(ra,{onClick:f,className:"bg-green-600 hover:bg-green-700",isProcessing:I,processingText:"Mengajukan...",children:"Ajukan"})})]})]})})]})},Ga=({uploaded:d,total:o,isComplete:_,className:l=""})=>{const N=o>0?Math.round(d/o*100):0;return a.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 ${l}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Progress Upload Dokumen"}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:[d," dari ",o," dokumen"]}),a.jsxs("div",{className:"text-lg font-bold text-green-600",children:[N,"%"]})]})]}),a.jsx("div",{className:"mb-4",children:a.jsx(sa,{value:N,className:"h-3 bg-gray-200"})}),a.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[a.jsx($,{className:"h-4 w-4"}),a.jsxs("span",{children:[d," Terupload"]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[a.jsx(fa,{className:"h-4 w-4"}),a.jsxs("span",{children:[o-d," Belum"]})]}),_&&a.jsxs("div",{className:"flex items-center gap-2 text-green-600 font-medium",children:[a.jsx($,{className:"h-4 w-4"}),a.jsx("span",{children:"Upload Selesai"})]})]})]})},se=()=>{var J,I,C,F;const{pengajuanId:d}=Na(),o=va(),{token:_}=na(),[l,N]=p.useState(null),[b,A]=p.useState(!0);p.useState(!1);const{submitForm:R,isSubmitting:k}=ia(),[H,x]=p.useState([]),[y,D]=p.useState(""),[j,K]=p.useState({required:0,total:0,isComplete:!1}),v=async()=>{var r,c;if(!(!_||!d)){A(!0);try{const m=await M(`/api/admin-wilayah/pengajuan/${d}`,_);if(m&&m.success!==!1){N(m.pengajuan||((r=m.data)==null?void 0:r.pengajuan)||m);const g=m.uploadProgress||((c=m.data)==null?void 0:c.uploadProgress);if(g){const h=Number(g.required??0),f=Number(g.total??0),T=typeof g.isComplete=="boolean"?g.isComplete:h>=f;K({required:h,total:f,isComplete:T})}else K({required:0,total:0,isComplete:!1})}else N(null),K({required:0,total:0,isComplete:!1})}catch(m){console.error("Failed to fetch pengajuan detail",m),N(null)}finally{A(!1)}}},q=async()=>{try{const r=await M("/api/admin-wilayah-file-config",_);if(r!=null&&r.success&&Array.isArray(r.data)){const c=new Map;r.data.forEach(g=>{var T;const h=g.jenis_jabatan_id,f=((T=g.jenis_jabatan)==null?void 0:T.jenis_jabatan)||`Jabatan ${h}`;h&&!c.has(h)&&c.set(h,f)});const m=Array.from(c.values());x(m),m.length>0&&!y&&D(m[0])}}catch(r){console.error("Failed to fetch job types:",r)}};p.useEffect(()=>{v(),q()},[d,_]);const B=r=>new Date(r).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),U=(r,c)=>{const m=(g,h)=>{var f;return g!=="submitted"||!h?!1:((f=h.files)==null?void 0:f.some(T=>T.file_category==="admin_wilayah"))||!1};switch(r){case"approved":return a.jsx(w,{className:"bg-green-600 text-white",children:"Disetujui Kab/Kota"});case"admin_wilayah_approved":return a.jsx(w,{className:"bg-green-700 text-white",children:"Disetujui Admin Wilayah"});case"admin_wilayah_rejected":return a.jsx(w,{className:"bg-red-600 text-white",children:"Ditolak Admin Wilayah"});case"submitted":return a.jsx(w,{className:"bg-blue-600 text-white",children:m(r,c)?"Diajukan Admin Wilayah":"Dikirim ke Superadmin"});default:return a.jsx(w,{className:"bg-gray-600 text-white",children:r})}},G=async()=>{!_||!d||R(async()=>{await ta(`/api/admin-wilayah/pengajuan/${d}/submit-to-superadmin`,{},_),await v()},()=>{},r=>{console.error("Error submitting to superadmin:",r)})};return b?a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsx("div",{className:"max-w-6xl mx-auto",children:a.jsxs("div",{className:"animate-pulse space-y-6",children:[a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),a.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})})}):l?a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[a.jsx(Ma,{title:"Upload File Admin Wilayah",subtitle:"Upload file tambahan untuk pengajuan mutasi pegawai",actions:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(w,{className:"bg-green-100 text-green-800",children:"Admin Wilayah"}),U(l.status,l),a.jsxs(S,{variant:"outline",onClick:()=>o("/admin-wilayah/dashboard"),className:"border-green-200 text-green-700 hover:bg-green-50",children:[a.jsx(Q,{className:"h-4 w-4 mr-2"}),"Kembali"]})]})}),a.jsxs(L,{className:"border-green-200 bg-green-50",children:[a.jsx(X,{children:a.jsxs(Y,{className:"text-green-800 flex items-center gap-2",children:[a.jsx(W,{className:"h-5 w-5"}),"Informasi Pengajuan"]})}),a.jsx(z,{children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Pa,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:((J=l.pegawai)==null?void 0:J.nama)||"-"}),a.jsxs("p",{className:"text-sm text-gray-600",children:["NIP: ",((I=l.pegawai)==null?void 0:I.nip)||"-"]})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Sa,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:((C=l.office)==null?void 0:C.kabkota)||"-"}),a.jsx("p",{className:"text-sm text-gray-600",children:((F=l.office)==null?void 0:F.name)||"-"})]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(W,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Jenis Jabatan"}),a.jsx("p",{className:"text-sm text-gray-600",children:l.jenis_jabatan})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(wa,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Tanggal Pengajuan"}),a.jsx("p",{className:"text-sm text-gray-600",children:B(l.created_at)})]})]})]})]})})]}),a.jsxs(L,{children:[a.jsx(X,{children:a.jsx(Y,{className:"text-green-800",children:"Upload File Admin Wilayah"})}),a.jsxs(z,{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Jenis Berkas Admin Wilayah"}),a.jsxs(Ka,{value:y,onValueChange:D,children:[a.jsx(Ra,{className:"w-full max-w-md",children:a.jsx(Ba,{placeholder:"Pilih jenis berkas..."})}),a.jsx(Fa,{children:H.map(r=>a.jsx(Ea,{value:r,children:r},r))})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Pilih jenis berkas yang sudah dikonfigurasi oleh superadmin"})]}),y&&j.total>0&&a.jsx(Ga,{uploaded:j.required,total:j.total,isComplete:j.isComplete,className:"mb-6"}),y&&a.jsx(za,{pengajuanId:l.id,jenisJabatanId:y,onFilesUploaded:()=>v(),onProgressChange:(r,c)=>K({required:r,total:c,isComplete:r>=c&&c>0}),pengajuanStatus:l.status})]})]}),a.jsx("div",{className:"flex items-center justify-end gap-3",children:(l.status==="approved"||l.status==="submitted")&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{className:"text-sm text-gray-600 mr-2",children:[j.required,"/",j.total," berkas wajib"]}),a.jsxs(ra,{onClick:G,className:"bg-green-600 hover:bg-green-700 text-white",isProcessing:k||l.status==="submitted"||j.required<j.total,processingText:"Mengirim...",children:[a.jsx(ea,{className:"h-4 w-4 mr-2"}),l.status==="submitted"?"Sudah Dikirim":"Submit ke Superadmin"]})]})})]})}):a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsx("div",{className:"max-w-6xl mx-auto",children:a.jsxs("div",{className:"text-center py-12",children:[a.jsx(W,{className:"h-16 w-16 mx-auto text-gray-300 mb-4"}),a.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Pengajuan Tidak Ditemukan"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Pengajuan yang Anda cari tidak ditemukan atau tidak memiliki akses."}),a.jsxs(S,{onClick:()=>o("/admin-wilayah/dashboard"),className:"bg-green-600 hover:bg-green-700 text-white",children:[a.jsx(Q,{className:"h-4 w-4 mr-2"}),"Kembali ke Dashboard"]})]})})})};export{se as default};
//# sourceMappingURL=AdminWilayahUploadPage-CdjExxQ7.js.map
