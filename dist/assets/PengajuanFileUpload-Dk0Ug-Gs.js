import{j as a,W as T,au as ja,a0 as H,_ as D,aD as ba,ar as xa,ap as fa,a1 as Na,X as Y,aN as wa}from"./ui-vendor-DiY4nm-6.js";import{g as Pa,d as Sa,u as va,r as t}from"./react-vendor-C8WR5ETM.js";import{C as F,c as A,a as ya,b as Da}from"./card-Chm9vonN.js";import{u as Fa,a as V,b as Aa,B as m,D as W,e as X,f as Q,g as Z,j as Ca}from"./index-DAJua31Z.js";import{P as Ka}from"./progress-ZGe8Y8-J.js";import{A as Ba,a as Ma,b as Ua,c as Ea,d as Ra,e as za,g as Ia,f as $a}from"./alert-dialog-DylU6zxM.js";const aa=r=>String(r).toLowerCase().replace(/[^a-z0-9_-]+/gi,"_").replace(/^_+|_+$/g,""),qa=r=>({surat_pengantar:"Surat Pengantar",surat_permohonan_dari_yang_bersangkutan:"Surat Permohonan Dari Yang Bersangkutan",surat_keputusan_cpns:"Surat Keputusan CPNS",surat_keputusan_pns:"Surat Keputusan PNS",surat_keputusan_kenaikan_pangkat_terakhir:"Surat Keputusan Kenaikan Pangkat Terakhir",surat_keputusan_jabatan_terakhir:"Surat Keputusan Jabatan Terakhir",skp_2_tahun_terakhir:"SKP 2 Tahun Terakhir",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan Yang Diterbitkan Inspektorat Jenderal Kementerian Agama",surat_keterangan_anjab_abk_instansi_asal:"Surat Keterangan Anjab dan ABK terhadap jabatan PNS dari instansi asal",surat_keterangan_anjab_abk_instansi_penerima:"Surat Keterangan Anjab dan ABK terhadap jabatan PNS dari instansi penerima",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan Tidak Pernah Dijatuhi Hukuman Disiplin Tingkat Sedang atau Berat Dalam 1 (satu) Tahun Terakhir Dari PPK",surat_persetujuan_mutasi_asal:"Surat Persetujuan Mutasi dari ASAL dengan menyebutkan jabatan yang akan diduduki",surat_lolos_butuh_ppk:"Surat Lolos Butuh dari Pejabat Pembina Kepegawaian instansi yang dituju",peta_jabatan:"Peta Jabatan",hasil_uji_kompetensi:"Hasil Uji Kompetensi",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",anjab_abk_instansi_asal:"Anjab/Abk Instansi Asal",anjab_abk_instansi_penerima:"Anjab/Abk Instansi Penerima",surat_keterangan_tidak_tugas_belajar:"Surat Keterangan Tidak Sedang Tugas Belajar",sptjm_pimpinan_satker_asal:"SPTJM Pimpinan Satker dari Asal",sptjm_pimpinan_satker_penerima:"SPTJM Pimpinan Satker dari Penerima",surat_rekomendasi_instansi_pembina:"Surat Rekomendasi Instansi Pembina"})[r]||r.replace(/_/g," ").toUpperCase(),La=r=>({surat_pengantar:"Dokumen Pengantar",surat_permohonan_dari_yang_bersangkutan:"Dokumen Pengantar",surat_keputusan_cpns:"Dokumen Kepegawaian",surat_keputusan_pns:"Dokumen Kepegawaian",surat_keputusan_kenaikan_pangkat_terakhir:"Dokumen Kepegawaian",surat_keputusan_jabatan_terakhir:"Dokumen Kepegawaian",skp_2_tahun_terakhir:"Dokumen Kepegawaian",surat_keterangan_bebas_temuan_inspektorat:"Dokumen Keterangan",surat_keterangan_anjab_abk_instansi_asal:"Dokumen Keterangan",surat_keterangan_anjab_abk_instansi_penerima:"Dokumen Keterangan",surat_pernyataan_tidak_hukuman_disiplin:"Dokumen Pernyataan",surat_persetujuan_mutasi_asal:"Dokumen Persetujuan",surat_lolos_butuh_ppk:"Dokumen Persetujuan",peta_jabatan:"Dokumen Pendukung",hasil_uji_kompetensi:"Dokumen Pendukung",hasil_evaluasi_pertimbangan_baperjakat:"Dokumen Pendukung",anjab_abk_instansi_asal:"Dokumen Pendukung",anjab_abk_instansi_penerima:"Dokumen Pendukung",surat_keterangan_tidak_tugas_belajar:"Dokumen Keterangan",sptjm_pimpinan_satker_asal:"Dokumen Pernyataan",sptjm_pimpinan_satker_penerima:"Dokumen Pernyataan",surat_rekomendasi_instansi_pembina:"Dokumen Rekomendasi"})[r]||"Dokumen Lainnya",Ga=r=>({guru:"Guru",eselon_iv:"Eselon IV",fungsional:"Fungsional",pelaksana:"Pelaksana"})[r]||r,Wa=()=>{var L,G;const{pengajuanId:r}=Pa(),k=Sa(),C=va(),{token:j}=Fa(),[o,ea]=t.useState(null),[b,g]=t.useState([]),[sa,K]=t.useState({}),[na,N]=t.useState({}),[ta,B]=t.useState(!1),[ra,w]=t.useState(!1),[ia,M]=t.useState(!0),[U,c]=t.useState(null),[x,E]=t.useState(!1),[d,la]=t.useState(null),[ua,P]=t.useState(!1),[oa,S]=t.useState(null),f=t.useRef({}),R=(L=C.state)==null?void 0:L.jabatan,v=(G=C.state)==null?void 0:G.requiredFiles,[z,I]=t.useState(null);t.useEffect(()=>{r&&$()},[r]),t.useEffect(()=>{(()=>{Object.values(f.current).forEach(s=>{s&&(s.value="")})})()});const $=async()=>{try{M(!0);const e=await V(`/api/pengajuan/${r}`,j);if(e.success)if(ea(e.data.pengajuan),v&&v.length>0)g(v),R&&I(R);else if(e.data.requiredFiles&&e.data.requiredFiles.length>0)g(e.data.requiredFiles);else if(e.data.pengajuan.jabatan_id)try{const s=await V(`/api/job-type-configurations/${e.data.pengajuan.jabatan_id}`,j);s.success&&s.data.required_files?(g(s.data.required_files),I(s.data)):g(y(e.data.pengajuan.jenis_jabatan))}catch(s){console.error("Error fetching job type configuration:",s),g(y(e.data.pengajuan.jenis_jabatan))}else g(y(e.data.pengajuan.jenis_jabatan));else c(e.message||"Gagal mengambil data pengajuan")}catch(e){console.error("Error fetching pengajuan data:",e),c("Terjadi kesalahan saat mengambil data pengajuan")}finally{M(!1)}},y=e=>{const s=["surat_pengantar","surat_permohonan_dari_yang_bersangkutan","surat_keputusan_cpns","surat_keputusan_pns","surat_keputusan_kenaikan_pangkat_terakhir","surat_keputusan_jabatan_terakhir","skp_2_tahun_terakhir","surat_keterangan_bebas_temuan_inspektorat"];return{guru:["surat_pengantar","surat_permohonan_dari_yang_bersangkutan","surat_keputusan_cpns","surat_keputusan_pns","surat_keputusan_kenaikan_pangkat_terakhir","surat_keputusan_jabatan_terakhir","skp_2_tahun_terakhir","surat_keterangan_bebas_temuan_inspektorat"],eselon_iv:["surat_pengantar","surat_permohonan_dari_yang_bersangkutan","surat_keputusan_cpns","surat_keputusan_pns","surat_keputusan_kenaikan_pangkat_terakhir","surat_keputusan_jabatan_terakhir","skp_2_tahun_terakhir","surat_keterangan_bebas_temuan_inspektorat","surat_keterangan_anjab_abk_instansi_asal","surat_keterangan_anjab_abk_instansi_penerima"],fungsional:s,pelaksana:["surat_pengantar","surat_permohonan_dari_yang_bersangkutan","surat_keputusan_cpns","surat_keputusan_pns","surat_keputusan_kenaikan_pangkat_terakhir","surat_keputusan_jabatan_terakhir","skp_2_tahun_terakhir"]}[e]||s},da=async(e,s)=>{const n=e==="skp_2_tahun_terakhir"?1048576:512e3;if(s.size>n){c(`File terlalu besar. Maksimal ${n===1048576?"1MB":"500KB"}. Ukuran file: ${(s.size/1024).toFixed(1)}KB`);return}K(i=>({...i,[e]:!0})),N(i=>({...i,[e]:0}));const l=new FormData;l.append("file",s),l.append("file_type",e);try{const i=setInterval(()=>{N(u=>({...u,[e]:Math.min(u[e]+10,90)}))},200),p=await fetch(`/api/pengajuan/${r}/upload`,{method:"POST",headers:{Authorization:`Bearer ${j}`},body:l});if(clearInterval(i),N(u=>({...u,[e]:100})),p.ok){const u=await p.json();if(u.success){await $(),c(null);const _=f.current[e];_&&(_.value="")}else c(u.message||"Gagal upload file")}else c("Gagal upload file")}catch(i){console.error("Error uploading file:",i),c("Terjadi kesalahan saat upload file")}finally{K(p=>({...p,[e]:!1})),S(null);const i=f.current[e];i&&(i.value="")}},ca=async()=>{try{E(!0);const e=await Ca(`/api/pengajuan/${r}/submit`,{catatan:""},j);e.success?B(!0):c(e.message||"Gagal submit pengajuan")}catch(e){console.error("Error submitting pengajuan:",e),c("Terjadi kesalahan saat submit pengajuan")}finally{E(!1),w(!1)}},ma=async e=>{try{const s=await fetch(`/api/pengajuan/files/${e.id}`,{headers:{Authorization:`Bearer ${j}`}});if(!s.ok)throw new Error("Gagal mengambil file");const n=await s.blob(),l=URL.createObjectURL(n);la({...e,blobUrl:l}),P(!0)}catch(s){console.error("Error previewing file:",s),c("Gagal preview file. Silakan coba lagi.")}},pa=e=>{window.open(`/api/pengajuan/files/${e.id}`,"_blank")},ga=e=>{S(e)},q=()=>b.every(e=>o==null?void 0:o.files.some(s=>s.file_type===e)),_a=e=>o!=null&&o.files.some(s=>s.file_type===e)?"uploaded":"pending",ha=e=>{const n=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,l)).toFixed(2))+" "+n[l]},ka=b.reduce((e,s)=>{const n=La(s);return e[n]||(e[n]=[]),e[n].push(s),e},{});return ia?a.jsx("div",{className:"container mx-auto p-6",children:a.jsx(F,{children:a.jsxs(A,{className:"flex items-center justify-center py-12",children:[a.jsx(T,{className:"h-8 w-8 animate-spin"}),a.jsx("span",{className:"ml-2",children:"Memuat data pengajuan..."})]})})}):o?a.jsxs("div",{className:"container mx-auto p-6",children:[a.jsxs(F,{children:[a.jsxs(ya,{children:[a.jsx(Da,{children:"Upload Berkas Pengajuan Mutasi PNS"}),a.jsxs("div",{className:"text-sm text-gray-600",children:[o.pegawai.nama," - ",o.pegawai.jabatan]}),a.jsxs("div",{className:"text-sm text-gray-500",children:["Jenis Jabatan: ",Ga(o.jenis_jabatan)]}),a.jsxs("div",{className:"text-sm text-gray-500",children:["Total Dokumen: ",z?z.max_dokumen:b.length," surat"]})]}),a.jsxs(A,{children:[U&&a.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:a.jsx("p",{className:"text-red-600",children:U})}),b.length===0?a.jsxs("div",{className:"text-center py-12",children:[a.jsx(H,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-500 mb-2",children:"Tidak ada dokumen yang diperlukan"}),a.jsx("p",{className:"text-sm text-gray-400",children:"Silakan hubungi admin untuk mengkonfigurasi dokumen yang diperlukan"})]}):Object.entries(ka).map(([e,s])=>a.jsxs("div",{className:"mb-8",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4 text-gray-800 border-b pb-2",children:e}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:s.map(n=>{const l=_a(n),i=sa[n],p=na[n],u=o.files.find(h=>h.file_type===n),_=oa===n;return a.jsxs("div",{className:"border rounded-lg p-4",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("h4",{className:"font-medium text-sm leading-tight",children:qa(n)}),a.jsxs("p",{className:"text-xs text-gray-600 mt-1",children:["Upload file PDF (maks. ",n==="skp_2_tahun_terakhir"?"1MB":"500KB",")"]})]}),a.jsxs(Aa,{variant:"secondary",className:l==="uploaded"?"bg-green-600 text-white hover:bg-green-700":"",children:[l==="uploaded"?a.jsx(D,{className:"h-3 w-3 mr-1"}):a.jsx(H,{className:"h-3 w-3 mr-1"}),l==="uploaded"?"Uploaded":"Pending"]})]}),l==="uploaded"&&u&&!_?a.jsxs("div",{className:"space-y-3",children:[a.jsx("div",{className:"text-sm text-green-600",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(D,{className:"h-4 w-4"}),a.jsx("span",{className:"truncate",children:u.file_name}),a.jsxs("span",{className:"text-gray-500 text-xs",children:["(",ha(u.file_size),")"]})]})}),a.jsxs("div",{className:"flex gap-2 flex-wrap",children:[a.jsxs(m,{size:"sm",variant:"outline",onClick:()=>ma(u),className:"flex items-center gap-1",children:[a.jsx(ba,{className:"h-3 w-3"}),"Preview"]}),a.jsxs(m,{size:"sm",variant:"outline",onClick:()=>pa(u),className:"flex items-center gap-1",children:[a.jsx(xa,{className:"h-3 w-3"}),"Download"]}),a.jsxs(m,{size:"sm",variant:"outline",onClick:()=>ga(n),className:"flex items-center gap-1",children:[a.jsx(fa,{className:"h-3 w-3"}),"Ganti File"]})]})]}):a.jsxs("div",{children:[a.jsx("input",{ref:h=>f.current[n]=h,type:"file",accept:".pdf",onChange:h=>{var O;const J=(O=h.target.files)==null?void 0:O[0];J&&(da(n,J),h.target.value="")},disabled:i,className:"hidden",id:`file-${aa(n)}`}),a.jsxs("label",{htmlFor:`file-${aa(n)}`,className:"cursor-pointer inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50",children:[a.jsx(Na,{className:"h-4 w-4 mr-2"}),i?"Uploading...":_?"Pilih File Baru":"Pilih File"]}),_&&a.jsxs(m,{size:"sm",variant:"ghost",onClick:()=>S(null),className:"ml-2 text-gray-500",children:[a.jsx(Y,{className:"h-3 w-3 mr-1"}),"Batal"]})]}),i&&a.jsxs("div",{className:"mt-2",children:[a.jsx(Ka,{value:p,className:"h-2"}),a.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[p,"% uploaded"]})]})]},n)})})]},e)),b.length>0&&a.jsxs("div",{className:"mt-8 pt-6 border-t",children:[a.jsxs(m,{onClick:()=>w(!0),disabled:!q()||x,className:"w-full bg-green-600 hover:bg-green-700 text-white",size:"lg",children:[a.jsx(wa,{className:"h-4 w-4 mr-2"}),"Submit Pengajuan"]}),!q()&&a.jsx("p",{className:"text-sm text-gray-500 mt-2 text-center",children:"Semua berkas harus diupload sebelum dapat submit"})]})]})]}),a.jsx(Ba,{open:ra,onOpenChange:w,children:a.jsxs(Ma,{children:[a.jsxs(Ua,{children:[a.jsx(Ea,{children:"Submit Pengajuan"}),a.jsx(Ra,{children:"Apakah Anda yakin ingin submit pengajuan ini? Setelah disubmit, pengajuan tidak dapat diedit lagi dan akan diproses oleh admin."})]}),a.jsxs(za,{children:[a.jsx(Ia,{disabled:x,children:"Batal"}),a.jsx($a,{onClick:ca,disabled:x,className:"bg-green-600 hover:bg-green-700 text-white",children:x?a.jsxs(a.Fragment,{children:[a.jsx(T,{className:"h-4 w-4 mr-2 animate-spin"}),"Submitting..."]}):"Submit Pengajuan"})]})]})}),a.jsx(W,{open:ta,onOpenChange:B,children:a.jsxs(X,{children:[a.jsx(Q,{children:a.jsx(Z,{children:"Pengajuan Berhasil!"})}),a.jsxs("div",{className:"text-center py-6",children:[a.jsx(D,{className:"h-16 w-16 text-green-500 mx-auto mb-4"}),a.jsxs("p",{className:"text-lg font-medium mb-2",children:["Pengajuan untuk ",o.pegawai.nama," berhasil disubmit"]}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Pengajuan akan diproses oleh admin. Anda akan mendapat notifikasi ketika status berubah."}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx(m,{onClick:()=>k("/dashboard"),className:"flex-1 bg-green-600 hover:bg-green-700 text-white",children:"Kembali ke Dashboard"}),a.jsx(m,{onClick:()=>k("/pengajuan/select"),variant:"outline",className:"flex-1",children:"Buat Pengajuan Baru"})]})]})]})}),a.jsx(W,{open:ua,onOpenChange:e=>{P(e),!e&&(d!=null&&d.blobUrl)&&URL.revokeObjectURL(d.blobUrl)},children:a.jsxs(X,{className:"max-w-4xl",children:[a.jsx(Q,{children:a.jsx(Z,{className:"flex items-center justify-between",children:a.jsxs("span",{children:["Preview File: ",d==null?void 0:d.file_name]})})}),a.jsx("div",{className:"mt-4",children:d&&a.jsxs("div",{className:"border rounded-lg overflow-hidden bg-white",children:[a.jsxs("div",{className:"bg-green-600 text-white px-4 py-2 flex items-center justify-between",children:[a.jsx("span",{className:"font-medium",children:d.file_name}),a.jsx(m,{variant:"ghost",size:"sm",onClick:()=>P(!1),className:"text-white hover:bg-green-700",children:a.jsx(Y,{className:"h-4 w-4"})})]}),a.jsx("iframe",{src:d.blobUrl||`/api/pengajuan/files/${d.id}`,className:"w-full h-96 border-0",title:"File Preview"})]})})]})})]}):a.jsx("div",{className:"container mx-auto p-6",children:a.jsx(F,{children:a.jsxs(A,{className:"flex items-center justify-center py-12",children:[a.jsx(ja,{className:"h-8 w-8 text-red-500"}),a.jsx("span",{className:"ml-2 text-red-600",children:"Pengajuan tidak ditemukan"})]})})})};export{Wa as default};
//# sourceMappingURL=PengajuanFileUpload-Dk0Ug-Gs.js.map
