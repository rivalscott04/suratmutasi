import{j as e,F as L,a2 as ee,an as Ie,at as D,a8 as Re,a4 as z,aE as Sa,aF as ue,aA as _a,E as Ge,a1 as He,aG as Ve,aj as Ta,X as Je,aH as Aa}from"./ui-vendor-B7g5fNgE.js";import{r,e as Pa,L as We}from"./react-vendor-BNG1zHOu.js";import{u as Ca,d as Ba,a as ge,S,B as o,I as Ea,b as pe,D as je,e as fe,g as be,m as Ma,j as La,l as Ze}from"./index-Cdokj0KM.js";import{C as F,c as I,a as Da,b as Oa}from"./card-DeWtRWHV.js";import{T as Ka,a as Ua,b as qe,c as _,d as $a,e as T}from"./table-D2M6x_-m.js";import{T as za,a as Fa,b as Ia,c as Ra,d as Ga,e as Ha,f as Va,g as Ja,h as Wa}from"./Template9-BZCzblYT.js";import{A as Za,a as qa,b as Xa,c as Ya}from"./accordion-BFJZkeK7.js";import{S as Ne,a as we,b as ve,c as ke,d as A}from"./select-C1XiyKbn.js";import{P as Xe}from"./PegawaiSearchInput-BcTkJ953.js";import{u as ye,w as Qa}from"./xlsx-DjuO7_Ju.js";import{L as Ye}from"./label-F8G4zri2.js";const ut=()=>{const{token:b,user:l}=Ca(),[j,Se]=r.useState([]),[f,R]=r.useState(!0),[_e,Te]=r.useState(null),[N,ae]=r.useState(""),[G,Qe]=r.useState("letter_number"),[te,ea]=r.useState("asc");r.useState(1),r.useState(10);const[w,se]=r.useState("all"),{toast:v}=Ba();r.useState(null),r.useState(null),r.useState([]);const[aa,Ae]=r.useState(!1),[H,ta]=r.useState(null);r.useState(!1),r.useState(null),r.useState(null),r.useState(null);const[sa,V]=r.useState({}),[le,la]=r.useState({}),[x,J]=r.useState(null),[h,W]=r.useState(null),[d,Z]=r.useState(null),[ne,Pe]=r.useState(!1),na=Pa(),[ia,Ce]=r.useState(!1),[ra,ie]=r.useState(!1),[O,re]=r.useState(null),[ce,Be]=r.useState(!1),[p,P]=r.useState([]),[K,q]=r.useState(!1),[ca,de]=r.useState(!1),[oe,Ee]=r.useState(!1),[da,X]=r.useState(!1),[U,Me]=r.useState("all"),[$,Le]=r.useState("all"),[De,oa]=r.useState([]),[me,Oe]=r.useState(!1),C=j.filter(a=>{var s,t,i,m,u,n;return((s=a.letter_number)==null?void 0:s.toLowerCase().includes(N.toLowerCase()))||((t=a.template_name)==null?void 0:t.toLowerCase().includes(N.toLowerCase()))||((m=(i=a.office)==null?void 0:i.namakantor)==null?void 0:m.toLowerCase().includes(N.toLowerCase()))||((n=(u=a.office)==null?void 0:u.kabkota)==null?void 0:n.toLowerCase().includes(N.toLowerCase()))}),xe=(()=>{switch(w){case"with-employee":return C.filter(a=>![2,9].includes(a.template_id));case"without-employee":return C.filter(a=>[2,9].includes(a.template_id));default:return C}})(),Y=[...xe].sort((a,s)=>{var m,u;let t=a[G]||"",i=s[G]||"";return G==="tanggal"&&(t=((m=a.form_data)==null?void 0:m.tanggal)||"",i=((u=s.form_data)==null?void 0:u.tanggal)||""),te==="asc"?String(t).localeCompare(String(i)):String(i).localeCompare(String(t))}).reduce((a,s)=>{var i,m;let t=((i=s.office)==null?void 0:i.namakantor)||((m=s.office)==null?void 0:m.kabkota);return!t&&s.office_id&&le[s.office_id]&&(t=le[s.office_id].namakantor||le[s.office_id].kabkota),t||(t="Kantor Tidak Diketahui"),a[t]||(a[t]=[]),a[t].push(s),a},{}),Q=Object.entries(Y).filter(([a,s])=>N?a.toLowerCase().includes(N.toLowerCase())||s.some(t=>t.letter_number.toLowerCase().includes(N.toLowerCase())):!0);r.useEffect(()=>{b&&(R(!0),ge("/api/letters",b).then(a=>Se(a.letters||[])).catch(a=>{a.message&&(a.message.includes("Invalid or expired token")||a.message.includes("401"))?Ce(!0):Te("Gagal mengambil data surat")}).finally(()=>R(!1)))},[b]),r.useEffect(()=>{b&&ge("/api/offices",b).then(a=>{const s={},t=a.offices||[];t.forEach(i=>{s[i.id]={namakantor:i.namakantor,kabkota:i.kabkota}}),la(s),oa(t)}).catch(()=>{})},[b]);const ma=Array.from(new Set(j.map(a=>a.template_name))).sort(),xa=a=>j.filter(s=>s.status===a).length,ha=j.length,Ke=j.length>0?j.reduce((a,s)=>(a[s.template_name]=(a[s.template_name]||0)+1,a),{}):{};Object.keys(Ke).length>0&&Object.entries(Ke).sort(([,a],[,s])=>s-a)[0][0];const y=j.length===0?null:j.reduce((a,s)=>{const t=new Date(a.created_at||0);return new Date(s.created_at||0)>t?s:a}),ua=()=>{var i,m,u,n;if(!y)return"Tidak ada data";const a=g=>({"01":"KOTA MATARAM","02":"KABUPATEN LOMBOK BARAT","03":"KABUPATEN LOMBOK TENGAH","04":"KABUPATEN LOMBOK TIMUR","05":"KABUPATEN SUMBAWA","06":"KABUPATEN DOMPU","07":"KOTA MATARAM","08":"KABUPATEN BIMA","09":"KOTA BIMA",10:"KABUPATEN SUMBAWA BARAT",11:"KABUPATEN LOMBOK UTARA",12:"KABUPATEN LOMBOK TENGAH",13:"KABUPATEN LOMBOK TIMUR",14:"KABUPATEN SUMBAWA",15:"KABUPATEN DOMPU",16:"KABUPATEN BIMA",17:"KOTA BIMA",18:"KABUPATEN SUMBAWA BARAT",19:"KABUPATEN LOMBOK UTARA",20:"KABUPATEN LOMBOK TENGAH"})[g]||"Kantor Tidak Diketahui",s=((i=y.office)==null?void 0:i.namakantor)||((m=y.office)==null?void 0:m.kabkota)||a(((u=y.form_data)==null?void 0:u.kode_kabko)||((n=y.office)==null?void 0:n.kode_kabko)||"")||"Kantor Tidak Diketahui",t=y.created_at?new Date(y.created_at).toLocaleDateString("id-ID",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}):"Tidak diketahui";return`${s} (${t})`},ga=a=>a==="generated"?e.jsx(pe,{className:"bg-green-100 text-green-700 border-green-200",children:"Generated"}):a==="signed"?e.jsx(pe,{className:"bg-blue-100 text-blue-700 border-blue-200",children:"Signed"}):null,pa=a=>{var g;let s=a.form_data;if(typeof s=="string")try{s=JSON.parse(s)}catch{s={}}if(!s)return e.jsx("div",{className:"text-error",children:"Data surat tidak ditemukan"});const t=String(a.template_id),i=(a.letter_number||"").split("/"),m=(g=a.letter_number)==null?void 0:g.match(/^B-([^/]+)/),u={nosrt:s.nosrt||(m?m[1]:""),nosurat:s.nosurat||(m?m[1]:""),blnno:s.blnno||i[5]||"",blnnomor:s.blnnomor||i[5]||"",thnno:s.thnno||i[6]||"",tahunskrg:s.tahunskrg||i[6]||""},n={...s,...u};return a.template_id===2&&s.unitkerja&&(n.unitkerja=s.unitkerja),t==="1"?e.jsx(za,{data:n}):t==="2"?e.jsx(Fa,{data:n}):t==="3"?e.jsx(Ia,{data:n}):t==="4"?e.jsx(Ra,{data:n}):t==="5"?e.jsx(Ga,{data:n}):t==="6"?e.jsx(Ha,{data:n}):t==="7"?e.jsx(Va,{data:n}):t==="8"?e.jsx(Ja,{data:n}):t==="9"?e.jsx(Wa,{data:n}):e.jsx("div",{className:"text-error",children:"Template tidak dikenali"})},ja=async a=>{if(!((l==null?void 0:l.role)==="admin"||a.created_by===(l==null?void 0:l.id))){v({title:"Tidak dapat menghapus surat",description:"Anda hanya dapat menghapus surat yang Anda buat sendiri.",variant:"destructive"});return}re(a),ie(!0)},Ue=a=>{J(a),W(null),Z(null)},fa=async()=>{if(!(!x||!h)&&!(x.template_id!==2&&x.template_id!==9&&!d)){Pe(!0);try{const a=x.form_data,s=x.template_id,t={...a,namapejabat:h.nama||"",nippejabat:h.nip||"",pangkatgolpejabat:h.pangkat_gol||"",jabatanpejabat:h.jabatan||""};switch(s!==2&&s!==9&&d&&(t.namapegawai=d.nama||"",t.nippegawai=d.nip||"",t.pangkatgolpegawai=d.pangkat_gol||"",t.jabatanpegawai=d.jabatan||""),(s===2||s===9)&&(delete t.namapegawai,delete t.nippegawai,delete t.pangkatgolpegawai,delete t.jabatanpegawai,delete t.ukerpegawai),s){case 1:t.ukerpejabat=h.unit_kerja||"",d&&(t.ukerpegawai=d.unit_kerja||"");break;case 2:break;case 3:d&&(t.tempattugas=d.tempat_tugas||"");break;case 4:d&&(t.unitkerja=d.unit_kerja||"");break;case 5:t.ukerpejabat=h.unit_kerja||"",d&&(t.tempattugas=d.tempat_tugas||"");break;case 6:t.ukerpejabat=h.unit_kerja||"",d&&(t.ukerpegawai=d.unit_kerja||"");break;case 7:d&&(t.tempattugas=d.tempat_tugas||"");break;case 8:d&&(t.tempattugas=d.tempat_tugas||"");break;case 9:t.ukerpejabat=h.unit_kerja||"";break}await La(`/api/letters/${x.id}`,{form_data:t},b),await B(),J(null),W(null),Z(null),v({title:"Berhasil",description:"Data pejabat dan pegawai berhasil diperbarui"})}catch(a){console.error("Error updating letter:",a),v({title:"Error",description:"Gagal memperbarui data surat",variant:"destructive"})}finally{Pe(!1)}}},ba=(a,s)=>{P(s?t=>[...t,a]:t=>t.filter(i=>i!==a))},$e=a=>{if(q(a),a){const t=Q.flatMap(([i,m])=>m).filter(i=>(l==null?void 0:l.role)==="admin"||i.created_by===(l==null?void 0:l.id));P(t.map(i=>i.id))}else P([])},ze=()=>{if(p.length===0){v({title:"Tidak ada surat dipilih",description:"Pilih surat yang akan dihapus terlebih dahulu.",variant:"destructive"});return}de(!0)},Na=async()=>{Ee(!0);try{for(const a of p)await Ze(`/api/letters/${a}`,b);v({title:"Surat berhasil dihapus",description:`${p.length} surat telah dihapus dari sistem.`,duration:3e3}),P([]),q(!1),de(!1),await B(),V({}),N&&ae("")}catch(a){v({title:"Gagal menghapus surat",description:a.message||"Terjadi kesalahan",variant:"destructive",duration:5e3})}finally{Ee(!1)}},B=async()=>{R(!0);try{const a=await ge("/api/letters",b);Se(a.letters||[])}catch{Te("Gagal mengambil data surat")}finally{R(!1)}},wa=async()=>{if(O){Be(!0);try{await Ze(`/api/letters/${O.id}`,b),v({title:"Surat berhasil dihapus",description:"Surat telah dihapus dari sistem.",duration:3e3}),await B(),V({}),N&&ae(""),ie(!1),re(null)}catch(a){v({title:"Gagal menghapus surat",description:a.message||"Terjadi kesalahan",variant:"destructive",duration:5e3})}finally{Be(!1)}}},va=async()=>{Oe(!0);try{let a=[...j];U!=="all"&&(a=a.filter(c=>c.template_name===U)),(l==null?void 0:l.role)==="admin"&&$!=="all"&&(a=a.filter(c=>c.office_id===$));const s=a.map(c=>{var M,Fe;let k=c.form_data;if(typeof k=="string")try{k=JSON.parse(k)}catch{k={}}const E=c.template_id===9;return{NIP:E?"":c.recipient_employee_nip||"",Nama:E?"":k.namapegawai||((M=c.recipient)==null?void 0:M.nama)||"","No Surat":c.letter_number||"","Jenis Surat/Template":c.template_name||"","NIP Penandatangan":c.signing_official_nip||"","Nama Penandatangan":((Fe=c.signing_official)==null?void 0:Fe.nama)||""}}),t=ye.book_new(),i=ye.json_to_sheet(s),m=[{wch:20},{wch:40},{wch:50},{wch:50},{wch:20},{wch:40}];i["!cols"]=m,ye.book_append_sheet(t,i,"Data Surat");const u=new Date,n=`${u.getFullYear()}${String(u.getMonth()+1).padStart(2,"0")}${String(u.getDate()).padStart(2,"0")}_${String(u.getHours()).padStart(2,"0")}${String(u.getMinutes()).padStart(2,"0")}`;let g=`Export_Surat_${n}.xlsx`;if(U!=="all"&&(g=`Export_Surat_${U.replace(/[^a-zA-Z0-9]/g,"_")}_${n}.xlsx`),(l==null?void 0:l.role)==="admin"&&$!=="all"){const c=De.find(M=>M.id===$);g=`Export_Surat_${((c==null?void 0:c.kabkota)||(c==null?void 0:c.namakantor)||"Office").replace(/[^a-zA-Z0-9]/g,"_")}_${n}.xlsx`}Qa(t,g),v({title:"Export berhasil",description:`Data surat berhasil diekspor ke Excel (${a.length} data)`,duration:3e3}),X(!1)}catch(a){console.error("Error exporting Excel:",a),v({title:"Gagal export Excel",description:a.message||"Terjadi kesalahan saat mengekspor data",variant:"destructive",duration:5e3})}finally{Oe(!1)}},he=(a,s)=>{V(t=>({...t,[a]:{...t[a]||{currentPage:1,pageSize:10},currentPage:s}}))},ka=(a,s)=>{V(t=>({...t,[a]:{...t[a]||{currentPage:1,pageSize:10},pageSize:s,currentPage:1}}))},ya=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-green-100 to-blue-100 rounded-full flex items-center justify-center",children:e.jsx(Aa,{className:"w-12 h-12 text-green-600"})}),e.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-red-600",children:"0"})})]}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Belum Ada Surat"}),e.jsx("p",{className:"text-gray-600 text-center max-w-md mb-6",children:"Riwayat surat masih kosong. Mulai buat surat pertama Anda untuk melihat data di sini."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(o,{asChild:!0,className:"bg-green-600 hover:bg-green-700",children:e.jsxs(We,{to:"/generator",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Buat Surat Baru"]})}),e.jsxs(o,{variant:"outline",onClick:B,disabled:f,children:[e.jsx(ee,{className:`w-4 h-4 mr-2 ${f?"animate-spin":""}`}),f?"Loading...":"Refresh Data"]})]})]});return f?e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(S,{className:"h-8 w-1/3 mb-4"}),e.jsx(S,{className:"h-6 w-1/2"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(S,{className:"h-32"}),e.jsx(S,{className:"h-32"}),e.jsx(S,{className:"h-32"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(S,{className:"h-16"}),e.jsx(S,{className:"h-16"}),e.jsx(S,{className:"h-16"})]})]}):_e?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(L,{className:"w-8 h-8 text-red-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Gagal Memuat Data"}),e.jsx("p",{className:"text-gray-600 mb-6",children:_e}),e.jsxs(o,{onClick:B,disabled:f,children:[e.jsx(ee,{className:`w-4 h-4 mr-2 ${f?"animate-spin":""}`}),f?"Loading...":"Coba Lagi"]})]})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Riwayat Surat"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Kelola dan pantau semua surat yang telah dibuat"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(o,{variant:"outline",onClick:B,disabled:f,children:[e.jsx(ee,{className:`w-4 h-4 mr-2 ${f?"animate-spin":""}`}),f?"Loading...":"Refresh"]}),e.jsxs(o,{variant:"outline",onClick:()=>X(!0),disabled:f||j.length===0,className:"border-green-200 text-green-700 hover:bg-green-50",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Export Excel"]}),xe.length>0&&(()=>{const a=xe.filter(s=>(l==null?void 0:l.role)==="admin"||s.created_by===(l==null?void 0:l.id)).length;return a>0?e.jsx(o,{variant:K?"destructive":"outline",onClick:()=>$e(!K),className:K?"bg-red-600 hover:bg-red-700":"border-green-200 text-green-700 hover:bg-green-50",children:K?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Batal Pilih Semua"]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Pilih Semua (",a,")"]})}):null})(),(l==null?void 0:l.role)!=="user"&&e.jsx(o,{asChild:!0,className:"bg-green-600 hover:bg-green-700",children:e.jsxs(We,{to:"/generator",children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Buat Surat Baru"]})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(Ea,{placeholder:"Cari surat, nomor surat, atau kantor...",value:N,onChange:a=>ae(a.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ne,{value:G,onValueChange:a=>Qe(a),children:[e.jsx(we,{className:"w-40",children:e.jsx(ve,{placeholder:"Urutkan"})}),e.jsxs(ke,{children:[e.jsx(A,{value:"letter_number",children:"Nomor Surat"}),e.jsx(A,{value:"template_name",children:"Template"}),e.jsx(A,{value:"tanggal",children:"Tanggal"}),e.jsx(A,{value:"status",children:"Status"})]})]}),e.jsx(o,{variant:"outline",onClick:()=>ea(te==="asc"?"desc":"asc"),children:te==="asc"?"↑":"↓"})]})]})]}),p.length>0&&e.jsx("div",{className:"mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-blue-600",children:p.length})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-blue-900",children:[p.length," surat dipilih"]}),e.jsx("p",{className:"text-sm text-blue-700",children:"Siap untuk dihapus"})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{P([]),q(!1)},className:"border-green-300 text-green-700 hover:bg-green-50",children:"Batal Pilih"}),e.jsxs(o,{variant:"destructive",size:"sm",onClick:ze,className:"bg-red-600 hover:bg-red-700 shadow-sm",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Hapus ",p.length," Surat"]})]})]})}),p.length>0&&e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(o,{size:"lg",onClick:ze,className:"bg-red-600 hover:bg-red-700 shadow-lg rounded-full w-16 h-16",children:e.jsx(D,{className:"w-6 h-6"})}),e.jsxs("div",{className:"bg-white rounded-full px-3 py-1 shadow-lg text-sm font-medium text-gray-700",children:[p.length," surat"]})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-1",children:e.jsxs("nav",{className:"flex space-x-1",children:[e.jsxs("button",{onClick:()=>se("all"),className:`flex-1 flex items-center justify-center py-3 px-4 rounded-md font-medium text-sm transition-all duration-200 ${w==="all"?"bg-green-50 text-green-700 border border-green-200 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(L,{className:"w-4 h-4 mr-2"}),"Semua Surat",e.jsx("span",{className:"ml-2 bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs",children:C.length})]}),e.jsxs("button",{onClick:()=>se("with-employee"),className:`flex-1 flex items-center justify-center py-3 px-4 rounded-md font-medium text-sm transition-all duration-200 ${w==="with-employee"?"bg-green-50 text-green-700 border border-green-200 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Surat dengan Pegawai",e.jsx("span",{className:"ml-2 bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs",children:C.filter(a=>![2,9].includes(a.template_id)).length})]}),e.jsxs("button",{onClick:()=>se("without-employee"),className:`flex-1 flex items-center justify-center py-3 px-4 rounded-md font-medium text-sm transition-all duration-200 ${w==="without-employee"?"bg-orange-50 text-orange-700 border border-orange-200 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(Sa,{className:"w-4 h-4 mr-2"}),"Analisis & Pernyataan",e.jsx("span",{className:"ml-2 bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs",children:C.filter(a=>[2,9].includes(a.template_id)).length})]})]})}),e.jsxs("div",{className:"mt-3 text-sm text-gray-600",children:[w==="all"&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{className:"w-4 h-4 mr-2 text-green-500"}),"Menampilkan semua surat yang telah dibuat dalam sistem"]}),w==="with-employee"&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{className:"w-4 h-4 mr-2 text-green-500"}),"Surat yang memerlukan data pegawai tertentu (Template 1, 3-8)"]}),w==="without-employee"&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{className:"w-4 h-4 mr-2 text-orange-500"}),"Surat analisis jabatan dan pernyataan (Template 2 & 9)"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(F,{children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Surat"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:ha})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(L,{className:"w-6 h-6 text-blue-600"})})]})})}),e.jsx(F,{children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Generated"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:xa("generated")})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(_a,{className:"w-6 h-6 text-green-600"})})]})})}),e.jsx(F,{children:e.jsx(I,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Surat Terbaru"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:y?`${y.letter_number} - ${ua()}`:"Tidak ada data"})]}),e.jsx("div",{className:"w-12 h-12 bg-teal-100 rounded-lg flex items-center justify-center",children:e.jsx(Ge,{className:"w-6 h-6 text-teal-600"})})]})})})]}),j.length===0?e.jsx(F,{children:e.jsx(I,{className:"p-0",children:e.jsx(ya,{})})}):e.jsxs(F,{children:[e.jsx(Da,{children:e.jsxs(Oa,{className:"flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5"}),w==="all"&&`Surat Berdasarkan Kantor (${Object.keys(Y).length} Kantor)`,w==="with-employee"&&`Surat dengan Pegawai (${Object.keys(Y).length} Kantor)`,w==="without-employee"&&`Surat Analisis & Pernyataan (${Object.keys(Y).length} Kantor)`]})}),e.jsx(I,{children:Q.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Re,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Tidak Ada Hasil"}),e.jsx("p",{className:"text-gray-600",children:"Coba ubah kata kunci pencarian Anda"})]}):e.jsx(Za,{type:"multiple",className:"space-y-2",children:Q.map(([a,s],t)=>{const i=sa[a]||{currentPage:1,pageSize:10},m=Math.ceil(s.length/i.pageSize),u=s.slice((i.currentPage-1)*i.pageSize,i.currentPage*i.pageSize);return e.jsxs(qa,{value:`office-${t}`,className:"border rounded-lg",children:[e.jsx(Xa,{className:"px-6 py-4 hover:bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(He,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:a}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.length," surat"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(pe,{variant:"secondary",children:s.length})})]})}),e.jsxs(Ya,{className:"px-6 pb-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-2 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:`pageSize-${t}`,className:"text-sm",children:"Tampilkan"}),e.jsx("select",{id:`pageSize-${t}`,value:i.pageSize,onChange:n=>ka(a,Number(n.target.value)),className:"border rounded px-2 py-1 text-sm",children:[10,20,50,100].map(n=>e.jsx("option",{value:n,children:n},n))}),e.jsx("span",{className:"text-sm",children:"data per halaman"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Menampilkan ",s.length===0?0:(i.currentPage-1)*i.pageSize+1,"–",Math.min(i.currentPage*i.pageSize,s.length)," dari ",s.length," surat"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ka,{children:[e.jsx(Ua,{className:"bg-gray-50",children:e.jsxs(qe,{children:[e.jsx(_,{className:"w-12",children:e.jsx("div",{className:"flex items-center gap-2",children:(()=>{const g=Q.flatMap(([c,k])=>k).filter(c=>(l==null?void 0:l.role)==="admin"||c.created_by===(l==null?void 0:l.id)).length;return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"checkbox",checked:K,onChange:c=>$e(c.target.checked),disabled:g===0,className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50"}),p.length>0&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:p.length})]})})()})}),e.jsx(_,{children:"No."}),e.jsx(_,{children:"Nomor Surat"}),e.jsx(_,{children:"Template"}),e.jsx(_,{children:"Pegawai"}),e.jsx(_,{children:"Tanggal"}),e.jsx(_,{children:"Status"}),e.jsx(_,{children:"Aksi"})]})}),e.jsx($a,{children:u.map((n,g)=>{let c=n.form_data;if(typeof c=="string")try{c=JSON.parse(c)}catch{c={}}const k=(l==null?void 0:l.role)==="admin"||n.created_by===(l==null?void 0:l.id),E=p.includes(n.id);return e.jsxs(qe,{className:E?"bg-blue-50 border-blue-200":"",children:[e.jsx(T,{children:e.jsx("input",{type:"checkbox",checked:E,onChange:M=>ba(n.id,M.target.checked),disabled:!k,className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50"})}),e.jsx(T,{children:(i.currentPage-1)*i.pageSize+g+1}),e.jsx(T,{className:"font-mono text-sm",children:n.letter_number}),e.jsx(T,{children:n.template_name}),e.jsx(T,{children:n.template_id===9?e.jsx("span",{className:"text-gray-500",children:"Tanpa Pegawai"}):e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:c.namapegawai}),e.jsx("div",{className:"text-sm text-gray-500",children:n.recipient_employee_nip})]})}),e.jsx(T,{children:c.tanggal||"-"}),e.jsx(T,{children:ga(n.status)}),e.jsx(T,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{ta(n),Ae(!0)},children:e.jsx(Ge,{className:"w-4 h-4"})}),(l==null?void 0:l.role)!=="user"&&((l==null?void 0:l.role)==="admin"||n.created_by===(l==null?void 0:l.id))&&n.template_id!==2&&n.template_id!==9&&e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>Ue(n),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Edit Pejabat & Pegawai"]}),(l==null?void 0:l.role)!=="user"&&((l==null?void 0:l.role)==="admin"||n.created_by===(l==null?void 0:l.id))&&(n.template_id===2||n.template_id===9)&&e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>Ue(n),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(Ve,{className:"w-4 h-4 mr-2"}),"Edit Pejabat"]}),(l==null?void 0:l.role)==="admin"&&((l==null?void 0:l.role)==="admin"||n.created_by===(l==null?void 0:l.id))&&e.jsx(o,{variant:"outline",size:"sm",onClick:()=>ja(n),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(D,{className:"w-4 h-4"})})]})})]},n.id)})})]})}),m>1&&e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[e.jsx(o,{size:"sm",variant:"outline",onClick:()=>he(a,Math.max(1,i.currentPage-1)),disabled:i.currentPage===1,children:"Prev"}),Array.from({length:m},(n,g)=>g+1).map(n=>e.jsx(o,{size:"sm",variant:n===i.currentPage?"default":"outline",onClick:()=>he(a,n),children:n},n)),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>he(a,Math.min(m,i.currentPage+1)),disabled:i.currentPage===m,children:"Next"})]})]})]},t)})})})]}),e.jsx(je,{open:aa,onOpenChange:Ae,children:e.jsxs(fe,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(be,{children:"Preview Surat"}),H&&e.jsx(o,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>window.open(Ma(`/letters/${H.id}/preview`),"_blank"),children:"Open in New Tab"})]}),H&&e.jsx("div",{className:"mt-4",children:pa(H)})]})}),ia&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full flex flex-col items-center animate-fade-in",children:[e.jsx(Ta,{className:"w-16 h-16 text-yellow-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Sesi Berakhir"}),e.jsx("p",{className:"text-gray-600 mb-6 text-center",children:"Sesi Anda telah habis. Silakan login kembali untuk melanjutkan."}),e.jsx("button",{className:"w-full py-3 rounded-lg bg-green-600 hover:bg-green-700 text-white text-lg font-semibold shadow transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-400",onClick:()=>{localStorage.removeItem("token"),Ce(!1),na("/login",{replace:!0})},children:"Login Ulang"})]})}),ra&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full flex flex-col items-center animate-fade-in",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(D,{className:"w-8 h-8 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Hapus Surat"}),e.jsxs("p",{className:"text-gray-600 mb-6 text-center",children:["Apakah Anda yakin ingin menghapus surat ",e.jsx("strong",{children:O==null?void 0:O.letter_number}),"? Tindakan ini tidak dapat dibatalkan."]}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx(o,{variant:"outline",onClick:()=>{ie(!1),re(null)},disabled:ce,className:"flex-1",children:"Batal"}),e.jsx(o,{onClick:wa,disabled:ce,className:"flex-1 bg-red-600 hover:bg-red-700",children:ce?"Menghapus...":"Hapus"})]})]})}),ca&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full flex flex-col items-center animate-fade-in",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(D,{className:"w-8 h-8 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Hapus Surat"}),e.jsxs("p",{className:"text-gray-600 mb-6 text-center",children:["Apakah Anda yakin ingin menghapus ",p.length," surat yang dipilih? Tindakan ini tidak dapat dibatalkan."]}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx(o,{variant:"outline",onClick:()=>{de(!1),P([]),q(!1)},disabled:oe,className:"flex-1",children:"Batal"}),e.jsx(o,{onClick:Na,disabled:oe,className:"flex-1 bg-red-600 hover:bg-red-700",children:oe?"Menghapus...":"Hapus"})]})]})}),x&&e.jsx(je,{open:!!x,onOpenChange:a=>{a||J(null)},children:e.jsxs(fe,{className:"max-w-2xl",children:[e.jsx(be,{children:x.template_id===2||x.template_id===9?"Edit Pejabat":"Edit Pejabat & Pegawai"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx(Xe,{label:"Cari Pejabat",placeholder:"Masukkan nama atau NIP pejabat...",onSelect:W,selectedPegawai:h})}),x.template_id!==2&&x.template_id!==9&&e.jsx("div",{children:e.jsx(Xe,{label:"Cari Pegawai",placeholder:"Masukkan nama atau NIP pegawai...",onSelect:Z,selectedPegawai:d})})]}),e.jsxs("div",{className:"space-y-4",children:[h&&e.jsxs("div",{className:"border rounded-lg p-4 bg-blue-50",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 flex items-center",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Preview Pejabat"]}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>W(null),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-100",children:e.jsx(Je,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Nama:"})," ",h.nama]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"NIP:"})," ",h.nip]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Pangkat/Gol:"})," ",h.pangkat_gol]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Jabatan:"})," ",h.jabatan]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Unit Kerja:"})," ",h.unit_kerja]})]})]}),d&&x.template_id!==2&&x.template_id!==9&&e.jsxs("div",{className:"border rounded-lg p-4 bg-green-50",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("h4",{className:"font-semibold text-green-900 flex items-center",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Preview Pegawai"]}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>Z(null),className:"text-green-600 hover:text-green-700 hover:bg-green-100",children:e.jsx(Je,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Nama:"})," ",d.nama]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"NIP:"})," ",d.nip]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Pangkat/Gol:"})," ",d.pangkat_gol]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Jabatan:"})," ",d.jabatan]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Unit Kerja:"})," ",d.unit_kerja]}),d.tempat_tugas&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Tempat Tugas:"})," ",d.tempat_tugas]})]})]}),!h&&(x.template_id===2||x.template_id===9)&&e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 text-center text-gray-500",children:[e.jsx(z,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"Pilih pejabat untuk melihat preview"})]}),!h&&!d&&x.template_id!==2&&x.template_id!==9&&e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 text-center text-gray-500",children:[e.jsx(z,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"Pilih pejabat dan pegawai untuk melihat preview"})]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-4",children:[e.jsx(o,{variant:"outline",onClick:()=>J(null),disabled:ne,children:"Batal"}),e.jsx(o,{onClick:fa,disabled:ne||!h||x.template_id!==2&&x.template_id!==9&&!d,className:"bg-green-600 hover:bg-green-700 text-white",children:ne?"Menyimpan...":"Simpan"})]})]})}),e.jsx(je,{open:da,onOpenChange:X,children:e.jsxs(fe,{className:"max-w-2xl",children:[e.jsx(be,{children:"Export Data ke Excel"}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ye,{htmlFor:"template-filter",children:"Filter by Jenis Surat/Template"}),e.jsxs(Ne,{value:U,onValueChange:Me,children:[e.jsx(we,{id:"template-filter",children:e.jsx(ve,{placeholder:"Pilih template"})}),e.jsxs(ke,{children:[e.jsx(A,{value:"all",children:"Semua Template"}),ma.map(a=>e.jsx(A,{value:a,children:a},a))]})]})]}),(l==null?void 0:l.role)==="admin"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(Ye,{htmlFor:"office-filter",children:"Filter by Kabupaten/Kota"}),e.jsxs(Ne,{value:$,onValueChange:Le,children:[e.jsx(we,{id:"office-filter",children:e.jsx(ve,{placeholder:"Pilih kabupaten/kota"})}),e.jsxs(ke,{children:[e.jsx(A,{value:"all",children:"Semua Kabupaten/Kota"}),De.map(a=>e.jsx(A,{value:a.id,children:a.kabkota||a.namakantor||a.name||"Kantor Tidak Diketahui"},a.id))]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(o,{variant:"outline",onClick:()=>{X(!1),Me("all"),Le("all")},disabled:me,children:"Batal"}),e.jsx(o,{onClick:va,disabled:me,className:"bg-green-600 hover:bg-green-700",children:me?e.jsxs(e.Fragment,{children:[e.jsx(ee,{className:"w-4 h-4 mr-2 animate-spin"}),"Mengekspor..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Export"]})})]})]})]})})]})};export{ut as default};
//# sourceMappingURL=Letters-B2l2qiOL.js.map
