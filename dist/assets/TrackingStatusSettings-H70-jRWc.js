import{j as e,aN as K,as as M,at as O,au as L,bk as G}from"./ui-vendor-DQXcJUOU.js";import{e as R,r}from"./react-vendor-DheTkQGW.js";import{u as $,d as U,a as z,B as d,D as q,A as Q,e as J,f as V,g as W,h as X,I as C,i as Y,b as Z,j as ee,c as ae,l as te}from"./index-CX3qYA0U.js";import{L as p}from"./label-Cit_hwhV.js";import{T as se}from"./textarea-DflClD5O.js";import{S as re}from"./switch-DhmvdxVl.js";import{C as ie,a as ne,b as ce,d as le,c as de}from"./card-Bcv3oeDx.js";import{A as oe,h as ue,a as ge,b as me,c as he,d as xe,e as ke,g as pe,f as je}from"./alert-dialog-DfYCIl23.js";import{T as be,a as fe,b as A,c as h,d as ve,e as x}from"./table-CkKK4iv1.js";import{P as B}from"./PageHeader-Bw47tffW.js";import{S as Se}from"./shepherd-lljao8WZ.js";const Fe=()=>{const{user:_e,token:k}=$(),{toast:i}=U(),j=R(),[_,E]=r.useState([]),[u,T]=r.useState(!0),[b,g]=r.useState(!1),[c,D]=r.useState(null),[y,N]=r.useState(!1),n=r.useRef(null),[l,o]=r.useState({status_name:"",status_code:"",description:"",is_active:!0,sort_order:0});r.useEffect(()=>{f()},[]);const f=async()=>{try{T(!0);const a=await z("/api/tracking/status-master/all",k);a.success&&E(a.data)}catch(a){console.error("Error loading tracking statuses:",a),i({title:"Error",description:"Gagal memuat data status tracking",variant:"destructive"})}finally{T(!1)}},w=a=>{a?(D(a),o({status_name:a.status_name,status_code:a.status_code,description:a.description||"",is_active:a.is_active,sort_order:a.sort_order})):(D(null),o({status_name:"",status_code:"",description:"",is_active:!0,sort_order:0})),g(!0)},P=async()=>{try{if(N(!0),!l.status_name){i({title:"Error",description:"Nama status harus diisi",variant:"destructive"});return}const a={...l,status_code:c?l.status_code:`status-${Date.now()}`};let t;c?t=await ee(`/api/tracking/status-master/${c.id}`,a,k):t=await ae("/api/tracking/status-master",a,k),t.success?(i({title:"Berhasil",description:c?"Status tracking berhasil diperbarui":"Status tracking berhasil dibuat"}),g(!1),f()):i({title:"Error",description:t.message||"Terjadi kesalahan",variant:"destructive"})}catch(a){console.error("Error submitting form:",a),i({title:"Error",description:"Terjadi kesalahan saat menyimpan data",variant:"destructive"})}finally{N(!1)}},I=async a=>{try{const t=await te(`/api/tracking/status-master/${a.id}`,k);t.success?(i({title:"Berhasil",description:"Status tracking berhasil dihapus"}),f()):i({title:"Error",description:t.message||"Gagal menghapus status tracking",variant:"destructive"})}catch(t){console.error("Error deleting status:",t),i({title:"Error",description:"Terjadi kesalahan saat menghapus data",variant:"destructive"})}},F=a=>`status-${Date.now()}`,H=a=>{o(t=>({...t,status_name:a,status_code:c?t.status_code:F()}))},v=r.useCallback(()=>{if(n.current&&(n.current.cancel(),n.current=null),u){i({title:"Tunggu sebentar",description:"Data status tracking sedang dimuat."});return}const a=new Se.Tour({useModalOverlay:!0,defaultStepOptions:{cancelIcon:{enabled:!0},classes:"bg-white shadow-xl rounded-lg border border-gray-200 text-gray-800",scrollTo:{behavior:"smooth",block:"center"}}}),t=()=>new Promise(s=>{b?s():(g(!0),setTimeout(s,350))}),m=s=>{const S=[{text:"Lewati",classes:"shepherd-button-secondary text-gray-500",action:async()=>{a.cancel()}}];return s!=null&&s.showBack&&S.push({text:"Kembali",classes:"shepherd-button-secondary",action:async()=>{a.back()}}),S.push({text:s!=null&&s.isFinal?"Ke Tracking Dokumen":"Lanjut",classes:"shepherd-button-primary bg-green-600 text-white hover:bg-green-700",action:async()=>{s!=null&&s.specialAction?s.specialAction():s!=null&&s.isFinal?a.complete():a.next()}}),S};a.addStep({id:"settings-intro",title:"Master Status Tracking",text:"Di sini Anda bisa membuat, mengedit, atau mematikan status tracking yang tersedia.",attachTo:{element:'[data-tour-id="tracking-settings-card"]',on:"bottom"},buttons:m()}),a.addStep({id:"add-status",title:"Tambah Status Baru",text:'Klik "Tambah Status" bila status yang Anda perlukan belum ada di daftar.',attachTo:{element:'[data-tour-id="tracking-add-button"]',on:"bottom"},buttons:m({showBack:!0})}),a.addStep({id:"status-form",title:"Isi Detail Status",text:"Masukkan nama status, deskripsi, dan atur apakah status aktif sebelum disimpan.",attachTo:{element:'[data-tour-id="tracking-status-form"]',on:"top"},beforeShowPromise:t,buttons:m({showBack:!0})}),a.addStep({id:"status-table",title:"Kelola Status yang Ada",text:"Gunakan tabel ini untuk melihat urutan tampil dan melakukan edit/hapus pada status yang sudah dibuat.",attachTo:{element:'[data-tour-id="tracking-status-table"]',on:"top"},buttons:m({showBack:!0})}),a.addStep({id:"go-to-tracking",title:"Lanjut ke Tracking Dokumen",text:"Setelah status tersedia, lanjutkan ke menu Tracking Dokumen untuk mencatat progres berkas.",buttons:m({showBack:!0,isFinal:!0,specialAction:()=>{sessionStorage.setItem("pending_tracking_doc_tour","true"),sessionStorage.removeItem("pending_tracking_settings_tour"),a.complete(),j("/tracking")}})}),a.on("complete",()=>{sessionStorage.removeItem("pending_tracking_settings_tour"),n.current=null}),a.on("cancel",()=>{sessionStorage.removeItem("pending_tracking_settings_tour"),n.current=null}),a.start(),n.current=a},[u,b,j,i]);return r.useEffect(()=>{!u&&sessionStorage.getItem("pending_tracking_settings_tour")==="true"&&v()},[u,v]),r.useEffect(()=>()=>{n.current&&(n.current.cancel(),n.current=null)},[]),u?e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx(B,{title:"Konfigurasi Status Tracking"}),e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 mx-auto"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Memuat data..."})]})})]}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-4",children:[e.jsx("div",{"data-tour-id":"tracking-settings-header",className:"flex-1",children:e.jsx(B,{title:"Konfigurasi Status Tracking"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(d,{variant:"outline",onClick:v,className:"border-green-200 text-green-700",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Mulai Tutorial"]}),e.jsx(d,{variant:"outline",onClick:()=>{sessionStorage.setItem("pending_tracking_doc_tour","true"),j("/tracking")},children:"Pergi ke Tracking"})]})]}),e.jsx("div",{className:"mb-6",children:e.jsxs(ie,{"data-tour-id":"tracking-settings-card",children:[e.jsx(ne,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(ce,{children:"Master Status Tracking"}),e.jsx(le,{children:"Kelola status tracking yang tersedia untuk admin pusat"})]}),e.jsxs(q,{open:b,onOpenChange:g,children:[e.jsx(Q,{asChild:!0,children:e.jsxs(d,{"data-tour-id":"tracking-add-button",onClick:()=>w(),className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Tambah Status"]})}),e.jsxs(J,{className:"sm:max-w-[425px]","data-tour-id":"tracking-status-form",children:[e.jsxs(V,{children:[e.jsx(W,{children:c?"Edit Status Tracking":"Tambah Status Tracking"}),e.jsx(X,{children:c?"Perbarui informasi status tracking":"Buat status tracking baru untuk admin pusat"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(p,{htmlFor:"status_name",children:"Nama Status"}),e.jsx(C,{id:"status_name",value:l.status_name,onChange:a=>H(a.target.value),placeholder:"Contoh: Diterima di Pusat"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(p,{htmlFor:"description",children:"Deskripsi"}),e.jsx(se,{id:"description",value:l.description,onChange:a=>o(t=>({...t,description:a.target.value})),placeholder:"Deskripsi status tracking",rows:3})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(p,{htmlFor:"sort_order",children:"Urutan Tampil"}),e.jsx(C,{id:"sort_order",type:"number",value:l.sort_order,onChange:a=>o(t=>({...t,sort_order:parseInt(a.target.value)||0})),placeholder:"0"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(re,{id:"is_active",checked:l.is_active,onCheckedChange:a=>o(t=>({...t,is_active:a}))}),e.jsx(p,{htmlFor:"is_active",children:"Status Aktif"})]})]}),e.jsxs(Y,{children:[e.jsx(d,{variant:"outline",onClick:()=>g(!1),children:"Batal"}),e.jsx(d,{onClick:P,disabled:y,className:"bg-green-600 hover:bg-green-700 text-white",children:y?"Menyimpan...":c?"Perbarui":"Simpan"})]})]})]})]})}),e.jsxs(de,{children:[e.jsx("div",{className:"rounded-md border","data-tour-id":"tracking-status-table",children:e.jsxs(be,{children:[e.jsx(fe,{children:e.jsxs(A,{children:[e.jsx(h,{children:"Status Tracking"}),e.jsx(h,{children:"Deskripsi"}),e.jsx(h,{children:"Urutan"}),e.jsx(h,{children:"Status"}),e.jsx(h,{className:"text-right",children:"Aksi"})]})}),e.jsx(ve,{children:_.map(a=>e.jsxs(A,{children:[e.jsx(x,{className:"font-medium",children:e.jsx("div",{className:"font-semibold text-gray-900",children:a.status_name})}),e.jsx(x,{children:a.description||"-"}),e.jsx(x,{children:a.sort_order}),e.jsx(x,{children:e.jsx(Z,{variant:a.is_active?"default":"secondary",className:a.is_active?"bg-green-100 text-green-800 hover:bg-green-200":"",children:a.is_active?"Aktif":"Tidak Aktif"})}),e.jsx(x,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>w(a),children:e.jsx(O,{className:"h-4 w-4"})}),e.jsxs(oe,{children:[e.jsx(ue,{asChild:!0,children:e.jsx(d,{variant:"outline",size:"sm",children:e.jsx(L,{className:"h-4 w-4"})})}),e.jsxs(ge,{children:[e.jsxs(me,{children:[e.jsx(he,{children:"Hapus Status Tracking"}),e.jsxs(xe,{children:['Apakah Anda yakin ingin menghapus status "',a.status_name,'"?',e.jsx("br",{}),e.jsx("strong",{children:"Perhatian:"})," Status yang sedang digunakan dalam tracking tidak bisa dihapus."]})]}),e.jsxs(ke,{children:[e.jsx(pe,{children:"Batal"}),e.jsx(je,{onClick:()=>I(a),className:"bg-red-600 hover:bg-red-700",children:"Hapus"})]})]})]})]})})]},a.id))})]})}),_.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(G,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"Belum ada status tracking"}),e.jsx("p",{className:"text-sm",children:'Klik "Tambah Status" untuk membuat status pertama'})]})]})]})})]})};export{Fe as default};
//# sourceMappingURL=TrackingStatusSettings-H70-jRWc.js.map
