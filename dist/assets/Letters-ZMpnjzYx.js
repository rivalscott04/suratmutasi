import{j as e,F as C,$ as re,ar as B,a5 as ke,a1 as D,aD as na,aE as de,ay as ia,aB as Se,_ as Ae,aF as Te,ag as ra,X as Pe,aG as da}from"./ui-vendor-Cjkg25QM.js";import{r,e as ca,L as _e}from"./react-vendor-BNG1zHOu.js";import{u as ma,d as oa,a as ce,S as k,B as c,I as xa,b as me,D as Ce,e as Be,g as Le,m as ha,j as ua,l as Me}from"./index-DNSinUKw.js";import{C as E,c as O,a as ga,b as ja}from"./card-DTtH1t2j.js";import{T as pa,a as ba,b as De,c as S,d as fa,e as A}from"./table-BJmXBxxh.js";import{T as Na,a as va,b as wa,c as ya,d as ka,e as Sa,f as Aa,g as Ta,h as Pa}from"./Template9-DNZ-R1Ik.js";import{A as _a,a as Ca,b as Ba,c as La}from"./accordion-BEpI0WnC.js";import{S as Ma,a as Da,b as Ea,c as Oa,d as J}from"./select-ipCcWXeO.js";import{P as Ee}from"./PegawaiSearchInput-CKxeULFz.js";import"./label-CnOm9cyw.js";const qa=()=>{const{token:j,user:l}=ma(),[w,oe]=r.useState([]),[p,K]=r.useState(!0),[xe,he]=r.useState(null),[b,W]=r.useState(""),[U,Oe]=r.useState("letter_number"),[X,Ke]=r.useState("asc");r.useState(1),r.useState(10);const[f,q]=r.useState("all"),{toast:y}=oa();r.useState(null),r.useState(null),r.useState([]);const[Ue,ue]=r.useState(!1),[z,ze]=r.useState(null);r.useState(!1),r.useState(null),r.useState(null),r.useState(null);const[$e,$]=r.useState({}),[Q,Re]=r.useState({}),[o,R]=r.useState(null),[x,I]=r.useState(null),[d,F]=r.useState(null),[Y,ge]=r.useState(!1),Ie=ca(),[Fe,je]=r.useState(!1),[Ge,Z]=r.useState(!1),[L,ee]=r.useState(null),[ae,pe]=r.useState(!1),[h,T]=r.useState([]),[M,G]=r.useState(!1),[He,te]=r.useState(!1),[se,be]=r.useState(!1),P=w.filter(a=>{var s,t,i,m,u,n;return((s=a.letter_number)==null?void 0:s.toLowerCase().includes(b.toLowerCase()))||((t=a.template_name)==null?void 0:t.toLowerCase().includes(b.toLowerCase()))||((m=(i=a.office)==null?void 0:i.namakantor)==null?void 0:m.toLowerCase().includes(b.toLowerCase()))||((n=(u=a.office)==null?void 0:u.kabkota)==null?void 0:n.toLowerCase().includes(b.toLowerCase()))}),le=(()=>{switch(f){case"with-employee":return P.filter(a=>![2,9].includes(a.template_id));case"without-employee":return P.filter(a=>[2,9].includes(a.template_id));default:return P}})(),H=[...le].sort((a,s)=>{var m,u;let t=a[U]||"",i=s[U]||"";return U==="tanggal"&&(t=((m=a.form_data)==null?void 0:m.tanggal)||"",i=((u=s.form_data)==null?void 0:u.tanggal)||""),X==="asc"?String(t).localeCompare(String(i)):String(i).localeCompare(String(t))}).reduce((a,s)=>{var i,m;let t=((i=s.office)==null?void 0:i.namakantor)||((m=s.office)==null?void 0:m.kabkota);return!t&&s.office_id&&Q[s.office_id]&&(t=Q[s.office_id].namakantor||Q[s.office_id].kabkota),t||(t="Kantor Tidak Diketahui"),a[t]||(a[t]=[]),a[t].push(s),a},{}),V=Object.entries(H).filter(([a,s])=>b?a.toLowerCase().includes(b.toLowerCase())||s.some(t=>t.letter_number.toLowerCase().includes(b.toLowerCase())):!0);r.useEffect(()=>{j&&(K(!0),ce("/api/letters",j).then(a=>oe(a.letters||[])).catch(a=>{a.message&&(a.message.includes("Invalid or expired token")||a.message.includes("401"))?je(!0):he("Gagal mengambil data surat")}).finally(()=>K(!1)))},[j]),r.useEffect(()=>{j&&ce("/api/offices",j).then(a=>{const s={};(a.offices||[]).forEach(t=>{s[t.id]={namakantor:t.namakantor,kabkota:t.kabkota}}),Re(s)}).catch(()=>{})},[j]);const Ve=a=>w.filter(s=>s.status===a).length,Je=w.length,fe=w.length>0?w.reduce((a,s)=>(a[s.template_name]=(a[s.template_name]||0)+1,a),{}):{};Object.keys(fe).length>0&&Object.entries(fe).sort(([,a],[,s])=>s-a)[0][0];const v=w.length===0?null:w.reduce((a,s)=>{const t=new Date(a.created_at||0);return new Date(s.created_at||0)>t?s:a}),We=()=>{var i,m,u,n;if(!v)return"Tidak ada data";const a=N=>({"01":"KOTA MATARAM","02":"KABUPATEN LOMBOK BARAT","03":"KABUPATEN LOMBOK TENGAH","04":"KABUPATEN LOMBOK TIMUR","05":"KABUPATEN SUMBAWA","06":"KABUPATEN DOMPU","07":"KOTA MATARAM","08":"KABUPATEN BIMA","09":"KOTA BIMA",10:"KABUPATEN SUMBAWA BARAT",11:"KABUPATEN LOMBOK UTARA",12:"KABUPATEN LOMBOK TENGAH",13:"KABUPATEN LOMBOK TIMUR",14:"KABUPATEN SUMBAWA",15:"KABUPATEN DOMPU",16:"KABUPATEN BIMA",17:"KOTA BIMA",18:"KABUPATEN SUMBAWA BARAT",19:"KABUPATEN LOMBOK UTARA",20:"KABUPATEN LOMBOK TENGAH"})[N]||"Kantor Tidak Diketahui",s=((i=v.office)==null?void 0:i.namakantor)||((m=v.office)==null?void 0:m.kabkota)||a(((u=v.form_data)==null?void 0:u.kode_kabko)||((n=v.office)==null?void 0:n.kode_kabko)||"")||"Kantor Tidak Diketahui",t=v.created_at?new Date(v.created_at).toLocaleDateString("id-ID",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"}):"Tidak diketahui";return`${s} (${t})`},Xe=a=>a==="generated"?e.jsx(me,{className:"bg-green-100 text-green-700 border-green-200",children:"Generated"}):a==="signed"?e.jsx(me,{className:"bg-blue-100 text-blue-700 border-blue-200",children:"Signed"}):null,qe=a=>{var N;let s=a.form_data;if(typeof s=="string")try{s=JSON.parse(s)}catch{s={}}if(!s)return e.jsx("div",{className:"text-error",children:"Data surat tidak ditemukan"});const t=String(a.template_id),i=(a.letter_number||"").split("/"),m=(N=a.letter_number)==null?void 0:N.match(/^B-([^/]+)/),u={nosrt:s.nosrt||(m?m[1]:""),nosurat:s.nosurat||(m?m[1]:""),blnno:s.blnno||i[5]||"",blnnomor:s.blnnomor||i[5]||"",thnno:s.thnno||i[6]||"",tahunskrg:s.tahunskrg||i[6]||""},n={...s,...u};return a.template_id===2&&s.unitkerja&&(n.unitkerja=s.unitkerja),t==="1"?e.jsx(Na,{data:n}):t==="2"?e.jsx(va,{data:n}):t==="3"?e.jsx(wa,{data:n}):t==="4"?e.jsx(ya,{data:n}):t==="5"?e.jsx(ka,{data:n}):t==="6"?e.jsx(Sa,{data:n}):t==="7"?e.jsx(Aa,{data:n}):t==="8"?e.jsx(Ta,{data:n}):t==="9"?e.jsx(Pa,{data:n}):e.jsx("div",{className:"text-error",children:"Template tidak dikenali"})},Qe=async a=>{if(!((l==null?void 0:l.role)==="admin"||a.created_by===(l==null?void 0:l.id))){y({title:"Tidak dapat menghapus surat",description:"Anda hanya dapat menghapus surat yang Anda buat sendiri.",variant:"destructive"});return}ee(a),Z(!0)},Ne=a=>{R(a),I(null),F(null)},Ye=async()=>{if(!(!o||!x)&&!(o.template_id!==2&&o.template_id!==9&&!d)){ge(!0);try{const a=o.form_data,s=o.template_id,t={...a,namapejabat:x.nama||"",nippejabat:x.nip||"",pangkatgolpejabat:x.pangkat_gol||"",jabatanpejabat:x.jabatan||""};switch(s!==2&&s!==9&&d&&(t.namapegawai=d.nama||"",t.nippegawai=d.nip||"",t.pangkatgolpegawai=d.pangkat_gol||"",t.jabatanpegawai=d.jabatan||""),(s===2||s===9)&&(delete t.namapegawai,delete t.nippegawai,delete t.pangkatgolpegawai,delete t.jabatanpegawai,delete t.ukerpegawai),s){case 1:t.ukerpejabat=x.unit_kerja||"",d&&(t.ukerpegawai=d.unit_kerja||"");break;case 2:break;case 3:d&&(t.tempattugas=d.tempat_tugas||"");break;case 4:d&&(t.unitkerja=d.unit_kerja||"");break;case 5:t.ukerpejabat=x.unit_kerja||"",d&&(t.tempattugas=d.tempat_tugas||"");break;case 6:t.ukerpejabat=x.unit_kerja||"",d&&(t.ukerpegawai=d.unit_kerja||"");break;case 7:d&&(t.tempattugas=d.tempat_tugas||"");break;case 8:d&&(t.tempattugas=d.tempat_tugas||"");break;case 9:t.ukerpejabat=x.unit_kerja||"";break}await ua(`/api/letters/${o.id}`,{form_data:t},j),await _(),R(null),I(null),F(null),y({title:"Berhasil",description:"Data pejabat dan pegawai berhasil diperbarui"})}catch(a){console.error("Error updating letter:",a),y({title:"Error",description:"Gagal memperbarui data surat",variant:"destructive"})}finally{ge(!1)}}},Ze=(a,s)=>{T(s?t=>[...t,a]:t=>t.filter(i=>i!==a))},ve=a=>{if(G(a),a){const t=V.flatMap(([i,m])=>m).filter(i=>(l==null?void 0:l.role)==="admin"||i.created_by===(l==null?void 0:l.id));T(t.map(i=>i.id))}else T([])},we=()=>{if(h.length===0){y({title:"Tidak ada surat dipilih",description:"Pilih surat yang akan dihapus terlebih dahulu.",variant:"destructive"});return}te(!0)},ea=async()=>{be(!0);try{for(const a of h)await Me(`/api/letters/${a}`,j);y({title:"Surat berhasil dihapus",description:`${h.length} surat telah dihapus dari sistem.`,duration:3e3}),T([]),G(!1),te(!1),await _(),$({}),b&&W("")}catch(a){y({title:"Gagal menghapus surat",description:a.message||"Terjadi kesalahan",variant:"destructive",duration:5e3})}finally{be(!1)}},_=async()=>{K(!0);try{const a=await ce("/api/letters",j);oe(a.letters||[])}catch{he("Gagal mengambil data surat")}finally{K(!1)}},aa=async()=>{if(L){pe(!0);try{await Me(`/api/letters/${L.id}`,j),y({title:"Surat berhasil dihapus",description:"Surat telah dihapus dari sistem.",duration:3e3}),await _(),$({}),b&&W(""),Z(!1),ee(null)}catch(a){y({title:"Gagal menghapus surat",description:a.message||"Terjadi kesalahan",variant:"destructive",duration:5e3})}finally{pe(!1)}}},ne=(a,s)=>{$(t=>({...t,[a]:{...t[a]||{currentPage:1,pageSize:10},currentPage:s}}))},ta=(a,s)=>{$(t=>({...t,[a]:{...t[a]||{currentPage:1,pageSize:10},pageSize:s,currentPage:1}}))},sa=()=>e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"w-24 h-24 bg-gradient-to-br from-green-100 to-blue-100 rounded-full flex items-center justify-center",children:e.jsx(da,{className:"w-12 h-12 text-green-600"})}),e.jsx("div",{className:"absolute -top-2 -right-2 w-8 h-8 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-red-600",children:"0"})})]}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Belum Ada Surat"}),e.jsx("p",{className:"text-gray-600 text-center max-w-md mb-6",children:"Riwayat surat masih kosong. Mulai buat surat pertama Anda untuk melihat data di sini."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(c,{asChild:!0,className:"bg-green-600 hover:bg-green-700",children:e.jsxs(_e,{to:"/generator",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Buat Surat Baru"]})}),e.jsxs(c,{variant:"outline",onClick:_,disabled:p,children:[e.jsx(re,{className:`w-4 h-4 mr-2 ${p?"animate-spin":""}`}),p?"Loading...":"Refresh Data"]})]})]});return p?e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(k,{className:"h-8 w-1/3 mb-4"}),e.jsx(k,{className:"h-6 w-1/2"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(k,{className:"h-32"}),e.jsx(k,{className:"h-32"}),e.jsx(k,{className:"h-32"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(k,{className:"h-16"}),e.jsx(k,{className:"h-16"}),e.jsx(k,{className:"h-16"})]})]}):xe?e.jsx("div",{className:"max-w-7xl mx-auto p-6",children:e.jsxs("div",{className:"flex flex-col items-center justify-center py-16",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(C,{className:"w-8 h-8 text-red-600"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Gagal Memuat Data"}),e.jsx("p",{className:"text-gray-600 mb-6",children:xe}),e.jsxs(c,{onClick:_,disabled:p,children:[e.jsx(re,{className:`w-4 h-4 mr-2 ${p?"animate-spin":""}`}),p?"Loading...":"Coba Lagi"]})]})}):e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Riwayat Surat"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Kelola dan pantau semua surat yang telah dibuat"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{variant:"outline",onClick:_,disabled:p,children:[e.jsx(re,{className:`w-4 h-4 mr-2 ${p?"animate-spin":""}`}),p?"Loading...":"Refresh"]}),le.length>0&&(()=>{const a=le.filter(s=>(l==null?void 0:l.role)==="admin"||s.created_by===(l==null?void 0:l.id)).length;return a>0?e.jsx(c,{variant:M?"destructive":"outline",onClick:()=>ve(!M),className:M?"bg-red-600 hover:bg-red-700":"border-green-200 text-green-700 hover:bg-green-50",children:M?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Batal Pilih Semua"]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Pilih Semua (",a,")"]})}):null})(),(l==null?void 0:l.role)!=="user"&&e.jsx(c,{asChild:!0,className:"bg-green-600 hover:bg-green-700",children:e.jsxs(_e,{to:"/generator",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Buat Surat Baru"]})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(xa,{placeholder:"Cari surat, nomor surat, atau kantor...",value:b,onChange:a=>W(a.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(Ma,{value:U,onValueChange:a=>Oe(a),children:[e.jsx(Da,{className:"w-40",children:e.jsx(Ea,{placeholder:"Urutkan"})}),e.jsxs(Oa,{children:[e.jsx(J,{value:"letter_number",children:"Nomor Surat"}),e.jsx(J,{value:"template_name",children:"Template"}),e.jsx(J,{value:"tanggal",children:"Tanggal"}),e.jsx(J,{value:"status",children:"Status"})]})]}),e.jsx(c,{variant:"outline",onClick:()=>Ke(X==="asc"?"desc":"asc"),children:X==="asc"?"↑":"↓"})]})]})]}),h.length>0&&e.jsx("div",{className:"mb-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold text-blue-600",children:h.length})}),e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold text-blue-900",children:[h.length," surat dipilih"]}),e.jsx("p",{className:"text-sm text-blue-700",children:"Siap untuk dihapus"})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>{T([]),G(!1)},className:"border-green-300 text-green-700 hover:bg-green-50",children:"Batal Pilih"}),e.jsxs(c,{variant:"destructive",size:"sm",onClick:we,className:"bg-red-600 hover:bg-red-700 shadow-sm",children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Hapus ",h.length," Surat"]})]})]})}),h.length>0&&e.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(c,{size:"lg",onClick:we,className:"bg-red-600 hover:bg-red-700 shadow-lg rounded-full w-16 h-16",children:e.jsx(B,{className:"w-6 h-6"})}),e.jsxs("div",{className:"bg-white rounded-full px-3 py-1 shadow-lg text-sm font-medium text-gray-700",children:[h.length," surat"]})]})}),e.jsxs("div",{className:"mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg border border-gray-200 p-1",children:e.jsxs("nav",{className:"flex space-x-1",children:[e.jsxs("button",{onClick:()=>q("all"),className:`flex-1 flex items-center justify-center py-3 px-4 rounded-md font-medium text-sm transition-all duration-200 ${f==="all"?"bg-green-50 text-green-700 border border-green-200 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Semua Surat",e.jsx("span",{className:"ml-2 bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs",children:P.length})]}),e.jsxs("button",{onClick:()=>q("with-employee"),className:`flex-1 flex items-center justify-center py-3 px-4 rounded-md font-medium text-sm transition-all duration-200 ${f==="with-employee"?"bg-green-50 text-green-700 border border-green-200 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Surat dengan Pegawai",e.jsx("span",{className:"ml-2 bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs",children:P.filter(a=>![2,9].includes(a.template_id)).length})]}),e.jsxs("button",{onClick:()=>q("without-employee"),className:`flex-1 flex items-center justify-center py-3 px-4 rounded-md font-medium text-sm transition-all duration-200 ${f==="without-employee"?"bg-orange-50 text-orange-700 border border-orange-200 shadow-sm":"text-gray-600 hover:text-gray-900 hover:bg-gray-50"}`,children:[e.jsx(na,{className:"w-4 h-4 mr-2"}),"Analisis & Pernyataan",e.jsx("span",{className:"ml-2 bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full text-xs",children:P.filter(a=>[2,9].includes(a.template_id)).length})]})]})}),e.jsxs("div",{className:"mt-3 text-sm text-gray-600",children:[f==="all"&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(de,{className:"w-4 h-4 mr-2 text-green-500"}),"Menampilkan semua surat yang telah dibuat dalam sistem"]}),f==="with-employee"&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(de,{className:"w-4 h-4 mr-2 text-green-500"}),"Surat yang memerlukan data pegawai tertentu (Template 1, 3-8)"]}),f==="without-employee"&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(de,{className:"w-4 h-4 mr-2 text-orange-500"}),"Surat analisis jabatan dan pernyataan (Template 2 & 9)"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(E,{children:e.jsx(O,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Surat"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:Je})]}),e.jsx("div",{className:"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center",children:e.jsx(C,{className:"w-6 h-6 text-blue-600"})})]})})}),e.jsx(E,{children:e.jsx(O,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Generated"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:Ve("generated")})]}),e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(ia,{className:"w-6 h-6 text-green-600"})})]})})}),e.jsx(E,{children:e.jsx(O,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Surat Terbaru"}),e.jsx("p",{className:"text-lg font-bold text-gray-900",children:v?`${v.letter_number} - ${We()}`:"Tidak ada data"})]}),e.jsx("div",{className:"w-12 h-12 bg-teal-100 rounded-lg flex items-center justify-center",children:e.jsx(Se,{className:"w-6 h-6 text-teal-600"})})]})})})]}),w.length===0?e.jsx(E,{children:e.jsx(O,{className:"p-0",children:e.jsx(sa,{})})}):e.jsxs(E,{children:[e.jsx(ga,{children:e.jsxs(ja,{className:"flex items-center gap-2",children:[e.jsx(Ae,{className:"w-5 h-5"}),f==="all"&&`Surat Berdasarkan Kantor (${Object.keys(H).length} Kantor)`,f==="with-employee"&&`Surat dengan Pegawai (${Object.keys(H).length} Kantor)`,f==="without-employee"&&`Surat Analisis & Pernyataan (${Object.keys(H).length} Kantor)`]})}),e.jsx(O,{children:V.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ke,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Tidak Ada Hasil"}),e.jsx("p",{className:"text-gray-600",children:"Coba ubah kata kunci pencarian Anda"})]}):e.jsx(_a,{type:"multiple",className:"space-y-2",children:V.map(([a,s],t)=>{const i=$e[a]||{currentPage:1,pageSize:10},m=Math.ceil(s.length/i.pageSize),u=s.slice((i.currentPage-1)*i.pageSize,i.currentPage*i.pageSize);return e.jsxs(Ca,{value:`office-${t}`,className:"border rounded-lg",children:[e.jsx(Ba,{className:"px-6 py-4 hover:bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:e.jsx(Ae,{className:"w-4 h-4 text-green-600"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:a}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.length," surat"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(me,{variant:"secondary",children:s.length})})]})}),e.jsxs(La,{className:"px-6 pb-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-2 gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:`pageSize-${t}`,className:"text-sm",children:"Tampilkan"}),e.jsx("select",{id:`pageSize-${t}`,value:i.pageSize,onChange:n=>ta(a,Number(n.target.value)),className:"border rounded px-2 py-1 text-sm",children:[10,20,50,100].map(n=>e.jsx("option",{value:n,children:n},n))}),e.jsx("span",{className:"text-sm",children:"data per halaman"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Menampilkan ",s.length===0?0:(i.currentPage-1)*i.pageSize+1,"–",Math.min(i.currentPage*i.pageSize,s.length)," dari ",s.length," surat"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(pa,{children:[e.jsx(ba,{className:"bg-gray-50",children:e.jsxs(De,{children:[e.jsx(S,{className:"w-12",children:e.jsx("div",{className:"flex items-center gap-2",children:(()=>{const N=V.flatMap(([g,ie])=>ie).filter(g=>(l==null?void 0:l.role)==="admin"||g.created_by===(l==null?void 0:l.id)).length;return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"checkbox",checked:M,onChange:g=>ve(g.target.checked),disabled:N===0,className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50"}),h.length>0&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:h.length})]})})()})}),e.jsx(S,{children:"No."}),e.jsx(S,{children:"Nomor Surat"}),e.jsx(S,{children:"Template"}),e.jsx(S,{children:"Pegawai"}),e.jsx(S,{children:"Tanggal"}),e.jsx(S,{children:"Status"}),e.jsx(S,{children:"Aksi"})]})}),e.jsx(fa,{children:u.map((n,N)=>{let g=n.form_data;if(typeof g=="string")try{g=JSON.parse(g)}catch{g={}}const ie=(l==null?void 0:l.role)==="admin"||n.created_by===(l==null?void 0:l.id),ye=h.includes(n.id);return e.jsxs(De,{className:ye?"bg-blue-50 border-blue-200":"",children:[e.jsx(A,{children:e.jsx("input",{type:"checkbox",checked:ye,onChange:la=>Ze(n.id,la.target.checked),disabled:!ie,className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500 disabled:opacity-50"})}),e.jsx(A,{children:(i.currentPage-1)*i.pageSize+N+1}),e.jsx(A,{className:"font-mono text-sm",children:n.letter_number}),e.jsx(A,{children:n.template_name}),e.jsx(A,{children:n.template_id===9?e.jsx("span",{className:"text-gray-500",children:"Tanpa Pegawai"}):e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:g.namapegawai}),e.jsx("div",{className:"text-sm text-gray-500",children:n.recipient_employee_nip})]})}),e.jsx(A,{children:g.tanggal||"-"}),e.jsx(A,{children:Xe(n.status)}),e.jsx(A,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>{ze(n),ue(!0)},children:e.jsx(Se,{className:"w-4 h-4"})}),(l==null?void 0:l.role)!=="user"&&((l==null?void 0:l.role)==="admin"||n.created_by===(l==null?void 0:l.id))&&n.template_id!==2&&n.template_id!==9&&e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>Ne(n),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Edit Pejabat & Pegawai"]}),(l==null?void 0:l.role)!=="user"&&((l==null?void 0:l.role)==="admin"||n.created_by===(l==null?void 0:l.id))&&(n.template_id===2||n.template_id===9)&&e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>Ne(n),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(Te,{className:"w-4 h-4 mr-2"}),"Edit Pejabat"]}),(l==null?void 0:l.role)==="admin"&&((l==null?void 0:l.role)==="admin"||n.created_by===(l==null?void 0:l.id))&&e.jsx(c,{variant:"outline",size:"sm",onClick:()=>Qe(n),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(B,{className:"w-4 h-4"})})]})})]},n.id)})})]})}),m>1&&e.jsxs("div",{className:"flex justify-center items-center gap-2 mt-4",children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>ne(a,Math.max(1,i.currentPage-1)),disabled:i.currentPage===1,children:"Prev"}),Array.from({length:m},(n,N)=>N+1).map(n=>e.jsx(c,{size:"sm",variant:n===i.currentPage?"default":"outline",onClick:()=>ne(a,n),children:n},n)),e.jsx(c,{size:"sm",variant:"outline",onClick:()=>ne(a,Math.min(m,i.currentPage+1)),disabled:i.currentPage===m,children:"Next"})]})]})]},t)})})})]}),e.jsx(Ce,{open:Ue,onOpenChange:ue,children:e.jsxs(Be,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(Le,{children:"Preview Surat"}),z&&e.jsx(c,{size:"sm",className:"bg-green-600 hover:bg-green-700 text-white",onClick:()=>window.open(ha(`/letters/${z.id}/preview`),"_blank"),children:"Open in New Tab"})]}),z&&e.jsx("div",{className:"mt-4",children:qe(z)})]})}),Fe&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full flex flex-col items-center animate-fade-in",children:[e.jsx(ra,{className:"w-16 h-16 text-yellow-500 mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Sesi Berakhir"}),e.jsx("p",{className:"text-gray-600 mb-6 text-center",children:"Sesi Anda telah habis. Silakan login kembali untuk melanjutkan."}),e.jsx("button",{className:"w-full py-3 rounded-lg bg-green-600 hover:bg-green-700 text-white text-lg font-semibold shadow transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-400",onClick:()=>{localStorage.removeItem("token"),je(!1),Ie("/login",{replace:!0})},children:"Login Ulang"})]})}),Ge&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full flex flex-col items-center animate-fade-in",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(B,{className:"w-8 h-8 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Hapus Surat"}),e.jsxs("p",{className:"text-gray-600 mb-6 text-center",children:["Apakah Anda yakin ingin menghapus surat ",e.jsx("strong",{children:L==null?void 0:L.letter_number}),"? Tindakan ini tidak dapat dibatalkan."]}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx(c,{variant:"outline",onClick:()=>{Z(!1),ee(null)},disabled:ae,className:"flex-1",children:"Batal"}),e.jsx(c,{onClick:aa,disabled:ae,className:"flex-1 bg-red-600 hover:bg-red-700",children:ae?"Menghapus...":"Hapus"})]})]})}),He&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full flex flex-col items-center animate-fade-in",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(B,{className:"w-8 h-8 text-red-600"})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Hapus Surat"}),e.jsxs("p",{className:"text-gray-600 mb-6 text-center",children:["Apakah Anda yakin ingin menghapus ",h.length," surat yang dipilih? Tindakan ini tidak dapat dibatalkan."]}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx(c,{variant:"outline",onClick:()=>{te(!1),T([]),G(!1)},disabled:se,className:"flex-1",children:"Batal"}),e.jsx(c,{onClick:ea,disabled:se,className:"flex-1 bg-red-600 hover:bg-red-700",children:se?"Menghapus...":"Hapus"})]})]})}),o&&e.jsx(Ce,{open:!!o,onOpenChange:a=>{a||R(null)},children:e.jsxs(Be,{className:"max-w-2xl",children:[e.jsx(Le,{children:o.template_id===2||o.template_id===9?"Edit Pejabat":"Edit Pejabat & Pegawai"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{children:e.jsx(Ee,{label:"Cari Pejabat",placeholder:"Masukkan nama atau NIP pejabat...",onSelect:I,selectedPegawai:x})}),o.template_id!==2&&o.template_id!==9&&e.jsx("div",{children:e.jsx(Ee,{label:"Cari Pegawai",placeholder:"Masukkan nama atau NIP pegawai...",onSelect:F,selectedPegawai:d})})]}),e.jsxs("div",{className:"space-y-4",children:[x&&e.jsxs("div",{className:"border rounded-lg p-4 bg-blue-50",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("h4",{className:"font-semibold text-blue-900 flex items-center",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Preview Pejabat"]}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>I(null),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-100",children:e.jsx(Pe,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Nama:"})," ",x.nama]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"NIP:"})," ",x.nip]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Pangkat/Gol:"})," ",x.pangkat_gol]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Jabatan:"})," ",x.jabatan]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Unit Kerja:"})," ",x.unit_kerja]})]})]}),d&&o.template_id!==2&&o.template_id!==9&&e.jsxs("div",{className:"border rounded-lg p-4 bg-green-50",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("h4",{className:"font-semibold text-green-900 flex items-center",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Preview Pegawai"]}),e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>F(null),className:"text-green-600 hover:text-green-700 hover:bg-green-100",children:e.jsx(Pe,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Nama:"})," ",d.nama]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"NIP:"})," ",d.nip]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Pangkat/Gol:"})," ",d.pangkat_gol]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Jabatan:"})," ",d.jabatan]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Unit Kerja:"})," ",d.unit_kerja]}),d.tempat_tugas&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Tempat Tugas:"})," ",d.tempat_tugas]})]})]}),!x&&(o.template_id===2||o.template_id===9)&&e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 text-center text-gray-500",children:[e.jsx(D,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"Pilih pejabat untuk melihat preview"})]}),!x&&!d&&o.template_id!==2&&o.template_id!==9&&e.jsxs("div",{className:"border rounded-lg p-4 bg-gray-50 text-center text-gray-500",children:[e.jsx(D,{className:"w-8 h-8 mx-auto mb-2 text-gray-400"}),e.jsx("p",{children:"Pilih pejabat dan pegawai untuk melihat preview"})]})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end mt-4",children:[e.jsx(c,{variant:"outline",onClick:()=>R(null),disabled:Y,children:"Batal"}),e.jsx(c,{onClick:Ye,disabled:Y||!x||o.template_id!==2&&o.template_id!==9&&!d,className:"bg-green-600 hover:bg-green-700 text-white",children:Y?"Menyimpan...":"Simpan"})]})]})})]})};export{qa as default};
//# sourceMappingURL=Letters-ZMpnjzYx.js.map
