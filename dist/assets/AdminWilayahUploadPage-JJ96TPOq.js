import{j as a,at as Sa,ae as ea,a6 as $,F as L,aA as wa,ak as va,ap as Na,U as sa,aK as ra,ag as Ta,a5 as na,a4 as Da,a$ as Aa,ai as Ka}from"./ui-vendor-BBh2_8F_.js";import{r as d,d as Ra,e as Ba}from"./react-vendor-BNG1zHOu.js";import{C as G,c as V,a as ta,b as ia}from"./card-_6hbulDc.js";import{u as la,d as Ea,B as T,b as w,a as F,c as da,s as Fa,y as C,z as Ua,P as Ia}from"./index-X_6NYigw.js";import{S as Ma,a as Ja,b as Ca,c as Wa,d as La}from"./select-_KCi3HCt.js";import{u as ua,S as oa}from"./protected-button-UpIvSpY0.js";import{P as $a}from"./PageHeader-BLDEyKHb.js";import{A as Ha,a as za,b as Oa,c as qa,d as Ga,e as Va,g as Xa,f as Ya}from"./alert-dialog-DF7O_xGI.js";const W=u=>String(u).toLowerCase().replace(/[^a-z0-9_-]+/gi,"_").replace(/^_+|_+$/g,""),Qa=({pengajuanId:u,jenisJabatanId:p,onFilesUploaded:j,onProgressChange:l,pengajuanStatus:v})=>{const{token:S,user:A}=la(),{toast:R}=Ea(),[_,H]=d.useState([]),[y,b]=d.useState([]);d.useState([]),d.useState("");const[D,x]=d.useState({}),[K,N]=d.useState({}),[z,B]=d.useState(!1),[U,X]=d.useState(!1),{submitForm:I,isSubmitting:M}=ua(),[J,E]=d.useState(!0),[r,c]=d.useState(null),[m,g]=d.useState(null),[k,h]=d.useState(!1),f=async()=>{try{E(!0),c(null);let e;if(isNaN(Number(p)))try{const n=await F("/api/job-type-configurations",S);if(n!=null&&n.success&&Array.isArray(n.data)){const t=n.data.find(i=>i.jenis_jabatan===p);if(t)e=t.id;else{c("Jenis jabatan tidak ditemukan");return}}else{c("Gagal mengambil data jenis jabatan");return}}catch{c("Gagal mencari jenis jabatan");return}else e=parseInt(String(p));const s=await F(`/api/admin-wilayah-file-config/job-type/${e}`,S);if(console.log("🔍 API Response:",s),console.log("🔍 Job Type ID:",e),console.log("🔍 Jenis Jabatan ID:",p),s.success){if(console.log("✅ Setting required files:",s.data),H(s.data),l){const n=y.filter(t=>s.data.some(i=>i.file_type===t.file_type)).length;l(n,s.data.length||0)}}else c("Failed to fetch file configurations")}catch(e){console.error("Error fetching file configs:",e),c("Error connecting to server")}finally{E(!1)}},Y=async()=>{var e;try{const s=await F(`/api/admin-wilayah/pengajuan/${u}`,S);if(s!=null&&s.success){const t=(s.uploadedAdminWilayahFiles||((e=s.data)==null?void 0:e.uploadedAdminWilayahFiles)||[]).map(i=>({id:i.id,pengajuan_id:u,file_type:i.file_type,file_name:i.file_name,file_path:i.file_path,file_size:i.file_size,verification_status:i.verification_status||"pending",created_at:i.created_at,updated_at:i.updated_at}));b(t)}else b([])}catch(s){console.error("Error fetching uploaded files:",s),b([])}};d.useEffect(()=>{p&&(f(),Y())},[p,S]),d.useEffect(()=>{if(l){const e=_.length,s=y.filter(n=>_.some(t=>t.file_type===n.file_type)).length;l(s,e)}},[_,y]);const O=async(e,s)=>{console.log("🚀 START UPLOAD - fileType:",e,"fileName:",s.name),x(n=>({...n,[e]:!0})),N(n=>({...n,[e]:0}));try{console.log("🔍 Uploading file:",{fileType:e,fileName:s.name,pengajuanId:u,jenisJabatanId:p,requiredFiles:_.map(o=>({file_type:o.file_type,display_name:o.display_name}))});const n=new FormData;n.append("file",s),n.append("pengajuan_id",u),n.append("file_type",e),n.append("file_category","admin_wilayah"),n.append("uploaded_by_role","admin_wilayah"),n.append("uploaded_by_name",(A==null?void 0:A.full_name)||"Admin Wilayah"),n.append("uploaded_by_office","Kanwil Provinsi"),console.log("📦 FormData created:",{file:s.name,pengajuan_id:u,file_type:e,file_category:"admin_wilayah"});for(let[o,P]of n.entries())console.log("📋 FormData entry:",o,P);const t=setInterval(()=>{N(o=>{const P=o[e]||0;return P<90?{...o,[e]:P+Math.random()*20}:o})},200),i=await da(`/api/admin-wilayah/pengajuan/${u}/upload`,n,S);if(clearInterval(t),N(o=>({...o,[e]:100})),i.success){const o={id:i.data.id,pengajuan_id:u,file_type:e,file_name:s.name,file_path:i.data.file_path,file_size:s.size,verification_status:"pending",created_at:new Date().toISOString(),updated_at:new Date().toISOString()},P=[...y,o];if(b(P),j(P),l){const q=_.length,aa=P.filter(fa=>_.some(Pa=>Pa.file_type===fa.file_type)).length;l(aa,q)}R({title:"Success",description:`Upload berhasil: ${s.name}`,variant:"default",duration:3e3})}else R({title:"Error",description:i.message||"Gagal upload file",variant:"destructive",duration:3e3})}catch(n){console.error("Error uploading file:",n),R({title:"Error",description:"Gagal upload file",variant:"destructive",duration:3e3})}finally{x(n=>({...n,[e]:!1})),N(n=>({...n,[e]:0}))}},ca=async()=>{I(async()=>{Fa("SUBMIT_SUCCESS","File berhasil diajukan ke Superadmin"),B(!1)},()=>{},e=>{C("OPERATION_FAILED","Gagal mengajukan file ke Superadmin")})},ma=e=>{if(e===0)return"0 Bytes";const s=1024,n=["Bytes","KB","MB","GB"],t=Math.floor(Math.log(e)/Math.log(s));return parseFloat((e/Math.pow(s,t)).toFixed(2))+" "+n[t]},pa=e=>y.find(n=>n.file_type===e)?"uploaded":"pending",ga=e=>y.find(s=>s.file_type===e),Q=(e,s)=>{var t;return((t={Guru:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Madrasah":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Wakil Kepala Madrasah":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala TU":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Seksi":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Sub Bagian":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},"Kepala Urusan":{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},Staff:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"},Pelaksana:{surat_rekomendasi_kanwil:"Surat Rekomendasi dari Instansi Pembina - Permohonan Pindah Tugas ke Dirjen Pendis",surat_persetujuan_kepala_wilayah:"Surat Persetujuan Kepala Wilayah - Kemenag Provinsi",surat_pengantar_permohonan_rekomendasi:"Surat Pengantar - Permohonan Rekomendasi Pindah Tugas",surat_pernyataan_tidak_tugas_belajar:"Surat Pernyataan - Tidak Sedang Tugas Belajar atau Ikatan Dinas",surat_pernyataan_tidak_hukuman_disiplin:"Surat Pernyataan - Tidak Sedang Dijatuhi Hukuman Disiplin",surat_pernyataan_tidak_proses_pidana:"Surat Pernyataan - Tidak Sedang Proses Pidana atau Penjara",surat_pernyataan_tanggung_jawab_mutlak:"Surat Pernyataan Tanggung Jawab Mutlak (SPTJM)",surat_keterangan_bebas_temuan_inspektorat:"Surat Keterangan Bebas Temuan (SKBT)",hasil_evaluasi_pertimbangan_baperjakat:"Hasil Evaluasi dan Pertimbangan (BAPERJAKAT)",surat_rekomendasi_kanwil_khusus:"Surat Rekomendasi Khusus - Dari Kanwil Provinsi"}}[e])==null?void 0:t[s])||null},Z=e=>{const{file_type:s,display_name:n}=e;if(s==="surat_rekomendasi_kanwil")return Q(p,s)||"Surat Rekomendasi dari Instansi Pembina - Varian 6.1-6.9";const t=Q(p,s);return t||n},ha=async e=>{try{const s=await fetch(`/api/pengajuan/files/${e.id}`,{headers:{Authorization:`Bearer ${S}`}});if(!s.ok)throw new Error("Gagal mengambil file");const n=await s.blob(),t=URL.createObjectURL(n);window.open(t,"_blank"),setTimeout(()=>URL.revokeObjectURL(t),5e3)}catch{C("OPERATION_FAILED","Gagal membuka preview file")}},_a=async e=>{try{const s=await fetch(`/api/pengajuan/files/${e.id}`,{headers:{Authorization:`Bearer ${S}`}});if(!s.ok)throw new Error("Gagal mengambil file");const n=await s.blob(),t=URL.createObjectURL(n),i=document.createElement("a");i.href=t,i.download=e.file_name||"file.pdf",document.body.appendChild(i),i.click(),i.remove(),setTimeout(()=>URL.revokeObjectURL(t),5e3)}catch{Ua("Gagal mengunduh file")}},xa=e=>{const s=document.getElementById(`replace-${W(e)}`);s&&s.click()},ka=(e,s)=>{s.preventDefault(),s.stopPropagation(),g(e),h(!0)},ja=(e,s)=>{s.preventDefault(),s.stopPropagation(),s.currentTarget.contains(s.relatedTarget)||(g(null),h(!1))},ya=e=>{e.preventDefault(),e.stopPropagation()},ba=(e,s)=>{var t;s.preventDefault(),s.stopPropagation();const n=s.dataTransfer.files;if(n&&n.length>0){const i=n[0],o=[".pdf",".doc",".docx"],P="."+((t=i.name.split(".").pop())==null?void 0:t.toLowerCase());if(!o.includes(P)){C("INVALID_FILE_TYPE","Hanya file PDF, DOC, dan DOCX yang diizinkan"),g(null),h(!1);return}const q=e==="skp_2_tahun_terakhir"?1.6*1024*1024:500*1024;if(i.size>q){C("FILE_TOO_LARGE",`Ukuran file maksimal ${e==="skp_2_tahun_terakhir"?"1.6MB":"500KB"}`),g(null),h(!1);return}O(e,i)}g(null),h(!1)};return J?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"animate-pulse space-y-4",children:[a.jsx("div",{className:"h-6 bg-gray-200 rounded w-1/3"}),a.jsx("div",{className:"space-y-3",children:[...Array(5)].map((e,s)=>a.jsx("div",{className:"h-20 bg-gray-200 rounded"},s))})]})}):r?a.jsx("div",{className:"space-y-4",children:a.jsxs("div",{className:"text-center py-8",children:[a.jsx(Sa,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Error Loading Files"}),a.jsx("p",{className:"text-gray-600 mb-4",children:r}),a.jsxs(T,{onClick:f,className:"flex items-center gap-2",children:[a.jsx(ea,{className:"h-4 w-4"}),"Retry"]})]})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-xl font-semibold",children:"Upload File Admin Wilayah"}),a.jsxs(T,{onClick:()=>{f(),Y()},variant:"outline",size:"sm",children:[a.jsx(ea,{className:"h-4 w-4 mr-2"}),"Refresh"]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Dokumen Wajib Admin Wilayah"}),a.jsx("div",{className:"text-sm text-gray-600",children:`${_.filter(s=>y.some(n=>n.file_type===s.file_type)).length}/${_.length} berkas sudah diupload`})]}),a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-3",children:_.map(e=>{console.log("🔧 Rendering fileConfig:",e);const s=pa(e.file_type),n=ga(e.file_type);return a.jsx(G,{className:"border border-gray-200",children:a.jsx(V,{className:"p-3",children:a.jsxs("div",{className:"flex flex-col gap-3",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("h4",{className:"font-medium text-gray-900 text-sm leading-tight",title:Z(e),children:Z(e)}),e.is_required&&a.jsx(w,{variant:"destructive",className:"text-[10px] py-0 px-1.5",children:"Wajib"})]}),s==="uploaded"?a.jsxs(w,{className:"bg-green-600 text-white flex items-center gap-1 text-xs",children:[a.jsx($,{className:"h-3 w-3"}),"Uploaded"]}):a.jsxs(w,{variant:"secondary",className:"flex items-center gap-1 text-xs",children:[a.jsx(L,{className:"h-3 w-3"}),"Pending"]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("p",{className:"text-xs text-gray-500",children:["PDF (maks. ",e.file_type==="skp_2_tahun_terakhir"?"1.6MB":"500KB",")"]}),D[e.file_type]&&a.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[a.jsx("div",{className:"animate-spin h-3 w-3 border border-green-600 border-t-transparent rounded-full"}),a.jsxs("span",{className:"text-green-600",children:["Uploading... ",K[e.file_type]||0,"%"]})]}),s==="uploaded"&&n&&a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-1 text-green-600 text-xs",children:[a.jsx($,{className:"h-3 w-3"}),a.jsx("span",{className:"truncate",children:n.file_name}),a.jsxs("span",{className:"text-gray-500",children:["(",ma(n.file_size),")"]})]}),a.jsxs("div",{className:"flex gap-1",children:[a.jsx(T,{size:"sm",variant:"outline",onClick:()=>ha(n),className:"h-6 px-2 text-xs",children:a.jsx(wa,{className:"h-3 w-3"})}),a.jsx(T,{size:"sm",variant:"outline",onClick:()=>_a(n),className:"h-6 px-2 text-xs",children:a.jsx(va,{className:"h-3 w-3"})}),a.jsx(T,{size:"sm",variant:"outline",onClick:()=>xa(e.file_type),className:"h-6 px-2 text-xs",children:a.jsx(Na,{className:"h-3 w-3"})}),a.jsx("input",{id:`replace-${W(e.file_type)}`,type:"file",className:"hidden",accept:".pdf,.doc,.docx",onChange:t=>{var o;const i=(o=t.target.files)==null?void 0:o[0];i&&(O(e.file_type,i),t.target.value="")}})]})]}),s!=="uploaded"&&a.jsxs("div",{className:`relative border-2 border-dashed rounded-lg p-6 transition-all duration-200 cursor-pointer w-full h-32 ${m===e.file_type?"border-green-500 bg-green-50":"border-gray-300 hover:border-green-400 hover:bg-gray-50"} ${D[e.file_type]?"pointer-events-none opacity-50":""}`,onDragEnter:t=>ka(e.file_type,t),onDragLeave:t=>ja(e.file_type,t),onDragOver:ya,onDrop:t=>ba(e.file_type,t),onClick:()=>{const t=document.getElementById(`file-${W(e.file_type)}`);t&&!t.disabled&&!D[e.file_type]&&t.click()},children:[a.jsx("div",{className:"flex flex-col items-center justify-center h-full text-center",children:D[e.file_type]?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin h-6 w-6 border-2 border-green-600 border-t-transparent rounded-full mb-2"}),a.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Uploading..."})]}):m===e.file_type?a.jsxs(a.Fragment,{children:[a.jsx(sa,{className:"h-8 w-8 text-green-500 mb-2"}),a.jsx("p",{className:"text-sm text-green-600 font-medium",children:"Lepaskan file di sini"})]}):a.jsxs(a.Fragment,{children:[a.jsx(sa,{className:"h-6 w-6 text-gray-400 mb-2"}),a.jsx("p",{className:"text-xs text-gray-600 leading-tight",children:"Drag & drop file di sini atau klik untuk memilih"})]})}),a.jsx("input",{type:"file",accept:".pdf,.doc,.docx",onChange:t=>{var o;console.log("📁 File input changed:",t.target.files);const i=(o=t.target.files)==null?void 0:o[0];i?(console.log("📄 File selected:",i.name,"fileConfig.file_type:",e.file_type),O(e.file_type,i),t.target.value=""):console.log("❌ No file selected")},className:"hidden",id:`file-${W(e.file_type)}`})]})]})]})})},e.id)})})]}),(()=>{const e=_.every(n=>y.some(t=>t.file_type===n.file_type)),s=v==="submitted";return a.jsx("div",{className:"flex justify-end",children:e?a.jsxs(T,{onClick:()=>!s&&B(!0),className:"bg-green-600 hover:bg-green-700",disabled:U||s,children:[a.jsx(ra,{className:"h-4 w-4 mr-2"}),s?"Sudah Dikirim":"Ajukan ke Superadmin"]}):a.jsx("div",{className:"text-sm text-gray-500 text-center",children:"Tombol ajukan akan muncul setelah semua berkas wajib diupload"})})})(),a.jsx(Ha,{open:z,onOpenChange:B,children:a.jsxs(za,{children:[a.jsxs(Oa,{children:[a.jsx(qa,{children:"Ajukan ke Superadmin"}),a.jsx(Ga,{children:"Apakah Anda yakin ingin mengajukan semua file yang telah diupload ke Superadmin? Tindakan ini tidak dapat dibatalkan."})]}),a.jsxs(Va,{children:[a.jsx(Xa,{disabled:U,children:"Batal"}),a.jsx(Ya,{asChild:!0,children:a.jsx(oa,{onClick:ca,className:"bg-green-600 hover:bg-green-700",isProcessing:M,processingText:"Mengajukan...",children:"Ajukan"})})]})]})})]})},Za=({uploaded:u,total:p,isComplete:j,className:l=""})=>{const v=p>0?Math.round(u/p*100):0;return a.jsxs("div",{className:`bg-white border border-gray-200 rounded-lg p-4 ${l}`,children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Progress Upload Dokumen"}),a.jsxs("div",{className:"text-right",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:[u," dari ",p," dokumen"]}),a.jsxs("div",{className:"text-lg font-bold text-green-600",children:[v,"%"]})]})]}),a.jsx("div",{className:"mb-4",children:a.jsx(Ia,{value:v,className:"h-3 bg-gray-200"})}),a.jsxs("div",{className:"flex items-center gap-6 text-sm",children:[a.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[a.jsx($,{className:"h-4 w-4"}),a.jsxs("span",{children:[u," Terupload"]})]}),a.jsxs("div",{className:"flex items-center gap-2 text-gray-500",children:[a.jsx(Ta,{className:"h-4 w-4"}),a.jsxs("span",{children:[p-u," Belum"]})]}),j&&a.jsxs("div",{className:"flex items-center gap-2 text-green-600 font-medium",children:[a.jsx($,{className:"h-4 w-4"}),a.jsx("span",{children:"Upload Selesai"})]})]})]})},de=()=>{var I,M,J,E;const{pengajuanId:u}=Ra(),p=Ba(),{token:j}=la(),[l,v]=d.useState(null),[S,A]=d.useState(!0);d.useState(!1);const{submitForm:R,isSubmitting:_}=ua(),[H,y]=d.useState([]),[b,D]=d.useState(""),[x,K]=d.useState({required:0,total:0,isComplete:!1}),N=async()=>{var r,c;if(!(!j||!u)){A(!0);try{const m=await F(`/api/admin-wilayah/pengajuan/${u}`,j);if(m&&m.success!==!1){v(m.pengajuan||((r=m.data)==null?void 0:r.pengajuan)||m);const g=m.uploadProgress||((c=m.data)==null?void 0:c.uploadProgress);if(g){const k=Number(g.required??0),h=Number(g.total??0),f=typeof g.isComplete=="boolean"?g.isComplete:k>=h;K({required:k,total:h,isComplete:f})}else K({required:0,total:0,isComplete:!1})}else v(null),K({required:0,total:0,isComplete:!1})}catch(m){console.error("Failed to fetch pengajuan detail",m),v(null)}finally{A(!1)}}},z=async()=>{try{const r=await F("/api/admin-wilayah-file-config",j);if(r!=null&&r.success&&Array.isArray(r.data)){const c=new Map;r.data.forEach(g=>{var f;const k=g.jenis_jabatan_id,h=((f=g.jenis_jabatan)==null?void 0:f.jenis_jabatan)||`Jabatan ${k}`;k&&!c.has(k)&&c.set(k,h)});const m=Array.from(c.values());y(m),m.length>0&&!b&&D(m[0])}}catch(r){console.error("Failed to fetch job types:",r)}};d.useEffect(()=>{N(),z()},[u,j]);const B=r=>new Date(r).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),U=(r,c)=>{const m=(g,k)=>{var h;return g!=="submitted"||!k?!1:((h=k.files)==null?void 0:h.some(f=>f.file_category==="admin_wilayah"))||!1};switch(r){case"approved":return a.jsx(w,{className:"bg-green-600 text-white",children:"Disetujui Kab/Kota"});case"admin_wilayah_approved":return a.jsx(w,{className:"bg-green-700 text-white",children:"Disetujui Admin Wilayah"});case"admin_wilayah_rejected":return a.jsx(w,{className:"bg-red-600 text-white",children:"Ditolak Admin Wilayah"});case"submitted":return a.jsx(w,{className:"bg-blue-600 text-white",children:m(r,c)?"Diajukan Admin Wilayah":"Dikirim ke Superadmin"});default:return a.jsx(w,{className:"bg-gray-600 text-white",children:r})}},X=async()=>{!j||!u||R(async()=>{await da(`/api/admin-wilayah/pengajuan/${u}/submit-to-superadmin`,{},j),await N()},()=>{},r=>{console.error("Error submitting to superadmin:",r)})};return S?a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsx("div",{className:"max-w-6xl mx-auto",children:a.jsxs("div",{className:"animate-pulse space-y-6",children:[a.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),a.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})})}):l?a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[a.jsx($a,{title:"Upload File Admin Wilayah",subtitle:"Upload file tambahan untuk pengajuan mutasi pegawai",actions:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(w,{className:"bg-green-100 text-green-800",children:"Admin Wilayah"}),U(l.status,l),a.jsxs(T,{variant:"outline",onClick:()=>p("/admin-wilayah/dashboard"),className:"border-green-200 text-green-700 hover:bg-green-50",children:[a.jsx(na,{className:"h-4 w-4 mr-2"}),"Kembali"]})]})}),a.jsxs(G,{className:"border-green-200 bg-green-50",children:[a.jsx(ta,{children:a.jsxs(ia,{className:"text-green-800 flex items-center gap-2",children:[a.jsx(L,{className:"h-5 w-5"}),"Informasi Pengajuan"]})}),a.jsx(V,{children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Da,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold text-gray-900",children:((I=l.pegawai)==null?void 0:I.nama)||"-"}),a.jsxs("p",{className:"text-sm text-gray-600",children:["NIP: ",((M=l.pegawai)==null?void 0:M.nip)||"-"]})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Aa,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:((J=l.office)==null?void 0:J.kabkota)||"-"}),a.jsx("p",{className:"text-sm text-gray-600",children:((E=l.office)==null?void 0:E.name)||"-"})]})]})]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(L,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Jenis Jabatan"}),a.jsx("p",{className:"text-sm text-gray-600",children:l.jenis_jabatan})]})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(Ka,{className:"h-5 w-5 text-green-600"}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:"Tanggal Pengajuan"}),a.jsx("p",{className:"text-sm text-gray-600",children:B(l.created_at)})]})]})]})]})})]}),a.jsxs(G,{children:[a.jsx(ta,{children:a.jsx(ia,{className:"text-green-800",children:"Upload File Admin Wilayah"})}),a.jsxs(V,{children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pilih Jenis Berkas Admin Wilayah"}),a.jsxs(Ma,{value:b,onValueChange:D,children:[a.jsx(Ja,{className:"w-full max-w-md",children:a.jsx(Ca,{placeholder:"Pilih jenis berkas..."})}),a.jsx(Wa,{children:H.map(r=>a.jsx(La,{value:r,children:r},r))})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Pilih jenis berkas yang sudah dikonfigurasi oleh superadmin"})]}),b&&x.total>0&&a.jsx(Za,{uploaded:x.required,total:x.total,isComplete:x.isComplete,className:"mb-6"}),b&&a.jsx(Qa,{pengajuanId:l.id,jenisJabatanId:b,onFilesUploaded:()=>N(),onProgressChange:(r,c)=>K({required:r,total:c,isComplete:r>=c&&c>0}),pengajuanStatus:l.status})]})]}),a.jsx("div",{className:"flex items-center justify-end gap-3",children:(l.status==="approved"||l.status==="submitted")&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{className:"text-sm text-gray-600 mr-2",children:[x.required,"/",x.total," berkas wajib"]}),a.jsxs(oa,{onClick:X,className:"bg-green-600 hover:bg-green-700 text-white",isProcessing:_||l.status==="submitted"||x.required<x.total,processingText:"Mengirim...",children:[a.jsx(ra,{className:"h-4 w-4 mr-2"}),l.status==="submitted"?"Sudah Dikirim":"Submit ke Superadmin"]})]})})]})}):a.jsx("div",{className:"min-h-screen bg-background p-6",children:a.jsx("div",{className:"max-w-6xl mx-auto",children:a.jsxs("div",{className:"text-center py-12",children:[a.jsx(L,{className:"h-16 w-16 mx-auto text-gray-300 mb-4"}),a.jsx("h2",{className:"text-2xl font-semibold text-gray-900 mb-2",children:"Pengajuan Tidak Ditemukan"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"Pengajuan yang Anda cari tidak ditemukan atau tidak memiliki akses."}),a.jsxs(T,{onClick:()=>p("/admin-wilayah/dashboard"),className:"bg-green-600 hover:bg-green-700 text-white",children:[a.jsx(na,{className:"h-4 w-4 mr-2"}),"Kembali ke Dashboard"]})]})})})};export{de as default};
//# sourceMappingURL=AdminWilayahUploadPage-JJ96TPOq.js.map
