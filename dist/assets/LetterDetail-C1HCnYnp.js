import{j as e,Z as A,a0 as H}from"./ui-vendor-BCnv6AUJ.js";import{g as K,r as m,L as p}from"./react-vendor-C8WR5ETM.js";import{u as O,d as I,a as v,S as w,B as f,b as y,k as P}from"./index-JbRs92HN.js";import{C as u,a as g,b,c as N}from"./card-Cs6QZd4w.js";import{T as R,a as z,b as M,c as U,d as Z,e as q,f as Q,g as V,h as W}from"./Template9-CiBdko-9.js";import{T as X,a as Y,b as _,c as o,d as ee,e as d}from"./table-CH8ZCvzV.js";import{S as n}from"./SuratPreviewContainer-4J1Y0q5m.js";const de=()=>{const{id:x}=K(),{token:c}=O(),[t,C]=m.useState(null),[D,B]=m.useState([]),[L,k]=m.useState(!0),[S,F]=m.useState(null),[l,h]=m.useState([]),{toast:j}=I();if(m.useEffect(()=>{!c||!x||(k(!0),v(`/api/letters/${x}`,c).then(a=>{var s;C(a.letter),(s=a.letter)!=null&&s.recipient_employee_nip&&v(`/api/letters?recipient_employee_nip=${a.letter.recipient_employee_nip}`,c).then(r=>B(r.letters||[]))}).catch(()=>F("Surat tidak ditemukan")).finally(()=>k(!1)))},[x,c]),L)return e.jsxs("div",{className:"flex justify-center items-center min-h-screen",children:[e.jsx(w,{className:"h-10 w-1/2"}),e.jsx(w,{className:"h-96 w-full mt-8"})]});if(S||!t)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen",children:[e.jsx("div",{className:"text-error mb-4",children:S||"Surat tidak ditemukan"}),e.jsx(p,{to:"/dashboard",className:"btn btn-primary",children:"Kembali ke Dashboard"})]});let i=t.form_data;if(typeof i=="string")try{i=JSON.parse(i)}catch{i={}}const $=a=>{var r;let s=a.form_data;if(typeof s=="string")try{s=JSON.parse(s)}catch{s={}}return s={...s,office:a.office,kode_kabko:((r=a.office)==null?void 0:r.kode_kabko)||s.kode_kabko,letter_number:a.letter_number,...a},s?String(a.template_id)==="1"?e.jsx(n,{children:e.jsx(R,{data:s})}):String(a.template_id)==="2"?e.jsx(n,{children:e.jsx(z,{data:s})}):String(a.template_id)==="3"?e.jsx(n,{children:e.jsx(M,{data:s})}):String(a.template_id)==="4"?e.jsx(n,{children:e.jsx(U,{data:s})}):String(a.template_id)==="5"?e.jsx(n,{children:e.jsx(Z,{data:s})}):String(a.template_id)==="6"?e.jsx(n,{children:e.jsx(q,{data:s})}):String(a.template_id)==="7"?e.jsx(n,{children:e.jsx(Q,{data:s})}):String(a.template_id)==="8"?e.jsx(n,{children:e.jsx(V,{data:s})}):String(a.template_id)==="9"?e.jsx(n,{children:e.jsx(W,{data:s})}):e.jsx("div",{className:"text-error",children:"Template tidak dikenali"}):e.jsx("div",{className:"text-error",children:"Data surat tidak ditemukan"})},G=async()=>{if(!c||l.length===0)return;j({title:"Memulai generate PDF batch...",description:`${l.length} surat diproses.`});let a=0,s=0;for(const r of l)try{await P(`/api/letters/${r}/generate-pdf`,{},c),a++}catch{s++}j({title:"Batch PDF selesai",description:`${a} sukses, ${s} gagal.`}),h([])},T=D.filter(a=>a.recipient_employee_nip===t.recipient_employee_nip);return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"max-w-6xl mx-auto p-4 md:p-8 space-y-8",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(f,{asChild:!0,variant:"outline",size:"sm",children:e.jsxs(p,{to:"/dashboard",children:[e.jsx(A,{className:"w-4 h-4 mr-1"})," Kembali"]})}),e.jsxs("h1",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(H,{className:"w-6 h-6 text-green-700"})," Detail Surat"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(b,{children:"Informasi Surat"})}),e.jsxs(N,{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Nomor Surat:"})," ",t.letter_number]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Tanggal:"})," ",i.tanggal]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Template:"})," ",t.template_name]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Status:"})," ",e.jsx(y,{children:t.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Pegawai:"})," ",i.namapegawai," (",t.recipient_employee_nip,")"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Pejabat Penandatangan:"})," ",i.namapejabat," (",t.signing_official_nip,")"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Unit Kerja Pegawai:"})," ",i.unitkerja||i.ukerpegawai]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Jabatan Pegawai:"})," ",i.jabatanpegawai]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:"Pangkat/Golongan Pegawai:"})," ",i.pangkatgolpegawai]}),e.jsx("div",{className:"pt-4",children:e.jsx(f,{onClick:async()=>{await P(`/api/letters/${t.id}/generate-pdf`,{},c),j({title:"PDF berhasil digenerate",description:"Silakan cek file surat."})},children:"Generate PDF"})})]})]}),e.jsxs(u,{children:[e.jsx(g,{children:e.jsx(b,{children:"Preview Surat"})}),e.jsx(N,{children:e.jsx("div",{className:"overflow-x-auto max-h-[500px]",children:$(t)})})]})]}),e.jsxs(u,{children:[e.jsxs(g,{children:[e.jsx(b,{children:"Daftar Surat Pegawai Ini"}),l.length>0&&e.jsxs(f,{className:"mt-2",onClick:G,children:["Generate PDF Batch (",l.length,")"]})]}),e.jsx(N,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(X,{children:[e.jsx(Y,{children:e.jsxs(_,{children:[e.jsx(o,{}),e.jsx(o,{children:"No."}),e.jsx(o,{children:"Nomor Surat"}),e.jsx(o,{children:"Template"}),e.jsx(o,{children:"Tanggal"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Aksi"})]})}),e.jsx(ee,{children:T.length===0?e.jsx(_,{children:e.jsx(d,{colSpan:7,className:"text-center",children:"Tidak ada surat lain"})}):T.map((a,s)=>{var r;return e.jsxs(_,{className:a.id===t.id?"bg-green-50 font-semibold":"",children:[e.jsx(d,{children:e.jsx("input",{type:"checkbox",checked:l.includes(a.id),onChange:E=>{E.target.checked?h([...l,a.id]):h(l.filter(J=>J!==a.id))}})}),e.jsx(d,{children:s+1}),e.jsx(d,{children:a.letter_number}),e.jsx(d,{children:a.template_name}),e.jsx(d,{children:typeof a.form_data=="string"?(()=>{try{return JSON.parse(a.form_data).tanggal}catch{return"-"}})():(r=a.form_data)==null?void 0:r.tanggal}),e.jsx(d,{children:e.jsx(y,{children:a.status})}),e.jsx(d,{children:a.id!==t.id&&e.jsx(p,{to:`/letters/${a.id}`,className:"btn btn-xs btn-outline",children:"Lihat"})})]},a.id)})})]})})})]})]})})};export{de as default};
//# sourceMappingURL=LetterDetail-C1HCnYnp.js.map
