import{j as e,a4 as ye,ar as Ce,a8 as ke,a9 as P,as as De,at as Se,aC as q,E as K,x as U,aI as T,a2 as J}from"./ui-vendor-B7g5fNgE.js";import{r as t}from"./react-vendor-BNG1zHOu.js";import{u as _e,a as Ae,t as m,B as r,I as h,b as Pe,D as Q,e as X,f as Y,g as Z,h as ee,i as se,j as Ue,c as Te,l as Le}from"./index-yKRLyRCw.js";import{L as d}from"./label-DVYofOmq.js";import{S as ae,a as le,b as te,c as re,d as c}from"./select-lvB8wQSz.js";import{T as Me,a as Ee,b as R,c as v,d as Be,e as g}from"./table-C2JZBiFo.js";import{A as Fe,a as Ie,b as Re,c as ze,d as Ge,e as Oe,g as He,f as We}from"./alert-dialog-CeHjzyti.js";import{C as ie,c as ne,a as Ve,b as $e,d as qe}from"./card-D92NyER7.js";const as=()=>{const{user:L,token:x}=_e(),[oe,de]=t.useState([]),[ce,z]=t.useState(!0),[N,he]=t.useState(""),[me,y]=t.useState(!1),[xe,C]=t.useState(!1),[ue,M]=t.useState(!1),[u,E]=t.useState(null),[a,i]=t.useState({email:"",full_name:"",password:"",role:"user",office_id:""}),[j,G]=t.useState(!1),[f,D]=t.useState(!1),[pe,O]=t.useState(!1),[ge,B]=t.useState(null),[H,F]=t.useState(""),[w,S]=t.useState(!1),je=()=>{const n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let p="";const o="abcdefghijklmnopqrstuvwxyz",l="ABCDEFGHIJKLMNOPQRSTUVWXYZ",A="0123456789",k="!@#$%^&*";p+=o[Math.floor(Math.random()*o.length)],p+=l[Math.floor(Math.random()*l.length)],p+=A[Math.floor(Math.random()*A.length)],p+=k[Math.floor(Math.random()*k.length)];for(let b=4;b<12;b++)p+=n[Math.floor(Math.random()*n.length)];return p.split("").sort(()=>Math.random()-.5).join("")},_=async s=>{if(!s){m({title:"Gagal menyalin",description:"Password kosong",variant:"destructive"});return}const n=o=>{try{const l=document.createElement("textarea");if(l.value=o,l.style.position="fixed",l.style.left="0",l.style.top="0",l.style.opacity="0",l.style.pointerEvents="none",l.setAttribute("readonly",""),document.body.appendChild(l),navigator.userAgent.match(/ipad|iphone/i)){const k=document.createRange();k.selectNodeContents(l);const b=window.getSelection();b&&(b.removeAllRanges(),b.addRange(k)),l.setSelectionRange(0,999999)}else l.select();const A=document.execCommand("copy");return document.body.removeChild(l),A}catch(l){return console.error("Fallback copy failed:",l),!1}};try{if(navigator.clipboard&&window.isSecureContext){await navigator.clipboard.writeText(s),S(!0),m({title:"Password disalin",description:"Password telah disalin ke clipboard"}),setTimeout(()=>S(!1),2e3);return}}catch(o){console.warn("Clipboard API failed, trying fallback:",o)}if(n(s))S(!0),m({title:"Password disalin",description:"Password telah disalin ke clipboard"}),setTimeout(()=>S(!1),2e3);else{m({title:"Gagal menyalin otomatis",description:"Silakan salin password secara manual dari field password",variant:"destructive",duration:5e3});const o=document.querySelector('input[type="password"], input[type="text"][id*="password"]');o&&(o.focus(),o.select())}},W=()=>{const s=je();i({...a,password:s}),m({title:"Password di-generate",description:"Password secure telah di-generate"})};if((L==null?void 0:L.role)!=="admin")return e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx(ie,{children:e.jsx(ne,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-xl font-semibold text-red-600 mb-2",children:"Akses Ditolak"}),e.jsx("p",{className:"text-gray-600",children:"Anda tidak memiliki akses ke halaman ini."})]})})})});t.useEffect(()=>{I()},[]);const I=async()=>{if(x){z(!0);try{const s=await Ae("/api/users",x);de(s.users||[])}catch(s){console.error("Failed to fetch users:",s),m({title:"Error",description:"Gagal mengambil data user",variant:"destructive"})}finally{z(!1)}}},fe=()=>{i({email:"",full_name:"",password:"",role:"user",office_id:""}),y(!0)},we=s=>{E(s),i({email:s.email,full_name:s.full_name,password:"",role:s.role,office_id:s.office_id||""}),C(!0)},be=s=>{E(s),M(!0)},V=async(s=!1)=>{if(x){D(!0);try{if(s&&u){const n={...a};n.password||delete n.password,await Ue(`/api/users/${u.id}`,n,x),B(!0),F("User berhasil diperbarui.")}else await Te("/api/users",a,x),B(!0),F("User berhasil ditambahkan.");I(),y(!1),C(!1),i({email:"",full_name:"",password:"",role:"user",office_id:""})}catch(n){B(!1),F((n==null?void 0:n.message)||"Gagal menyimpan user.")}finally{D(!1),y(!1),C(!1),O(!0)}}},ve=async()=>{if(!(!x||!u)){D(!0);try{await Le(`/api/users/${u.id}`,x),m({title:"Sukses",description:"User berhasil dihapus"}),I(),M(!1),E(null)}catch(s){console.error("Failed to delete user:",s),m({title:"Error",description:"Gagal menghapus user",variant:"destructive"})}finally{D(!1)}}},$=oe.filter(s=>s.full_name.toLowerCase().includes(N.toLowerCase())||s.email.toLowerCase().includes(N.toLowerCase())||s.role.toLowerCase().includes(N.toLowerCase())),Ne=s=>{switch(s){case"admin":return"bg-red-100 text-red-800";case"operator":return"bg-blue-100 text-blue-800";case"user":return"bg-green-100 text-green-800";case"admin_wilayah":return"bg-purple-100 text-purple-800";case"bimas":return"bg-orange-100 text-orange-800";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[pe&&e.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/20 backdrop-blur-sm animate-in fade-in-0 duration-200",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl p-8 max-w-sm w-full flex flex-col items-center animate-in zoom-in-95 duration-200",children:[ge?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-10 h-10 text-green-600",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Berhasil"}),e.jsx("p",{className:"text-gray-600 mb-6 text-center",children:H})]}):e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:e.jsx("svg",{className:"w-10 h-10 text-red-600",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})}),e.jsx("h2",{className:"text-2xl font-bold mb-2 text-gray-900",children:"Gagal"}),e.jsx("p",{className:"text-gray-600 mb-6 text-center",children:H})]}),e.jsx("button",{className:"w-full py-3 rounded-lg bg-green-600 hover:bg-green-700 text-white text-lg font-semibold shadow transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-green-400",onClick:()=>O(!1),children:"Tutup"})]})}),e.jsxs(ie,{children:[e.jsx(Ve,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs($e,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"w-5 h-5"}),"Management User"]}),e.jsx(qe,{children:"Kelola user dan akses sistem"})]}),e.jsxs(r,{onClick:fe,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(Ce,{className:"w-4 h-4 mr-2"}),"Tambah User"]})]})}),e.jsxs(ne,{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(ke,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(h,{placeholder:"Cari user...",value:N,onChange:s=>he(s.target.value),className:"pl-10"})]})}),ce?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx(P,{className:"w-6 h-6 animate-spin mr-2 text-green-600"}),e.jsx("span",{children:"Loading users..."})]}):e.jsx("div",{className:"border rounded-lg",children:e.jsxs(Me,{children:[e.jsx(Ee,{children:e.jsxs(R,{children:[e.jsx(v,{children:"Nama"}),e.jsx(v,{children:"Email"}),e.jsx(v,{children:"Role"}),e.jsx(v,{children:"Office ID"}),e.jsx(v,{children:"Created At"}),e.jsx(v,{className:"text-right",children:"Aksi"})]})}),e.jsx(Be,{children:$.length===0?e.jsx(R,{children:e.jsx(g,{colSpan:6,className:"text-center py-8 text-gray-500",children:N?"Tidak ada user yang ditemukan":"Belum ada user"})}):$.map(s=>e.jsxs(R,{children:[e.jsx(g,{className:"font-medium",children:s.full_name}),e.jsx(g,{children:s.email}),e.jsx(g,{children:e.jsx(Pe,{className:Ne(s.role),children:s.role})}),e.jsx(g,{children:s.office_id||"-"}),e.jsx(g,{children:s.created_at?new Date(s.created_at).toLocaleDateString("id-ID"):"-"}),e.jsx(g,{className:"text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx(r,{variant:"outline",size:"sm",onClick:()=>we(s),children:e.jsx(De,{className:"w-4 h-4"})}),e.jsx(r,{variant:"outline",size:"sm",onClick:()=>be(s),className:"text-red-600 hover:text-red-700",children:e.jsx(Se,{className:"w-4 h-4"})})]})})]},s.id))})]})})]})]}),e.jsx(Q,{open:me,onOpenChange:y,children:e.jsxs(X,{className:"sm:max-w-md",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Tambah User Baru"}),e.jsx(ee,{children:"Masukkan informasi user yang akan ditambahkan ke sistem."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"email",children:"Email"}),e.jsx(h,{id:"email",type:"email",value:a.email,onChange:s=>i({...a,email:s.target.value}),placeholder:"user@example.com"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"full_name",children:"Nama Lengkap"}),e.jsx(h,{id:"full_name",value:a.full_name,onChange:s=>i({...a,full_name:s.target.value}),placeholder:"Nama lengkap user"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(h,{id:"password",type:j?"text":"password",value:a.password,onChange:s=>i({...a,password:s.target.value}),placeholder:"Password"}),e.jsxs("div",{className:"absolute right-0 top-0 h-full flex items-center gap-1 pr-2",children:[e.jsx(r,{type:"button",variant:"ghost",size:"sm",className:"h-full px-2 hover:bg-transparent",onClick:()=>G(!j),children:j?e.jsx(q,{className:"h-4 w-4"}):e.jsx(K,{className:"h-4 w-4"})}),a.password&&e.jsx(r,{type:"button",variant:"ghost",size:"sm",className:"h-full px-2 hover:bg-transparent",onClick:()=>_(a.password),children:w?e.jsx(U,{className:"h-4 w-4 text-green-600"}):e.jsx(T,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{type:"button",variant:"outline",size:"sm",onClick:W,className:"flex items-center gap-2 border-green-600 text-green-600 hover:bg-green-50",children:[e.jsx(J,{className:"h-4 w-4"}),"Generate Password"]}),a.password&&e.jsxs(r,{type:"button",variant:"outline",size:"sm",onClick:()=>_(a.password),className:"flex items-center gap-2 border-blue-600 text-blue-600 hover:bg-blue-50",children:[w?e.jsx(U,{className:"h-4 w-4"}):e.jsx(T,{className:"h-4 w-4"}),w?"Disalin!":"Copy Password"]})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"role",children:"Role"}),e.jsxs(ae,{value:a.role,onValueChange:s=>i({...a,role:s}),children:[e.jsx(le,{children:e.jsx(te,{placeholder:"Pilih role"})}),e.jsxs(re,{children:[e.jsx(c,{value:"user",children:"User"}),e.jsx(c,{value:"operator",children:"Operator"}),e.jsx(c,{value:"admin",children:"Admin"}),e.jsx(c,{value:"admin_wilayah",children:"Admin Wilayah"}),e.jsx(c,{value:"bimas",children:"Bimas"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"office_id",children:"Office ID"}),e.jsx(h,{id:"office_id",value:a.office_id,onChange:s=>i({...a,office_id:s.target.value}),placeholder:"ID kantor (opsional)"})]})]}),e.jsxs(se,{children:[e.jsx(r,{variant:"outline",onClick:()=>y(!1),children:"Batal"}),e.jsxs(r,{onClick:()=>V(!1),disabled:f||!a.email||!a.full_name||!a.password,className:"bg-green-600 hover:bg-green-700",children:[f?e.jsx(P,{className:"w-4 h-4 animate-spin mr-2 text-white"}):null,"Tambah User"]})]})]})}),e.jsx(Q,{open:xe,onOpenChange:C,children:e.jsxs(X,{className:"sm:max-w-md",children:[e.jsxs(Y,{children:[e.jsx(Z,{children:"Edit User"}),e.jsx(ee,{children:"Perbarui informasi user."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit-email",children:"Email"}),e.jsx(h,{id:"edit-email",type:"email",value:a.email,onChange:s=>i({...a,email:s.target.value}),placeholder:"user@example.com"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit-full_name",children:"Nama Lengkap"}),e.jsx(h,{id:"edit-full_name",value:a.full_name,onChange:s=>i({...a,full_name:s.target.value}),placeholder:"Nama lengkap user"})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit-password",children:"Password Baru (opsional)"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx(h,{id:"edit-password",type:j?"text":"password",value:a.password,onChange:s=>i({...a,password:s.target.value}),placeholder:"Kosongkan jika tidak ingin mengubah password"}),e.jsxs("div",{className:"absolute right-0 top-0 h-full flex items-center gap-1 pr-2",children:[e.jsx(r,{type:"button",variant:"ghost",size:"sm",className:"h-full px-2 hover:bg-transparent",onClick:()=>G(!j),children:j?e.jsx(q,{className:"h-4 w-4"}):e.jsx(K,{className:"h-4 w-4"})}),a.password&&e.jsx(r,{type:"button",variant:"ghost",size:"sm",className:"h-full px-2 hover:bg-transparent",onClick:()=>_(a.password),children:w?e.jsx(U,{className:"h-4 w-4 text-green-600"}):e.jsx(T,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(r,{type:"button",variant:"outline",size:"sm",onClick:W,className:"flex items-center gap-2 border-green-600 text-green-600 hover:bg-green-50",children:[e.jsx(J,{className:"h-4 w-4"}),"Generate Password"]}),a.password&&e.jsxs(r,{type:"button",variant:"outline",size:"sm",onClick:()=>_(a.password),className:"flex items-center gap-2 border-blue-600 text-blue-600 hover:bg-blue-50",children:[w?e.jsx(U,{className:"h-4 w-4"}):e.jsx(T,{className:"h-4 w-4"}),w?"Disalin!":"Copy Password"]})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit-role",children:"Role"}),e.jsxs(ae,{value:a.role,onValueChange:s=>i({...a,role:s}),children:[e.jsx(le,{children:e.jsx(te,{placeholder:"Pilih role"})}),e.jsxs(re,{children:[e.jsx(c,{value:"user",children:"User"}),e.jsx(c,{value:"operator",children:"Operator"}),e.jsx(c,{value:"admin",children:"Admin"}),e.jsx(c,{value:"admin_wilayah",children:"Admin Wilayah"}),e.jsx(c,{value:"bimas",children:"Bimas"})]})]})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:"edit-office_id",children:"Office ID"}),e.jsx(h,{id:"edit-office_id",value:a.office_id,onChange:s=>i({...a,office_id:s.target.value}),placeholder:"ID kantor (opsional)"})]})]}),e.jsxs(se,{children:[e.jsx(r,{variant:"outline",onClick:()=>C(!1),children:"Batal"}),e.jsxs(r,{onClick:()=>V(!0),disabled:f||!a.email||!a.full_name,className:"bg-green-600 hover:bg-green-700 text-white",children:[f?e.jsx(P,{className:"w-4 h-4 animate-spin mr-2 text-white"}):null,"Update User"]})]})]})}),e.jsx(Fe,{open:ue,onOpenChange:M,children:e.jsxs(Ie,{children:[e.jsxs(Re,{children:[e.jsx(ze,{children:"Hapus User"}),e.jsxs(Ge,{children:['Apakah Anda yakin ingin menghapus user "',u==null?void 0:u.full_name,'"? Tindakan ini tidak dapat dibatalkan.']})]}),e.jsxs(Oe,{children:[e.jsx(He,{children:"Batal"}),e.jsxs(We,{onClick:ve,disabled:f,className:"bg-red-600 hover:bg-red-700",children:[f?e.jsx(P,{className:"w-4 h-4 animate-spin mr-2 text-white"}):null,"Hapus"]})]})]})})]})};export{as as default};
//# sourceMappingURL=Users-CKYIp7nm.js.map
