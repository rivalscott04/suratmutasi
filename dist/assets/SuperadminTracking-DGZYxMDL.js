import{j as e,F as N,a3 as S,ak as h,aw as p,a8 as V,bh as C,a1 as z,al as T,aa as L,E as K,T as q}from"./ui-vendor-sDPVfCnv.js";import{r as c}from"./react-vendor-BNG1zHOu.js";import{u as Q,d as W,a as X,I as Y,b as r,B as Z,D as $,e as ee,f as se,g as ae}from"./index-BfFoZe-y.js";import{C as l,c as n}from"./card-gcIfCSez.js";import{P}from"./PageHeader-DxtRMcFK.js";const re=()=>{var _;const{user:j,token:E}=Q(),{toast:B}=W(),[I,A]=c.useState([]),[O,f]=c.useState(!0),[d,F]=c.useState(""),[t,M]=c.useState(null),[G,v]=c.useState(!1),[m,H]=c.useState({total:0,completed:0,inProgress:0,overdue:0});c.useEffect(()=>{J()},[]);const J=async()=>{try{f(!0);const a=(j==null?void 0:j.office_id)===null?"/api/tracking/superadmin":"/api/tracking/admin",i=await X(a,E);i.success&&(A(i.data),R(i.data))}catch(s){console.error("Error loading tracking data:",s),B({title:"Error",description:"Gagal memuat data tracking",variant:"destructive"})}finally{f(!1)}},R=s=>{const a=s.length;let i=0,k=0,D=0;s.forEach(g=>{if(g.tracking&&g.tracking.length>0){const o=g.tracking[0];if(o.status_name.includes("Selesai"))i++;else if(k++,o.estimated_days){const u=new Date(o.created_at);u.setDate(u.getDate()+o.estimated_days),new Date>u&&D++}}}),H({total:a,completed:i,inProgress:k,overdue:D})},U=s=>{M(s),v(!0)},y=I.filter(s=>{var a;return s.pegawai_nip.toLowerCase().includes(d.toLowerCase())||s.jenis_jabatan.toLowerCase().includes(d.toLowerCase())||((a=s.office)==null?void 0:a.kabkota.toLowerCase().includes(d.toLowerCase()))}),b=s=>s.includes("Selesai")?"default":s.includes("Diproses")?"secondary":s.includes("Disposisi")?"outline":"secondary",w=s=>s.includes("Selesai")?e.jsx(S,{className:"h-4 w-4 text-green-600"}):s.includes("Diproses")?e.jsx(h,{className:"h-4 w-4 text-blue-600"}):s.includes("Disposisi")?e.jsx(q,{className:"h-4 w-4 text-orange-600"}):e.jsx(p,{className:"h-4 w-4 text-gray-600"}),x=s=>{if(!s.estimated_days)return!1;const a=new Date(s.created_at);return a.setDate(a.getDate()+s.estimated_days),new Date>a&&!s.status_name.includes("Selesai")};return O?e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx(P,{title:"Tracking Dokumen",subtitle:"Monitor progress berkas di pusat"}),e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,a)=>e.jsx(l,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"animate-pulse space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"})]})})},a))})]}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx(P,{title:"Tracking Dokumen",subtitle:"Monitor progress berkas di pusat"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[e.jsx(l,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Berkas"}),e.jsx("p",{className:"text-2xl font-bold",children:m.total})]})]})})}),e.jsx(l,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(S,{className:"h-8 w-8 text-green-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Selesai"}),e.jsx("p",{className:"text-2xl font-bold",children:m.completed})]})]})})}),e.jsx(l,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(h,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Dalam Proses"}),e.jsx("p",{className:"text-2xl font-bold",children:m.inProgress})]})]})})}),e.jsx(l,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(p,{className:"h-8 w-8 text-red-600"}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Terlambat"}),e.jsx("p",{className:"text-2xl font-bold",children:m.overdue})]})]})})})]}),e.jsx(l,{className:"mb-6",children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx(Y,{placeholder:"Cari berdasarkan NIP, jenis jabatan, atau kabupaten...",value:d,onChange:s=>F(s.target.value),className:"pl-10"})]})})}),e.jsx("div",{className:"space-y-4",children:y.length===0?e.jsx(l,{children:e.jsxs(n,{className:"p-6 text-center",children:[e.jsx(N,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Tidak ada data tracking"})]})}):y.map(s=>{var i;const a=s.tracking&&s.tracking.length>0?s.tracking[0]:null;return e.jsx(l,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-2",children:[e.jsx("h3",{className:"font-semibold text-lg",children:s.pegawai_nip}),e.jsx(r,{variant:"outline",children:s.jenis_jabatan}),a&&e.jsxs("div",{className:"flex items-center gap-2",children:[w(a.status_name),e.jsx(r,{variant:b(a.status_name),className:x(a)?"border-red-500 text-red-700":"",children:a.status_name}),x(a)&&e.jsxs(r,{variant:"destructive",className:"text-xs",children:[e.jsx(C,{className:"h-3 w-3 mr-1"}),"Terlambat"]})]})]}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-600 mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4"}),((i=s.office)==null?void 0:i.kabkota)||"N/A"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-4 w-4"}),s.total_dokumen," dokumen"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4"}),new Date(s.final_approved_at).toLocaleDateString("id-ID")]}),a&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-4 w-4"}),a.tracked_by_name]})]}),a&&e.jsx("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Catatan: "}),e.jsx("span",{className:"text-gray-600",children:a.notes||"Tidak ada catatan"})]}),a.estimated_days&&e.jsxs("div",{className:"flex items-center gap-1 text-gray-600",children:[e.jsx(h,{className:"h-3 w-3"}),"Estimasi: ",a.estimated_days," hari"]})]})})]}),e.jsx("div",{className:"flex gap-2",children:e.jsxs(Z,{onClick:()=>U(s),size:"sm",variant:"outline",className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-4 w-4"}),"Lihat Detail"]})})]})})},s.id)})}),e.jsx($,{open:G,onOpenChange:v,children:e.jsxs(ee,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsx(se,{children:e.jsx(ae,{children:"Detail Tracking"})}),t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg",children:[e.jsx("h3",{className:"font-semibold text-lg mb-2",children:t.pegawai_nip}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Jenis Jabatan:"}),e.jsx("p",{className:"text-gray-600",children:t.jenis_jabatan})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Kabupaten:"}),e.jsx("p",{className:"text-gray-600",children:((_=t.office)==null?void 0:_.kabkota)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Total Dokumen:"}),e.jsx("p",{className:"text-gray-600",children:t.total_dokumen})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Final Approved:"}),e.jsx("p",{className:"text-gray-600",children:new Date(t.final_approved_at).toLocaleDateString("id-ID")})]})]})]}),t.tracking&&t.tracking.length>0?e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-4",children:"Riwayat Tracking"}),e.jsx("div",{className:"space-y-3",children:t.tracking.map((s,a)=>e.jsx(l,{children:e.jsx(n,{className:"p-4",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[w(s.status_name),e.jsx(r,{variant:b(s.status_name),className:x(s)?"border-red-500 text-red-700":"",children:s.status_name}),x(s)&&e.jsxs(r,{variant:"destructive",className:"text-xs",children:[e.jsx(C,{className:"h-3 w-3 mr-1"}),"Terlambat"]})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-3 w-3"}),s.tracked_by_name]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-3 w-3"}),new Date(s.created_at).toLocaleString("id-ID")]}),s.estimated_days&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"h-3 w-3"}),"Estimasi: ",s.estimated_days," hari"]}),s.notes&&e.jsxs("div",{className:"mt-2",children:[e.jsx("span",{className:"font-medium",children:"Catatan:"}),e.jsx("p",{className:"text-gray-600",children:s.notes})]})]})]})})})},s.id))})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(p,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:"Belum ada tracking untuk berkas ini"})]})]})]})})]})};export{re as default};
//# sourceMappingURL=SuperadminTracking-DGZYxMDL.js.map
